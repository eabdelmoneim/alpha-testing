(function(De,ht){typeof exports=="object"&&typeof module<"u"?ht(exports):typeof define=="function"&&define.amd?define(["exports"],ht):(De=typeof globalThis<"u"?globalThis:De||self,ht(De["@walletconnect/sign-client"]={}))})(this,function(De){"use strict";var ht=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function kt(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var ft={exports:{}},cr=typeof Reflect=="object"?Reflect:null,Wn=cr&&typeof cr.apply=="function"?cr.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},Jr;cr&&typeof cr.ownKeys=="function"?Jr=cr.ownKeys:Object.getOwnPropertySymbols?Jr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Jr=function(e){return Object.getOwnPropertyNames(e)};function lc(t){console&&console.warn&&console.warn(t)}var Yn=Number.isNaN||function(e){return e!==e};function Oe(){Oe.init.call(this)}ft.exports=Oe,ft.exports.once=pc,Oe.EventEmitter=Oe,Oe.prototype._events=void 0,Oe.prototype._eventsCount=0,Oe.prototype._maxListeners=void 0;var Xn=10;function Qr(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Oe,"defaultMaxListeners",{enumerable:!0,get:function(){return Xn},set:function(t){if(typeof t!="number"||t<0||Yn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");Xn=t}}),Oe.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Oe.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||Yn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function Jn(t){return t._maxListeners===void 0?Oe.defaultMaxListeners:t._maxListeners}Oe.prototype.getMaxListeners=function(){return Jn(this)},Oe.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var a;if(r.length>0&&(a=r[0]),a instanceof Error)throw a;var c=new Error("Unhandled error."+(a?" ("+a.message+")":""));throw c.context=a,c}var h=s[e];if(h===void 0)return!1;if(typeof h=="function")Wn(h,this,r);else for(var l=h.length,f=rs(h,l),i=0;i<l;++i)Wn(f[i],this,r);return!0};function Qn(t,e,r,i){var n,s,a;if(Qr(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),a=s[e]),a===void 0)a=s[e]=r,++t._eventsCount;else if(typeof a=="function"?a=s[e]=i?[r,a]:[a,r]:i?a.unshift(r):a.push(r),n=Jn(t),n>0&&a.length>n&&!a.warned){a.warned=!0;var c=new Error("Possible EventEmitter memory leak detected. "+a.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");c.name="MaxListenersExceededWarning",c.emitter=t,c.type=e,c.count=a.length,lc(c)}return t}Oe.prototype.addListener=function(e,r){return Qn(this,e,r,!1)},Oe.prototype.on=Oe.prototype.addListener,Oe.prototype.prependListener=function(e,r){return Qn(this,e,r,!0)};function hc(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Zn(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=hc.bind(i);return n.listener=r,i.wrapFn=n,n}Oe.prototype.once=function(e,r){return Qr(r),this.on(e,Zn(this,e,r)),this},Oe.prototype.prependOnceListener=function(e,r){return Qr(r),this.prependListener(e,Zn(this,e,r)),this},Oe.prototype.removeListener=function(e,r){var i,n,s,a,c;if(Qr(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,a=i.length-1;a>=0;a--)if(i[a]===r||i[a].listener===r){c=i[a].listener,s=a;break}if(s<0)return this;s===0?i.shift():fc(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,c||r)}return this},Oe.prototype.off=Oe.prototype.removeListener,Oe.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),a;for(n=0;n<s.length;++n)a=s[n],a!=="removeListener"&&this.removeAllListeners(a);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function es(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?dc(n):rs(n,n.length)}Oe.prototype.listeners=function(e){return es(this,e,!0)},Oe.prototype.rawListeners=function(e){return es(this,e,!1)},Oe.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):ts.call(t,e)},Oe.prototype.listenerCount=ts;function ts(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Oe.prototype.eventNames=function(){return this._eventsCount>0?Jr(this._events):[]};function rs(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function fc(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function dc(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function pc(t,e){return new Promise(function(r,i){function n(a){t.removeListener(e,s),i(a)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}is(t,e,s,{once:!0}),e!=="error"&&gc(t,n,{once:!0})})}function gc(t,e,r){typeof t.on=="function"&&is(t,"error",e,r)}function is(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){i.once&&t.removeEventListener(e,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}const yc=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,_c=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,wc=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function bc(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){mc(t);return}return e}function mc(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Zr(t,e={}){if(typeof t!="string")return t;const r=t.trim();if(t[0]==='"'&&t.at(-1)==='"'&&!t.includes("\\"))return r.slice(1,-1);if(r.length<=9){const i=r.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!wc.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(yc.test(t)||_c.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,bc)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function vc(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function He(t,...e){try{return vc(t(...e))}catch(r){return Promise.reject(r)}}function Ec(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Dc(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function ei(t){if(Ec(t))return String(t);if(Dc(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return ei(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function ns(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const Ci="base64:";function Sc(t){if(typeof t=="string")return t;ns();const e=Buffer.from(t).toString("base64");return Ci+e}function Ic(t){return typeof t!="string"||!t.startsWith(Ci)?t:(ns(),Buffer.from(t.slice(Ci.length),"base64"))}function dt(t){return t?t.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function Oc(...t){return dt(t.join(":"))}function ti(t){return t=dt(t),t?t+":":""}function m1(t){return t}const xc="memory",Tc=()=>{const t=new Map;return{name:xc,options:{},hasItem(e){return t.has(e)},getItem(e){return t.get(e)||null},getItemRaw(e){return t.get(e)||null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return Array.from(t.keys())},clear(){t.clear()},dispose(){t.clear()}}};function Nc(t={}){const e={mounts:{"":t.driver||Tc()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=l=>{for(const f of e.mountpoints)if(l.startsWith(f))return{base:f,relativeKey:l.slice(f.length),driver:e.mounts[f]};return{base:"",relativeKey:l,driver:e.mounts[""]}},i=(l,f)=>e.mountpoints.filter(g=>g.startsWith(l)||f&&l.startsWith(g)).map(g=>({relativeBase:l.length>g.length?l.slice(g.length):void 0,mountpoint:g,driver:e.mounts[g]})),n=(l,f)=>{if(e.watching){f=dt(f);for(const g of e.watchListeners)g(l,f)}},s=async()=>{if(!e.watching){e.watching=!0;for(const l in e.mounts)e.unwatch[l]=await ss(e.mounts[l],n,l)}},a=async()=>{if(e.watching){for(const l in e.unwatch)await e.unwatch[l]();e.unwatch={},e.watching=!1}},c=(l,f,g)=>{const y=new Map,w=m=>{let T=y.get(m.base);return T||(T={driver:m.driver,base:m.base,items:[]},y.set(m.base,T)),T};for(const m of l){const T=typeof m=="string",A=dt(T?m:m.key),M=T?void 0:m.value,D=T||!m.options?f:{...f,...m.options},x=r(A);w(x).items.push({key:A,value:M,relativeKey:x.relativeKey,options:D})}return Promise.all([...y.values()].map(m=>g(m))).then(m=>m.flat())},h={hasItem(l,f={}){l=dt(l);const{relativeKey:g,driver:y}=r(l);return He(y.hasItem,g,f)},getItem(l,f={}){l=dt(l);const{relativeKey:g,driver:y}=r(l);return He(y.getItem,g,f).then(w=>Zr(w))},getItems(l,f){return c(l,f,g=>g.driver.getItems?He(g.driver.getItems,g.items.map(y=>({key:y.relativeKey,options:y.options})),f).then(y=>y.map(w=>({key:Oc(g.base,w.key),value:Zr(w.value)}))):Promise.all(g.items.map(y=>He(g.driver.getItem,y.relativeKey,y.options).then(w=>({key:y.key,value:Zr(w)})))))},getItemRaw(l,f={}){l=dt(l);const{relativeKey:g,driver:y}=r(l);return y.getItemRaw?He(y.getItemRaw,g,f):He(y.getItem,g,f).then(w=>Ic(w))},async setItem(l,f,g={}){if(f===void 0)return h.removeItem(l);l=dt(l);const{relativeKey:y,driver:w}=r(l);w.setItem&&(await He(w.setItem,y,ei(f),g),w.watch||n("update",l))},async setItems(l,f){await c(l,f,async g=>{g.driver.setItems&&await He(g.driver.setItems,g.items.map(y=>({key:y.relativeKey,value:ei(y.value),options:y.options})),f),g.driver.setItem&&await Promise.all(g.items.map(y=>He(g.driver.setItem,y.relativeKey,ei(y.value),y.options)))})},async setItemRaw(l,f,g={}){if(f===void 0)return h.removeItem(l,g);l=dt(l);const{relativeKey:y,driver:w}=r(l);if(w.setItemRaw)await He(w.setItemRaw,y,f,g);else if(w.setItem)await He(w.setItem,y,Sc(f),g);else return;w.watch||n("update",l)},async removeItem(l,f={}){typeof f=="boolean"&&(f={removeMeta:f}),l=dt(l);const{relativeKey:g,driver:y}=r(l);y.removeItem&&(await He(y.removeItem,g,f),(f.removeMeta||f.removeMata)&&await He(y.removeItem,g+"$",f),y.watch||n("remove",l))},async getMeta(l,f={}){typeof f=="boolean"&&(f={nativeOnly:f}),l=dt(l);const{relativeKey:g,driver:y}=r(l),w=Object.create(null);if(y.getMeta&&Object.assign(w,await He(y.getMeta,g,f)),!f.nativeOnly){const m=await He(y.getItem,g+"$",f).then(T=>Zr(T));m&&typeof m=="object"&&(typeof m.atime=="string"&&(m.atime=new Date(m.atime)),typeof m.mtime=="string"&&(m.mtime=new Date(m.mtime)),Object.assign(w,m))}return w},setMeta(l,f,g={}){return this.setItem(l+"$",f,g)},removeMeta(l,f={}){return this.removeItem(l+"$",f)},async getKeys(l,f={}){l=ti(l);const g=i(l,!0);let y=[];const w=[];for(const m of g){const A=(await He(m.driver.getKeys,m.relativeBase,f)).map(M=>m.mountpoint+dt(M)).filter(M=>!y.some(D=>M.startsWith(D)));w.push(...A),y=[m.mountpoint,...y.filter(M=>!M.startsWith(m.mountpoint))]}return l?w.filter(m=>m.startsWith(l)&&!m.endsWith("$")):w.filter(m=>!m.endsWith("$"))},async clear(l,f={}){l=ti(l),await Promise.all(i(l,!1).map(async g=>{if(g.driver.clear)return He(g.driver.clear,g.relativeBase,f);if(g.driver.removeItem){const y=await g.driver.getKeys(g.relativeBase||"",f);return Promise.all(y.map(w=>g.driver.removeItem(w,f)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(l=>os(l)))},async watch(l){return await s(),e.watchListeners.push(l),async()=>{e.watchListeners=e.watchListeners.filter(f=>f!==l),e.watchListeners.length===0&&await a()}},async unwatch(){e.watchListeners=[],await a()},mount(l,f){if(l=ti(l),l&&e.mounts[l])throw new Error(`already mounted at ${l}`);return l&&(e.mountpoints.push(l),e.mountpoints.sort((g,y)=>y.length-g.length)),e.mounts[l]=f,e.watching&&Promise.resolve(ss(f,n,l)).then(g=>{e.unwatch[l]=g}).catch(console.error),h},async unmount(l,f=!0){l=ti(l),!(!l||!e.mounts[l])&&(e.watching&&l in e.unwatch&&(e.unwatch[l](),delete e.unwatch[l]),f&&await os(e.mounts[l]),e.mountpoints=e.mountpoints.filter(g=>g!==l),delete e.mounts[l])},getMount(l=""){l=dt(l)+":";const f=r(l);return{driver:f.driver,base:f.base}},getMounts(l="",f={}){return l=dt(l),i(l,f.parents).map(y=>({driver:y.driver,base:y.mountpoint}))}};return h}function ss(t,e,r){return t.watch?t.watch((i,n)=>e(i,r+n)):()=>{}}async function os(t){typeof t.dispose=="function"&&await He(t.dispose)}function Wt(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function as(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const i=Wt(r);return(n,s)=>i.then(a=>s(a.transaction(e,n).objectStore(e)))}let Li;function Sr(){return Li||(Li=as("keyval-store","keyval")),Li}function cs(t,e=Sr()){return e("readonly",r=>Wt(r.get(t)))}function Rc(t,e,r=Sr()){return r("readwrite",i=>(i.put(e,t),Wt(i.transaction)))}function Pc(t,e=Sr()){return e("readwrite",r=>(r.delete(t),Wt(r.transaction)))}function Ac(t=Sr()){return t("readwrite",e=>(e.clear(),Wt(e.transaction)))}function Cc(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Wt(t.transaction)}function Lc(t=Sr()){return t("readonly",e=>{if(e.getAllKeys)return Wt(e.getAllKeys());const r=[];return Cc(e,i=>r.push(i.key)).then(()=>r)})}const Fc=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),$c=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function ri(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return $c(t)}catch{return t}}function Ir(t){return typeof t=="string"?t:Fc(t)||""}const Uc="idb-keyval";var Mc=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let i;return t.dbName&&t.storeName&&(i=as(t.dbName,t.storeName)),{name:Uc,options:t,async hasItem(n){return!(typeof await cs(r(n),i)>"u")},async getItem(n){return await cs(r(n),i)??null},setItem(n,s){return Rc(r(n),s,i)},removeItem(n){return Pc(r(n),i)},getKeys(){return Lc(i)},clear(){return Ac(i)}}};const jc="WALLET_CONNECT_V2_INDEXED_DB",qc="keyvaluestorage";class Bc{constructor(){this.indexedDb=Nc({driver:Mc({dbName:jc,storeName:qc})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,Ir(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var Fi=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},ii={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof Fi<"u"&&Fi.localStorage?ii.exports=Fi.localStorage:typeof window<"u"&&window.localStorage?ii.exports=window.localStorage:ii.exports=new e})();function zc(t){var e;return[t[0],ri((e=t[1])!=null?e:"")]}class Kc{constructor(){this.localStorage=ii.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(zc)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return ri(r)}async setItem(e,r){this.localStorage.setItem(e,Ir(r))}async removeItem(e){this.localStorage.removeItem(e)}}const Hc="wc_storage_version",us=1,Vc=async(t,e,r)=>{const i=Hc,n=await e.getItem(i);if(n&&n>=us){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const a=[];for(;s.length;){const c=s.shift();if(!c)continue;const h=c.toLowerCase();if(h.includes("wc@")||h.includes("walletconnect")||h.includes("wc_")||h.includes("wallet_connect")){const l=await t.getItem(c);await e.setItem(c,l),a.push(c)}}await e.setItem(i,us),r(e),Gc(t,a)},Gc=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class kc{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new Kc;this.storage=e;try{const r=new Bc;Vc(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}var ur={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var $i=function(t,e){return $i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},$i(t,e)};function Wc(t,e){$i(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ui=function(){return Ui=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ui.apply(this,arguments)};function Yc(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Xc(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Jc(t,e){return function(r,i){e(r,i,t)}}function Qc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Zc(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(f){try{l(i.next(f))}catch(g){a(g)}}function h(f){try{l(i.throw(f))}catch(g){a(g)}}function l(f){f.done?s(f.value):n(f.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function eu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(f){return h([l,f])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(f){l=[6,f],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function tu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function ru(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Mi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ls(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function iu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ls(arguments[e]));return t}function nu(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Or(t){return this instanceof Or?(this.v=t,this):new Or(t)}function su(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(w){return new Promise(function(m,T){s.push([y,w,m,T])>1||c(y,w)})})}function c(y,w){try{h(i[y](w))}catch(m){g(s[0][3],m)}}function h(y){y.value instanceof Or?Promise.resolve(y.value.v).then(l,f):g(s[0][2],y)}function l(y){c("next",y)}function f(y){c("throw",y)}function g(y,w){y(w),s.shift(),s.length&&c(s[0][0],s[0][1])}}function ou(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:Or(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function au(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Mi=="function"?Mi(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function cu(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function uu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function lu(t){return t&&t.__esModule?t:{default:t}}function hu(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function fu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var du=Object.freeze({__proto__:null,__extends:Wc,get __assign(){return Ui},__rest:Yc,__decorate:Xc,__param:Jc,__metadata:Qc,__awaiter:Zc,__generator:eu,__createBinding:tu,__exportStar:ru,__values:Mi,__read:ls,__spread:iu,__spreadArrays:nu,__await:Or,__asyncGenerator:su,__asyncDelegator:ou,__asyncValues:au,__makeTemplateObject:cu,__importStar:uu,__importDefault:lu,__classPrivateFieldGet:hu,__classPrivateFieldSet:fu}),ni=kt(du),xr={},W={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var ji=function(t,e){return ji=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},ji(t,e)};function pu(t,e){ji(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var qi=function(){return qi=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},qi.apply(this,arguments)};function gu(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function yu(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function _u(t,e){return function(r,i){e(r,i,t)}}function wu(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function bu(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(f){try{l(i.next(f))}catch(g){a(g)}}function h(f){try{l(i.throw(f))}catch(g){a(g)}}function l(f){f.done?s(f.value):n(f.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function mu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(f){return h([l,f])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(f){l=[6,f],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function vu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Eu(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Bi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function hs(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function Du(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(hs(arguments[e]));return t}function Su(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Tr(t){return this instanceof Tr?(this.v=t,this):new Tr(t)}function Iu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(w){return new Promise(function(m,T){s.push([y,w,m,T])>1||c(y,w)})})}function c(y,w){try{h(i[y](w))}catch(m){g(s[0][3],m)}}function h(y){y.value instanceof Tr?Promise.resolve(y.value.v).then(l,f):g(s[0][2],y)}function l(y){c("next",y)}function f(y){c("throw",y)}function g(y,w){y(w),s.shift(),s.length&&c(s[0][0],s[0][1])}}function Ou(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:Tr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function xu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Bi=="function"?Bi(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function Tu(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Nu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Ru(t){return t&&t.__esModule?t:{default:t}}function Pu(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Au(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Cu=Object.freeze({__proto__:null,__extends:pu,get __assign(){return qi},__rest:gu,__decorate:yu,__param:_u,__metadata:wu,__awaiter:bu,__generator:mu,__createBinding:vu,__exportStar:Eu,__values:Bi,__read:hs,__spread:Du,__spreadArrays:Su,__await:Tr,__asyncGenerator:Iu,__asyncDelegator:Ou,__asyncValues:xu,__makeTemplateObject:Tu,__importStar:Nu,__importDefault:Ru,__classPrivateFieldGet:Pu,__classPrivateFieldSet:Au}),si=kt(Cu),zi={},Nr={},fs;function Lu(){if(fs)return Nr;fs=1,Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return Nr.delay=t,Nr}var Yt={},Ki={},Xt={},ds;function Fu(){return ds||(ds=1,Object.defineProperty(Xt,"__esModule",{value:!0}),Xt.ONE_THOUSAND=Xt.ONE_HUNDRED=void 0,Xt.ONE_HUNDRED=100,Xt.ONE_THOUSAND=1e3),Xt}var Hi={},ps;function $u(){return ps||(ps=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(Hi)),Hi}var gs;function ys(){return gs||(gs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=si;e.__exportStar(Fu(),t),e.__exportStar($u(),t)}(Ki)),Ki}var _s;function Uu(){if(_s)return Yt;_s=1,Object.defineProperty(Yt,"__esModule",{value:!0}),Yt.fromMiliseconds=Yt.toMiliseconds=void 0;const t=ys();function e(i){return i*t.ONE_THOUSAND}Yt.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Yt.fromMiliseconds=r,Yt}var ws;function Mu(){return ws||(ws=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=si;e.__exportStar(Lu(),t),e.__exportStar(Uu(),t)}(zi)),zi}var lr={},bs;function ju(){if(bs)return lr;bs=1,Object.defineProperty(lr,"__esModule",{value:!0}),lr.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return lr.Watch=t,lr.default=t,lr}var Vi={},Rr={},ms;function qu(){if(ms)return Rr;ms=1,Object.defineProperty(Rr,"__esModule",{value:!0}),Rr.IWatch=void 0;class t{}return Rr.IWatch=t,Rr}var vs;function Bu(){return vs||(vs=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),si.__exportStar(qu(),t)}(Vi)),Vi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=si;e.__exportStar(Mu(),t),e.__exportStar(ju(),t),e.__exportStar(Bu(),t),e.__exportStar(ys(),t)})(W);var Gi={},Pr={};class Jt{}var zu=Object.freeze({__proto__:null,IEvents:Jt}),Ku=kt(zu),Es;function Hu(){if(Es)return Pr;Es=1,Object.defineProperty(Pr,"__esModule",{value:!0}),Pr.IHeartBeat=void 0;const t=Ku;class e extends t.IEvents{constructor(i){super()}}return Pr.IHeartBeat=e,Pr}var Ds;function Ss(){return Ds||(Ds=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),ni.__exportStar(Hu(),t)}(Gi)),Gi}var ki={},Qt={},Is;function Vu(){if(Is)return Qt;Is=1,Object.defineProperty(Qt,"__esModule",{value:!0}),Qt.HEARTBEAT_EVENTS=Qt.HEARTBEAT_INTERVAL=void 0;const t=W;return Qt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,Qt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},Qt}var Os;function xs(){return Os||(Os=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),ni.__exportStar(Vu(),t)}(ki)),ki}var Ts;function Gu(){if(Ts)return xr;Ts=1,Object.defineProperty(xr,"__esModule",{value:!0}),xr.HeartBeat=void 0;const t=ni,e=ft.exports,r=W,i=Ss(),n=xs();class s extends i.IHeartBeat{constructor(c){super(c),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=c?.interval||n.HEARTBEAT_INTERVAL}static init(c){return t.__awaiter(this,void 0,void 0,function*(){const h=new s(c);return yield h.init(),h})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(c,h){this.events.on(c,h)}once(c,h){this.events.once(c,h)}off(c,h){this.events.off(c,h)}removeListener(c,h){this.events.removeListener(c,h)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return xr.HeartBeat=s,xr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=ni;e.__exportStar(Gu(),t),e.__exportStar(Ss(),t),e.__exportStar(xs(),t)})(ur);var ye={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Wi=function(t,e){return Wi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Wi(t,e)};function ku(t,e){Wi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Yi=function(){return Yi=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Yi.apply(this,arguments)};function Wu(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Yu(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Xu(t,e){return function(r,i){e(r,i,t)}}function Ju(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Qu(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(f){try{l(i.next(f))}catch(g){a(g)}}function h(f){try{l(i.throw(f))}catch(g){a(g)}}function l(f){f.done?s(f.value):n(f.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function Zu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(f){return h([l,f])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(f){l=[6,f],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function el(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function tl(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Xi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Ns(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function rl(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Ns(arguments[e]));return t}function il(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Ar(t){return this instanceof Ar?(this.v=t,this):new Ar(t)}function nl(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(w){return new Promise(function(m,T){s.push([y,w,m,T])>1||c(y,w)})})}function c(y,w){try{h(i[y](w))}catch(m){g(s[0][3],m)}}function h(y){y.value instanceof Ar?Promise.resolve(y.value.v).then(l,f):g(s[0][2],y)}function l(y){c("next",y)}function f(y){c("throw",y)}function g(y,w){y(w),s.shift(),s.length&&c(s[0][0],s[0][1])}}function sl(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:Ar(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function ol(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Xi=="function"?Xi(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function al(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function cl(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function ul(t){return t&&t.__esModule?t:{default:t}}function ll(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function hl(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var fl=Object.freeze({__proto__:null,__extends:ku,get __assign(){return Yi},__rest:Wu,__decorate:Yu,__param:Xu,__metadata:Ju,__awaiter:Qu,__generator:Zu,__createBinding:el,__exportStar:tl,__values:Xi,__read:Ns,__spread:rl,__spreadArrays:il,__await:Ar,__asyncGenerator:nl,__asyncDelegator:sl,__asyncValues:ol,__makeTemplateObject:al,__importStar:cl,__importDefault:ul,__classPrivateFieldGet:ll,__classPrivateFieldSet:hl}),dl=kt(fl),Ji,Rs;function pl(){if(Rs)return Ji;Rs=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Ji=e;function e(r,i,n){var s=n&&n.stringify||t,a=1;if(typeof r=="object"&&r!==null){var c=i.length+a;if(c===1)return r;var h=new Array(c);h[0]=s(r);for(var l=1;l<c;l++)h[l]=s(i[l]);return h.join(" ")}if(typeof r!="string")return r;var f=i.length;if(f===0)return r;for(var g="",y=1-a,w=-1,m=r&&r.length||0,T=0;T<m;){if(r.charCodeAt(T)===37&&T+1<m){switch(w=w>-1?w:0,r.charCodeAt(T+1)){case 100:case 102:if(y>=f||i[y]==null)break;w<T&&(g+=r.slice(w,T)),g+=Number(i[y]),w=T+2,T++;break;case 105:if(y>=f||i[y]==null)break;w<T&&(g+=r.slice(w,T)),g+=Math.floor(Number(i[y])),w=T+2,T++;break;case 79:case 111:case 106:if(y>=f||i[y]===void 0)break;w<T&&(g+=r.slice(w,T));var A=typeof i[y];if(A==="string"){g+="'"+i[y]+"'",w=T+2,T++;break}if(A==="function"){g+=i[y].name||"<anonymous>",w=T+2,T++;break}g+=s(i[y]),w=T+2,T++;break;case 115:if(y>=f)break;w<T&&(g+=r.slice(w,T)),g+=String(i[y]),w=T+2,T++;break;case 37:w<T&&(g+=r.slice(w,T)),g+="%",w=T+2,T++,y--;break}++y}++T}return w===-1?r:(w<m&&(g+=r.slice(w)),g)}return Ji}var Qi,Ps;function gl(){if(Ps)return Qi;Ps=1;const t=pl();Qi=n;const e=E().console||{},r={mapHttpRequest:m,mapHttpResponse:m,wrapRequestSerializer:T,wrapResponseSerializer:T,wrapErrorSerializer:T,req:m,res:m,err:y};function i(p,o){return Array.isArray(p)?p.filter(function(C){return C!=="!stdSerializers.err"}):p===!0?Object.keys(o):!1}function n(p){p=p||{},p.browser=p.browser||{};const o=p.browser.transmit;if(o&&typeof o.send!="function")throw Error("pino: transmit option must have a send function");const d=p.browser.write||e;p.browser.write&&(p.browser.asObject=!0);const C=p.serializers||{},L=i(p.browser.serialize,C);let K=p.browser.serialize;Array.isArray(p.browser.serialize)&&p.browser.serialize.indexOf("!stdSerializers.err")>-1&&(K=!1);const G=["error","fatal","warn","info","debug","trace"];typeof d=="function"&&(d.error=d.fatal=d.warn=d.info=d.debug=d.trace=d),p.enabled===!1&&(p.level="silent");const Q=p.level||"info",O=Object.create(d);O.log||(O.log=A),Object.defineProperty(O,"levelVal",{get:k}),Object.defineProperty(O,"level",{get:q,set:$});const P={transmit:o,serialize:L,asObject:p.browser.asObject,levels:G,timestamp:w(p)};O.levels=n.levels,O.level=Q,O.setMaxListeners=O.getMaxListeners=O.emit=O.addListener=O.on=O.prependListener=O.once=O.prependOnceListener=O.removeListener=O.removeAllListeners=O.listeners=O.listenerCount=O.eventNames=O.write=O.flush=A,O.serializers=C,O._serialize=L,O._stdErrSerialize=K,O.child=j,o&&(O._logEvent=g());function k(){return this.level==="silent"?1/0:this.levels.values[this.level]}function q(){return this._level}function $(F){if(F!=="silent"&&!this.levels.values[F])throw Error("unknown level "+F);this._level=F,s(P,O,"error","log"),s(P,O,"fatal","error"),s(P,O,"warn","error"),s(P,O,"info","log"),s(P,O,"debug","log"),s(P,O,"trace","log")}function j(F,B){if(!F)throw new Error("missing bindings for child Pino");B=B||{},L&&F.serializers&&(B.serializers=F.serializers);const te=B.serializers;if(L&&te){var z=Object.assign({},C,te),Z=p.browser.serialize===!0?Object.keys(z):L;delete F.serializers,h([F],Z,z,this._stdErrSerialize)}function X(ee){this._childLevel=(ee._childLevel|0)+1,this.error=l(ee,F,"error"),this.fatal=l(ee,F,"fatal"),this.warn=l(ee,F,"warn"),this.info=l(ee,F,"info"),this.debug=l(ee,F,"debug"),this.trace=l(ee,F,"trace"),z&&(this.serializers=z,this._serialize=Z),o&&(this._logEvent=g([].concat(ee._logEvent.bindings,F)))}return X.prototype=this,new X(this)}return O}n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers=r,n.stdTimeFunctions=Object.assign({},{nullTime:M,epochTime:D,unixTime:x,isoTime:b});function s(p,o,d,C){const L=Object.getPrototypeOf(o);o[d]=o.levelVal>o.levels.values[d]?A:L[d]?L[d]:e[d]||e[C]||A,a(p,o,d)}function a(p,o,d){!p.transmit&&o[d]===A||(o[d]=function(C){return function(){const K=p.timestamp(),G=new Array(arguments.length),Q=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var O=0;O<G.length;O++)G[O]=arguments[O];if(p.serialize&&!p.asObject&&h(G,this._serialize,this.serializers,this._stdErrSerialize),p.asObject?C.call(Q,c(this,d,G,K)):C.apply(Q,G),p.transmit){const P=p.transmit.level||o.level,k=n.levels.values[P],q=n.levels.values[d];if(q<k)return;f(this,{ts:K,methodLevel:d,methodValue:q,transmitLevel:P,transmitValue:n.levels.values[p.transmit.level||o.level],send:p.transmit.send,val:o.levelVal},G)}}}(o[d]))}function c(p,o,d,C){p._serialize&&h(d,p._serialize,p.serializers,p._stdErrSerialize);const L=d.slice();let K=L[0];const G={};C&&(G.time=C),G.level=n.levels.values[o];let Q=(p._childLevel|0)+1;if(Q<1&&(Q=1),K!==null&&typeof K=="object"){for(;Q--&&typeof L[0]=="object";)Object.assign(G,L.shift());K=L.length?t(L.shift(),L):void 0}else typeof K=="string"&&(K=t(L.shift(),L));return K!==void 0&&(G.msg=K),G}function h(p,o,d,C){for(const L in p)if(C&&p[L]instanceof Error)p[L]=n.stdSerializers.err(p[L]);else if(typeof p[L]=="object"&&!Array.isArray(p[L]))for(const K in p[L])o&&o.indexOf(K)>-1&&K in d&&(p[L][K]=d[K](p[L][K]))}function l(p,o,d){return function(){const C=new Array(1+arguments.length);C[0]=o;for(var L=1;L<C.length;L++)C[L]=arguments[L-1];return p[d].apply(this,C)}}function f(p,o,d){const C=o.send,L=o.ts,K=o.methodLevel,G=o.methodValue,Q=o.val,O=p._logEvent.bindings;h(d,p._serialize||Object.keys(p.serializers),p.serializers,p._stdErrSerialize===void 0?!0:p._stdErrSerialize),p._logEvent.ts=L,p._logEvent.messages=d.filter(function(P){return O.indexOf(P)===-1}),p._logEvent.level.label=K,p._logEvent.level.value=G,C(K,p._logEvent,Q),p._logEvent=g(O)}function g(p){return{ts:0,messages:[],bindings:p||[],level:{label:"",value:0}}}function y(p){const o={type:p.constructor.name,msg:p.message,stack:p.stack};for(const d in p)o[d]===void 0&&(o[d]=p[d]);return o}function w(p){return typeof p.timestamp=="function"?p.timestamp:p.timestamp===!1?M:D}function m(){return{}}function T(p){return p}function A(){}function M(){return!1}function D(){return Date.now()}function x(){return Math.round(Date.now()/1e3)}function b(){return new Date(Date.now()).toISOString()}function E(){function p(o){return typeof o<"u"&&o}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return p(self)||p(window)||p(this)||{}}}return Qi}var Zt={},As;function Cs(){return As||(As=1,Object.defineProperty(Zt,"__esModule",{value:!0}),Zt.PINO_CUSTOM_CONTEXT_KEY=Zt.PINO_LOGGER_DEFAULTS=void 0,Zt.PINO_LOGGER_DEFAULTS={level:"info"},Zt.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Zt}var st={},Ls;function yl(){if(Ls)return st;Ls=1,Object.defineProperty(st,"__esModule",{value:!0}),st.generateChildLogger=st.formatChildLoggerContext=st.getLoggerContext=st.setBrowserLoggerContext=st.getBrowserLoggerContext=st.getDefaultLoggerOptions=void 0;const t=Cs();function e(c){return Object.assign(Object.assign({},c),{level:c?.level||t.PINO_LOGGER_DEFAULTS.level})}st.getDefaultLoggerOptions=e;function r(c,h=t.PINO_CUSTOM_CONTEXT_KEY){return c[h]||""}st.getBrowserLoggerContext=r;function i(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){return c[l]=h,c}st.setBrowserLoggerContext=i;function n(c,h=t.PINO_CUSTOM_CONTEXT_KEY){let l="";return typeof c.bindings>"u"?l=r(c,h):l=c.bindings().context||"",l}st.getLoggerContext=n;function s(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){const f=n(c,l);return f.trim()?`${f}/${h}`:h}st.formatChildLoggerContext=s;function a(c,h,l=t.PINO_CUSTOM_CONTEXT_KEY){const f=s(c,h,l),g=c.child({context:f});return i(g,f,l)}return st.generateChildLogger=a,st}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=dl,r=e.__importDefault(gl());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(Cs(),t),e.__exportStar(yl(),t)})(ye);class _l extends Jt{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class wl extends Jt{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class bl{constructor(e,r){this.logger=e,this.core=r}}class ml extends Jt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class vl extends Jt{constructor(e){super()}}class El{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}}class Dl extends Jt{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Sl extends Jt{constructor(e,r){super(),this.core=e,this.logger=r}}class Il{constructor(e,r){this.projectId=e,this.logger=r}}class Ol{constructor(e,r){this.projectId=e,this.logger=r}}class xl{constructor(e){this.opts=e,this.protocol="wc",this.version=2}}class Tl{constructor(e){this.client=e}}var Zi={},hr={},oi={},ai={};Object.defineProperty(ai,"__esModule",{value:!0}),ai.BrowserRandomSource=void 0;const Fs=65536;class Nl{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=Fs)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,Fs)));return r}}ai.BrowserRandomSource=Nl;function Rl(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var ci={},yt={};Object.defineProperty(yt,"__esModule",{value:!0});function Pl(t){for(var e=0;e<t.length;e++)t[e]=0;return t}yt.wipe=Pl;var Al={},Cl=Object.freeze({__proto__:null,default:Al}),Ll=kt(Cl);Object.defineProperty(ci,"__esModule",{value:!0}),ci.NodeRandomSource=void 0;const Fl=yt;class $l{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof Rl<"u"){const e=Ll;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,Fl.wipe)(r),i}}ci.NodeRandomSource=$l,Object.defineProperty(oi,"__esModule",{value:!0}),oi.SystemRandomSource=void 0;const Ul=ai,Ml=ci;class jl{constructor(){if(this.isAvailable=!1,this.name="",this._source=new Ul.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new Ml.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}oi.SystemRandomSource=jl;var ie={},$s={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(c,h){var l=c>>>16&65535,f=c&65535,g=h>>>16&65535,y=h&65535;return f*y+(l*y+f*g<<16>>>0)|0}t.mul=Math.imul||e;function r(c,h){return c+h|0}t.add=r;function i(c,h){return c-h|0}t.sub=i;function n(c,h){return c<<h|c>>>32-h}t.rotl=n;function s(c,h){return c<<32-h|c>>>h}t.rotr=s;function a(c){return typeof c=="number"&&isFinite(c)&&Math.floor(c)===c}t.isInteger=Number.isInteger||a,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(c){return t.isInteger(c)&&c>=-t.MAX_SAFE_INTEGER&&c<=t.MAX_SAFE_INTEGER}})($s),Object.defineProperty(ie,"__esModule",{value:!0});var Us=$s;function ql(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}ie.readInt16BE=ql;function Bl(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}ie.readUint16BE=Bl;function zl(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}ie.readInt16LE=zl;function Kl(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}ie.readUint16LE=Kl;function Ms(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}ie.writeUint16BE=Ms,ie.writeInt16BE=Ms;function js(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}ie.writeUint16LE=js,ie.writeInt16LE=js;function en(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}ie.readInt32BE=en;function tn(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}ie.readUint32BE=tn;function rn(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}ie.readInt32LE=rn;function nn(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}ie.readUint32LE=nn;function ui(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}ie.writeUint32BE=ui,ie.writeInt32BE=ui;function li(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}ie.writeUint32LE=li,ie.writeInt32LE=li;function Hl(t,e){e===void 0&&(e=0);var r=en(t,e),i=en(t,e+4);return r*4294967296+i-(i>>31)*4294967296}ie.readInt64BE=Hl;function Vl(t,e){e===void 0&&(e=0);var r=tn(t,e),i=tn(t,e+4);return r*4294967296+i}ie.readUint64BE=Vl;function Gl(t,e){e===void 0&&(e=0);var r=rn(t,e),i=rn(t,e+4);return i*4294967296+r-(r>>31)*4294967296}ie.readInt64LE=Gl;function kl(t,e){e===void 0&&(e=0);var r=nn(t,e),i=nn(t,e+4);return i*4294967296+r}ie.readUint64LE=kl;function qs(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),ui(t/4294967296>>>0,e,r),ui(t>>>0,e,r+4),e}ie.writeUint64BE=qs,ie.writeInt64BE=qs;function Bs(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),li(t>>>0,e,r),li(t/4294967296>>>0,e,r+4),e}ie.writeUint64LE=Bs,ie.writeInt64LE=Bs;function Wl(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,s=t/8+r-1;s>=r;s--)i+=e[s]*n,n*=256;return i}ie.readUintBE=Wl;function Yl(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,s=r;s<r+t/8;s++)i+=e[s]*n,n*=256;return i}ie.readUintLE=Yl;function Xl(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!Us.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,s=t/8+i-1;s>=i;s--)r[s]=e/n&255,n*=256;return r}ie.writeUintBE=Xl;function Jl(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!Us.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,s=i;s<i+t/8;s++)r[s]=e/n&255,n*=256;return r}ie.writeUintLE=Jl;function Ql(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}ie.readFloat32BE=Ql;function Zl(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}ie.readFloat32LE=Zl;function eh(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}ie.readFloat64BE=eh;function th(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}ie.readFloat64LE=th;function rh(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}ie.writeFloat32BE=rh;function ih(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}ie.writeFloat32LE=ih;function nh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}ie.writeFloat64BE=nh;function sh(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}ie.writeFloat64LE=sh,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=oi,r=ie,i=yt;t.defaultRandomSource=new e.SystemRandomSource;function n(l,f=t.defaultRandomSource){return f.randomBytes(l)}t.randomBytes=n;function s(l=t.defaultRandomSource){const f=n(4,l),g=(0,r.readUint32LE)(f);return(0,i.wipe)(f),g}t.randomUint32=s;const a="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function c(l,f=a,g=t.defaultRandomSource){if(f.length<2)throw new Error("randomString charset is too short");if(f.length>256)throw new Error("randomString charset is too long");let y="";const w=f.length,m=256-256%w;for(;l>0;){const T=n(Math.ceil(l*256/m),g);for(let A=0;A<T.length&&l>0;A++){const M=T[A];M<m&&(y+=f.charAt(M%w),l--)}(0,i.wipe)(T)}return y}t.randomString=c;function h(l,f=a,g=t.defaultRandomSource){const y=Math.ceil(l/(Math.log(f.length)/Math.LN2));return c(y,f,g)}t.randomStringForEntropy=h}(hr);var zs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=yt;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},c.prototype.update=function(h,l){if(l===void 0&&(l=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var f=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&l>0;)this._buffer[this._bufferLength++]=h[f++],l--;this._bufferLength===this.blockSize&&(s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(f=s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,f,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=h[f++],l--;return this},c.prototype.finish=function(h){if(!this._finished){var l=this._bytesHashed,f=this._bufferLength,g=l/536870912|0,y=l<<3,w=l%128<112?128:256;this._buffer[f]=128;for(var m=f+1;m<w-8;m++)this._buffer[m]=0;e.writeUint32BE(g,this._buffer,w-8),e.writeUint32BE(y,this._buffer,w-4),s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,w),this._finished=!0}for(var m=0;m<this.digestLength/8;m++)e.writeUint32BE(this._stateHi[m],h,m*8),e.writeUint32BE(this._stateLo[m],h,m*8+4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.stateHi),r.wipe(h.stateLo),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function s(c,h,l,f,g,y,w){for(var m=l[0],T=l[1],A=l[2],M=l[3],D=l[4],x=l[5],b=l[6],E=l[7],p=f[0],o=f[1],d=f[2],C=f[3],L=f[4],K=f[5],G=f[6],Q=f[7],O,P,k,q,$,j,F,B;w>=128;){for(var te=0;te<16;te++){var z=8*te+y;c[te]=e.readUint32BE(g,z),h[te]=e.readUint32BE(g,z+4)}for(var te=0;te<80;te++){var Z=m,X=T,ee=A,R=M,N=D,S=x,u=b,v=E,H=p,Y=o,he=d,we=C,de=L,ve=K,Ue=G,Ce=Q;if(O=E,P=Q,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=(D>>>14|L<<32-14)^(D>>>18|L<<32-18)^(L>>>41-32|D<<32-(41-32)),P=(L>>>14|D<<32-14)^(L>>>18|D<<32-18)^(D>>>41-32|L<<32-(41-32)),$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,O=D&x^~D&b,P=L&K^~L&G,$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,O=n[te*2],P=n[te*2+1],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,O=c[te%16],P=h[te%16],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,k=F&65535|B<<16,q=$&65535|j<<16,O=k,P=q,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=(m>>>28|p<<32-28)^(p>>>34-32|m<<32-(34-32))^(p>>>39-32|m<<32-(39-32)),P=(p>>>28|m<<32-28)^(m>>>34-32|p<<32-(34-32))^(m>>>39-32|p<<32-(39-32)),$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,O=m&T^m&A^T&A,P=p&o^p&d^o&d,$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,v=F&65535|B<<16,Ce=$&65535|j<<16,O=R,P=we,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=k,P=q,$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,R=F&65535|B<<16,we=$&65535|j<<16,T=Z,A=X,M=ee,D=R,x=N,b=S,E=u,m=v,o=H,d=Y,C=he,L=we,K=de,G=ve,Q=Ue,p=Ce,te%16===15)for(var z=0;z<16;z++)O=c[z],P=h[z],$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=c[(z+9)%16],P=h[(z+9)%16],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,k=c[(z+1)%16],q=h[(z+1)%16],O=(k>>>1|q<<32-1)^(k>>>8|q<<32-8)^k>>>7,P=(q>>>1|k<<32-1)^(q>>>8|k<<32-8)^(q>>>7|k<<32-7),$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,k=c[(z+14)%16],q=h[(z+14)%16],O=(k>>>19|q<<32-19)^(q>>>61-32|k<<32-(61-32))^k>>>6,P=(q>>>19|k<<32-19)^(k>>>61-32|q<<32-(61-32))^(q>>>6|k<<32-6),$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,c[z]=F&65535|B<<16,h[z]=$&65535|j<<16}O=m,P=p,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=l[0],P=f[0],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,l[0]=m=F&65535|B<<16,f[0]=p=$&65535|j<<16,O=T,P=o,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=l[1],P=f[1],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,l[1]=T=F&65535|B<<16,f[1]=o=$&65535|j<<16,O=A,P=d,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=l[2],P=f[2],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,l[2]=A=F&65535|B<<16,f[2]=d=$&65535|j<<16,O=M,P=C,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=l[3],P=f[3],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,l[3]=M=F&65535|B<<16,f[3]=C=$&65535|j<<16,O=D,P=L,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=l[4],P=f[4],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,l[4]=D=F&65535|B<<16,f[4]=L=$&65535|j<<16,O=x,P=K,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=l[5],P=f[5],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,l[5]=x=F&65535|B<<16,f[5]=K=$&65535|j<<16,O=b,P=G,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=l[6],P=f[6],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,l[6]=b=F&65535|B<<16,f[6]=G=$&65535|j<<16,O=E,P=Q,$=P&65535,j=P>>>16,F=O&65535,B=O>>>16,O=l[7],P=f[7],$+=P&65535,j+=P>>>16,F+=O&65535,B+=O>>>16,j+=$>>>16,F+=j>>>16,B+=F>>>16,l[7]=E=F&65535|B<<16,f[7]=Q=$&65535|j<<16,y+=128,w-=128}return y}function a(c){var h=new i;h.update(c);var l=h.digest();return h.clean(),l}t.hash=a})(zs),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=hr,r=zs,i=yt;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(R){const N=new Float64Array(16);if(R)for(let S=0;S<R.length;S++)N[S]=R[S];return N}const s=new Uint8Array(32);s[0]=9;const a=n(),c=n([1]),h=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),l=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),f=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),g=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),y=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function w(R,N){for(let S=0;S<16;S++)R[S]=N[S]|0}function m(R){let N=1;for(let S=0;S<16;S++){let u=R[S]+N+65535;N=Math.floor(u/65536),R[S]=u-N*65536}R[0]+=N-1+37*(N-1)}function T(R,N,S){const u=~(S-1);for(let v=0;v<16;v++){const H=u&(R[v]^N[v]);R[v]^=H,N[v]^=H}}function A(R,N){const S=n(),u=n();for(let v=0;v<16;v++)u[v]=N[v];m(u),m(u),m(u);for(let v=0;v<2;v++){S[0]=u[0]-65517;for(let Y=1;Y<15;Y++)S[Y]=u[Y]-65535-(S[Y-1]>>16&1),S[Y-1]&=65535;S[15]=u[15]-32767-(S[14]>>16&1);const H=S[15]>>16&1;S[14]&=65535,T(u,S,1-H)}for(let v=0;v<16;v++)R[2*v]=u[v]&255,R[2*v+1]=u[v]>>8}function M(R,N){let S=0;for(let u=0;u<32;u++)S|=R[u]^N[u];return(1&S-1>>>8)-1}function D(R,N){const S=new Uint8Array(32),u=new Uint8Array(32);return A(S,R),A(u,N),M(S,u)}function x(R){const N=new Uint8Array(32);return A(N,R),N[0]&1}function b(R,N){for(let S=0;S<16;S++)R[S]=N[2*S]+(N[2*S+1]<<8);R[15]&=32767}function E(R,N,S){for(let u=0;u<16;u++)R[u]=N[u]+S[u]}function p(R,N,S){for(let u=0;u<16;u++)R[u]=N[u]-S[u]}function o(R,N,S){let u,v,H=0,Y=0,he=0,we=0,de=0,ve=0,Ue=0,Ce=0,_e=0,pe=0,fe=0,ue=0,ce=0,ae=0,oe=0,re=0,le=0,ge=0,ne=0,be=0,me=0,Se=0,Ie=0,Ee=0,xt=0,Lt=0,Kt=0,mt=0,nr=0,Wr=0,Oi=0,Me=S[0],Le=S[1],je=S[2],qe=S[3],Be=S[4],Fe=S[5],Ge=S[6],ke=S[7],We=S[8],Ye=S[9],Xe=S[10],Ke=S[11],ze=S[12],Re=S[13],Je=S[14],Qe=S[15];u=N[0],H+=u*Me,Y+=u*Le,he+=u*je,we+=u*qe,de+=u*Be,ve+=u*Fe,Ue+=u*Ge,Ce+=u*ke,_e+=u*We,pe+=u*Ye,fe+=u*Xe,ue+=u*Ke,ce+=u*ze,ae+=u*Re,oe+=u*Je,re+=u*Qe,u=N[1],Y+=u*Me,he+=u*Le,we+=u*je,de+=u*qe,ve+=u*Be,Ue+=u*Fe,Ce+=u*Ge,_e+=u*ke,pe+=u*We,fe+=u*Ye,ue+=u*Xe,ce+=u*Ke,ae+=u*ze,oe+=u*Re,re+=u*Je,le+=u*Qe,u=N[2],he+=u*Me,we+=u*Le,de+=u*je,ve+=u*qe,Ue+=u*Be,Ce+=u*Fe,_e+=u*Ge,pe+=u*ke,fe+=u*We,ue+=u*Ye,ce+=u*Xe,ae+=u*Ke,oe+=u*ze,re+=u*Re,le+=u*Je,ge+=u*Qe,u=N[3],we+=u*Me,de+=u*Le,ve+=u*je,Ue+=u*qe,Ce+=u*Be,_e+=u*Fe,pe+=u*Ge,fe+=u*ke,ue+=u*We,ce+=u*Ye,ae+=u*Xe,oe+=u*Ke,re+=u*ze,le+=u*Re,ge+=u*Je,ne+=u*Qe,u=N[4],de+=u*Me,ve+=u*Le,Ue+=u*je,Ce+=u*qe,_e+=u*Be,pe+=u*Fe,fe+=u*Ge,ue+=u*ke,ce+=u*We,ae+=u*Ye,oe+=u*Xe,re+=u*Ke,le+=u*ze,ge+=u*Re,ne+=u*Je,be+=u*Qe,u=N[5],ve+=u*Me,Ue+=u*Le,Ce+=u*je,_e+=u*qe,pe+=u*Be,fe+=u*Fe,ue+=u*Ge,ce+=u*ke,ae+=u*We,oe+=u*Ye,re+=u*Xe,le+=u*Ke,ge+=u*ze,ne+=u*Re,be+=u*Je,me+=u*Qe,u=N[6],Ue+=u*Me,Ce+=u*Le,_e+=u*je,pe+=u*qe,fe+=u*Be,ue+=u*Fe,ce+=u*Ge,ae+=u*ke,oe+=u*We,re+=u*Ye,le+=u*Xe,ge+=u*Ke,ne+=u*ze,be+=u*Re,me+=u*Je,Se+=u*Qe,u=N[7],Ce+=u*Me,_e+=u*Le,pe+=u*je,fe+=u*qe,ue+=u*Be,ce+=u*Fe,ae+=u*Ge,oe+=u*ke,re+=u*We,le+=u*Ye,ge+=u*Xe,ne+=u*Ke,be+=u*ze,me+=u*Re,Se+=u*Je,Ie+=u*Qe,u=N[8],_e+=u*Me,pe+=u*Le,fe+=u*je,ue+=u*qe,ce+=u*Be,ae+=u*Fe,oe+=u*Ge,re+=u*ke,le+=u*We,ge+=u*Ye,ne+=u*Xe,be+=u*Ke,me+=u*ze,Se+=u*Re,Ie+=u*Je,Ee+=u*Qe,u=N[9],pe+=u*Me,fe+=u*Le,ue+=u*je,ce+=u*qe,ae+=u*Be,oe+=u*Fe,re+=u*Ge,le+=u*ke,ge+=u*We,ne+=u*Ye,be+=u*Xe,me+=u*Ke,Se+=u*ze,Ie+=u*Re,Ee+=u*Je,xt+=u*Qe,u=N[10],fe+=u*Me,ue+=u*Le,ce+=u*je,ae+=u*qe,oe+=u*Be,re+=u*Fe,le+=u*Ge,ge+=u*ke,ne+=u*We,be+=u*Ye,me+=u*Xe,Se+=u*Ke,Ie+=u*ze,Ee+=u*Re,xt+=u*Je,Lt+=u*Qe,u=N[11],ue+=u*Me,ce+=u*Le,ae+=u*je,oe+=u*qe,re+=u*Be,le+=u*Fe,ge+=u*Ge,ne+=u*ke,be+=u*We,me+=u*Ye,Se+=u*Xe,Ie+=u*Ke,Ee+=u*ze,xt+=u*Re,Lt+=u*Je,Kt+=u*Qe,u=N[12],ce+=u*Me,ae+=u*Le,oe+=u*je,re+=u*qe,le+=u*Be,ge+=u*Fe,ne+=u*Ge,be+=u*ke,me+=u*We,Se+=u*Ye,Ie+=u*Xe,Ee+=u*Ke,xt+=u*ze,Lt+=u*Re,Kt+=u*Je,mt+=u*Qe,u=N[13],ae+=u*Me,oe+=u*Le,re+=u*je,le+=u*qe,ge+=u*Be,ne+=u*Fe,be+=u*Ge,me+=u*ke,Se+=u*We,Ie+=u*Ye,Ee+=u*Xe,xt+=u*Ke,Lt+=u*ze,Kt+=u*Re,mt+=u*Je,nr+=u*Qe,u=N[14],oe+=u*Me,re+=u*Le,le+=u*je,ge+=u*qe,ne+=u*Be,be+=u*Fe,me+=u*Ge,Se+=u*ke,Ie+=u*We,Ee+=u*Ye,xt+=u*Xe,Lt+=u*Ke,Kt+=u*ze,mt+=u*Re,nr+=u*Je,Wr+=u*Qe,u=N[15],re+=u*Me,le+=u*Le,ge+=u*je,ne+=u*qe,be+=u*Be,me+=u*Fe,Se+=u*Ge,Ie+=u*ke,Ee+=u*We,xt+=u*Ye,Lt+=u*Xe,Kt+=u*Ke,mt+=u*ze,nr+=u*Re,Wr+=u*Je,Oi+=u*Qe,H+=38*le,Y+=38*ge,he+=38*ne,we+=38*be,de+=38*me,ve+=38*Se,Ue+=38*Ie,Ce+=38*Ee,_e+=38*xt,pe+=38*Lt,fe+=38*Kt,ue+=38*mt,ce+=38*nr,ae+=38*Wr,oe+=38*Oi,v=1,u=H+v+65535,v=Math.floor(u/65536),H=u-v*65536,u=Y+v+65535,v=Math.floor(u/65536),Y=u-v*65536,u=he+v+65535,v=Math.floor(u/65536),he=u-v*65536,u=we+v+65535,v=Math.floor(u/65536),we=u-v*65536,u=de+v+65535,v=Math.floor(u/65536),de=u-v*65536,u=ve+v+65535,v=Math.floor(u/65536),ve=u-v*65536,u=Ue+v+65535,v=Math.floor(u/65536),Ue=u-v*65536,u=Ce+v+65535,v=Math.floor(u/65536),Ce=u-v*65536,u=_e+v+65535,v=Math.floor(u/65536),_e=u-v*65536,u=pe+v+65535,v=Math.floor(u/65536),pe=u-v*65536,u=fe+v+65535,v=Math.floor(u/65536),fe=u-v*65536,u=ue+v+65535,v=Math.floor(u/65536),ue=u-v*65536,u=ce+v+65535,v=Math.floor(u/65536),ce=u-v*65536,u=ae+v+65535,v=Math.floor(u/65536),ae=u-v*65536,u=oe+v+65535,v=Math.floor(u/65536),oe=u-v*65536,u=re+v+65535,v=Math.floor(u/65536),re=u-v*65536,H+=v-1+37*(v-1),v=1,u=H+v+65535,v=Math.floor(u/65536),H=u-v*65536,u=Y+v+65535,v=Math.floor(u/65536),Y=u-v*65536,u=he+v+65535,v=Math.floor(u/65536),he=u-v*65536,u=we+v+65535,v=Math.floor(u/65536),we=u-v*65536,u=de+v+65535,v=Math.floor(u/65536),de=u-v*65536,u=ve+v+65535,v=Math.floor(u/65536),ve=u-v*65536,u=Ue+v+65535,v=Math.floor(u/65536),Ue=u-v*65536,u=Ce+v+65535,v=Math.floor(u/65536),Ce=u-v*65536,u=_e+v+65535,v=Math.floor(u/65536),_e=u-v*65536,u=pe+v+65535,v=Math.floor(u/65536),pe=u-v*65536,u=fe+v+65535,v=Math.floor(u/65536),fe=u-v*65536,u=ue+v+65535,v=Math.floor(u/65536),ue=u-v*65536,u=ce+v+65535,v=Math.floor(u/65536),ce=u-v*65536,u=ae+v+65535,v=Math.floor(u/65536),ae=u-v*65536,u=oe+v+65535,v=Math.floor(u/65536),oe=u-v*65536,u=re+v+65535,v=Math.floor(u/65536),re=u-v*65536,H+=v-1+37*(v-1),R[0]=H,R[1]=Y,R[2]=he,R[3]=we,R[4]=de,R[5]=ve,R[6]=Ue,R[7]=Ce,R[8]=_e,R[9]=pe,R[10]=fe,R[11]=ue,R[12]=ce,R[13]=ae,R[14]=oe,R[15]=re}function d(R,N){o(R,N,N)}function C(R,N){const S=n();let u;for(u=0;u<16;u++)S[u]=N[u];for(u=253;u>=0;u--)d(S,S),u!==2&&u!==4&&o(S,S,N);for(u=0;u<16;u++)R[u]=S[u]}function L(R,N){const S=n();let u;for(u=0;u<16;u++)S[u]=N[u];for(u=250;u>=0;u--)d(S,S),u!==1&&o(S,S,N);for(u=0;u<16;u++)R[u]=S[u]}function K(R,N){const S=n(),u=n(),v=n(),H=n(),Y=n(),he=n(),we=n(),de=n(),ve=n();p(S,R[1],R[0]),p(ve,N[1],N[0]),o(S,S,ve),E(u,R[0],R[1]),E(ve,N[0],N[1]),o(u,u,ve),o(v,R[3],N[3]),o(v,v,l),o(H,R[2],N[2]),E(H,H,H),p(Y,u,S),p(he,H,v),E(we,H,v),E(de,u,S),o(R[0],Y,he),o(R[1],de,we),o(R[2],we,he),o(R[3],Y,de)}function G(R,N,S){for(let u=0;u<4;u++)T(R[u],N[u],S)}function Q(R,N){const S=n(),u=n(),v=n();C(v,N[2]),o(S,N[0],v),o(u,N[1],v),A(R,u),R[31]^=x(S)<<7}function O(R,N,S){w(R[0],a),w(R[1],c),w(R[2],c),w(R[3],a);for(let u=255;u>=0;--u){const v=S[u/8|0]>>(u&7)&1;G(R,N,v),K(N,R),K(R,R),G(R,N,v)}}function P(R,N){const S=[n(),n(),n(),n()];w(S[0],f),w(S[1],g),w(S[2],c),o(S[3],f,g),O(R,S,N)}function k(R){if(R.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const N=(0,r.hash)(R);N[0]&=248,N[31]&=127,N[31]|=64;const S=new Uint8Array(32),u=[n(),n(),n(),n()];P(u,N),Q(S,u);const v=new Uint8Array(64);return v.set(R),v.set(S,32),{publicKey:S,secretKey:v}}t.generateKeyPairFromSeed=k;function q(R){const N=(0,e.randomBytes)(32,R),S=k(N);return(0,i.wipe)(N),S}t.generateKeyPair=q;function $(R){if(R.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(R.subarray(32))}t.extractPublicKeyFromSecretKey=$;const j=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function F(R,N){let S,u,v,H;for(u=63;u>=32;--u){for(S=0,v=u-32,H=u-12;v<H;++v)N[v]+=S-16*N[u]*j[v-(u-32)],S=Math.floor((N[v]+128)/256),N[v]-=S*256;N[v]+=S,N[u]=0}for(S=0,v=0;v<32;v++)N[v]+=S-(N[31]>>4)*j[v],S=N[v]>>8,N[v]&=255;for(v=0;v<32;v++)N[v]-=S*j[v];for(u=0;u<32;u++)N[u+1]+=N[u]>>8,R[u]=N[u]&255}function B(R){const N=new Float64Array(64);for(let S=0;S<64;S++)N[S]=R[S];for(let S=0;S<64;S++)R[S]=0;F(R,N)}function te(R,N){const S=new Float64Array(64),u=[n(),n(),n(),n()],v=(0,r.hash)(R.subarray(0,32));v[0]&=248,v[31]&=127,v[31]|=64;const H=new Uint8Array(64);H.set(v.subarray(32),32);const Y=new r.SHA512;Y.update(H.subarray(32)),Y.update(N);const he=Y.digest();Y.clean(),B(he),P(u,he),Q(H,u),Y.reset(),Y.update(H.subarray(0,32)),Y.update(R.subarray(32)),Y.update(N);const we=Y.digest();B(we);for(let de=0;de<32;de++)S[de]=he[de];for(let de=0;de<32;de++)for(let ve=0;ve<32;ve++)S[de+ve]+=we[de]*v[ve];return F(H.subarray(32),S),H}t.sign=te;function z(R,N){const S=n(),u=n(),v=n(),H=n(),Y=n(),he=n(),we=n();return w(R[2],c),b(R[1],N),d(v,R[1]),o(H,v,h),p(v,v,R[2]),E(H,R[2],H),d(Y,H),d(he,Y),o(we,he,Y),o(S,we,v),o(S,S,H),L(S,S),o(S,S,v),o(S,S,H),o(S,S,H),o(R[0],S,H),d(u,R[0]),o(u,u,H),D(u,v)&&o(R[0],R[0],y),d(u,R[0]),o(u,u,H),D(u,v)?-1:(x(R[0])===N[31]>>7&&p(R[0],a,R[0]),o(R[3],R[0],R[1]),0)}function Z(R,N,S){const u=new Uint8Array(32),v=[n(),n(),n(),n()],H=[n(),n(),n(),n()];if(S.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(z(H,R))return!1;const Y=new r.SHA512;Y.update(S.subarray(0,32)),Y.update(R),Y.update(N);const he=Y.digest();return B(he),O(v,H,he),P(H,S.subarray(32)),K(v,H),Q(u,v),!M(S,u)}t.verify=Z;function X(R){let N=[n(),n(),n(),n()];if(z(N,R))throw new Error("Ed25519: invalid public key");let S=n(),u=n(),v=N[1];E(S,c,v),p(u,c,v),C(u,u),o(S,S,u);let H=new Uint8Array(32);return A(H,S),H}t.convertPublicKeyToX25519=X;function ee(R){const N=(0,r.hash)(R.subarray(0,32));N[0]&=248,N[31]&=127,N[31]|=64;const S=new Uint8Array(N.subarray(0,32));return(0,i.wipe)(N),S}t.convertSecretKeyToX25519=ee}(Zi);const oh="EdDSA",ah="JWT",Ks=".",Hs="base64url",ch="utf8",uh="utf8",lh=":",hh="did",fh="key",Vs="base58btc",dh="z",ph="K36",gh=32;function sn(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function Gs(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?sn(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function on(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=Gs(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return sn(r)}function yh(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=t.length,h=t.charAt(0),l=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var T=0,A=0,M=0,D=m.length;M!==D&&m[M]===0;)M++,T++;for(var x=(D-M)*f+1>>>0,b=new Uint8Array(x);M!==D;){for(var E=m[M],p=0,o=x-1;(E!==0||p<A)&&o!==-1;o--,p++)E+=256*b[o]>>>0,b[o]=E%c>>>0,E=E/c>>>0;if(E!==0)throw new Error("Non-zero carry");A=p,M++}for(var d=x-A;d!==x&&b[d]===0;)d++;for(var C=h.repeat(T);d<x;++d)C+=t.charAt(b[d]);return C}function y(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var T=0;if(m[T]!==" "){for(var A=0,M=0;m[T]===h;)A++,T++;for(var D=(m.length-T)*l+1>>>0,x=new Uint8Array(D);m[T];){var b=r[m.charCodeAt(T)];if(b===255)return;for(var E=0,p=D-1;(b!==0||E<M)&&p!==-1;p--,E++)b+=c*x[p]>>>0,x[p]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");M=E,T++}if(m[T]!==" "){for(var o=D-M;o!==D&&x[o]===0;)o++;for(var d=new Uint8Array(A+(D-o)),C=A;o!==D;)d[C++]=x[o++];return d}}}function w(m){var T=y(m);if(T)return T;throw new Error(`Non-${e} character`)}return{encode:g,decodeUnsafe:y,decode:w}}var _h=yh,wh=_h;const ks=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},bh=t=>new TextEncoder().encode(t),mh=t=>new TextDecoder().decode(t);class vh{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Eh{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return Ws(this,e)}}class Dh{constructor(e){this.decoders=e}or(e){return Ws(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const Ws=(t,e)=>new Dh({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Sh{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new vh(e,r,i),this.decoder=new Eh(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const hi=({name:t,prefix:e,encode:r,decode:i})=>new Sh(t,e,r,i),Cr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=wh(r,e);return hi({prefix:t,name:e,encode:i,decode:s=>ks(n(s))})},Ih=(t,e,r,i)=>{const n={};for(let f=0;f<e.length;++f)n[e[f]]=f;let s=t.length;for(;t[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,h=0,l=0;for(let f=0;f<s;++f){const g=n[t[f]];if(g===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|g,c+=r,c>=8&&(c-=8,a[l++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return a},Oh=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],a+=8;a>r;)a-=r,s+=e[n&c>>a];if(a&&(s+=e[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},et=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>hi({prefix:e,name:t,encode(n){return Oh(n,i,r)},decode(n){return Ih(n,i,r,t)}}),xh=hi({prefix:"\0",name:"identity",encode:t=>mh(t),decode:t=>bh(t)});var Th=Object.freeze({__proto__:null,identity:xh});const Nh=et({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var Rh=Object.freeze({__proto__:null,base2:Nh});const Ph=et({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var Ah=Object.freeze({__proto__:null,base8:Ph});const Ch=Cr({prefix:"9",name:"base10",alphabet:"0123456789"});var Lh=Object.freeze({__proto__:null,base10:Ch});const Fh=et({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),$h=et({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var Uh=Object.freeze({__proto__:null,base16:Fh,base16upper:$h});const Mh=et({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),jh=et({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),qh=et({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),Bh=et({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),zh=et({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),Kh=et({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Hh=et({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Vh=et({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),Gh=et({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var kh=Object.freeze({__proto__:null,base32:Mh,base32upper:jh,base32pad:qh,base32padupper:Bh,base32hex:zh,base32hexupper:Kh,base32hexpad:Hh,base32hexpadupper:Vh,base32z:Gh});const Wh=Cr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Yh=Cr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Xh=Object.freeze({__proto__:null,base36:Wh,base36upper:Yh});const Jh=Cr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Qh=Cr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Zh=Object.freeze({__proto__:null,base58btc:Jh,base58flickr:Qh});const ef=et({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),tf=et({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),rf=et({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),nf=et({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var sf=Object.freeze({__proto__:null,base64:ef,base64pad:tf,base64url:rf,base64urlpad:nf});const Ys=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),of=Ys.reduce((t,e,r)=>(t[r]=e,t),[]),af=Ys.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function cf(t){return t.reduce((e,r)=>(e+=of[r],e),"")}function uf(t){const e=[];for(const r of t){const i=af[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const lf=hi({prefix:"\u{1F680}",name:"base256emoji",encode:cf,decode:uf});var hf=Object.freeze({__proto__:null,base256emoji:lf}),ff=Js,Xs=128,df=127,pf=~df,gf=Math.pow(2,31);function Js(t,e,r){e=e||[],r=r||0;for(var i=r;t>=gf;)e[r++]=t&255|Xs,t/=128;for(;t&pf;)e[r++]=t&255|Xs,t>>>=7;return e[r]=t|0,Js.bytes=r-i+1,e}var yf=an,_f=128,Qs=127;function an(t,i){var r=0,i=i||0,n=0,s=i,a,c=t.length;do{if(s>=c)throw an.bytes=0,new RangeError("Could not decode varint");a=t[s++],r+=n<28?(a&Qs)<<n:(a&Qs)*Math.pow(2,n),n+=7}while(a>=_f);return an.bytes=s-i,r}var wf=Math.pow(2,7),bf=Math.pow(2,14),mf=Math.pow(2,21),vf=Math.pow(2,28),Ef=Math.pow(2,35),Df=Math.pow(2,42),Sf=Math.pow(2,49),If=Math.pow(2,56),Of=Math.pow(2,63),xf=function(t){return t<wf?1:t<bf?2:t<mf?3:t<vf?4:t<Ef?5:t<Df?6:t<Sf?7:t<If?8:t<Of?9:10},Tf={encode:ff,decode:yf,encodingLength:xf},Zs=Tf;const eo=(t,e,r=0)=>(Zs.encode(t,e,r),e),to=t=>Zs.encodingLength(t),cn=(t,e)=>{const r=e.byteLength,i=to(t),n=i+to(r),s=new Uint8Array(n+r);return eo(t,s,0),eo(r,s,i),s.set(e,n),new Nf(t,r,e,s)};class Nf{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const ro=({name:t,code:e,encode:r})=>new Rf(t,e,r);class Rf{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?cn(this.code,r):r.then(i=>cn(this.code,i))}else throw Error("Unknown type, must be binary type")}}const io=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),Pf=ro({name:"sha2-256",code:18,encode:io("SHA-256")}),Af=ro({name:"sha2-512",code:19,encode:io("SHA-512")});var Cf=Object.freeze({__proto__:null,sha256:Pf,sha512:Af});const no=0,Lf="identity",so=ks;var Ff=Object.freeze({__proto__:null,identity:{code:no,name:Lf,encode:so,digest:t=>cn(no,so(t))}});new TextEncoder,new TextDecoder;const oo={...Th,...Rh,...Ah,...Lh,...Uh,...kh,...Xh,...Zh,...sf,...hf};({...Cf,...Ff});function ao(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const co=ao("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),un=ao("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=Gs(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),uo={utf8:co,"utf-8":co,hex:oo.base16,latin1:un,ascii:un,binary:un,...oo};function ot(t,e="utf8"){const r=uo[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function pt(t,e="utf8"){const r=uo[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?sn(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function fi(t){return ot(pt(Ir(t),ch),Hs)}function lo(t){const e=pt(ph,Vs),r=dh+ot(on([e,t]),Vs);return[hh,fh,r].join(lh)}function $f(t){return ot(t,Hs)}function Uf(t){return pt([fi(t.header),fi(t.payload)].join(Ks),uh)}function Mf(t){return[fi(t.header),fi(t.payload),$f(t.signature)].join(Ks)}function ho(t=hr.randomBytes(gh)){return Zi.generateKeyPairFromSeed(t)}async function jf(t,e,r,i,n=W.fromMiliseconds(Date.now())){const s={alg:oh,typ:ah},a=lo(i.publicKey),c=n+r,h={iss:a,sub:t,aud:e,iat:n,exp:c},l=Uf({header:s,payload:h}),f=Zi.sign(i.secretKey,l);return Mf({header:s,payload:h,signature:f})}var ln={},di={};Object.defineProperty(di,"__esModule",{value:!0});var it=ie,hn=yt,qf=20;function Bf(t,e,r){for(var i=1634760805,n=857760878,s=2036477234,a=1797285236,c=r[3]<<24|r[2]<<16|r[1]<<8|r[0],h=r[7]<<24|r[6]<<16|r[5]<<8|r[4],l=r[11]<<24|r[10]<<16|r[9]<<8|r[8],f=r[15]<<24|r[14]<<16|r[13]<<8|r[12],g=r[19]<<24|r[18]<<16|r[17]<<8|r[16],y=r[23]<<24|r[22]<<16|r[21]<<8|r[20],w=r[27]<<24|r[26]<<16|r[25]<<8|r[24],m=r[31]<<24|r[30]<<16|r[29]<<8|r[28],T=e[3]<<24|e[2]<<16|e[1]<<8|e[0],A=e[7]<<24|e[6]<<16|e[5]<<8|e[4],M=e[11]<<24|e[10]<<16|e[9]<<8|e[8],D=e[15]<<24|e[14]<<16|e[13]<<8|e[12],x=i,b=n,E=s,p=a,o=c,d=h,C=l,L=f,K=g,G=y,Q=w,O=m,P=T,k=A,q=M,$=D,j=0;j<qf;j+=2)x=x+o|0,P^=x,P=P>>>32-16|P<<16,K=K+P|0,o^=K,o=o>>>32-12|o<<12,b=b+d|0,k^=b,k=k>>>32-16|k<<16,G=G+k|0,d^=G,d=d>>>32-12|d<<12,E=E+C|0,q^=E,q=q>>>32-16|q<<16,Q=Q+q|0,C^=Q,C=C>>>32-12|C<<12,p=p+L|0,$^=p,$=$>>>32-16|$<<16,O=O+$|0,L^=O,L=L>>>32-12|L<<12,E=E+C|0,q^=E,q=q>>>32-8|q<<8,Q=Q+q|0,C^=Q,C=C>>>32-7|C<<7,p=p+L|0,$^=p,$=$>>>32-8|$<<8,O=O+$|0,L^=O,L=L>>>32-7|L<<7,b=b+d|0,k^=b,k=k>>>32-8|k<<8,G=G+k|0,d^=G,d=d>>>32-7|d<<7,x=x+o|0,P^=x,P=P>>>32-8|P<<8,K=K+P|0,o^=K,o=o>>>32-7|o<<7,x=x+d|0,$^=x,$=$>>>32-16|$<<16,Q=Q+$|0,d^=Q,d=d>>>32-12|d<<12,b=b+C|0,P^=b,P=P>>>32-16|P<<16,O=O+P|0,C^=O,C=C>>>32-12|C<<12,E=E+L|0,k^=E,k=k>>>32-16|k<<16,K=K+k|0,L^=K,L=L>>>32-12|L<<12,p=p+o|0,q^=p,q=q>>>32-16|q<<16,G=G+q|0,o^=G,o=o>>>32-12|o<<12,E=E+L|0,k^=E,k=k>>>32-8|k<<8,K=K+k|0,L^=K,L=L>>>32-7|L<<7,p=p+o|0,q^=p,q=q>>>32-8|q<<8,G=G+q|0,o^=G,o=o>>>32-7|o<<7,b=b+C|0,P^=b,P=P>>>32-8|P<<8,O=O+P|0,C^=O,C=C>>>32-7|C<<7,x=x+d|0,$^=x,$=$>>>32-8|$<<8,Q=Q+$|0,d^=Q,d=d>>>32-7|d<<7;it.writeUint32LE(x+i|0,t,0),it.writeUint32LE(b+n|0,t,4),it.writeUint32LE(E+s|0,t,8),it.writeUint32LE(p+a|0,t,12),it.writeUint32LE(o+c|0,t,16),it.writeUint32LE(d+h|0,t,20),it.writeUint32LE(C+l|0,t,24),it.writeUint32LE(L+f|0,t,28),it.writeUint32LE(K+g|0,t,32),it.writeUint32LE(G+y|0,t,36),it.writeUint32LE(Q+w|0,t,40),it.writeUint32LE(O+m|0,t,44),it.writeUint32LE(P+T|0,t,48),it.writeUint32LE(k+A|0,t,52),it.writeUint32LE(q+M|0,t,56),it.writeUint32LE($+D|0,t,60)}function fo(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,a;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),a=s.length-e.length,s.set(e,a)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,a=n}for(var c=new Uint8Array(64),h=0;h<r.length;h+=64){Bf(c,s,t);for(var l=h;l<h+64&&l<r.length;l++)i[l]=r[l]^c[l-h];Kf(s,0,a)}return hn.wipe(c),n===0&&hn.wipe(s),i}di.streamXOR=fo;function zf(t,e,r,i){return i===void 0&&(i=0),hn.wipe(r),fo(t,e,r,r,i)}di.stream=zf;function Kf(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var po={},qt={};Object.defineProperty(qt,"__esModule",{value:!0});function Hf(t,e,r){return~(t-1)&e|t-1&r}qt.select=Hf;function Vf(t,e){return(t|0)-(e|0)-1>>>31&1}qt.lessOrEqual=Vf;function go(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}qt.compare=go;function Gf(t,e){return t.length===0||e.length===0?!1:go(t,e)!==0}qt.equal=Gf,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=qt,r=yt;t.DIGEST_LENGTH=16;var i=function(){function a(c){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=c[0]|c[1]<<8;this._r[0]=h&8191;var l=c[2]|c[3]<<8;this._r[1]=(h>>>13|l<<3)&8191;var f=c[4]|c[5]<<8;this._r[2]=(l>>>10|f<<6)&7939;var g=c[6]|c[7]<<8;this._r[3]=(f>>>7|g<<9)&8191;var y=c[8]|c[9]<<8;this._r[4]=(g>>>4|y<<12)&255,this._r[5]=y>>>1&8190;var w=c[10]|c[11]<<8;this._r[6]=(y>>>14|w<<2)&8191;var m=c[12]|c[13]<<8;this._r[7]=(w>>>11|m<<5)&8065;var T=c[14]|c[15]<<8;this._r[8]=(m>>>8|T<<8)&8191,this._r[9]=T>>>5&127,this._pad[0]=c[16]|c[17]<<8,this._pad[1]=c[18]|c[19]<<8,this._pad[2]=c[20]|c[21]<<8,this._pad[3]=c[22]|c[23]<<8,this._pad[4]=c[24]|c[25]<<8,this._pad[5]=c[26]|c[27]<<8,this._pad[6]=c[28]|c[29]<<8,this._pad[7]=c[30]|c[31]<<8}return a.prototype._blocks=function(c,h,l){for(var f=this._fin?0:2048,g=this._h[0],y=this._h[1],w=this._h[2],m=this._h[3],T=this._h[4],A=this._h[5],M=this._h[6],D=this._h[7],x=this._h[8],b=this._h[9],E=this._r[0],p=this._r[1],o=this._r[2],d=this._r[3],C=this._r[4],L=this._r[5],K=this._r[6],G=this._r[7],Q=this._r[8],O=this._r[9];l>=16;){var P=c[h+0]|c[h+1]<<8;g+=P&8191;var k=c[h+2]|c[h+3]<<8;y+=(P>>>13|k<<3)&8191;var q=c[h+4]|c[h+5]<<8;w+=(k>>>10|q<<6)&8191;var $=c[h+6]|c[h+7]<<8;m+=(q>>>7|$<<9)&8191;var j=c[h+8]|c[h+9]<<8;T+=($>>>4|j<<12)&8191,A+=j>>>1&8191;var F=c[h+10]|c[h+11]<<8;M+=(j>>>14|F<<2)&8191;var B=c[h+12]|c[h+13]<<8;D+=(F>>>11|B<<5)&8191;var te=c[h+14]|c[h+15]<<8;x+=(B>>>8|te<<8)&8191,b+=te>>>5|f;var z=0,Z=z;Z+=g*E,Z+=y*(5*O),Z+=w*(5*Q),Z+=m*(5*G),Z+=T*(5*K),z=Z>>>13,Z&=8191,Z+=A*(5*L),Z+=M*(5*C),Z+=D*(5*d),Z+=x*(5*o),Z+=b*(5*p),z+=Z>>>13,Z&=8191;var X=z;X+=g*p,X+=y*E,X+=w*(5*O),X+=m*(5*Q),X+=T*(5*G),z=X>>>13,X&=8191,X+=A*(5*K),X+=M*(5*L),X+=D*(5*C),X+=x*(5*d),X+=b*(5*o),z+=X>>>13,X&=8191;var ee=z;ee+=g*o,ee+=y*p,ee+=w*E,ee+=m*(5*O),ee+=T*(5*Q),z=ee>>>13,ee&=8191,ee+=A*(5*G),ee+=M*(5*K),ee+=D*(5*L),ee+=x*(5*C),ee+=b*(5*d),z+=ee>>>13,ee&=8191;var R=z;R+=g*d,R+=y*o,R+=w*p,R+=m*E,R+=T*(5*O),z=R>>>13,R&=8191,R+=A*(5*Q),R+=M*(5*G),R+=D*(5*K),R+=x*(5*L),R+=b*(5*C),z+=R>>>13,R&=8191;var N=z;N+=g*C,N+=y*d,N+=w*o,N+=m*p,N+=T*E,z=N>>>13,N&=8191,N+=A*(5*O),N+=M*(5*Q),N+=D*(5*G),N+=x*(5*K),N+=b*(5*L),z+=N>>>13,N&=8191;var S=z;S+=g*L,S+=y*C,S+=w*d,S+=m*o,S+=T*p,z=S>>>13,S&=8191,S+=A*E,S+=M*(5*O),S+=D*(5*Q),S+=x*(5*G),S+=b*(5*K),z+=S>>>13,S&=8191;var u=z;u+=g*K,u+=y*L,u+=w*C,u+=m*d,u+=T*o,z=u>>>13,u&=8191,u+=A*p,u+=M*E,u+=D*(5*O),u+=x*(5*Q),u+=b*(5*G),z+=u>>>13,u&=8191;var v=z;v+=g*G,v+=y*K,v+=w*L,v+=m*C,v+=T*d,z=v>>>13,v&=8191,v+=A*o,v+=M*p,v+=D*E,v+=x*(5*O),v+=b*(5*Q),z+=v>>>13,v&=8191;var H=z;H+=g*Q,H+=y*G,H+=w*K,H+=m*L,H+=T*C,z=H>>>13,H&=8191,H+=A*d,H+=M*o,H+=D*p,H+=x*E,H+=b*(5*O),z+=H>>>13,H&=8191;var Y=z;Y+=g*O,Y+=y*Q,Y+=w*G,Y+=m*K,Y+=T*L,z=Y>>>13,Y&=8191,Y+=A*C,Y+=M*d,Y+=D*o,Y+=x*p,Y+=b*E,z+=Y>>>13,Y&=8191,z=(z<<2)+z|0,z=z+Z|0,Z=z&8191,z=z>>>13,X+=z,g=Z,y=X,w=ee,m=R,T=N,A=S,M=u,D=v,x=H,b=Y,h+=16,l-=16}this._h[0]=g,this._h[1]=y,this._h[2]=w,this._h[3]=m,this._h[4]=T,this._h[5]=A,this._h[6]=M,this._h[7]=D,this._h[8]=x,this._h[9]=b},a.prototype.finish=function(c,h){h===void 0&&(h=0);var l=new Uint16Array(10),f,g,y,w;if(this._leftover){for(w=this._leftover,this._buffer[w++]=1;w<16;w++)this._buffer[w]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(f=this._h[1]>>>13,this._h[1]&=8191,w=2;w<10;w++)this._h[w]+=f,f=this._h[w]>>>13,this._h[w]&=8191;for(this._h[0]+=f*5,f=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=f,f=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=f,l[0]=this._h[0]+5,f=l[0]>>>13,l[0]&=8191,w=1;w<10;w++)l[w]=this._h[w]+f,f=l[w]>>>13,l[w]&=8191;for(l[9]-=8192,g=(f^1)-1,w=0;w<10;w++)l[w]&=g;for(g=~g,w=0;w<10;w++)this._h[w]=this._h[w]&g|l[w];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,y=this._h[0]+this._pad[0],this._h[0]=y&65535,w=1;w<8;w++)y=(this._h[w]+this._pad[w]|0)+(y>>>16)|0,this._h[w]=y&65535;return c[h+0]=this._h[0]>>>0,c[h+1]=this._h[0]>>>8,c[h+2]=this._h[1]>>>0,c[h+3]=this._h[1]>>>8,c[h+4]=this._h[2]>>>0,c[h+5]=this._h[2]>>>8,c[h+6]=this._h[3]>>>0,c[h+7]=this._h[3]>>>8,c[h+8]=this._h[4]>>>0,c[h+9]=this._h[4]>>>8,c[h+10]=this._h[5]>>>0,c[h+11]=this._h[5]>>>8,c[h+12]=this._h[6]>>>0,c[h+13]=this._h[6]>>>8,c[h+14]=this._h[7]>>>0,c[h+15]=this._h[7]>>>8,this._finished=!0,this},a.prototype.update=function(c){var h=0,l=c.length,f;if(this._leftover){f=16-this._leftover,f>l&&(f=l);for(var g=0;g<f;g++)this._buffer[this._leftover+g]=c[h+g];if(l-=f,h+=f,this._leftover+=f,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(l>=16&&(f=l-l%16,this._blocks(c,h,f),h+=f,l-=f),l){for(var g=0;g<l;g++)this._buffer[this._leftover+g]=c[h+g];this._leftover+=l}return this},a.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var c=new Uint8Array(16);return this.finish(c),c},a.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},a}();t.Poly1305=i;function n(a,c){var h=new i(a);h.update(c);var l=h.digest();return h.clean(),l}t.oneTimeAuth=n;function s(a,c){return a.length!==t.DIGEST_LENGTH||c.length!==t.DIGEST_LENGTH?!1:e.equal(a,c)}t.equal=s}(po),function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=di,r=po,i=yt,n=ie,s=qt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var a=new Uint8Array(16),c=function(){function h(l){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,l.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(l)}return h.prototype.seal=function(l,f,g,y){if(l.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var w=new Uint8Array(16);w.set(l,w.length-l.length);var m=new Uint8Array(32);e.stream(this._key,w,m,4);var T=f.length+this.tagLength,A;if(y){if(y.length!==T)throw new Error("ChaCha20Poly1305: incorrect destination length");A=y}else A=new Uint8Array(T);return e.streamXOR(this._key,w,f,A,4),this._authenticate(A.subarray(A.length-this.tagLength,A.length),m,A.subarray(0,A.length-this.tagLength),g),i.wipe(w),A},h.prototype.open=function(l,f,g,y){if(l.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(f.length<this.tagLength)return null;var w=new Uint8Array(16);w.set(l,w.length-l.length);var m=new Uint8Array(32);e.stream(this._key,w,m,4);var T=new Uint8Array(this.tagLength);if(this._authenticate(T,m,f.subarray(0,f.length-this.tagLength),g),!s.equal(T,f.subarray(f.length-this.tagLength,f.length)))return null;var A=f.length-this.tagLength,M;if(y){if(y.length!==A)throw new Error("ChaCha20Poly1305: incorrect destination length");M=y}else M=new Uint8Array(A);return e.streamXOR(this._key,w,f.subarray(0,f.length-this.tagLength),M,4),i.wipe(w),M},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(l,f,g,y){var w=new r.Poly1305(f);y&&(w.update(y),y.length%16>0&&w.update(a.subarray(y.length%16))),w.update(g),g.length%16>0&&w.update(a.subarray(g.length%16));var m=new Uint8Array(8);y&&n.writeUint64LE(y.length,m),w.update(m),n.writeUint64LE(g.length,m),w.update(m);for(var T=w.digest(),A=0;A<T.length;A++)l[A]=T[A];w.clean(),i.wipe(T),i.wipe(m)},h}();t.ChaCha20Poly1305=c}(ln);var yo={},Lr={},fn={};Object.defineProperty(fn,"__esModule",{value:!0});function kf(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}fn.isSerializableHash=kf,Object.defineProperty(Lr,"__esModule",{value:!0});var Nt=fn,Wf=qt,Yf=yt,_o=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),Nt.isSerializableHash(this._inner)&&Nt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),Yf.wipe(i)}return t.prototype.reset=function(){if(!Nt.isSerializableHash(this._inner)||!Nt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){Nt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),Nt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!Nt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!Nt.isSerializableHash(this._inner)||!Nt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!Nt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();Lr.HMAC=_o;function Xf(t,e,r){var i=new _o(t,e);i.update(r);var n=i.digest();return i.clean(),n}Lr.hmac=Xf,Lr.equal=Wf.equal,Object.defineProperty(yo,"__esModule",{value:!0});var wo=Lr,bo=yt,Jf=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var s=wo.hmac(this._hash,i,r);this._hmac=new wo.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),bo.wipe(this._buffer),bo.wipe(this._counter),this._bufpos=0},t}(),Qf=yo.HKDF=Jf,pi={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=yt;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function c(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return c.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},c.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},c.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},c.prototype.update=function(h,l){if(l===void 0&&(l=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var f=0;if(this._bytesHashed+=l,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&l>0;)this._buffer[this._bufferLength++]=h[f++],l--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(l>=this.blockSize&&(f=s(this._temp,this._state,h,f,l),l%=this.blockSize);l>0;)this._buffer[this._bufferLength++]=h[f++],l--;return this},c.prototype.finish=function(h){if(!this._finished){var l=this._bytesHashed,f=this._bufferLength,g=l/536870912|0,y=l<<3,w=l%64<56?64:128;this._buffer[f]=128;for(var m=f+1;m<w-8;m++)this._buffer[m]=0;e.writeUint32BE(g,this._buffer,w-8),e.writeUint32BE(y,this._buffer,w-4),s(this._temp,this._state,this._buffer,0,w),this._finished=!0}for(var m=0;m<this.digestLength/4;m++)e.writeUint32BE(this._state[m],h,m*4);return this},c.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},c.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},c.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},c.prototype.cleanSavedState=function(h){r.wipe(h.state),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},c}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(c,h,l,f,g){for(;g>=64;){for(var y=h[0],w=h[1],m=h[2],T=h[3],A=h[4],M=h[5],D=h[6],x=h[7],b=0;b<16;b++){var E=f+b*4;c[b]=e.readUint32BE(l,E)}for(var b=16;b<64;b++){var p=c[b-2],o=(p>>>17|p<<32-17)^(p>>>19|p<<32-19)^p>>>10;p=c[b-15];var d=(p>>>7|p<<32-7)^(p>>>18|p<<32-18)^p>>>3;c[b]=(o+c[b-7]|0)+(d+c[b-16]|0)}for(var b=0;b<64;b++){var o=(((A>>>6|A<<26)^(A>>>11|A<<21)^(A>>>25|A<<7))+(A&M^~A&D)|0)+(x+(n[b]+c[b]|0)|0)|0,d=((y>>>2|y<<32-2)^(y>>>13|y<<32-13)^(y>>>22|y<<32-22))+(y&w^y&m^w&m)|0;x=D,D=M,M=A,A=T+o|0,T=m,m=w,w=y,y=o+d|0}h[0]+=y,h[1]+=w,h[2]+=m,h[3]+=T,h[4]+=A,h[5]+=M,h[6]+=D,h[7]+=x,f+=64,g-=64}return f}function a(c){var h=new i;h.update(c);var l=h.digest();return h.clean(),l}t.hash=a})(pi);var dn={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=hr,r=yt;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(b){const E=new Float64Array(16);if(b)for(let p=0;p<b.length;p++)E[p]=b[p];return E}const n=new Uint8Array(32);n[0]=9;const s=i([56129,1]);function a(b){let E=1;for(let p=0;p<16;p++){let o=b[p]+E+65535;E=Math.floor(o/65536),b[p]=o-E*65536}b[0]+=E-1+37*(E-1)}function c(b,E,p){const o=~(p-1);for(let d=0;d<16;d++){const C=o&(b[d]^E[d]);b[d]^=C,E[d]^=C}}function h(b,E){const p=i(),o=i();for(let d=0;d<16;d++)o[d]=E[d];a(o),a(o),a(o);for(let d=0;d<2;d++){p[0]=o[0]-65517;for(let L=1;L<15;L++)p[L]=o[L]-65535-(p[L-1]>>16&1),p[L-1]&=65535;p[15]=o[15]-32767-(p[14]>>16&1);const C=p[15]>>16&1;p[14]&=65535,c(o,p,1-C)}for(let d=0;d<16;d++)b[2*d]=o[d]&255,b[2*d+1]=o[d]>>8}function l(b,E){for(let p=0;p<16;p++)b[p]=E[2*p]+(E[2*p+1]<<8);b[15]&=32767}function f(b,E,p){for(let o=0;o<16;o++)b[o]=E[o]+p[o]}function g(b,E,p){for(let o=0;o<16;o++)b[o]=E[o]-p[o]}function y(b,E,p){let o,d,C=0,L=0,K=0,G=0,Q=0,O=0,P=0,k=0,q=0,$=0,j=0,F=0,B=0,te=0,z=0,Z=0,X=0,ee=0,R=0,N=0,S=0,u=0,v=0,H=0,Y=0,he=0,we=0,de=0,ve=0,Ue=0,Ce=0,_e=p[0],pe=p[1],fe=p[2],ue=p[3],ce=p[4],ae=p[5],oe=p[6],re=p[7],le=p[8],ge=p[9],ne=p[10],be=p[11],me=p[12],Se=p[13],Ie=p[14],Ee=p[15];o=E[0],C+=o*_e,L+=o*pe,K+=o*fe,G+=o*ue,Q+=o*ce,O+=o*ae,P+=o*oe,k+=o*re,q+=o*le,$+=o*ge,j+=o*ne,F+=o*be,B+=o*me,te+=o*Se,z+=o*Ie,Z+=o*Ee,o=E[1],L+=o*_e,K+=o*pe,G+=o*fe,Q+=o*ue,O+=o*ce,P+=o*ae,k+=o*oe,q+=o*re,$+=o*le,j+=o*ge,F+=o*ne,B+=o*be,te+=o*me,z+=o*Se,Z+=o*Ie,X+=o*Ee,o=E[2],K+=o*_e,G+=o*pe,Q+=o*fe,O+=o*ue,P+=o*ce,k+=o*ae,q+=o*oe,$+=o*re,j+=o*le,F+=o*ge,B+=o*ne,te+=o*be,z+=o*me,Z+=o*Se,X+=o*Ie,ee+=o*Ee,o=E[3],G+=o*_e,Q+=o*pe,O+=o*fe,P+=o*ue,k+=o*ce,q+=o*ae,$+=o*oe,j+=o*re,F+=o*le,B+=o*ge,te+=o*ne,z+=o*be,Z+=o*me,X+=o*Se,ee+=o*Ie,R+=o*Ee,o=E[4],Q+=o*_e,O+=o*pe,P+=o*fe,k+=o*ue,q+=o*ce,$+=o*ae,j+=o*oe,F+=o*re,B+=o*le,te+=o*ge,z+=o*ne,Z+=o*be,X+=o*me,ee+=o*Se,R+=o*Ie,N+=o*Ee,o=E[5],O+=o*_e,P+=o*pe,k+=o*fe,q+=o*ue,$+=o*ce,j+=o*ae,F+=o*oe,B+=o*re,te+=o*le,z+=o*ge,Z+=o*ne,X+=o*be,ee+=o*me,R+=o*Se,N+=o*Ie,S+=o*Ee,o=E[6],P+=o*_e,k+=o*pe,q+=o*fe,$+=o*ue,j+=o*ce,F+=o*ae,B+=o*oe,te+=o*re,z+=o*le,Z+=o*ge,X+=o*ne,ee+=o*be,R+=o*me,N+=o*Se,S+=o*Ie,u+=o*Ee,o=E[7],k+=o*_e,q+=o*pe,$+=o*fe,j+=o*ue,F+=o*ce,B+=o*ae,te+=o*oe,z+=o*re,Z+=o*le,X+=o*ge,ee+=o*ne,R+=o*be,N+=o*me,S+=o*Se,u+=o*Ie,v+=o*Ee,o=E[8],q+=o*_e,$+=o*pe,j+=o*fe,F+=o*ue,B+=o*ce,te+=o*ae,z+=o*oe,Z+=o*re,X+=o*le,ee+=o*ge,R+=o*ne,N+=o*be,S+=o*me,u+=o*Se,v+=o*Ie,H+=o*Ee,o=E[9],$+=o*_e,j+=o*pe,F+=o*fe,B+=o*ue,te+=o*ce,z+=o*ae,Z+=o*oe,X+=o*re,ee+=o*le,R+=o*ge,N+=o*ne,S+=o*be,u+=o*me,v+=o*Se,H+=o*Ie,Y+=o*Ee,o=E[10],j+=o*_e,F+=o*pe,B+=o*fe,te+=o*ue,z+=o*ce,Z+=o*ae,X+=o*oe,ee+=o*re,R+=o*le,N+=o*ge,S+=o*ne,u+=o*be,v+=o*me,H+=o*Se,Y+=o*Ie,he+=o*Ee,o=E[11],F+=o*_e,B+=o*pe,te+=o*fe,z+=o*ue,Z+=o*ce,X+=o*ae,ee+=o*oe,R+=o*re,N+=o*le,S+=o*ge,u+=o*ne,v+=o*be,H+=o*me,Y+=o*Se,he+=o*Ie,we+=o*Ee,o=E[12],B+=o*_e,te+=o*pe,z+=o*fe,Z+=o*ue,X+=o*ce,ee+=o*ae,R+=o*oe,N+=o*re,S+=o*le,u+=o*ge,v+=o*ne,H+=o*be,Y+=o*me,he+=o*Se,we+=o*Ie,de+=o*Ee,o=E[13],te+=o*_e,z+=o*pe,Z+=o*fe,X+=o*ue,ee+=o*ce,R+=o*ae,N+=o*oe,S+=o*re,u+=o*le,v+=o*ge,H+=o*ne,Y+=o*be,he+=o*me,we+=o*Se,de+=o*Ie,ve+=o*Ee,o=E[14],z+=o*_e,Z+=o*pe,X+=o*fe,ee+=o*ue,R+=o*ce,N+=o*ae,S+=o*oe,u+=o*re,v+=o*le,H+=o*ge,Y+=o*ne,he+=o*be,we+=o*me,de+=o*Se,ve+=o*Ie,Ue+=o*Ee,o=E[15],Z+=o*_e,X+=o*pe,ee+=o*fe,R+=o*ue,N+=o*ce,S+=o*ae,u+=o*oe,v+=o*re,H+=o*le,Y+=o*ge,he+=o*ne,we+=o*be,de+=o*me,ve+=o*Se,Ue+=o*Ie,Ce+=o*Ee,C+=38*X,L+=38*ee,K+=38*R,G+=38*N,Q+=38*S,O+=38*u,P+=38*v,k+=38*H,q+=38*Y,$+=38*he,j+=38*we,F+=38*de,B+=38*ve,te+=38*Ue,z+=38*Ce,d=1,o=C+d+65535,d=Math.floor(o/65536),C=o-d*65536,o=L+d+65535,d=Math.floor(o/65536),L=o-d*65536,o=K+d+65535,d=Math.floor(o/65536),K=o-d*65536,o=G+d+65535,d=Math.floor(o/65536),G=o-d*65536,o=Q+d+65535,d=Math.floor(o/65536),Q=o-d*65536,o=O+d+65535,d=Math.floor(o/65536),O=o-d*65536,o=P+d+65535,d=Math.floor(o/65536),P=o-d*65536,o=k+d+65535,d=Math.floor(o/65536),k=o-d*65536,o=q+d+65535,d=Math.floor(o/65536),q=o-d*65536,o=$+d+65535,d=Math.floor(o/65536),$=o-d*65536,o=j+d+65535,d=Math.floor(o/65536),j=o-d*65536,o=F+d+65535,d=Math.floor(o/65536),F=o-d*65536,o=B+d+65535,d=Math.floor(o/65536),B=o-d*65536,o=te+d+65535,d=Math.floor(o/65536),te=o-d*65536,o=z+d+65535,d=Math.floor(o/65536),z=o-d*65536,o=Z+d+65535,d=Math.floor(o/65536),Z=o-d*65536,C+=d-1+37*(d-1),d=1,o=C+d+65535,d=Math.floor(o/65536),C=o-d*65536,o=L+d+65535,d=Math.floor(o/65536),L=o-d*65536,o=K+d+65535,d=Math.floor(o/65536),K=o-d*65536,o=G+d+65535,d=Math.floor(o/65536),G=o-d*65536,o=Q+d+65535,d=Math.floor(o/65536),Q=o-d*65536,o=O+d+65535,d=Math.floor(o/65536),O=o-d*65536,o=P+d+65535,d=Math.floor(o/65536),P=o-d*65536,o=k+d+65535,d=Math.floor(o/65536),k=o-d*65536,o=q+d+65535,d=Math.floor(o/65536),q=o-d*65536,o=$+d+65535,d=Math.floor(o/65536),$=o-d*65536,o=j+d+65535,d=Math.floor(o/65536),j=o-d*65536,o=F+d+65535,d=Math.floor(o/65536),F=o-d*65536,o=B+d+65535,d=Math.floor(o/65536),B=o-d*65536,o=te+d+65535,d=Math.floor(o/65536),te=o-d*65536,o=z+d+65535,d=Math.floor(o/65536),z=o-d*65536,o=Z+d+65535,d=Math.floor(o/65536),Z=o-d*65536,C+=d-1+37*(d-1),b[0]=C,b[1]=L,b[2]=K,b[3]=G,b[4]=Q,b[5]=O,b[6]=P,b[7]=k,b[8]=q,b[9]=$,b[10]=j,b[11]=F,b[12]=B,b[13]=te,b[14]=z,b[15]=Z}function w(b,E){y(b,E,E)}function m(b,E){const p=i();for(let o=0;o<16;o++)p[o]=E[o];for(let o=253;o>=0;o--)w(p,p),o!==2&&o!==4&&y(p,p,E);for(let o=0;o<16;o++)b[o]=p[o]}function T(b,E){const p=new Uint8Array(32),o=new Float64Array(80),d=i(),C=i(),L=i(),K=i(),G=i(),Q=i();for(let q=0;q<31;q++)p[q]=b[q];p[31]=b[31]&127|64,p[0]&=248,l(o,E);for(let q=0;q<16;q++)C[q]=o[q];d[0]=K[0]=1;for(let q=254;q>=0;--q){const $=p[q>>>3]>>>(q&7)&1;c(d,C,$),c(L,K,$),f(G,d,L),g(d,d,L),f(L,C,K),g(C,C,K),w(K,G),w(Q,d),y(d,L,d),y(L,C,G),f(G,d,L),g(d,d,L),w(C,d),g(L,K,Q),y(d,L,s),f(d,d,K),y(L,L,d),y(d,K,Q),y(K,C,o),w(C,G),c(d,C,$),c(L,K,$)}for(let q=0;q<16;q++)o[q+16]=d[q],o[q+32]=L[q],o[q+48]=C[q],o[q+64]=K[q];const O=o.subarray(32),P=o.subarray(16);m(O,O),y(P,P,O);const k=new Uint8Array(32);return h(k,P),k}t.scalarMult=T;function A(b){return T(b,n)}t.scalarMultBase=A;function M(b){if(b.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const E=new Uint8Array(b);return{publicKey:A(E),secretKey:E}}t.generateKeyPairFromSeed=M;function D(b){const E=(0,e.randomBytes)(32,b),p=M(E);return(0,r.wipe)(E),p}t.generateKeyPair=D;function x(b,E,p=!1){if(b.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(E.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const o=T(b,E);if(p){let d=0;for(let C=0;C<o.length;C++)d|=o[C];if(d===0)throw new Error("X25519: invalid shared key")}return o}t.sharedKey=x})(dn);var mo=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},Zf=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),ed=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),td=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),rd=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),id=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),nd=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,sd=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,vo=3,od=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",nd]],Eo=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function ad(t){return t?Do(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new id:typeof navigator<"u"?Do(navigator.userAgent):ld()}function cd(t){return t!==""&&od.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function Do(t){var e=cd(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new rd;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<vo&&(n=mo(mo([],n,!0),hd(vo-n.length),!0)):n=[];var s=n.join("."),a=ud(t),c=sd.exec(t);return c&&c[1]?new td(r,s,a,c[1]):new Zf(r,s,a)}function ud(t){for(var e=0,r=Eo.length;e<r;e++){var i=Eo[e],n=i[0],s=i[1],a=s.exec(t);if(a)return n}return null}function ld(){var t=typeof process<"u"&&process.version;return t?new ed(process.version.slice(1)):null}function hd(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Te={};Object.defineProperty(Te,"__esModule",{value:!0}),Te.getLocalStorage=Te.getLocalStorageOrThrow=Te.getCrypto=Te.getCryptoOrThrow=So=Te.getLocation=Te.getLocationOrThrow=gn=Te.getNavigator=Te.getNavigatorOrThrow=pn=Te.getDocument=Te.getDocumentOrThrow=Te.getFromWindowOrThrow=Te.getFromWindow=void 0;function er(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Te.getFromWindow=er;function fr(t){const e=er(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Te.getFromWindowOrThrow=fr;function fd(){return fr("document")}Te.getDocumentOrThrow=fd;function dd(){return er("document")}var pn=Te.getDocument=dd;function pd(){return fr("navigator")}Te.getNavigatorOrThrow=pd;function gd(){return er("navigator")}var gn=Te.getNavigator=gd;function yd(){return fr("location")}Te.getLocationOrThrow=yd;function _d(){return er("location")}var So=Te.getLocation=_d;function wd(){return fr("crypto")}Te.getCryptoOrThrow=wd;function bd(){return er("crypto")}Te.getCrypto=bd;function md(){return fr("localStorage")}Te.getLocalStorageOrThrow=md;function vd(){return er("localStorage")}Te.getLocalStorage=vd;var yn={};Object.defineProperty(yn,"__esModule",{value:!0});var Io=yn.getWindowMetadata=void 0;const Oo=Te;function Ed(){let t,e;try{t=Oo.getDocumentOrThrow(),e=Oo.getLocationOrThrow()}catch{return null}function r(){const g=t.getElementsByTagName("link"),y=[];for(let w=0;w<g.length;w++){const m=g[w],T=m.getAttribute("rel");if(T&&T.toLowerCase().indexOf("icon")>-1){const A=m.getAttribute("href");if(A)if(A.toLowerCase().indexOf("https:")===-1&&A.toLowerCase().indexOf("http:")===-1&&A.indexOf("//")!==0){let M=e.protocol+"//"+e.host;if(A.indexOf("/")===0)M+=A;else{const D=e.pathname.split("/");D.pop();const x=D.join("/");M+=x+"/"+A}y.push(M)}else if(A.indexOf("//")===0){const M=e.protocol+A;y.push(M)}else y.push(A)}}return y}function i(...g){const y=t.getElementsByTagName("meta");for(let w=0;w<y.length;w++){const m=y[w],T=["itemprop","property","name"].map(A=>m.getAttribute(A)).filter(A=>A?g.includes(A):!1);if(T.length&&T){const A=m.getAttribute("content");if(A)return A}}return""}function n(){let g=i("name","og:site_name","og:title","twitter:title");return g||(g=t.title),g}function s(){return i("description","og:description","twitter:description","keywords")}const a=n(),c=s(),h=e.origin,l=r();return{description:c,url:h,icons:l,name:a}}Io=yn.getWindowMetadata=Ed;var Fr={},Dd=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),xo="%[a-f0-9]{2}",To=new RegExp("("+xo+")|([^%]+?)","gi"),No=new RegExp("("+xo+")+","gi");function _n(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],_n(r),_n(i))}function Sd(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(To)||[],r=1;r<e.length;r++)t=_n(e,r).join(""),e=t.match(To)||[];return t}}function Id(t){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},r=No.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=Sd(r[0]);i!==r[0]&&(e[r[0]]=i)}r=No.exec(t)}e["%C2"]="\uFFFD";for(var n=Object.keys(e),s=0;s<n.length;s++){var a=n[s];t=t.replace(new RegExp(a,"g"),e[a])}return t}var Od=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Id(t)}},xd=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},Td=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),s=0;s<i.length;s++){var a=i[s],c=t[a];(n?e.indexOf(a)!==-1:e(a,c,t))&&(r[a]=c)}return r};(function(t){const e=Dd,r=Od,i=xd,n=Td,s=D=>D==null,a=Symbol("encodeFragmentIdentifier");function c(D){switch(D.arrayFormat){case"index":return x=>(b,E)=>{const p=b.length;return E===void 0||D.skipNull&&E===null||D.skipEmptyString&&E===""?b:E===null?[...b,[f(x,D),"[",p,"]"].join("")]:[...b,[f(x,D),"[",f(p,D),"]=",f(E,D)].join("")]};case"bracket":return x=>(b,E)=>E===void 0||D.skipNull&&E===null||D.skipEmptyString&&E===""?b:E===null?[...b,[f(x,D),"[]"].join("")]:[...b,[f(x,D),"[]=",f(E,D)].join("")];case"colon-list-separator":return x=>(b,E)=>E===void 0||D.skipNull&&E===null||D.skipEmptyString&&E===""?b:E===null?[...b,[f(x,D),":list="].join("")]:[...b,[f(x,D),":list=",f(E,D)].join("")];case"comma":case"separator":case"bracket-separator":{const x=D.arrayFormat==="bracket-separator"?"[]=":"=";return b=>(E,p)=>p===void 0||D.skipNull&&p===null||D.skipEmptyString&&p===""?E:(p=p===null?"":p,E.length===0?[[f(b,D),x,f(p,D)].join("")]:[[E,f(p,D)].join(D.arrayFormatSeparator)])}default:return x=>(b,E)=>E===void 0||D.skipNull&&E===null||D.skipEmptyString&&E===""?b:E===null?[...b,f(x,D)]:[...b,[f(x,D),"=",f(E,D)].join("")]}}function h(D){let x;switch(D.arrayFormat){case"index":return(b,E,p)=>{if(x=/\[(\d*)\]$/.exec(b),b=b.replace(/\[\d*\]$/,""),!x){p[b]=E;return}p[b]===void 0&&(p[b]={}),p[b][x[1]]=E};case"bracket":return(b,E,p)=>{if(x=/(\[\])$/.exec(b),b=b.replace(/\[\]$/,""),!x){p[b]=E;return}if(p[b]===void 0){p[b]=[E];return}p[b]=[].concat(p[b],E)};case"colon-list-separator":return(b,E,p)=>{if(x=/(:list)$/.exec(b),b=b.replace(/:list$/,""),!x){p[b]=E;return}if(p[b]===void 0){p[b]=[E];return}p[b]=[].concat(p[b],E)};case"comma":case"separator":return(b,E,p)=>{const o=typeof E=="string"&&E.includes(D.arrayFormatSeparator),d=typeof E=="string"&&!o&&g(E,D).includes(D.arrayFormatSeparator);E=d?g(E,D):E;const C=o||d?E.split(D.arrayFormatSeparator).map(L=>g(L,D)):E===null?E:g(E,D);p[b]=C};case"bracket-separator":return(b,E,p)=>{const o=/(\[\])$/.test(b);if(b=b.replace(/\[\]$/,""),!o){p[b]=E&&g(E,D);return}const d=E===null?[]:E.split(D.arrayFormatSeparator).map(C=>g(C,D));if(p[b]===void 0){p[b]=d;return}p[b]=[].concat(p[b],d)};default:return(b,E,p)=>{if(p[b]===void 0){p[b]=E;return}p[b]=[].concat(p[b],E)}}}function l(D){if(typeof D!="string"||D.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function f(D,x){return x.encode?x.strict?e(D):encodeURIComponent(D):D}function g(D,x){return x.decode?r(D):D}function y(D){return Array.isArray(D)?D.sort():typeof D=="object"?y(Object.keys(D)).sort((x,b)=>Number(x)-Number(b)).map(x=>D[x]):D}function w(D){const x=D.indexOf("#");return x!==-1&&(D=D.slice(0,x)),D}function m(D){let x="";const b=D.indexOf("#");return b!==-1&&(x=D.slice(b)),x}function T(D){D=w(D);const x=D.indexOf("?");return x===-1?"":D.slice(x+1)}function A(D,x){return x.parseNumbers&&!Number.isNaN(Number(D))&&typeof D=="string"&&D.trim()!==""?D=Number(D):x.parseBooleans&&D!==null&&(D.toLowerCase()==="true"||D.toLowerCase()==="false")&&(D=D.toLowerCase()==="true"),D}function M(D,x){x=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},x),l(x.arrayFormatSeparator);const b=h(x),E=Object.create(null);if(typeof D!="string"||(D=D.trim().replace(/^[?#&]/,""),!D))return E;for(const p of D.split("&")){if(p==="")continue;let[o,d]=i(x.decode?p.replace(/\+/g," "):p,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(x.arrayFormat)?d:g(d,x),b(g(o,x),d,E)}for(const p of Object.keys(E)){const o=E[p];if(typeof o=="object"&&o!==null)for(const d of Object.keys(o))o[d]=A(o[d],x);else E[p]=A(o,x)}return x.sort===!1?E:(x.sort===!0?Object.keys(E).sort():Object.keys(E).sort(x.sort)).reduce((p,o)=>{const d=E[o];return d&&typeof d=="object"&&!Array.isArray(d)?p[o]=y(d):p[o]=d,p},Object.create(null))}t.extract=T,t.parse=M,t.stringify=(D,x)=>{if(!D)return"";x=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},x),l(x.arrayFormatSeparator);const b=d=>x.skipNull&&s(D[d])||x.skipEmptyString&&D[d]==="",E=c(x),p={};for(const d of Object.keys(D))b(d)||(p[d]=D[d]);const o=Object.keys(p);return x.sort!==!1&&o.sort(x.sort),o.map(d=>{const C=D[d];return C===void 0?"":C===null?f(d,x):Array.isArray(C)?C.length===0&&x.arrayFormat==="bracket-separator"?f(d,x)+"[]":C.reduce(E(d),[]).join("&"):f(d,x)+"="+f(C,x)}).filter(d=>d.length>0).join("&")},t.parseUrl=(D,x)=>{x=Object.assign({decode:!0},x);const[b,E]=i(D,"#");return Object.assign({url:b.split("?")[0]||"",query:M(T(D),x)},x&&x.parseFragmentIdentifier&&E?{fragmentIdentifier:g(E,x)}:{})},t.stringifyUrl=(D,x)=>{x=Object.assign({encode:!0,strict:!0,[a]:!0},x);const b=w(D.url).split("?")[0]||"",E=t.extract(D.url),p=t.parse(E,{sort:!1}),o=Object.assign(p,D.query);let d=t.stringify(o,x);d&&(d=`?${d}`);let C=m(D.url);return D.fragmentIdentifier&&(C=`#${x[a]?f(D.fragmentIdentifier,x):D.fragmentIdentifier}`),`${b}${d}${C}`},t.pick=(D,x,b)=>{b=Object.assign({parseFragmentIdentifier:!0,[a]:!1},b);const{url:E,query:p,fragmentIdentifier:o}=t.parseUrl(D,b);return t.stringifyUrl({url:E,query:n(p,x),fragmentIdentifier:o},b)},t.exclude=(D,x,b)=>{const E=Array.isArray(x)?p=>!x.includes(p):(p,o)=>!x(p,o);return t.pick(D,E,b)}})(Fr);const Nd={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}};function Ro(t,e){return t.includes(":")?[t]:e.chains||[]}const Po="base10",at="base16",wn="base64pad",bn="utf8",Ao=0,tr=1,Rd=0,Co=1,mn=12,vn=32;function Pd(){const t=dn.generateKeyPair();return{privateKey:ot(t.secretKey,at),publicKey:ot(t.publicKey,at)}}function En(){const t=hr.randomBytes(vn);return ot(t,at)}function Ad(t,e){const r=dn.sharedKey(pt(t,at),pt(e,at),!0),i=new Qf(pi.SHA256,r).expand(vn);return ot(i,at)}function Cd(t){const e=pi.hash(pt(t,at));return ot(e,at)}function dr(t){const e=pi.hash(pt(t,bn));return ot(e,at)}function Ld(t){return pt(`${t}`,Po)}function $r(t){return Number(ot(t,Po))}function Fd(t){const e=Ld(typeof t.type<"u"?t.type:Ao);if($r(e)===tr&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?pt(t.senderPublicKey,at):void 0,i=typeof t.iv<"u"?pt(t.iv,at):hr.randomBytes(mn),n=new ln.ChaCha20Poly1305(pt(t.symKey,at)).seal(i,pt(t.message,bn));return Ud({type:e,sealed:n,iv:i,senderPublicKey:r})}function $d(t){const e=new ln.ChaCha20Poly1305(pt(t.symKey,at)),{sealed:r,iv:i}=gi(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return ot(n,bn)}function Ud(t){if($r(t.type)===tr){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return ot(on([t.type,t.senderPublicKey,t.iv,t.sealed]),wn)}return ot(on([t.type,t.iv,t.sealed]),wn)}function gi(t){const e=pt(t,wn),r=e.slice(Rd,Co),i=Co;if($r(r)===tr){const c=i+vn,h=c+mn,l=e.slice(i,c),f=e.slice(c,h),g=e.slice(h);return{type:r,sealed:g,iv:f,senderPublicKey:l}}const n=i+mn,s=e.slice(i,n),a=e.slice(n);return{type:r,sealed:a,iv:s}}function Md(t,e){const r=gi(t);return Lo({type:$r(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?ot(r.senderPublicKey,at):void 0,receiverPublicKey:e?.receiverPublicKey})}function Lo(t){const e=t?.type||Ao;if(e===tr){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Fo(t){return t.type===tr&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var jd=Object.defineProperty,$o=Object.getOwnPropertySymbols,qd=Object.prototype.hasOwnProperty,Bd=Object.prototype.propertyIsEnumerable,Uo=(t,e,r)=>e in t?jd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Mo=(t,e)=>{for(var r in e||(e={}))qd.call(e,r)&&Uo(t,r,e[r]);if($o)for(var r of $o(e))Bd.call(e,r)&&Uo(t,r,e[r]);return t};const zd="ReactNative",_t={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},Kd="js";function Ur(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function pr(){return!pn()&&!!gn()&&navigator.product===zd}function gr(){return!Ur()&&!!gn()&&!!pn()}function Mr(){return pr()?_t.reactNative:Ur()?_t.node:gr()?_t.browser:_t.unknown}function Hd(){var t;try{return pr()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function Vd(t,e){let r=Fr.parse(t);return r=Mo(Mo({},r),e),t=Fr.stringify(r),t}function Gd(){return Io()||{name:"",description:"",url:"",icons:[""]}}function kd(){if(Mr()===_t.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=ad();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function Wd(){var t;const e=Mr();return e===_t.browser?[e,((t=So())==null?void 0:t.host)||"unknown"].join(":"):e}function Yd(t,e,r){const i=kd(),n=Wd();return[[t,e].join("-"),[Kd,r].join("-"),i,n].join("/")}function Xd({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:a,bundleId:c}){const h=r.split("?"),l=Yd(t,e,i),f={auth:n,ua:l,projectId:s,useOnCloseEvent:a||void 0,origin:c||void 0},g=Vd(h[1]||"",f);return h[0]+"?"+g}function rr(t,e){return t.filter(r=>e.includes(r)).length===t.length}function jo(t){return Object.fromEntries(t.entries())}function qo(t){return new Map(Object.entries(t))}function yr(t=W.FIVE_MINUTES,e){const r=W.toMiliseconds(t||W.FIVE_MINUTES);let i,n,s;return{resolve:a=>{s&&i&&(clearTimeout(s),i(a))},reject:a=>{s&&n&&(clearTimeout(s),n(a))},done:()=>new Promise((a,c)=>{s=setTimeout(()=>{c(new Error(e))},r),i=a,n=c})}}function jr(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const a=await t;i(a)}catch(a){n(a)}clearTimeout(s)})}function Bo(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Jd(t){return Bo("topic",t)}function Qd(t){return Bo("id",t)}function zo(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function wt(t,e){return W.fromMiliseconds((e||Date.now())+W.toMiliseconds(t))}function Bt(t){return Date.now()>=W.toMiliseconds(t)}function xe(t,e){return`${t}${e?`:${e}`:""}`}async function Zd({id:t,topic:e,wcDeepLink:r}){try{if(!r)return;const i=typeof r=="string"?JSON.parse(r):r;let n=i?.href;if(typeof n!="string")return;n.endsWith("/")&&(n=n.slice(0,-1));const s=`${n}/wc?requestId=${t}&sessionTopic=${e}`,a=Mr();a===_t.browser?s.startsWith("https://")?window.open(s,"_blank","noreferrer noopener"):window.open(s,"_self","noreferrer noopener"):a===_t.reactNative&&typeof(global==null?void 0:global.Linking)<"u"&&await global.Linking.openURL(s)}catch(i){console.error(i)}}async function ep(t,e){try{return await t.getItem(e)||(gr()?localStorage.getItem(e):void 0)}catch(r){console.error(r)}}const tp="irn";function Dn(t){return t?.relay||{protocol:tp}}function yi(t){const e=Nd[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var rp=Object.defineProperty,ip=Object.defineProperties,np=Object.getOwnPropertyDescriptors,Ko=Object.getOwnPropertySymbols,sp=Object.prototype.hasOwnProperty,op=Object.prototype.propertyIsEnumerable,Ho=(t,e,r)=>e in t?rp(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ap=(t,e)=>{for(var r in e||(e={}))sp.call(e,r)&&Ho(t,r,e[r]);if(Ko)for(var r of Ko(e))op.call(e,r)&&Ho(t,r,e[r]);return t},cp=(t,e)=>ip(t,np(e));function up(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),a=t[n];r[s]=a}}),r}function Vo(t){t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",a=Fr.parse(s);return{protocol:i,topic:lp(n[0]),version:parseInt(n[1],10),symKey:a.symKey,relay:up(a),expiryTimestamp:a.expiryTimestamp?parseInt(a.expiryTimestamp,10):void 0}}function lp(t){return t.startsWith("//")?t.substring(2):t}function hp(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=r+e+n;t[n]&&(i[s]=t[n])}),i}function fp(t){return`${t.protocol}:${t.topic}@${t.version}?`+Fr.stringify(cp(ap({symKey:t.symKey},hp(t.relay)),{expiryTimestamp:t.expiryTimestamp}))}function _r(t){const e=[];return t.forEach(r=>{const[i,n]=r.split(":");e.push(`${i}:${n}`)}),e}function dp(t){const e=[];return Object.values(t).forEach(r=>{e.push(..._r(r.accounts))}),e}function pp(t,e){const r=[];return Object.values(t).forEach(i=>{_r(i.accounts).includes(e)&&r.push(...i.methods)}),r}function gp(t,e){const r=[];return Object.values(t).forEach(i=>{_r(i.accounts).includes(e)&&r.push(...i.events)}),r}const yp={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},_p={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function V(t,e){const{message:r,code:i}=_p[t];return{message:e?`${r} ${e}`:r,code:i}}function Ae(t,e){const{message:r,code:i}=yp[t];return{message:e?`${r} ${e}`:r,code:i}}function qr(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function _i(t){return Object.getPrototypeOf(t)===Object.prototype&&Object.keys(t).length}function ct(t){return typeof t>"u"}function Ve(t,e){return e&&ct(t)?!0:typeof t=="string"&&!!t.trim().length}function Sn(t,e){return e&&ct(t)?!0:typeof t=="number"&&!isNaN(t)}function wp(t,e){const{requiredNamespaces:r}=e,i=Object.keys(t.namespaces),n=Object.keys(r);let s=!0;return rr(n,i)?(i.forEach(a=>{const{accounts:c,methods:h,events:l}=t.namespaces[a],f=_r(c),g=r[a];(!rr(Ro(a,g),f)||!rr(g.methods,h)||!rr(g.events,l))&&(s=!1)}),s):!1}function wi(t){return Ve(t,!1)&&t.includes(":")?t.split(":").length===2:!1}function bp(t){if(Ve(t,!1)&&t.includes(":")){const e=t.split(":");if(e.length===3){const r=e[0]+":"+e[1];return!!e[2]&&wi(r)}}return!1}function mp(t){if(Ve(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function vp(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function Ep(t){return t?.topic}function Dp(t,e){let r=null;return Ve(t?.publicKey,!1)||(r=V("MISSING_OR_INVALID",`${e} controller public key should be a string`)),r}function Go(t){let e=!0;return qr(t)?t.length&&(e=t.every(r=>Ve(r,!1))):e=!1,e}function Sp(t,e,r){let i=null;return qr(e)&&e.length?e.forEach(n=>{i||wi(n)||(i=Ae("UNSUPPORTED_CHAINS",`${r}, chain ${n} should be a string and conform to "namespace:chainId" format`))}):wi(t)||(i=Ae("UNSUPPORTED_CHAINS",`${r}, chains must be defined as "namespace:chainId" e.g. "eip155:1": {...} in the namespace key OR as an array of CAIP-2 chainIds e.g. eip155: { chains: ["eip155:1", "eip155:5"] }`)),i}function Ip(t,e,r){let i=null;return Object.entries(t).forEach(([n,s])=>{if(i)return;const a=Sp(n,Ro(n,s),`${e} ${r}`);a&&(i=a)}),i}function Op(t,e){let r=null;return qr(t)?t.forEach(i=>{r||bp(i)||(r=Ae("UNSUPPORTED_ACCOUNTS",`${e}, account ${i} should be a string and conform to "namespace:chainId:address" format`))}):r=Ae("UNSUPPORTED_ACCOUNTS",`${e}, accounts should be an array of strings conforming to "namespace:chainId:address" format`),r}function xp(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Op(i?.accounts,`${e} namespace`);n&&(r=n)}),r}function Tp(t,e){let r=null;return Go(t?.methods)?Go(t?.events)||(r=Ae("UNSUPPORTED_EVENTS",`${e}, events should be an array of strings or empty array for no events`)):r=Ae("UNSUPPORTED_METHODS",`${e}, methods should be an array of strings or empty array for no methods`),r}function ko(t,e){let r=null;return Object.values(t).forEach(i=>{if(r)return;const n=Tp(i,`${e}, namespace`);n&&(r=n)}),r}function Np(t,e,r){let i=null;if(t&&_i(t)){const n=ko(t,e);n&&(i=n);const s=Ip(t,e,r);s&&(i=s)}else i=V("MISSING_OR_INVALID",`${e}, ${r} should be an object with data`);return i}function In(t,e){let r=null;if(t&&_i(t)){const i=ko(t,e);i&&(r=i);const n=xp(t,e);n&&(r=n)}else r=V("MISSING_OR_INVALID",`${e}, namespaces should be an object with data`);return r}function Wo(t){return Ve(t.protocol,!0)}function Rp(t,e){let r=!1;return e&&!t?r=!0:t&&qr(t)&&t.length&&t.forEach(i=>{r=Wo(i)}),r}function Pp(t){return typeof t=="number"}function gt(t){return typeof t<"u"&&typeof t!==null}function Ap(t){return!(!t||typeof t!="object"||!t.code||!Sn(t.code,!1)||!t.message||!Ve(t.message,!1))}function Cp(t){return!(ct(t)||!Ve(t.method,!1))}function Lp(t){return!(ct(t)||ct(t.result)&&ct(t.error)||!Sn(t.id,!1)||!Ve(t.jsonrpc,!1))}function Fp(t){return!(ct(t)||!Ve(t.name,!1))}function Yo(t,e){return!(!wi(e)||!dp(t).includes(e))}function $p(t,e,r){return Ve(r,!1)?pp(t,e).includes(r):!1}function Up(t,e,r){return Ve(r,!1)?gp(t,e).includes(r):!1}function Xo(t,e,r){let i=null;const n=Mp(t),s=jp(e),a=Object.keys(n),c=Object.keys(s),h=Jo(Object.keys(t)),l=Jo(Object.keys(e)),f=h.filter(g=>!l.includes(g));return f.length&&(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces keys don't satisfy requiredNamespaces.
      Required: ${f.toString()}
      Received: ${Object.keys(e).toString()}`)),rr(a,c)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces chains don't satisfy required namespaces.
      Required: ${a.toString()}
      Approved: ${c.toString()}`)),Object.keys(e).forEach(g=>{if(!g.includes(":")||i)return;const y=_r(e[g].accounts);y.includes(g)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces accounts don't satisfy namespace accounts for ${g}
        Required: ${g}
        Approved: ${y.toString()}`))}),a.forEach(g=>{i||(rr(n[g].methods,s[g].methods)?rr(n[g].events,s[g].events)||(i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces events don't satisfy namespace events for ${g}`)):i=V("NON_CONFORMING_NAMESPACES",`${r} namespaces methods don't satisfy namespace methods for ${g}`))}),i}function Mp(t){const e={};return Object.keys(t).forEach(r=>{var i;r.includes(":")?e[r]=t[r]:(i=t[r].chains)==null||i.forEach(n=>{e[n]={methods:t[r].methods,events:t[r].events}})}),e}function Jo(t){return[...new Set(t.map(e=>e.includes(":")?e.split(":")[0]:e))]}function jp(t){const e={};return Object.keys(t).forEach(r=>{if(r.includes(":"))e[r]=t[r];else{const i=_r(t[r].accounts);i?.forEach(n=>{e[n]={accounts:t[r].accounts.filter(s=>s.includes(`${n}:`)),methods:t[r].methods,events:t[r].events}})}}),e}function qp(t,e){return Sn(t,!1)&&t<=e.max&&t>=e.min}function Qo(){const t=Mr();return new Promise(e=>{switch(t){case _t.browser:e(Bp());break;case _t.reactNative:e(zp());break;case _t.node:e(Kp());break;default:e(!0)}})}function Bp(){return gr()&&navigator?.onLine}async function zp(){if(pr()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function Kp(){return!0}function Hp(t){switch(Mr()){case _t.browser:Vp(t);break;case _t.reactNative:Gp(t);break}}function Vp(t){!pr()&&gr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function Gp(t){pr()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}const On={};class Br{static get(e){return On[e]}static set(e,r){On[e]=r}static delete(e){delete On[e]}}const kp="PARSE_ERROR",Wp="INVALID_REQUEST",Yp="METHOD_NOT_FOUND",Xp="INVALID_PARAMS",Zo="INTERNAL_ERROR",xn="SERVER_ERROR",Jp=[-32700,-32600,-32601,-32602,-32603],zr={[kp]:{code:-32700,message:"Parse error"},[Wp]:{code:-32600,message:"Invalid Request"},[Yp]:{code:-32601,message:"Method not found"},[Xp]:{code:-32602,message:"Invalid params"},[Zo]:{code:-32603,message:"Internal error"},[xn]:{code:-32e3,message:"Server error"}},ea=xn;function Qp(t){return Jp.includes(t)}function ta(t){return Object.keys(zr).includes(t)?zr[t]:zr[ea]}function Zp(t){const e=Object.values(zr).find(r=>r.code===t);return e||zr[ea]}function eg(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var ra={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var Tn=function(t,e){return Tn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},Tn(t,e)};function tg(t,e){Tn(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Nn=function(){return Nn=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Nn.apply(this,arguments)};function rg(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function ig(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,a;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var c=t.length-1;c>=0;c--)(a=t[c])&&(s=(n<3?a(s):n>3?a(e,r,s):a(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function ng(t,e){return function(r,i){e(r,i,t)}}function sg(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function og(t,e,r,i){function n(s){return s instanceof r?s:new r(function(a){a(s)})}return new(r||(r=Promise))(function(s,a){function c(f){try{l(i.next(f))}catch(g){a(g)}}function h(f){try{l(i.throw(f))}catch(g){a(g)}}function l(f){f.done?s(f.value):n(f.value).then(c,h)}l((i=i.apply(t,e||[])).next())})}function ag(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,a;return a={next:c(0),throw:c(1),return:c(2)},typeof Symbol=="function"&&(a[Symbol.iterator]=function(){return this}),a;function c(l){return function(f){return h([l,f])}}function h(l){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=l[0]&2?n.return:l[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,l[1])).done)return s;switch(n=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return r.label++,{value:l[1],done:!1};case 5:r.label++,n=l[1],l=[0];continue;case 7:l=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){r=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){r.label=l[1];break}if(l[0]===6&&r.label<s[1]){r.label=s[1],s=l;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(l);break}s[2]&&r.ops.pop(),r.trys.pop();continue}l=e.call(t,r)}catch(f){l=[6,f],n=0}finally{i=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function cg(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function ug(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Rn(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function ia(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],a;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(c){a={error:c}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(a)throw a.error}}return s}function lg(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(ia(arguments[e]));return t}function hg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],a=0,c=s.length;a<c;a++,n++)i[n]=s[a];return i}function Kr(t){return this instanceof Kr?(this.v=t,this):new Kr(t)}function fg(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},a("next"),a("throw"),a("return"),n[Symbol.asyncIterator]=function(){return this},n;function a(y){i[y]&&(n[y]=function(w){return new Promise(function(m,T){s.push([y,w,m,T])>1||c(y,w)})})}function c(y,w){try{h(i[y](w))}catch(m){g(s[0][3],m)}}function h(y){y.value instanceof Kr?Promise.resolve(y.value.v).then(l,f):g(s[0][2],y)}function l(y){c("next",y)}function f(y){c("throw",y)}function g(y,w){y(w),s.shift(),s.length&&c(s[0][0],s[0][1])}}function dg(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(a){return(r=!r)?{value:Kr(t[n](a)),done:n==="return"}:s?s(a):a}:s}}function pg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Rn=="function"?Rn(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(a){return new Promise(function(c,h){a=t[s](a),n(c,h,a.done,a.value)})}}function n(s,a,c,h){Promise.resolve(h).then(function(l){s({value:l,done:c})},a)}}function gg(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function yg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function _g(t){return t&&t.__esModule?t:{default:t}}function wg(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function bg(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var mg=Object.freeze({__proto__:null,__extends:tg,get __assign(){return Nn},__rest:rg,__decorate:ig,__param:ng,__metadata:sg,__awaiter:og,__generator:ag,__createBinding:cg,__exportStar:ug,__values:Rn,__read:ia,__spread:lg,__spreadArrays:hg,__await:Kr,__asyncGenerator:fg,__asyncDelegator:dg,__asyncValues:pg,__makeTemplateObject:gg,__importStar:yg,__importDefault:_g,__classPrivateFieldGet:wg,__classPrivateFieldSet:bg}),vg=kt(mg),Ft={},na;function Eg(){if(na)return Ft;na=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.isBrowserCryptoAvailable=Ft.getSubtleCrypto=Ft.getBrowerCrypto=void 0;function t(){return ht?.crypto||ht?.msCrypto||{}}Ft.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}Ft.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return Ft.isBrowserCryptoAvailable=r,Ft}var $t={},sa;function Dg(){if(sa)return $t;sa=1,Object.defineProperty($t,"__esModule",{value:!0}),$t.isBrowser=$t.isNode=$t.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}$t.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}$t.isNode=e;function r(){return!t()&&!e()}return $t.isBrowser=r,$t}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=vg;e.__exportStar(Eg(),t),e.__exportStar(Dg(),t)})(ra);function wr(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function ir(t=6){return BigInt(wr(t))}function br(t,e,r){return{id:r||wr(),jsonrpc:"2.0",method:t,params:e}}function Pn(t,e){return{id:t,jsonrpc:"2.0",result:e}}function An(t,e,r){return{id:t,jsonrpc:"2.0",error:Sg(e,r)}}function Sg(t,e){return typeof t>"u"?ta(Zo):(typeof t=="string"&&(t=Object.assign(Object.assign({},ta(xn)),{message:t})),typeof e<"u"&&(t.data=e),Qp(t.code)&&(t=Zp(t.code)),t)}class Ig{}class Og extends Ig{constructor(){super()}}class xg extends Og{constructor(e){super()}}const Tg="^wss?:";function Ng(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function Rg(t,e){const r=Ng(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function oa(t){return Rg(t,Tg)}function Pg(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function aa(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function Cn(t){return aa(t)&&"method"in t}function bi(t){return aa(t)&&(Ut(t)||Ot(t))}function Ut(t){return"result"in t}function Ot(t){return"error"in t}class Ag extends xg{constructor(e){super(e),this.events=new ft.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(br(e.method,e.params||[],e.id||ir().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{Ot(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),bi(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Cg=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),Lg=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",ca=t=>t.split("?")[0],ua=10,Fg=Cg();class $g{constructor(e){if(this.url=e,this.events=new ft.exports.EventEmitter,this.registering=!1,!oa(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(Ir(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!oa(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=new URLSearchParams(e).get("origin"),s=ra.isReactNative()?{headers:{origin:n}}:{rejectUnauthorized:!Pg(e)},a=new Fg(e,[],s);Lg()?a.onerror=c=>{const h=c;i(this.emitError(h.error))}:a.on("error",c=>{i(this.emitError(c))}),a.onopen=()=>{this.onOpen(a),r(a)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?ri(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=An(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return eg(e,ca(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ua&&this.events.setMaxListeners(ua)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${ca(this.url)}`));return this.events.emit("register_error",r),r}}var Ln={exports:{}};(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,s=2,a=9007199254740991,c="[object Arguments]",h="[object Array]",l="[object AsyncFunction]",f="[object Boolean]",g="[object Date]",y="[object Error]",w="[object Function]",m="[object GeneratorFunction]",T="[object Map]",A="[object Number]",M="[object Null]",D="[object Object]",x="[object Promise]",b="[object Proxy]",E="[object RegExp]",p="[object Set]",o="[object String]",d="[object Symbol]",C="[object Undefined]",L="[object WeakMap]",K="[object ArrayBuffer]",G="[object DataView]",Q="[object Float32Array]",O="[object Float64Array]",P="[object Int8Array]",k="[object Int16Array]",q="[object Int32Array]",$="[object Uint8Array]",j="[object Uint8ClampedArray]",F="[object Uint16Array]",B="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,z=/^\[object .+?Constructor\]$/,Z=/^(?:0|[1-9]\d*)$/,X={};X[Q]=X[O]=X[P]=X[k]=X[q]=X[$]=X[j]=X[F]=X[B]=!0,X[c]=X[h]=X[K]=X[f]=X[G]=X[g]=X[y]=X[w]=X[T]=X[A]=X[D]=X[E]=X[p]=X[o]=X[L]=!1;var ee=typeof ht=="object"&&ht&&ht.Object===Object&&ht,R=typeof self=="object"&&self&&self.Object===Object&&self,N=ee||R||Function("return this")(),S=e&&!e.nodeType&&e,u=S&&!0&&t&&!t.nodeType&&t,v=u&&u.exports===S,H=v&&ee.process,Y=function(){try{return H&&H.binding&&H.binding("util")}catch{}}(),he=Y&&Y.isTypedArray;function we(_,I){for(var U=-1,J=_==null?0:_.length,Ne=0,se=[];++U<J;){var $e=_[U];I($e,U,_)&&(se[Ne++]=$e)}return se}function de(_,I){for(var U=-1,J=I.length,Ne=_.length;++U<J;)_[Ne+U]=I[U];return _}function ve(_,I){for(var U=-1,J=_==null?0:_.length;++U<J;)if(I(_[U],U,_))return!0;return!1}function Ue(_,I){for(var U=-1,J=Array(_);++U<_;)J[U]=I(U);return J}function Ce(_){return function(I){return _(I)}}function _e(_,I){return _.has(I)}function pe(_,I){return _?.[I]}function fe(_){var I=-1,U=Array(_.size);return _.forEach(function(J,Ne){U[++I]=[Ne,J]}),U}function ue(_,I){return function(U){return _(I(U))}}function ce(_){var I=-1,U=Array(_.size);return _.forEach(function(J){U[++I]=J}),U}var ae=Array.prototype,oe=Function.prototype,re=Object.prototype,le=N["__core-js_shared__"],ge=oe.toString,ne=re.hasOwnProperty,be=function(){var _=/[^.]+$/.exec(le&&le.keys&&le.keys.IE_PROTO||"");return _?"Symbol(src)_1."+_:""}(),me=re.toString,Se=RegExp("^"+ge.call(ne).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Ie=v?N.Buffer:void 0,Ee=N.Symbol,xt=N.Uint8Array,Lt=re.propertyIsEnumerable,Kt=ae.splice,mt=Ee?Ee.toStringTag:void 0,nr=Object.getOwnPropertySymbols,Wr=Ie?Ie.isBuffer:void 0,Oi=ue(Object.keys,Object),Me=Dr(N,"DataView"),Le=Dr(N,"Map"),je=Dr(N,"Promise"),qe=Dr(N,"Set"),Be=Dr(N,"WeakMap"),Fe=Dr(Object,"create"),Ge=or(Me),ke=or(Le),We=or(je),Ye=or(qe),Xe=or(Be),Ke=Ee?Ee.prototype:void 0,ze=Ke?Ke.valueOf:void 0;function Re(_){var I=-1,U=_==null?0:_.length;for(this.clear();++I<U;){var J=_[I];this.set(J[0],J[1])}}function Je(){this.__data__=Fe?Fe(null):{},this.size=0}function Qe(_){var I=this.has(_)&&delete this.__data__[_];return this.size-=I?1:0,I}function C_(_){var I=this.__data__;if(Fe){var U=I[_];return U===i?void 0:U}return ne.call(I,_)?I[_]:void 0}function L_(_){var I=this.__data__;return Fe?I[_]!==void 0:ne.call(I,_)}function F_(_,I){var U=this.__data__;return this.size+=this.has(_)?0:1,U[_]=Fe&&I===void 0?i:I,this}Re.prototype.clear=Je,Re.prototype.delete=Qe,Re.prototype.get=C_,Re.prototype.has=L_,Re.prototype.set=F_;function Mt(_){var I=-1,U=_==null?0:_.length;for(this.clear();++I<U;){var J=_[I];this.set(J[0],J[1])}}function $_(){this.__data__=[],this.size=0}function U_(_){var I=this.__data__,U=Ti(I,_);if(U<0)return!1;var J=I.length-1;return U==J?I.pop():Kt.call(I,U,1),--this.size,!0}function M_(_){var I=this.__data__,U=Ti(I,_);return U<0?void 0:I[U][1]}function j_(_){return Ti(this.__data__,_)>-1}function q_(_,I){var U=this.__data__,J=Ti(U,_);return J<0?(++this.size,U.push([_,I])):U[J][1]=I,this}Mt.prototype.clear=$_,Mt.prototype.delete=U_,Mt.prototype.get=M_,Mt.prototype.has=j_,Mt.prototype.set=q_;function sr(_){var I=-1,U=_==null?0:_.length;for(this.clear();++I<U;){var J=_[I];this.set(J[0],J[1])}}function B_(){this.size=0,this.__data__={hash:new Re,map:new(Le||Mt),string:new Re}}function z_(_){var I=Ni(this,_).delete(_);return this.size-=I?1:0,I}function K_(_){return Ni(this,_).get(_)}function H_(_){return Ni(this,_).has(_)}function V_(_,I){var U=Ni(this,_),J=U.size;return U.set(_,I),this.size+=U.size==J?0:1,this}sr.prototype.clear=B_,sr.prototype.delete=z_,sr.prototype.get=K_,sr.prototype.has=H_,sr.prototype.set=V_;function xi(_){var I=-1,U=_==null?0:_.length;for(this.__data__=new sr;++I<U;)this.add(_[I])}function G_(_){return this.__data__.set(_,i),this}function k_(_){return this.__data__.has(_)}xi.prototype.add=xi.prototype.push=G_,xi.prototype.has=k_;function Ht(_){var I=this.__data__=new Mt(_);this.size=I.size}function W_(){this.__data__=new Mt,this.size=0}function Y_(_){var I=this.__data__,U=I.delete(_);return this.size=I.size,U}function X_(_){return this.__data__.get(_)}function J_(_){return this.__data__.has(_)}function Q_(_,I){var U=this.__data__;if(U instanceof Mt){var J=U.__data__;if(!Le||J.length<r-1)return J.push([_,I]),this.size=++U.size,this;U=this.__data__=new sr(J)}return U.set(_,I),this.size=U.size,this}Ht.prototype.clear=W_,Ht.prototype.delete=Y_,Ht.prototype.get=X_,Ht.prototype.has=J_,Ht.prototype.set=Q_;function Z_(_,I){var U=Ri(_),J=!U&&p1(_),Ne=!U&&!J&&kn(_),se=!U&&!J&&!Ne&&cc(_),$e=U||J||Ne||se,Ze=$e?Ue(_.length,String):[],rt=Ze.length;for(var Pe in _)(I||ne.call(_,Pe))&&!($e&&(Pe=="length"||Ne&&(Pe=="offset"||Pe=="parent")||se&&(Pe=="buffer"||Pe=="byteLength"||Pe=="byteOffset")||u1(Pe,rt)))&&Ze.push(Pe);return Ze}function Ti(_,I){for(var U=_.length;U--;)if(nc(_[U][0],I))return U;return-1}function e1(_,I,U){var J=I(_);return Ri(_)?J:de(J,U(_))}function Yr(_){return _==null?_===void 0?C:M:mt&&mt in Object(_)?a1(_):d1(_)}function ec(_){return Xr(_)&&Yr(_)==c}function tc(_,I,U,J,Ne){return _===I?!0:_==null||I==null||!Xr(_)&&!Xr(I)?_!==_&&I!==I:t1(_,I,U,J,tc,Ne)}function t1(_,I,U,J,Ne,se){var $e=Ri(_),Ze=Ri(I),rt=$e?h:Vt(_),Pe=Ze?h:Vt(I);rt=rt==c?D:rt,Pe=Pe==c?D:Pe;var vt=rt==D,Tt=Pe==D,nt=rt==Pe;if(nt&&kn(_)){if(!kn(I))return!1;$e=!0,vt=!1}if(nt&&!vt)return se||(se=new Ht),$e||cc(_)?rc(_,I,U,J,Ne,se):s1(_,I,rt,U,J,Ne,se);if(!(U&n)){var St=vt&&ne.call(_,"__wrapped__"),It=Tt&&ne.call(I,"__wrapped__");if(St||It){var Gt=St?_.value():_,jt=It?I.value():I;return se||(se=new Ht),Ne(Gt,jt,U,J,se)}}return nt?(se||(se=new Ht),o1(_,I,U,J,Ne,se)):!1}function r1(_){if(!ac(_)||h1(_))return!1;var I=sc(_)?Se:z;return I.test(or(_))}function i1(_){return Xr(_)&&oc(_.length)&&!!X[Yr(_)]}function n1(_){if(!f1(_))return Oi(_);var I=[];for(var U in Object(_))ne.call(_,U)&&U!="constructor"&&I.push(U);return I}function rc(_,I,U,J,Ne,se){var $e=U&n,Ze=_.length,rt=I.length;if(Ze!=rt&&!($e&&rt>Ze))return!1;var Pe=se.get(_);if(Pe&&se.get(I))return Pe==I;var vt=-1,Tt=!0,nt=U&s?new xi:void 0;for(se.set(_,I),se.set(I,_);++vt<Ze;){var St=_[vt],It=I[vt];if(J)var Gt=$e?J(It,St,vt,I,_,se):J(St,It,vt,_,I,se);if(Gt!==void 0){if(Gt)continue;Tt=!1;break}if(nt){if(!ve(I,function(jt,ar){if(!_e(nt,ar)&&(St===jt||Ne(St,jt,U,J,se)))return nt.push(ar)})){Tt=!1;break}}else if(!(St===It||Ne(St,It,U,J,se))){Tt=!1;break}}return se.delete(_),se.delete(I),Tt}function s1(_,I,U,J,Ne,se,$e){switch(U){case G:if(_.byteLength!=I.byteLength||_.byteOffset!=I.byteOffset)return!1;_=_.buffer,I=I.buffer;case K:return!(_.byteLength!=I.byteLength||!se(new xt(_),new xt(I)));case f:case g:case A:return nc(+_,+I);case y:return _.name==I.name&&_.message==I.message;case E:case o:return _==I+"";case T:var Ze=fe;case p:var rt=J&n;if(Ze||(Ze=ce),_.size!=I.size&&!rt)return!1;var Pe=$e.get(_);if(Pe)return Pe==I;J|=s,$e.set(_,I);var vt=rc(Ze(_),Ze(I),J,Ne,se,$e);return $e.delete(_),vt;case d:if(ze)return ze.call(_)==ze.call(I)}return!1}function o1(_,I,U,J,Ne,se){var $e=U&n,Ze=ic(_),rt=Ze.length,Pe=ic(I),vt=Pe.length;if(rt!=vt&&!$e)return!1;for(var Tt=rt;Tt--;){var nt=Ze[Tt];if(!($e?nt in I:ne.call(I,nt)))return!1}var St=se.get(_);if(St&&se.get(I))return St==I;var It=!0;se.set(_,I),se.set(I,_);for(var Gt=$e;++Tt<rt;){nt=Ze[Tt];var jt=_[nt],ar=I[nt];if(J)var uc=$e?J(ar,jt,nt,I,_,se):J(jt,ar,nt,_,I,se);if(!(uc===void 0?jt===ar||Ne(jt,ar,U,J,se):uc)){It=!1;break}Gt||(Gt=nt=="constructor")}if(It&&!Gt){var Pi=_.constructor,Ai=I.constructor;Pi!=Ai&&"constructor"in _&&"constructor"in I&&!(typeof Pi=="function"&&Pi instanceof Pi&&typeof Ai=="function"&&Ai instanceof Ai)&&(It=!1)}return se.delete(_),se.delete(I),It}function ic(_){return e1(_,_1,c1)}function Ni(_,I){var U=_.__data__;return l1(I)?U[typeof I=="string"?"string":"hash"]:U.map}function Dr(_,I){var U=pe(_,I);return r1(U)?U:void 0}function a1(_){var I=ne.call(_,mt),U=_[mt];try{_[mt]=void 0;var J=!0}catch{}var Ne=me.call(_);return J&&(I?_[mt]=U:delete _[mt]),Ne}var c1=nr?function(_){return _==null?[]:(_=Object(_),we(nr(_),function(I){return Lt.call(_,I)}))}:w1,Vt=Yr;(Me&&Vt(new Me(new ArrayBuffer(1)))!=G||Le&&Vt(new Le)!=T||je&&Vt(je.resolve())!=x||qe&&Vt(new qe)!=p||Be&&Vt(new Be)!=L)&&(Vt=function(_){var I=Yr(_),U=I==D?_.constructor:void 0,J=U?or(U):"";if(J)switch(J){case Ge:return G;case ke:return T;case We:return x;case Ye:return p;case Xe:return L}return I});function u1(_,I){return I=I??a,!!I&&(typeof _=="number"||Z.test(_))&&_>-1&&_%1==0&&_<I}function l1(_){var I=typeof _;return I=="string"||I=="number"||I=="symbol"||I=="boolean"?_!=="__proto__":_===null}function h1(_){return!!be&&be in _}function f1(_){var I=_&&_.constructor,U=typeof I=="function"&&I.prototype||re;return _===U}function d1(_){return me.call(_)}function or(_){if(_!=null){try{return ge.call(_)}catch{}try{return _+""}catch{}}return""}function nc(_,I){return _===I||_!==_&&I!==I}var p1=ec(function(){return arguments}())?ec:function(_){return Xr(_)&&ne.call(_,"callee")&&!Lt.call(_,"callee")},Ri=Array.isArray;function g1(_){return _!=null&&oc(_.length)&&!sc(_)}var kn=Wr||b1;function y1(_,I){return tc(_,I)}function sc(_){if(!ac(_))return!1;var I=Yr(_);return I==w||I==m||I==l||I==b}function oc(_){return typeof _=="number"&&_>-1&&_%1==0&&_<=a}function ac(_){var I=typeof _;return _!=null&&(I=="object"||I=="function")}function Xr(_){return _!=null&&typeof _=="object"}var cc=he?Ce(he):i1;function _1(_){return g1(_)?Z_(_):n1(_)}function w1(){return[]}function b1(){return!1}t.exports=y1})(Ln,Ln.exports);var Ug=Ln.exports;function Mg(t,e){return e=e||{},new Promise(function(r,i){var n=new XMLHttpRequest,s=[],a=[],c={},h=function(){return{ok:(n.status/100|0)==2,statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:h,headers:{keys:function(){return s},entries:function(){return a},get:function(f){return c[f.toLowerCase()]},has:function(f){return f.toLowerCase()in c}}}};for(var l in n.open(e.method||"get",t,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(f,g,y){s.push(g=g.toLowerCase()),a.push([g,y]),c[g]=c[g]?c[g]+","+y:y}),r(h())},n.onerror=i,n.withCredentials=e.credentials=="include",e.headers)n.setRequestHeader(l,e.headers[l]);n.send(e.body||null)})}var jg=Object.freeze({__proto__:null,default:Mg}),la=kt(jg),qg=self.fetch||(self.fetch=la.default||la),Bg=Object.defineProperty,ha=Object.getOwnPropertySymbols,zg=Object.prototype.hasOwnProperty,Kg=Object.prototype.propertyIsEnumerable,fa=(t,e,r)=>e in t?Bg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,ut=(t,e)=>{for(var r in e||(e={}))zg.call(e,r)&&fa(t,r,e[r]);if(ha)for(var r of ha(e))Kg.call(e,r)&&fa(t,r,e[r]);return t};function Hg(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),a=s.charCodeAt(0);if(r[a]!==255)throw new TypeError(s+" is ambiguous");r[a]=n}var c=t.length,h=t.charAt(0),l=Math.log(c)/Math.log(256),f=Math.log(256)/Math.log(c);function g(m){if(m instanceof Uint8Array||(ArrayBuffer.isView(m)?m=new Uint8Array(m.buffer,m.byteOffset,m.byteLength):Array.isArray(m)&&(m=Uint8Array.from(m))),!(m instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(m.length===0)return"";for(var T=0,A=0,M=0,D=m.length;M!==D&&m[M]===0;)M++,T++;for(var x=(D-M)*f+1>>>0,b=new Uint8Array(x);M!==D;){for(var E=m[M],p=0,o=x-1;(E!==0||p<A)&&o!==-1;o--,p++)E+=256*b[o]>>>0,b[o]=E%c>>>0,E=E/c>>>0;if(E!==0)throw new Error("Non-zero carry");A=p,M++}for(var d=x-A;d!==x&&b[d]===0;)d++;for(var C=h.repeat(T);d<x;++d)C+=t.charAt(b[d]);return C}function y(m){if(typeof m!="string")throw new TypeError("Expected String");if(m.length===0)return new Uint8Array;var T=0;if(m[T]!==" "){for(var A=0,M=0;m[T]===h;)A++,T++;for(var D=(m.length-T)*l+1>>>0,x=new Uint8Array(D);m[T];){var b=r[m.charCodeAt(T)];if(b===255)return;for(var E=0,p=D-1;(b!==0||E<M)&&p!==-1;p--,E++)b+=c*x[p]>>>0,x[p]=b%256>>>0,b=b/256>>>0;if(b!==0)throw new Error("Non-zero carry");M=E,T++}if(m[T]!==" "){for(var o=D-M;o!==D&&x[o]===0;)o++;for(var d=new Uint8Array(A+(D-o)),C=A;o!==D;)d[C++]=x[o++];return d}}}function w(m){var T=y(m);if(T)return T;throw new Error(`Non-${e} character`)}return{encode:g,decodeUnsafe:y,decode:w}}var Vg=Hg,Gg=Vg;const da=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},kg=t=>new TextEncoder().encode(t),Wg=t=>new TextDecoder().decode(t);class Yg{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class Xg{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return pa(this,e)}}class Jg{constructor(e){this.decoders=e}or(e){return pa(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const pa=(t,e)=>new Jg(ut(ut({},t.decoders||{[t.prefix]:t}),e.decoders||{[e.prefix]:e}));class Qg{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Yg(e,r,i),this.decoder=new Xg(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const mi=({name:t,prefix:e,encode:r,decode:i})=>new Qg(t,e,r,i),Hr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Gg(r,e);return mi({prefix:t,name:e,encode:i,decode:s=>da(n(s))})},Zg=(t,e,r,i)=>{const n={};for(let f=0;f<e.length;++f)n[e[f]]=f;let s=t.length;for(;t[s-1]==="=";)--s;const a=new Uint8Array(s*r/8|0);let c=0,h=0,l=0;for(let f=0;f<s;++f){const g=n[t[f]];if(g===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|g,c+=r,c>=8&&(c-=8,a[l++]=255&h>>c)}if(c>=r||255&h<<8-c)throw new SyntaxError("Unexpected end of data");return a},ey=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",a=0,c=0;for(let h=0;h<t.length;++h)for(c=c<<8|t[h],a+=8;a>r;)a-=r,s+=e[n&c>>a];if(a&&(s+=e[n&c<<r-a]),i)for(;s.length*r&7;)s+="=";return s},tt=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>mi({prefix:e,name:t,encode(n){return ey(n,i,r)},decode(n){return Zg(n,i,r,t)}}),ty=mi({prefix:"\0",name:"identity",encode:t=>Wg(t),decode:t=>kg(t)});var ry=Object.freeze({__proto__:null,identity:ty});const iy=tt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ny=Object.freeze({__proto__:null,base2:iy});const sy=tt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var oy=Object.freeze({__proto__:null,base8:sy});const ay=Hr({prefix:"9",name:"base10",alphabet:"0123456789"});var cy=Object.freeze({__proto__:null,base10:ay});const uy=tt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),ly=tt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var hy=Object.freeze({__proto__:null,base16:uy,base16upper:ly});const fy=tt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),dy=tt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),py=tt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gy=tt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yy=tt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),_y=tt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),wy=tt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),by=tt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),my=tt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var vy=Object.freeze({__proto__:null,base32:fy,base32upper:dy,base32pad:py,base32padupper:gy,base32hex:yy,base32hexupper:_y,base32hexpad:wy,base32hexpadupper:by,base32z:my});const Ey=Hr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Dy=Hr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Sy=Object.freeze({__proto__:null,base36:Ey,base36upper:Dy});const Iy=Hr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Oy=Hr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var xy=Object.freeze({__proto__:null,base58btc:Iy,base58flickr:Oy});const Ty=tt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),Ny=tt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Ry=tt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Py=tt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ay=Object.freeze({__proto__:null,base64:Ty,base64pad:Ny,base64url:Ry,base64urlpad:Py});const ga=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Cy=ga.reduce((t,e,r)=>(t[r]=e,t),[]),Ly=ga.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Fy(t){return t.reduce((e,r)=>(e+=Cy[r],e),"")}function $y(t){const e=[];for(const r of t){const i=Ly[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Uy=mi({prefix:"\u{1F680}",name:"base256emoji",encode:Fy,decode:$y});var My=Object.freeze({__proto__:null,base256emoji:Uy}),jy=_a,ya=128,qy=127,By=~qy,zy=Math.pow(2,31);function _a(t,e,r){e=e||[],r=r||0;for(var i=r;t>=zy;)e[r++]=t&255|ya,t/=128;for(;t&By;)e[r++]=t&255|ya,t>>>=7;return e[r]=t|0,_a.bytes=r-i+1,e}var Ky=Fn,Hy=128,wa=127;function Fn(t,i){var r=0,i=i||0,n=0,s=i,a,c=t.length;do{if(s>=c)throw Fn.bytes=0,new RangeError("Could not decode varint");a=t[s++],r+=n<28?(a&wa)<<n:(a&wa)*Math.pow(2,n),n+=7}while(a>=Hy);return Fn.bytes=s-i,r}var Vy=Math.pow(2,7),Gy=Math.pow(2,14),ky=Math.pow(2,21),Wy=Math.pow(2,28),Yy=Math.pow(2,35),Xy=Math.pow(2,42),Jy=Math.pow(2,49),Qy=Math.pow(2,56),Zy=Math.pow(2,63),e0=function(t){return t<Vy?1:t<Gy?2:t<ky?3:t<Wy?4:t<Yy?5:t<Xy?6:t<Jy?7:t<Qy?8:t<Zy?9:10},t0={encode:jy,decode:Ky,encodingLength:e0},ba=t0;const ma=(t,e,r=0)=>(ba.encode(t,e,r),e),va=t=>ba.encodingLength(t),$n=(t,e)=>{const r=e.byteLength,i=va(t),n=i+va(r),s=new Uint8Array(n+r);return ma(t,s,0),ma(r,s,i),s.set(e,n),new r0(t,r,e,s)};class r0{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Ea=({name:t,code:e,encode:r})=>new i0(t,e,r);class i0{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?$n(this.code,r):r.then(i=>$n(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Da=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),n0=Ea({name:"sha2-256",code:18,encode:Da("SHA-256")}),s0=Ea({name:"sha2-512",code:19,encode:Da("SHA-512")});var o0=Object.freeze({__proto__:null,sha256:n0,sha512:s0});const Sa=0,a0="identity",Ia=da;var c0=Object.freeze({__proto__:null,identity:{code:Sa,name:a0,encode:Ia,digest:t=>$n(Sa,Ia(t))}});new TextEncoder,new TextDecoder;const Oa=ut(ut(ut(ut(ut(ut(ut(ut(ut(ut({},ry),ny),oy),cy),hy),vy),Sy),xy),Ay),My);ut(ut({},o0),c0);function xa(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function u0(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?xa(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Ta(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const Na=Ta("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Un=Ta("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=u0(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),l0=ut({utf8:Na,"utf-8":Na,hex:Oa.base16,latin1:Un,ascii:Un,binary:Un},Oa);function h0(t,e="utf8"){const r=l0[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?xa(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}const Ra="wc",f0=2,Mn="core",zt=`${Ra}@2:${Mn}:`,d0={name:Mn,logger:"error"},p0={database:":memory:"},g0="crypto",Pa="client_ed25519_seed",y0=W.ONE_DAY,_0="keychain",w0="0.3",b0="messages",m0="0.3",v0=W.SIX_HOURS,E0="publisher",Aa="irn",D0="error",Ca="wss://relay.walletconnect.com",La="wss://relay.walletconnect.org",S0="relayer",bt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},I0="_subscription",Et={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},O0=W.ONE_SECOND,x0="2.11.3",T0=1e4,N0="0.3",R0="WALLETCONNECT_CLIENT_ID",Rt={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},P0="subscription",A0="0.3",C0=W.FIVE_SECONDS*1e3,L0="pairing",F0="0.3",Vr={wc_pairingDelete:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:W.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:W.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:W.ONE_DAY,prompt:!1,tag:0},res:{ttl:W.ONE_DAY,prompt:!1,tag:0}}},mr={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},Pt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},$0="history",U0="0.3",M0="expirer",Dt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},j0="0.3",jn="verify-api",vr="https://verify.walletconnect.com",qn="https://verify.walletconnect.org",q0=[vr,qn],B0="echo",z0="https://echo.walletconnect.com";class K0{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=_0,this.version=w0,this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=V("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=ye.generateChildLogger(r,this.name)}get context(){return ye.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,jo(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?qo(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class H0{constructor(e,r,i){this.core=e,this.logger=r,this.name=g0,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),s=ho(n);return lo(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=Pd();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const s=await this.getClientSeed(),a=ho(s),c=En();return await jf(c,n,y0,a)},this.generateSharedKey=(n,s,a)=>{this.isInitialized();const c=this.getPrivateKey(n),h=Ad(c,s);return this.setSymKey(h,a)},this.setSymKey=async(n,s)=>{this.isInitialized();const a=s||Cd(n);return await this.keychain.set(a,n),a},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,s,a)=>{this.isInitialized();const c=Lo(a),h=Ir(s);if(Fo(c)){const y=c.senderPublicKey,w=c.receiverPublicKey;n=await this.generateSharedKey(y,w)}const l=this.getSymKey(n),{type:f,senderPublicKey:g}=c;return Fd({type:f,symKey:l,message:h,senderPublicKey:g})},this.decode=async(n,s,a)=>{this.isInitialized();const c=Md(s,a);if(Fo(c)){const h=c.receiverPublicKey,l=c.senderPublicKey;n=await this.generateSharedKey(h,l)}try{const h=this.getSymKey(n),l=$d({symKey:h,encoded:s});return ri(l)}catch(h){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(h)}},this.getPayloadType=n=>{const s=gi(n);return $r(s.type)},this.getPayloadSenderPublicKey=n=>{const s=gi(n);return s.senderPublicKey?ot(s.senderPublicKey,at):void 0},this.core=e,this.logger=ye.generateChildLogger(r,this.name),this.keychain=i||new K0(this.core,this.logger)}get context(){return ye.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(Pa)}catch{e=En(),await this.keychain.set(Pa,e)}return h0(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class V0 extends bl{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=b0,this.version=m0,this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const s=dr(n);let a=this.messages.get(i);return typeof a>"u"&&(a={}),typeof a[s]<"u"||(a[s]=n,this.messages.set(i,a),await this.persist()),s},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const s=this.get(i),a=dr(n);return typeof s[a]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=ye.generateChildLogger(e,this.name),this.core=r}get context(){return ye.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,jo(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?qo(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class G0 extends ml{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new ft.exports.EventEmitter,this.name=E0,this.queue=new Map,this.publishTimeout=W.toMiliseconds(W.ONE_MINUTE),this.failedPublishTimeout=W.toMiliseconds(W.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(i,n,s)=>{var a;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});const c=s?.ttl||v0,h=Dn(s),l=s?.prompt||!1,f=s?.tag||0,g=s?.id||ir().toString(),y={topic:i,message:n,opts:{ttl:c,relay:h,prompt:l,tag:f,id:g}},w=`Failed to publish payload, please try again. id:${g} tag:${f}`,m=Date.now();let T,A=1;try{for(;T===void 0;){if(Date.now()-m>this.publishTimeout)throw new Error(w);this.logger.trace({id:g,attempts:A},`publisher.publish - attempt ${A}`),T=await await jr(this.rpcPublish(i,n,c,h,l,f,g).catch(M=>this.logger.warn(M)),this.publishTimeout,w),A++,T||await new Promise(M=>setTimeout(M,this.failedPublishTimeout))}this.relayer.events.emit(bt.publish,y),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:g,topic:i,message:n,opts:s}})}catch(M){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(M),(a=s?.internal)!=null&&a.throwOnFailedPublish)throw M;this.queue.set(g,y)}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=ye.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return ye.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,s,a,c){var h,l,f,g;const y={method:yi(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:s,tag:a},id:c};return ct((h=y.params)==null?void 0:h.prompt)&&((l=y.params)==null||delete l.prompt),ct((f=y.params)==null?void 0:f.tag)&&((g=y.params)==null||delete g.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:y}),this.relayer.request(y)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(ur.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(bt.connection_stalled);return}this.checkQueue()}),this.relayer.on(bt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class k0{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var W0=Object.defineProperty,Y0=Object.defineProperties,X0=Object.getOwnPropertyDescriptors,Fa=Object.getOwnPropertySymbols,J0=Object.prototype.hasOwnProperty,Q0=Object.prototype.propertyIsEnumerable,$a=(t,e,r)=>e in t?W0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Gr=(t,e)=>{for(var r in e||(e={}))J0.call(e,r)&&$a(t,r,e[r]);if(Fa)for(var r of Fa(e))Q0.call(e,r)&&$a(t,r,e[r]);return t},Bn=(t,e)=>Y0(t,X0(e));class Z0 extends Dl{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new k0,this.events=new ft.exports.EventEmitter,this.name=P0,this.version=A0,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=zt,this.subscribeTimeout=W.toMiliseconds(W.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=Dn(n),a={topic:i,relay:s};this.pending.set(i,a);const c=await this.rpcSubscribe(i,s);return typeof c=="string"&&(this.onSubscribe(c,a),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}})),c}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>{if(this.topics.includes(i))return!0;const n=`${this.pendingSubscriptionWatchLabel}_${i}`;return await new Promise((s,a)=>{const c=new W.Watch;c.start(n);const h=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(h),c.stop(n),s(!0)),c.elapsed(n)>=C0&&(clearInterval(h),c.stop(n),a(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=ye.generateChildLogger(r,this.name),this.clientId=""}get context(){return ye.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=Dn(i);await this.rpcUnsubscribe(e,r,n);const s=Ae("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:yi(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await jr(this.relayer.request(i).catch(n=>this.logger.warn(n)),this.subscribeTimeout)?dr(e+this.clientId):null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(bt.connection_stalled)}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:yi(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await jr(this.relayer.request(i).catch(n=>this.logger.warn(n)),this.subscribeTimeout)}catch{this.relayer.events.emit(bt.connection_stalled)}}rpcUnsubscribe(e,r,i){const n={method:yi(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,Bn(Gr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,Gr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,Gr({},r)),this.topicMap.set(r.topic,e),this.events.emit(Rt.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(Rt.deleted,Bn(Gr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(Rt.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(Rt.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);qr(r)&&this.onBatchSubscribe(r.map((i,n)=>Bn(Gr({},e[n]),{id:i})))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(ur.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(Rt.created,async e=>{const r=Rt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(Rt.deleted,async e=>{const r=Rt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var e_=Object.defineProperty,Ua=Object.getOwnPropertySymbols,t_=Object.prototype.hasOwnProperty,r_=Object.prototype.propertyIsEnumerable,Ma=(t,e,r)=>e in t?e_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,i_=(t,e)=>{for(var r in e||(e={}))t_.call(e,r)&&Ma(t,r,e[r]);if(Ua)for(var r of Ua(e))r_.call(e,r)&&Ma(t,r,e[r]);return t};class n_ extends vl{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ft.exports.EventEmitter,this.name=S0,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=W.toMiliseconds(W.THIRTY_SECONDS+W.ONE_SECOND),this.request=async r=>{var i,n;this.logger.debug("Publishing Request Payload");const s=r.id||ir().toString();await this.toEstablishConnection();try{const a=this.provider.request(r);this.requestsInFlight.set(s,{promise:a,request:r}),this.logger.trace({id:s,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - attempt to publish...");const c=await new Promise(async(h,l)=>{const f=()=>{l(new Error(`relayer.request - publish interrupted, id: ${s}`))};this.provider.on(Et.disconnect,f);const g=await a;this.provider.off(Et.disconnect,f),h(g)});return this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - published"),c}catch(a){throw this.logger.debug(`Failed to Publish Request: ${s}`),a}finally{this.requestsInFlight.delete(s)}},this.resetPingTimeout=()=>{if(Ur())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,n;(n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||n.terminate()},this.heartBeatTimeout)}catch(r){this.logger.warn(r)}},this.onPayloadHandler=r=>{this.onProviderPayload(r),this.resetPingTimeout()},this.onConnectHandler=()=>{this.startPingTimeout(),this.events.emit(bt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(bt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(Et.payload,this.onPayloadHandler),this.provider.on(Et.connect,this.onConnectHandler),this.provider.on(Et.disconnect,this.onDisconnectHandler),this.provider.on(Et.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?ye.generateChildLogger(e.logger,this.name):ye.pino(ye.getDefaultLoggerOptions({level:e.logger||D0})),this.messages=new V0(this.logger,e.core),this.subscriber=new Z0(this,this.logger),this.publisher=new G0(this,this.logger),this.relayUrl=e?.relayUrl||Ca,this.projectId=e.projectId,this.bundleId=Hd(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${La}...`),await this.restartTransport(La)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&this.subscriber.pending.size===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},T0)}get context(){return ye.getLoggerContext(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let n=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",s;const a=c=>{c.topic===e&&(this.subscriber.off(Rt.created,a),s())};return await Promise.all([new Promise(c=>{s=c,this.subscriber.on(Rt.created,a)}),new Promise(async c=>{n=await this.subscriber.subscribe(e,r)||n,c()})]),n}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(e=>e.promise))}catch(e){this.logger.warn(e)}this.hasExperiencedNetworkDisruption||this.connected?await jr(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect(),await this.createProvider()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(r,i)=>{const n=()=>{this.provider.off(Et.disconnect,n),i(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(Et.disconnect,n),await jr(this.provider.connect(),W.toMiliseconds(W.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(s=>{i(s)}),await this.subscriber.start(),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r}finally{this.connectionAttemptInProgress=!1}}async restartTransport(e){this.connectionAttemptInProgress||(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await Qo())throw new Error("No internet connection detected. Please restart your network and try again.")}startPingTimeout(){var e,r,i,n,s;if(Ur())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||s.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(a){this.logger.warn(a)}}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Ag(new $g(Xd({sdkVersion:x0,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.debug(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),Cn(e)){if(!e.method.endsWith(I0))return;const r=e.params,{topic:i,message:n,publishedAt:s}=r.data,a={topic:i,message:n,publishedAt:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(i_({type:"event",event:r.id},a)),this.events.emit(r.id,a),await this.acknowledgePayload(e),await this.onMessageEvent(a)}else bi(e)&&this.events.emit(bt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(bt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=Pn(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(Et.payload,this.onPayloadHandler),this.provider.off(Et.connect,this.onConnectHandler),this.provider.off(Et.disconnect,this.onDisconnectHandler),this.provider.off(Et.error,this.onProviderErrorHandler)}async registerEventListeners(){let e=await Qo();Hp(async r=>{e!==r&&(e=r,r?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.events.emit(bt.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e))},W.toMiliseconds(O0))}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)}),await this.transportOpen())}}var s_=Object.defineProperty,ja=Object.getOwnPropertySymbols,o_=Object.prototype.hasOwnProperty,a_=Object.prototype.propertyIsEnumerable,qa=(t,e,r)=>e in t?s_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ba=(t,e)=>{for(var r in e||(e={}))o_.call(e,r)&&qa(t,r,e[r]);if(ja)for(var r of ja(e))a_.call(e,r)&&qa(t,r,e[r]);return t};class vi extends El{constructor(e,r,i,n=zt,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=N0,this.cached=[],this.initialized=!1,this.storagePrefix=zt,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(a=>{this.getKey&&a!==null&&!ct(a)?this.map.set(this.getKey(a),a):vp(a)?this.map.set(a.id,a):Ep(a)&&this.map.set(a.topic,a)}),this.cached=[],this.initialized=!0)},this.set=async(a,c)=>{this.isInitialized(),this.map.has(a)?await this.update(a,c):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:a,value:c}),this.map.set(a,c),await this.persist())},this.get=a=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:a}),this.getData(a)),this.getAll=a=>(this.isInitialized(),a?this.values.filter(c=>Object.keys(a).every(h=>Ug(c[h],a[h]))):this.values),this.update=async(a,c)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:a,update:c});const h=Ba(Ba({},this.getData(a)),c);this.map.set(a,h),await this.persist()},this.delete=async(a,c)=>{this.isInitialized(),this.map.has(a)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:a,reason:c}),this.map.delete(a),this.addToRecentlyDeleted(a),await this.persist())},this.logger=ye.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return ye.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:n}=V("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class c_{constructor(e,r){this.core=e,this.logger=r,this.name=L0,this.version=F0,this.events=new ft.exports,this.initialized=!1,this.storagePrefix=zt,this.ignoredPayloadTypes=[tr],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=En(),n=await this.core.crypto.setSymKey(i),s=wt(W.FIVE_MINUTES),a={protocol:Aa},c={topic:n,expiry:s,relay:a,active:!1},h=fp({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:a,expiryTimestamp:s});return await this.pairings.set(n,c),await this.core.relayer.subscribe(n),this.core.expirer.set(n,s),{topic:n,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:s,relay:a,expiryTimestamp:c}=Vo(i.uri);let h;if(this.pairings.keys.includes(n)&&(h=this.pairings.get(n),h.active))throw new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);const l=c||wt(W.FIVE_MINUTES),f={topic:n,relay:a,expiry:l,active:!1};return await this.pairings.set(n,f),this.core.expirer.set(n,l),i.activatePairing&&await this.activate({topic:n}),this.events.emit(mr.create,f),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(s,n),await this.core.relayer.subscribe(n,{relay:a}),f},this.activate=async({topic:i})=>{this.isInitialized();const n=wt(W.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:a,resolve:c,reject:h}=yr();this.events.once(xe("pairing_ping",s),({error:l})=>{l?h(l):c()}),await a()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",Ae("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,s)=>{const a=br(n,s),c=await this.core.crypto.encode(i,a),h=Vr[n].req;return this.core.history.set(i,a),this.core.relayer.publish(i,c,h),a.id},this.sendResult=async(i,n,s)=>{const a=Pn(i,s),c=await this.core.crypto.encode(n,a),h=await this.core.history.get(n,i),l=Vr[h.request.method].res;await this.core.relayer.publish(n,c,l),await this.core.history.resolve(a)},this.sendError=async(i,n,s)=>{const a=An(i,s),c=await this.core.crypto.encode(n,a),h=await this.core.history.get(n,i),l=Vr[h.request.method]?Vr[h.request.method].res:Vr.unregistered_method.res;await this.core.relayer.publish(n,c,l),await this.core.history.resolve(a)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,Ae("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>Bt(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return this.onPairingPingRequest(n,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,s);default:return this.onUnknownRpcMethodRequest(n,s)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:s}=i,a=(await this.core.history.get(n,s.id)).request.method;switch(a){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(a)}},this.onPairingPingRequest=async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(mr.ping,{id:s,topic:i})}catch(a){await this.sendError(s,i,a),this.logger.error(a)}},this.onPairingPingResponse=(i,n)=>{const{id:s}=n;setTimeout(()=>{Ut(n)?this.events.emit(xe("pairing_ping",s),{}):Ot(n)&&this.events.emit(xe("pairing_ping",s),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(mr.delete,{id:s,topic:i})}catch(a){await this.sendError(s,i,a),this.logger.error(a)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:s,method:a}=n;try{if(this.registeredMethods.includes(a))return;const c=Ae("WC_METHOD_UNSUPPORTED",a);await this.sendError(s,i,c),this.logger.error(c)}catch(c){await this.sendError(s,i,c),this.logger.error(c)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(Ae("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{var n;if(!gt(i)){const{message:a}=V("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(a)}if(!mp(i.uri)){const{message:a}=V("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(a)}const s=Vo(i.uri);if(!((n=s?.relay)!=null&&n.protocol)){const{message:a}=V("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(a)}if(!(s!=null&&s.symKey)){const{message:a}=V("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(a)}if(s!=null&&s.expiryTimestamp&&W.toMiliseconds(s?.expiryTimestamp)<Date.now()){const{message:a}=V("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(a)}},this.isValidPing=async i=>{if(!gt(i)){const{message:s}=V("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!gt(i)){const{message:s}=V("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!Ve(i,!1)){const{message:n}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(Bt(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=V("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=ye.generateChildLogger(r,this.name),this.pairings=new vi(this.core,this.logger,this.name,this.storagePrefix)}get context(){return ye.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(bt.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);try{Cn(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):bi(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(Dt.expired,async e=>{const{topic:r}=zo(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(mr.expire,{topic:r}))})}}class u_ extends wl{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new ft.exports.EventEmitter,this.name=$0,this.version=U0,this.cached=[],this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const a={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:wt(W.THIRTY_DAYS)};this.records.set(a.id,a),this.events.emit(Pt.created,a)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=Ot(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(Pt.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(Pt.deleted,s)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=ye.generateChildLogger(r,this.name)}get context(){return ye.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:br(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(Pt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(Pt.created,e=>{const r=Pt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Pt.updated,e=>{const r=Pt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(Pt.deleted,e=>{const r=Pt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(ur.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{W.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class l_ extends Sl{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new ft.exports.EventEmitter,this.name=M0,this.version=j0,this.cached=[],this.initialized=!1,this.storagePrefix=zt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const s=this.formatTarget(i),a={target:s,expiry:n};this.expirations.set(s,a),this.checkExpiry(s,a),this.events.emit(Dt.created,{target:s,expiration:a})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(Dt.deleted,{target:n,expiration:s})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=ye.generateChildLogger(r,this.name)}get context(){return ye.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Jd(e);if(typeof e=="number")return Qd(e);const{message:r}=V("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(Dt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=V("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=V("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;W.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(Dt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(ur.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(Dt.created,e=>{const r=Dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Dt.expired,e=>{const r=Dt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(Dt.deleted,e=>{const r=Dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}}}class h_ extends Il{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=jn,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async i=>{if(this.verifyDisabled||pr()||!gr())return;const n=this.getVerifyUrl(i?.verifyUrl);this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=qn;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const n=this.getVerifyUrl(i?.verifyUrl);let s;try{s=await this.fetchAttestation(i.attestationId,n)}catch(a){this.logger.info(`failed to resolve attestation: ${i.attestationId} from url: ${n}`),this.logger.info(a),s=await this.fetchAttestation(i.attestationId,qn)}return s},this.fetchAttestation=async(i,n)=>{this.logger.info(`resolving attestation: ${i} from url: ${n}`);const s=this.startAbortTimer(W.ONE_SECOND*2),a=await fetch(`${n}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(s),a.status===200?await a.json():void 0},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var n;try{if(!this.iframe)return;(n=this.iframe.contentWindow)==null||n.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const n=s=>{s.data==="verify_ready"&&(this.onInit(),window.removeEventListener("message",n),i())};await Promise.race([new Promise(s=>{const a=document.getElementById(jn);if(a)return this.iframe=a,this.onInit(),s();window.addEventListener("message",n);const c=document.createElement("iframe");c.id=jn,c.src=`${this.verifyUrl}/${this.projectId}`,c.style.display="none",document.body.append(c),this.iframe=c,i=s}),new Promise((s,a)=>setTimeout(()=>{window.removeEventListener("message",n),a("verify iframe load timeout")},W.toMiliseconds(W.FIVE_SECONDS)))])},this.onInit=()=>{this.initialized=!0,this.processQueue()},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=i=>{let n=i||vr;return q0.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${vr}`),n=vr),n},this.logger=ye.generateChildLogger(r,this.name),this.verifyUrl=vr,this.abortController=new AbortController,this.isDevEnv=Ur()&&process.env.IS_VITEST}get context(){return ye.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),W.toMiliseconds(e))}}class f_ extends Ol{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.context=B0,this.registerDeviceToken=async i=>{const{clientId:n,token:s,notificationType:a,enableEncrypted:c=!1}=i,h=`${z0}/${this.projectId}/clients`;await qg(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:a,token:s,always_raw:c})})},this.logger=ye.generateChildLogger(r,this.context)}}var d_=Object.defineProperty,za=Object.getOwnPropertySymbols,p_=Object.prototype.hasOwnProperty,g_=Object.prototype.propertyIsEnumerable,Ka=(t,e,r)=>e in t?d_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ha=(t,e)=>{for(var r in e||(e={}))p_.call(e,r)&&Ka(t,r,e[r]);if(za)for(var r of za(e))g_.call(e,r)&&Ka(t,r,e[r]);return t};class zn extends _l{constructor(e){super(e),this.protocol=Ra,this.version=f0,this.name=Mn,this.events=new ft.exports.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||Ca,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:ye.pino(ye.getDefaultLoggerOptions({level:e?.logger||d0.logger}));this.logger=ye.generateChildLogger(r,this.name),this.heartbeat=new ur.HeartBeat,this.crypto=new H0(this,this.logger,e?.keychain),this.history=new u_(this,this.logger),this.expirer=new l_(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new kc(Ha(Ha({},p0),e?.storageOptions)),this.relayer=new n_({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new c_(this,this.logger),this.verify=new h_(this.projectId||"",this.logger),this.echoClient=new f_(this.projectId||"",this.logger)}static async init(e){const r=new zn(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(R0,i),r}get context(){return ye.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const y_=zn,Kn="wc",Hn=2,Vn="client",Ei=`${Kn}@${Hn}:${Vn}:`,Di={name:Vn,logger:"error",controller:!1,relayUrl:"wss://relay.walletconnect.com"},__={session_proposal:"session_proposal",session_update:"session_update",session_extend:"session_extend",session_ping:"session_ping",session_delete:"session_delete",session_expire:"session_expire",session_request:"session_request",session_request_sent:"session_request_sent",session_event:"session_event",proposal_expire:"proposal_expire",session_request_expire:"session_request_expire"},w_={database:":memory:"},Gn="WALLETCONNECT_DEEPLINK_CHOICE",b_={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},m_="history",v_="0.3",Va="proposal",E_=W.THIRTY_DAYS,Ga="Proposal expired",ka="session",kr=W.SEVEN_DAYS,Wa="engine",At={wc_sessionPropose:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1100},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1101}},wc_sessionSettle:{req:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1102},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1103}},wc_sessionUpdate:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1104},res:{ttl:W.ONE_DAY,prompt:!1,tag:1105}},wc_sessionExtend:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1106},res:{ttl:W.ONE_DAY,prompt:!1,tag:1107}},wc_sessionRequest:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1108},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1109}},wc_sessionEvent:{req:{ttl:W.FIVE_MINUTES,prompt:!0,tag:1110},res:{ttl:W.FIVE_MINUTES,prompt:!1,tag:1111}},wc_sessionDelete:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1112},res:{ttl:W.ONE_DAY,prompt:!1,tag:1113}},wc_sessionPing:{req:{ttl:W.ONE_DAY,prompt:!1,tag:1114},res:{ttl:W.ONE_DAY,prompt:!1,tag:1115}}},Si={min:W.FIVE_MINUTES,max:W.SEVEN_DAYS},Ct={idle:"IDLE",active:"ACTIVE"},Ya="request",Xa=["wc_sessionPropose","wc_sessionRequest","wc_authRequest"];var D_=Object.defineProperty,S_=Object.defineProperties,I_=Object.getOwnPropertyDescriptors,Ja=Object.getOwnPropertySymbols,O_=Object.prototype.hasOwnProperty,x_=Object.prototype.propertyIsEnumerable,Qa=(t,e,r)=>e in t?D_(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,lt=(t,e)=>{for(var r in e||(e={}))O_.call(e,r)&&Qa(t,r,e[r]);if(Ja)for(var r of Ja(e))x_.call(e,r)&&Qa(t,r,e[r]);return t},Er=(t,e)=>S_(t,I_(e));class T_ extends Tl{constructor(e){super(e),this.name=Wa,this.events=new ft.exports,this.initialized=!1,this.ignoredPayloadTypes=[tr],this.requestQueue={state:Ct.idle,queue:[]},this.sessionRequestQueue={state:Ct.idle,queue:[]},this.requestQueueDelay=W.ONE_SECOND,this.recentlyDeletedMap=new Map,this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.registerPairingEvents(),this.client.core.pairing.register({methods:Object.keys(At)}),this.initialized=!0,setTimeout(()=>{this.sessionRequestQueue.queue=this.getPendingSessionRequests(),this.processSessionRequestQueue()},W.toMiliseconds(this.requestQueueDelay)))},this.connect=async r=>{await this.isInitialized();const i=Er(lt({},r),{requiredNamespaces:r.requiredNamespaces||{},optionalNamespaces:r.optionalNamespaces||{}});await this.isValidConnect(i);const{pairingTopic:n,requiredNamespaces:s,optionalNamespaces:a,sessionProperties:c,relays:h}=i;let l=n,f,g=!1;try{l&&(g=this.client.core.pairing.pairings.get(l).active)}catch(b){throw this.client.logger.error(`connect() -> pairing.get(${l}) failed`),b}if(!l||!g){const{topic:b,uri:E}=await this.client.core.pairing.create();l=b,f=E}if(!l){const{message:b}=V("NO_MATCHING_KEY",`connect() pairing topic: ${l}`);throw new Error(b)}const y=await this.client.core.crypto.generateKeyPair(),w=At.wc_sessionPropose.req.ttl||W.FIVE_MINUTES,m=wt(w),T=lt({requiredNamespaces:s,optionalNamespaces:a,relays:h??[{protocol:Aa}],proposer:{publicKey:y,metadata:this.client.metadata},expiryTimestamp:m},c&&{sessionProperties:c}),{reject:A,resolve:M,done:D}=yr(w,Ga);this.events.once(xe("session_connect"),async({error:b,session:E})=>{if(b)A(b);else if(E){E.self.publicKey=y;const p=Er(lt({},E),{requiredNamespaces:T.requiredNamespaces,optionalNamespaces:T.optionalNamespaces});await this.client.session.set(E.topic,p),await this.setExpiry(E.topic,E.expiry),l&&await this.client.core.pairing.updateMetadata({topic:l,metadata:E.peer.metadata}),M(p)}});const x=await this.sendRequest({topic:l,method:"wc_sessionPropose",params:T,throwOnFailedPublish:!0});return await this.setProposal(x,lt({id:x},T)),{uri:f,approval:D}},this.pair=async r=>{await this.isInitialized();try{return await this.client.core.pairing.pair(r)}catch(i){throw this.client.logger.error("pair() failed"),i}},this.approve=async r=>{await this.isInitialized();try{await this.isValidApprove(r)}catch(M){throw this.client.logger.error("approve() -> isValidApprove() failed"),M}const{id:i,relayProtocol:n,namespaces:s,sessionProperties:a}=r;let c;try{c=this.client.proposal.get(i)}catch(M){throw this.client.logger.error(`approve() -> proposal.get(${i}) failed`),M}let{pairingTopic:h,proposer:l,requiredNamespaces:f,optionalNamespaces:g}=c;h=h||"";const y=await this.client.core.crypto.generateKeyPair(),w=l.publicKey,m=await this.client.core.crypto.generateSharedKey(y,w),T=lt({relay:{protocol:n??"irn"},namespaces:s,pairingTopic:h,controller:{publicKey:y,metadata:this.client.metadata},expiry:wt(kr)},a&&{sessionProperties:a});await this.client.core.relayer.subscribe(m);const A=Er(lt({},T),{topic:m,requiredNamespaces:f,optionalNamespaces:g,pairingTopic:h,acknowledged:!1,self:T.controller,peer:{publicKey:l.publicKey,metadata:l.metadata},controller:y});await this.client.session.set(m,A);try{await this.sendResult({id:i,topic:h,result:{relay:{protocol:n??"irn"},responderPublicKey:y},throwOnFailedPublish:!0}),await this.sendRequest({topic:m,method:"wc_sessionSettle",params:T,throwOnFailedPublish:!0})}catch(M){throw this.client.logger.error(M),this.client.session.delete(m,Ae("USER_DISCONNECTED")),await this.client.core.relayer.unsubscribe(m),M}return await this.client.core.pairing.updateMetadata({topic:h,metadata:l.metadata}),await this.client.proposal.delete(i,Ae("USER_DISCONNECTED")),await this.client.core.pairing.activate({topic:h}),await this.setExpiry(m,wt(kr)),{topic:m,acknowledged:()=>new Promise(M=>setTimeout(()=>M(this.client.session.get(m)),500))}},this.reject=async r=>{await this.isInitialized();try{await this.isValidReject(r)}catch(a){throw this.client.logger.error("reject() -> isValidReject() failed"),a}const{id:i,reason:n}=r;let s;try{s=this.client.proposal.get(i).pairingTopic}catch(a){throw this.client.logger.error(`reject() -> proposal.get(${i}) failed`),a}s&&(await this.sendError(i,s,n),await this.client.proposal.delete(i,Ae("USER_DISCONNECTED")))},this.update=async r=>{await this.isInitialized();try{await this.isValidUpdate(r)}catch(g){throw this.client.logger.error("update() -> isValidUpdate() failed"),g}const{topic:i,namespaces:n}=r,{done:s,resolve:a,reject:c}=yr(),h=wr(),l=ir().toString(),f=this.client.session.get(i).namespaces;return this.events.once(xe("session_update",h),async({error:g})=>{g?c(g):(await this.client.session.update(i,{namespaces:n}),a())}),this.sendRequest({topic:i,method:"wc_sessionUpdate",params:{namespaces:n},throwOnFailedPublish:!0,clientRpcId:h,relayRpcId:l}).catch(g=>{this.client.logger.error(g),this.client.session.update(i,{namespaces:f}),c(g)}),{acknowledged:s}},this.extend=async r=>{await this.isInitialized();try{await this.isValidExtend(r)}catch(h){throw this.client.logger.error("extend() -> isValidExtend() failed"),h}const{topic:i}=r,n=wr(),{done:s,resolve:a,reject:c}=yr();return this.events.once(xe("session_extend",n),({error:h})=>{h?c(h):a()}),await this.setExpiry(i,wt(kr)),this.sendRequest({topic:i,method:"wc_sessionExtend",params:{},clientRpcId:n,throwOnFailedPublish:!0}).catch(h=>{c(h)}),{acknowledged:s}},this.request=async r=>{await this.isInitialized();try{await this.isValidRequest(r)}catch(y){throw this.client.logger.error("request() -> isValidRequest() failed"),y}const{chainId:i,request:n,topic:s,expiry:a=At.wc_sessionRequest.req.ttl}=r,c=wr(),h=ir().toString(),{done:l,resolve:f,reject:g}=yr(a,"Request expired. Please try again.");return this.events.once(xe("session_request",c),({error:y,result:w})=>{y?g(y):f(w)}),await Promise.all([new Promise(async y=>{await this.sendRequest({clientRpcId:c,relayRpcId:h,topic:s,method:"wc_sessionRequest",params:{request:Er(lt({},n),{expiryTimestamp:wt(a)}),chainId:i},expiry:a,throwOnFailedPublish:!0}).catch(w=>g(w)),this.client.events.emit("session_request_sent",{topic:s,request:n,chainId:i,id:c}),y()}),new Promise(async y=>{const w=await ep(this.client.core.storage,Gn);Zd({id:c,topic:s,wcDeepLink:w}),y()}),l()]).then(y=>y[2])},this.respond=async r=>{await this.isInitialized(),await this.isValidRespond(r);const{topic:i,response:n}=r,{id:s}=n;Ut(n)?await this.sendResult({id:s,topic:i,result:n.result,throwOnFailedPublish:!0}):Ot(n)&&await this.sendError(s,i,n.error),this.cleanupAfterResponse(r)},this.ping=async r=>{await this.isInitialized();try{await this.isValidPing(r)}catch(n){throw this.client.logger.error("ping() -> isValidPing() failed"),n}const{topic:i}=r;if(this.client.session.keys.includes(i)){const n=wr(),s=ir().toString(),{done:a,resolve:c,reject:h}=yr();this.events.once(xe("session_ping",n),({error:l})=>{l?h(l):c()}),await Promise.all([this.sendRequest({topic:i,method:"wc_sessionPing",params:{},throwOnFailedPublish:!0,clientRpcId:n,relayRpcId:s}),a()])}else this.client.core.pairing.pairings.keys.includes(i)&&await this.client.core.pairing.ping({topic:i})},this.emit=async r=>{await this.isInitialized(),await this.isValidEmit(r);const{topic:i,event:n,chainId:s}=r,a=ir().toString();await this.sendRequest({topic:i,method:"wc_sessionEvent",params:{event:n,chainId:s},throwOnFailedPublish:!0,relayRpcId:a})},this.disconnect=async r=>{await this.isInitialized(),await this.isValidDisconnect(r);const{topic:i}=r;if(this.client.session.keys.includes(i))await this.sendRequest({topic:i,method:"wc_sessionDelete",params:Ae("USER_DISCONNECTED"),throwOnFailedPublish:!0}),await this.deleteSession({topic:i,emitEvent:!1});else if(this.client.core.pairing.pairings.keys.includes(i))await this.client.core.pairing.disconnect({topic:i});else{const{message:n}=V("MISMATCHED_TOPIC",`Session or pairing topic not found: ${i}`);throw new Error(n)}},this.find=r=>(this.isInitialized(),this.client.session.getAll().filter(i=>wp(i,r))),this.getPendingSessionRequests=()=>this.client.pendingRequest.getAll(),this.cleanupDuplicatePairings=async r=>{if(r.pairingTopic)try{const i=this.client.core.pairing.pairings.get(r.pairingTopic),n=this.client.core.pairing.pairings.getAll().filter(s=>{var a,c;return((a=s.peerMetadata)==null?void 0:a.url)&&((c=s.peerMetadata)==null?void 0:c.url)===r.peer.metadata.url&&s.topic&&s.topic!==i.topic});if(n.length===0)return;this.client.logger.info(`Cleaning up ${n.length} duplicate pairing(s)`),await Promise.all(n.map(s=>this.client.core.pairing.disconnect({topic:s.topic}))),this.client.logger.info("Duplicate pairings clean up finished")}catch(i){this.client.logger.error(i)}},this.deleteSession=async r=>{const{topic:i,expirerHasDeleted:n=!1,emitEvent:s=!0,id:a=0}=r,{self:c}=this.client.session.get(i);await this.client.core.relayer.unsubscribe(i),await this.client.session.delete(i,Ae("USER_DISCONNECTED")),this.addToRecentlyDeleted(i,"session"),this.client.core.crypto.keychain.has(c.publicKey)&&await this.client.core.crypto.deleteKeyPair(c.publicKey),this.client.core.crypto.keychain.has(i)&&await this.client.core.crypto.deleteSymKey(i),n||this.client.core.expirer.del(i),this.client.core.storage.removeItem(Gn).catch(h=>this.client.logger.warn(h)),this.getPendingSessionRequests().forEach(h=>{h.topic===i&&this.deletePendingSessionRequest(h.id,Ae("USER_DISCONNECTED"))}),s&&this.client.events.emit("session_delete",{id:a,topic:i})},this.deleteProposal=async(r,i)=>{await Promise.all([this.client.proposal.delete(r,Ae("USER_DISCONNECTED")),i?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"proposal")},this.deletePendingSessionRequest=async(r,i,n=!1)=>{await Promise.all([this.client.pendingRequest.delete(r,i),n?Promise.resolve():this.client.core.expirer.del(r)]),this.addToRecentlyDeleted(r,"request"),this.sessionRequestQueue.queue=this.sessionRequestQueue.queue.filter(s=>s.id!==r),n&&(this.sessionRequestQueue.state=Ct.idle,this.client.events.emit("session_request_expire",{id:r}))},this.setExpiry=async(r,i)=>{this.client.session.keys.includes(r)&&await this.client.session.update(r,{expiry:i}),this.client.core.expirer.set(r,i)},this.setProposal=async(r,i)=>{await this.client.proposal.set(r,i),this.client.core.expirer.set(r,wt(At.wc_sessionPropose.req.ttl))},this.setPendingSessionRequest=async r=>{const{id:i,topic:n,params:s,verifyContext:a}=r,c=s.request.expiryTimestamp||wt(At.wc_sessionRequest.req.ttl);await this.client.pendingRequest.set(i,{id:i,topic:n,params:s,verifyContext:a}),c&&this.client.core.expirer.set(i,c)},this.sendRequest=async r=>{const{topic:i,method:n,params:s,expiry:a,relayRpcId:c,clientRpcId:h,throwOnFailedPublish:l}=r,f=br(n,s,h);if(gr()&&Xa.includes(n)){const w=dr(JSON.stringify(f));this.client.core.verify.register({attestationId:w})}let g;try{g=await this.client.core.crypto.encode(i,f)}catch(w){throw await this.cleanup(),this.client.logger.error(`sendRequest() -> core.crypto.encode() for topic ${i} failed`),w}const y=At[n].req;return a&&(y.ttl=a),c&&(y.id=c),this.client.core.history.set(i,f),l?(y.internal=Er(lt({},y.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(i,g,y)):this.client.core.relayer.publish(i,g,y).catch(w=>this.client.logger.error(w)),f.id},this.sendResult=async r=>{const{id:i,topic:n,result:s,throwOnFailedPublish:a}=r,c=Pn(i,s);let h;try{h=await this.client.core.crypto.encode(n,c)}catch(g){throw await this.cleanup(),this.client.logger.error(`sendResult() -> core.crypto.encode() for topic ${n} failed`),g}let l;try{l=await this.client.core.history.get(n,i)}catch(g){throw this.client.logger.error(`sendResult() -> history.get(${n}, ${i}) failed`),g}const f=At[l.request.method].res;a?(f.internal=Er(lt({},f.internal),{throwOnFailedPublish:!0}),await this.client.core.relayer.publish(n,h,f)):this.client.core.relayer.publish(n,h,f).catch(g=>this.client.logger.error(g)),await this.client.core.history.resolve(c)},this.sendError=async(r,i,n)=>{const s=An(r,n);let a;try{a=await this.client.core.crypto.encode(i,s)}catch(l){throw await this.cleanup(),this.client.logger.error(`sendError() -> core.crypto.encode() for topic ${i} failed`),l}let c;try{c=await this.client.core.history.get(i,r)}catch(l){throw this.client.logger.error(`sendError() -> history.get(${i}, ${r}) failed`),l}const h=At[c.request.method].res;this.client.core.relayer.publish(i,a,h),await this.client.core.history.resolve(s)},this.cleanup=async()=>{const r=[],i=[];this.client.session.getAll().forEach(n=>{let s=!1;Bt(n.expiry)&&(s=!0),this.client.core.crypto.keychain.has(n.topic)||(s=!0),s&&r.push(n.topic)}),this.client.proposal.getAll().forEach(n=>{Bt(n.expiryTimestamp)&&i.push(n.id)}),await Promise.all([...r.map(n=>this.deleteSession({topic:n})),...i.map(n=>this.deleteProposal(n))])},this.onRelayEventRequest=async r=>{this.requestQueue.queue.push(r),await this.processRequestsQueue()},this.processRequestsQueue=async()=>{if(this.requestQueue.state===Ct.active){this.client.logger.info("Request queue already active, skipping...");return}for(this.client.logger.info(`Request queue starting with ${this.requestQueue.queue.length} requests`);this.requestQueue.queue.length>0;){this.requestQueue.state=Ct.active;const r=this.requestQueue.queue.shift();if(r)try{this.processRequest(r),await new Promise(i=>setTimeout(i,300))}catch(i){this.client.logger.warn(i)}}this.requestQueue.state=Ct.idle},this.processRequest=r=>{const{topic:i,payload:n}=r,s=n.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeRequest(i,n);case"wc_sessionSettle":return this.onSessionSettleRequest(i,n);case"wc_sessionUpdate":return this.onSessionUpdateRequest(i,n);case"wc_sessionExtend":return this.onSessionExtendRequest(i,n);case"wc_sessionPing":return this.onSessionPingRequest(i,n);case"wc_sessionDelete":return this.onSessionDeleteRequest(i,n);case"wc_sessionRequest":return this.onSessionRequest(i,n);case"wc_sessionEvent":return this.onSessionEventRequest(i,n);default:return this.client.logger.info(`Unsupported request method ${s}`)}},this.onRelayEventResponse=async r=>{const{topic:i,payload:n}=r,s=(await this.client.core.history.get(i,n.id)).request.method;switch(s){case"wc_sessionPropose":return this.onSessionProposeResponse(i,n);case"wc_sessionSettle":return this.onSessionSettleResponse(i,n);case"wc_sessionUpdate":return this.onSessionUpdateResponse(i,n);case"wc_sessionExtend":return this.onSessionExtendResponse(i,n);case"wc_sessionPing":return this.onSessionPingResponse(i,n);case"wc_sessionRequest":return this.onSessionRequestResponse(i,n);default:return this.client.logger.info(`Unsupported response method ${s}`)}},this.onRelayEventUnknownPayload=r=>{const{topic:i}=r,{message:n}=V("MISSING_OR_INVALID",`Decoded payload on topic ${i} is not identifiable as a JSON-RPC request or a response.`);throw new Error(n)},this.onSessionProposeRequest=async(r,i)=>{const{params:n,id:s}=i;try{this.isValidConnect(lt({},i.params));const a=n.expiryTimestamp||wt(At.wc_sessionPropose.req.ttl),c=lt({id:s,pairingTopic:r,expiryTimestamp:a},n);await this.setProposal(s,c);const h=dr(JSON.stringify(i)),l=await this.getVerifyContext(h,c.proposer.metadata);this.client.events.emit("session_proposal",{id:s,params:c,verifyContext:l})}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.onSessionProposeResponse=async(r,i)=>{const{id:n}=i;if(Ut(i)){const{result:s}=i;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",result:s});const a=this.client.proposal.get(n);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",proposal:a});const c=a.proposer.publicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",selfPublicKey:c});const h=s.responderPublicKey;this.client.logger.trace({type:"method",method:"onSessionProposeResponse",peerPublicKey:h});const l=await this.client.core.crypto.generateSharedKey(c,h);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",sessionTopic:l});const f=await this.client.core.relayer.subscribe(l);this.client.logger.trace({type:"method",method:"onSessionProposeResponse",subscriptionId:f}),await this.client.core.pairing.activate({topic:r})}else if(Ot(i)){await this.client.proposal.delete(n,Ae("USER_DISCONNECTED"));const s=xe("session_connect");if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners, 954`);this.events.emit(xe("session_connect"),{error:i.error})}},this.onSessionSettleRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidSessionSettleRequest(s);const{relay:a,controller:c,expiry:h,namespaces:l,sessionProperties:f,pairingTopic:g}=i.params,y=lt({topic:r,relay:a,expiry:h,namespaces:l,acknowledged:!0,pairingTopic:g,requiredNamespaces:{},optionalNamespaces:{},controller:c.publicKey,self:{publicKey:"",metadata:this.client.metadata},peer:{publicKey:c.publicKey,metadata:c.metadata}},f&&{sessionProperties:f});await this.sendResult({id:i.id,topic:r,result:!0,throwOnFailedPublish:!0});const w=xe("session_connect");if(this.events.listenerCount(w)===0)throw new Error(`emitting ${w} without any listeners 997`);this.events.emit(xe("session_connect"),{session:y}),this.cleanupDuplicatePairings(y)}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.onSessionSettleResponse=async(r,i)=>{const{id:n}=i;Ut(i)?(await this.client.session.update(r,{acknowledged:!0}),this.events.emit(xe("session_approve",n),{})):Ot(i)&&(await this.client.session.delete(r,Ae("USER_DISCONNECTED")),this.events.emit(xe("session_approve",n),{error:i.error}))},this.onSessionUpdateRequest=async(r,i)=>{const{params:n,id:s}=i;try{const a=`${r}_session_update`,c=Br.get(a);if(c&&this.isRequestOutOfSync(c,s)){this.client.logger.info(`Discarding out of sync request - ${s}`),this.sendError(s,r,Ae("INVALID_UPDATE_REQUEST"));return}this.isValidUpdate(lt({topic:r},n));try{Br.set(a,s),await this.client.session.update(r,{namespaces:n.namespaces}),await this.sendResult({id:s,topic:r,result:!0,throwOnFailedPublish:!0})}catch(h){throw Br.delete(a),h}this.client.events.emit("session_update",{id:s,topic:r,params:n})}catch(a){await this.sendError(s,r,a),this.client.logger.error(a)}},this.isRequestOutOfSync=(r,i)=>parseInt(i.toString().slice(0,-3))<=parseInt(r.toString().slice(0,-3)),this.onSessionUpdateResponse=(r,i)=>{const{id:n}=i,s=xe("session_update",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Ut(i)?this.events.emit(xe("session_update",n),{}):Ot(i)&&this.events.emit(xe("session_update",n),{error:i.error})},this.onSessionExtendRequest=async(r,i)=>{const{id:n}=i;try{this.isValidExtend({topic:r}),await this.setExpiry(r,wt(kr)),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_extend",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionExtendResponse=(r,i)=>{const{id:n}=i,s=xe("session_extend",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Ut(i)?this.events.emit(xe("session_extend",n),{}):Ot(i)&&this.events.emit(xe("session_extend",n),{error:i.error})},this.onSessionPingRequest=async(r,i)=>{const{id:n}=i;try{this.isValidPing({topic:r}),await this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.client.events.emit("session_ping",{id:n,topic:r})}catch(s){await this.sendError(n,r,s),this.client.logger.error(s)}},this.onSessionPingResponse=(r,i)=>{const{id:n}=i,s=xe("session_ping",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);setTimeout(()=>{Ut(i)?this.events.emit(xe("session_ping",n),{}):Ot(i)&&this.events.emit(xe("session_ping",n),{error:i.error})},500)},this.onSessionDeleteRequest=async(r,i)=>{const{id:n}=i;try{this.isValidDisconnect({topic:r,reason:i.params}),await Promise.all([new Promise(s=>{this.client.core.relayer.once(bt.publish,async()=>{s(await this.deleteSession({topic:r,id:n}))})}),this.sendResult({id:n,topic:r,result:!0,throwOnFailedPublish:!0}),this.cleanupPendingSentRequestsForTopic({topic:r,error:Ae("USER_DISCONNECTED")})])}catch(s){this.client.logger.error(s)}},this.onSessionRequest=async(r,i)=>{const{id:n,params:s}=i;try{this.isValidRequest(lt({topic:r},s));const a=dr(JSON.stringify(br("wc_sessionRequest",s,n))),c=this.client.session.get(r),h=await this.getVerifyContext(a,c.peer.metadata),l={id:n,topic:r,params:s,verifyContext:h};await this.setPendingSessionRequest(l),this.addSessionRequestToSessionRequestQueue(l),this.processSessionRequestQueue()}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.onSessionRequestResponse=(r,i)=>{const{id:n}=i,s=xe("session_request",n);if(this.events.listenerCount(s)===0)throw new Error(`emitting ${s} without any listeners`);Ut(i)?this.events.emit(xe("session_request",n),{result:i.result}):Ot(i)&&this.events.emit(xe("session_request",n),{error:i.error})},this.onSessionEventRequest=async(r,i)=>{const{id:n,params:s}=i;try{const a=`${r}_session_event_${s.event.name}`,c=Br.get(a);if(c&&this.isRequestOutOfSync(c,n)){this.client.logger.info(`Discarding out of sync request - ${n}`);return}this.isValidEmit(lt({topic:r},s)),this.client.events.emit("session_event",{id:n,topic:r,params:s}),Br.set(a,n)}catch(a){await this.sendError(n,r,a),this.client.logger.error(a)}},this.addSessionRequestToSessionRequestQueue=r=>{this.sessionRequestQueue.queue.push(r)},this.cleanupAfterResponse=r=>{this.deletePendingSessionRequest(r.response.id,{message:"fulfilled",code:0}),setTimeout(()=>{this.sessionRequestQueue.state=Ct.idle,this.processSessionRequestQueue()},W.toMiliseconds(this.requestQueueDelay))},this.cleanupPendingSentRequestsForTopic=({topic:r,error:i})=>{const n=this.client.core.history.pending;n.length>0&&n.filter(s=>s.topic===r&&s.request.method==="wc_sessionRequest").forEach(s=>{const a=s.request.id,c=xe("session_request",a);if(this.events.listenerCount(c)===0)throw new Error(`emitting ${c} without any listeners`);this.events.emit(xe("session_request",s.request.id),{error:i})})},this.processSessionRequestQueue=()=>{if(this.sessionRequestQueue.state===Ct.active){this.client.logger.info("session request queue is already active.");return}const r=this.sessionRequestQueue.queue[0];if(!r){this.client.logger.info("session request queue is empty.");return}try{this.sessionRequestQueue.state=Ct.active,this.client.events.emit("session_request",r)}catch(i){this.client.logger.error(i)}},this.onPairingCreated=r=>{if(r.active)return;const i=this.client.proposal.getAll().find(n=>n.pairingTopic===r.topic);i&&this.onSessionProposeRequest(r.topic,br("wc_sessionPropose",{requiredNamespaces:i.requiredNamespaces,optionalNamespaces:i.optionalNamespaces,relays:i.relays,proposer:i.proposer,sessionProperties:i.sessionProperties},i.id))},this.isValidConnect=async r=>{if(!gt(r)){const{message:h}=V("MISSING_OR_INVALID",`connect() params: ${JSON.stringify(r)}`);throw new Error(h)}const{pairingTopic:i,requiredNamespaces:n,optionalNamespaces:s,sessionProperties:a,relays:c}=r;if(ct(i)||await this.isValidPairingTopic(i),!Rp(c,!0)){const{message:h}=V("MISSING_OR_INVALID",`connect() relays: ${c}`);throw new Error(h)}!ct(n)&&_i(n)!==0&&this.validateNamespaces(n,"requiredNamespaces"),!ct(s)&&_i(s)!==0&&this.validateNamespaces(s,"optionalNamespaces"),ct(a)||this.validateSessionProps(a,"sessionProperties")},this.validateNamespaces=(r,i)=>{const n=Np(r,"connect()",i);if(n)throw new Error(n.message)},this.isValidApprove=async r=>{if(!gt(r))throw new Error(V("MISSING_OR_INVALID",`approve() params: ${r}`).message);const{id:i,namespaces:n,relayProtocol:s,sessionProperties:a}=r;this.checkRecentlyDeleted(i),await this.isValidProposalId(i);const c=this.client.proposal.get(i),h=In(n,"approve()");if(h)throw new Error(h.message);const l=Xo(c.requiredNamespaces,n,"approve()");if(l)throw new Error(l.message);if(!Ve(s,!0)){const{message:f}=V("MISSING_OR_INVALID",`approve() relayProtocol: ${s}`);throw new Error(f)}ct(a)||this.validateSessionProps(a,"sessionProperties")},this.isValidReject=async r=>{if(!gt(r)){const{message:s}=V("MISSING_OR_INVALID",`reject() params: ${r}`);throw new Error(s)}const{id:i,reason:n}=r;if(this.checkRecentlyDeleted(i),await this.isValidProposalId(i),!Ap(n)){const{message:s}=V("MISSING_OR_INVALID",`reject() reason: ${JSON.stringify(n)}`);throw new Error(s)}},this.isValidSessionSettleRequest=r=>{if(!gt(r)){const{message:l}=V("MISSING_OR_INVALID",`onSessionSettleRequest() params: ${r}`);throw new Error(l)}const{relay:i,controller:n,namespaces:s,expiry:a}=r;if(!Wo(i)){const{message:l}=V("MISSING_OR_INVALID","onSessionSettleRequest() relay protocol should be a string");throw new Error(l)}const c=Dp(n,"onSessionSettleRequest()");if(c)throw new Error(c.message);const h=In(s,"onSessionSettleRequest()");if(h)throw new Error(h.message);if(Bt(a)){const{message:l}=V("EXPIRED","onSessionSettleRequest()");throw new Error(l)}},this.isValidUpdate=async r=>{if(!gt(r)){const{message:h}=V("MISSING_OR_INVALID",`update() params: ${r}`);throw new Error(h)}const{topic:i,namespaces:n}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const s=this.client.session.get(i),a=In(n,"update()");if(a)throw new Error(a.message);const c=Xo(s.requiredNamespaces,n,"update()");if(c)throw new Error(c.message)},this.isValidExtend=async r=>{if(!gt(r)){const{message:n}=V("MISSING_OR_INVALID",`extend() params: ${r}`);throw new Error(n)}const{topic:i}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i)},this.isValidRequest=async r=>{if(!gt(r)){const{message:h}=V("MISSING_OR_INVALID",`request() params: ${r}`);throw new Error(h)}const{topic:i,request:n,chainId:s,expiry:a}=r;this.checkRecentlyDeleted(i),await this.isValidSessionTopic(i);const{namespaces:c}=this.client.session.get(i);if(!Yo(c,s)){const{message:h}=V("MISSING_OR_INVALID",`request() chainId: ${s}`);throw new Error(h)}if(!Cp(n)){const{message:h}=V("MISSING_OR_INVALID",`request() ${JSON.stringify(n)}`);throw new Error(h)}if(!$p(c,s,n.method)){const{message:h}=V("MISSING_OR_INVALID",`request() method: ${n.method}`);throw new Error(h)}if(a&&!qp(a,Si)){const{message:h}=V("MISSING_OR_INVALID",`request() expiry: ${a}. Expiry must be a number (in seconds) between ${Si.min} and ${Si.max}`);throw new Error(h)}},this.isValidRespond=async r=>{var i;if(!gt(r)){const{message:a}=V("MISSING_OR_INVALID",`respond() params: ${r}`);throw new Error(a)}const{topic:n,response:s}=r;try{await this.isValidSessionTopic(n)}catch(a){throw(i=r?.response)!=null&&i.id&&this.cleanupAfterResponse(r),a}if(!Lp(s)){const{message:a}=V("MISSING_OR_INVALID",`respond() response: ${JSON.stringify(s)}`);throw new Error(a)}},this.isValidPing=async r=>{if(!gt(r)){const{message:n}=V("MISSING_OR_INVALID",`ping() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.isValidEmit=async r=>{if(!gt(r)){const{message:c}=V("MISSING_OR_INVALID",`emit() params: ${r}`);throw new Error(c)}const{topic:i,event:n,chainId:s}=r;await this.isValidSessionTopic(i);const{namespaces:a}=this.client.session.get(i);if(!Yo(a,s)){const{message:c}=V("MISSING_OR_INVALID",`emit() chainId: ${s}`);throw new Error(c)}if(!Fp(n)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}if(!Up(a,s,n.name)){const{message:c}=V("MISSING_OR_INVALID",`emit() event: ${JSON.stringify(n)}`);throw new Error(c)}},this.isValidDisconnect=async r=>{if(!gt(r)){const{message:n}=V("MISSING_OR_INVALID",`disconnect() params: ${r}`);throw new Error(n)}const{topic:i}=r;await this.isValidSessionOrPairingTopic(i)},this.getVerifyContext=async(r,i)=>{const n={verified:{verifyUrl:i.verifyUrl||vr,validation:"UNKNOWN",origin:i.url||""}};try{const s=await this.client.core.verify.resolve({attestationId:r,verifyUrl:i.verifyUrl});s&&(n.verified.origin=s.origin,n.verified.isScam=s.isScam,n.verified.validation=s.origin===new URL(i.url).origin?"VALID":"INVALID")}catch(s){this.client.logger.info(s)}return this.client.logger.info(`Verify context: ${JSON.stringify(n)}`),n},this.validateSessionProps=(r,i)=>{Object.values(r).forEach(n=>{if(!Ve(n,!1)){const{message:s}=V("MISSING_OR_INVALID",`${i} must be in Record<string, string> format. Received: ${JSON.stringify(n)}`);throw new Error(s)}})},this.addToRecentlyDeleted=(r,i)=>{if(this.recentlyDeletedMap.set(r,i),this.recentlyDeletedMap.size>=this.recentlyDeletedLimit){let n=0;const s=this.recentlyDeletedLimit/2;for(const a of this.recentlyDeletedMap.keys()){if(n++>=s)break;this.recentlyDeletedMap.delete(a)}}},this.checkRecentlyDeleted=r=>{const i=this.recentlyDeletedMap.get(r);if(i){const{message:n}=V("MISSING_OR_INVALID",`Record was recently deleted - ${i}: ${r}`);throw new Error(n)}}}async isInitialized(){if(!this.initialized){const{message:e}=V("NOT_INITIALIZED",this.name);throw new Error(e)}await this.client.core.relayer.confirmOnlineStateOrThrow()}registerRelayerEvents(){this.client.core.relayer.on(bt.message,async e=>{const{topic:r,message:i}=e;if(this.ignoredPayloadTypes.includes(this.client.core.crypto.getPayloadType(i)))return;const n=await this.client.core.crypto.decode(r,i);try{Cn(n)?(this.client.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):bi(n)?(await this.client.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.client.core.history.delete(r,n.id)):this.onRelayEventUnknownPayload({topic:r,payload:n})}catch(s){this.client.logger.error(s)}})}registerExpirerEvents(){this.client.core.expirer.on(Dt.expired,async e=>{const{topic:r,id:i}=zo(e.target);if(i&&this.client.pendingRequest.keys.includes(i))return await this.deletePendingSessionRequest(i,V("EXPIRED"),!0);r?this.client.session.keys.includes(r)&&(await this.deleteSession({topic:r,expirerHasDeleted:!0}),this.client.events.emit("session_expire",{topic:r})):i&&(await this.deleteProposal(i,!0),this.client.events.emit("proposal_expire",{id:i}))})}registerPairingEvents(){this.client.core.pairing.events.on(mr.create,e=>this.onPairingCreated(e)),this.client.core.pairing.events.on(mr.delete,e=>{this.addToRecentlyDeleted(e.topic,"pairing")})}isValidPairingTopic(e){if(!Ve(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`pairing topic should be a string: ${e}`);throw new Error(r)}if(!this.client.core.pairing.pairings.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`pairing topic doesn't exist: ${e}`);throw new Error(r)}if(Bt(this.client.core.pairing.pairings.get(e).expiry)){const{message:r}=V("EXPIRED",`pairing topic: ${e}`);throw new Error(r)}}async isValidSessionTopic(e){if(!Ve(e,!1)){const{message:r}=V("MISSING_OR_INVALID",`session topic should be a string: ${e}`);throw new Error(r)}if(this.checkRecentlyDeleted(e),!this.client.session.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`session topic doesn't exist: ${e}`);throw new Error(r)}if(Bt(this.client.session.get(e).expiry)){await this.deleteSession({topic:e});const{message:r}=V("EXPIRED",`session topic: ${e}`);throw new Error(r)}if(!this.client.core.crypto.keychain.has(e)){const{message:r}=V("MISSING_OR_INVALID",`session topic does not exist in keychain: ${e}`);throw await this.deleteSession({topic:e}),new Error(r)}}async isValidSessionOrPairingTopic(e){if(this.checkRecentlyDeleted(e),this.client.session.keys.includes(e))await this.isValidSessionTopic(e);else if(this.client.core.pairing.pairings.keys.includes(e))this.isValidPairingTopic(e);else if(Ve(e,!1)){const{message:r}=V("NO_MATCHING_KEY",`session or pairing topic doesn't exist: ${e}`);throw new Error(r)}else{const{message:r}=V("MISSING_OR_INVALID",`session or pairing topic should be a string: ${e}`);throw new Error(r)}}async isValidProposalId(e){if(!Pp(e)){const{message:r}=V("MISSING_OR_INVALID",`proposal id should be a number: ${e}`);throw new Error(r)}if(!this.client.proposal.keys.includes(e)){const{message:r}=V("NO_MATCHING_KEY",`proposal id doesn't exist: ${e}`);throw new Error(r)}if(Bt(this.client.proposal.get(e).expiryTimestamp)){await this.deleteProposal(e);const{message:r}=V("EXPIRED",`proposal id: ${e}`);throw new Error(r)}}}class N_ extends vi{constructor(e,r){super(e,r,Va,Ei),this.core=e,this.logger=r}}class Za extends vi{constructor(e,r){super(e,r,ka,Ei),this.core=e,this.logger=r}}class R_ extends vi{constructor(e,r){super(e,r,Ya,Ei,i=>i.id),this.core=e,this.logger=r}}class Ii extends xl{constructor(e){super(e),this.protocol=Kn,this.version=Hn,this.name=Di.name,this.events=new ft.exports.EventEmitter,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.removeAllListeners=i=>this.events.removeAllListeners(i),this.connect=async i=>{try{return await this.engine.connect(i)}catch(n){throw this.logger.error(n.message),n}},this.pair=async i=>{try{return await this.engine.pair(i)}catch(n){throw this.logger.error(n.message),n}},this.approve=async i=>{try{return await this.engine.approve(i)}catch(n){throw this.logger.error(n.message),n}},this.reject=async i=>{try{return await this.engine.reject(i)}catch(n){throw this.logger.error(n.message),n}},this.update=async i=>{try{return await this.engine.update(i)}catch(n){throw this.logger.error(n.message),n}},this.extend=async i=>{try{return await this.engine.extend(i)}catch(n){throw this.logger.error(n.message),n}},this.request=async i=>{try{return await this.engine.request(i)}catch(n){throw this.logger.error(n.message),n}},this.respond=async i=>{try{return await this.engine.respond(i)}catch(n){throw this.logger.error(n.message),n}},this.ping=async i=>{try{return await this.engine.ping(i)}catch(n){throw this.logger.error(n.message),n}},this.emit=async i=>{try{return await this.engine.emit(i)}catch(n){throw this.logger.error(n.message),n}},this.disconnect=async i=>{try{return await this.engine.disconnect(i)}catch(n){throw this.logger.error(n.message),n}},this.find=i=>{try{return this.engine.find(i)}catch(n){throw this.logger.error(n.message),n}},this.getPendingSessionRequests=()=>{try{return this.engine.getPendingSessionRequests()}catch(i){throw this.logger.error(i.message),i}},this.name=e?.name||Di.name,this.metadata=e?.metadata||Gd();const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:ye.pino(ye.getDefaultLoggerOptions({level:e?.logger||Di.logger}));this.core=e?.core||new y_(e),this.logger=ye.generateChildLogger(r,this.name),this.session=new Za(this.core,this.logger),this.proposal=new N_(this.core,this.logger),this.pendingRequest=new R_(this.core,this.logger),this.engine=new T_(this)}static async init(e){const r=new Ii(e);return await r.initialize(),r}get context(){return ye.getLoggerContext(this.logger)}get pairing(){return this.core.pairing.pairings}async initialize(){this.logger.trace("Initialized");try{await this.core.start(),await this.session.init(),await this.proposal.init(),await this.pendingRequest.init(),await this.engine.init(),this.core.verify.init({verifyUrl:this.metadata.verifyUrl}),this.logger.info("SignClient Initialization Success")}catch(e){throw this.logger.info("SignClient Initialization Failure"),this.logger.error(e.message),e}}}const P_=Za,A_=Ii;De.ENGINE_CONTEXT=Wa,De.ENGINE_QUEUE_STATES=Ct,De.ENGINE_RPC_OPTS=At,De.HISTORY_CONTEXT=m_,De.HISTORY_EVENTS=b_,De.HISTORY_STORAGE_VERSION=v_,De.METHODS_TO_VERIFY=Xa,De.PROPOSAL_CONTEXT=Va,De.PROPOSAL_EXPIRY=E_,De.PROPOSAL_EXPIRY_MESSAGE=Ga,De.REQUEST_CONTEXT=Ya,De.SESSION_CONTEXT=ka,De.SESSION_EXPIRY=kr,De.SESSION_REQUEST_EXPIRY_BOUNDARIES=Si,De.SIGN_CLIENT_CONTEXT=Vn,De.SIGN_CLIENT_DEFAULT=Di,De.SIGN_CLIENT_EVENTS=__,De.SIGN_CLIENT_PROTOCOL=Kn,De.SIGN_CLIENT_STORAGE_OPTIONS=w_,De.SIGN_CLIENT_STORAGE_PREFIX=Ei,De.SIGN_CLIENT_VERSION=Hn,De.SessionStore=P_,De.SignClient=A_,De.WALLETCONNECT_DEEPLINK_CHOICE=Gn,De.default=Ii,Object.defineProperty(De,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
