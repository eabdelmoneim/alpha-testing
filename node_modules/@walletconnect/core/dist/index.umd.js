(function(q,st){typeof exports=="object"&&typeof module<"u"?st(exports):typeof define=="function"&&define.amd?define(["exports"],st):(q=typeof globalThis<"u"?globalThis:q||self,st(q["@walletconnect/core"]={}))})(this,function(q){"use strict";var st=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function Lt(t){var e=t.default;if(typeof e=="function"){var r=function(){return e.apply(this,arguments)};r.prototype=e.prototype}else r={};return Object.defineProperty(r,"__esModule",{value:!0}),Object.keys(t).forEach(function(i){var n=Object.getOwnPropertyDescriptor(t,i);Object.defineProperty(r,i,n.get?n:{enumerable:!0,get:function(){return t[i]}})}),r}var ht={exports:{}},Vt=typeof Reflect=="object"?Reflect:null,gn=Vt&&typeof Vt.apply=="function"?Vt.apply:function(e,r,i){return Function.prototype.apply.call(e,r,i)},Sr;Vt&&typeof Vt.ownKeys=="function"?Sr=Vt.ownKeys:Object.getOwnPropertySymbols?Sr=function(e){return Object.getOwnPropertyNames(e).concat(Object.getOwnPropertySymbols(e))}:Sr=function(e){return Object.getOwnPropertyNames(e)};function ja(t){console&&console.warn&&console.warn(t)}var yn=Number.isNaN||function(e){return e!==e};function Ie(){Ie.init.call(this)}ht.exports=Ie,ht.exports.once=Ka,Ie.EventEmitter=Ie,Ie.prototype._events=void 0,Ie.prototype._eventsCount=0,Ie.prototype._maxListeners=void 0;var pn=10;function Or(t){if(typeof t!="function")throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}Object.defineProperty(Ie,"defaultMaxListeners",{enumerable:!0,get:function(){return pn},set:function(t){if(typeof t!="number"||t<0||yn(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");pn=t}}),Ie.init=function(){(this._events===void 0||this._events===Object.getPrototypeOf(this)._events)&&(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ie.prototype.setMaxListeners=function(e){if(typeof e!="number"||e<0||yn(e))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+e+".");return this._maxListeners=e,this};function _n(t){return t._maxListeners===void 0?Ie.defaultMaxListeners:t._maxListeners}Ie.prototype.getMaxListeners=function(){return _n(this)},Ie.prototype.emit=function(e){for(var r=[],i=1;i<arguments.length;i++)r.push(arguments[i]);var n=e==="error",s=this._events;if(s!==void 0)n=n&&s.error===void 0;else if(!n)return!1;if(n){var f;if(r.length>0&&(f=r[0]),f instanceof Error)throw f;var u=new Error("Unhandled error."+(f?" ("+f.message+")":""));throw u.context=f,u}var h=s[e];if(h===void 0)return!1;if(typeof h=="function")gn(h,this,r);else for(var c=h.length,l=En(h,c),i=0;i<c;++i)gn(l[i],this,r);return!0};function bn(t,e,r,i){var n,s,f;if(Or(r),s=t._events,s===void 0?(s=t._events=Object.create(null),t._eventsCount=0):(s.newListener!==void 0&&(t.emit("newListener",e,r.listener?r.listener:r),s=t._events),f=s[e]),f===void 0)f=s[e]=r,++t._eventsCount;else if(typeof f=="function"?f=s[e]=i?[r,f]:[f,r]:i?f.unshift(r):f.push(r),n=_n(t),n>0&&f.length>n&&!f.warned){f.warned=!0;var u=new Error("Possible EventEmitter memory leak detected. "+f.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");u.name="MaxListenersExceededWarning",u.emitter=t,u.type=e,u.count=f.length,ja(u)}return t}Ie.prototype.addListener=function(e,r){return bn(this,e,r,!1)},Ie.prototype.on=Ie.prototype.addListener,Ie.prototype.prependListener=function(e,r){return bn(this,e,r,!0)};function Fa(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,arguments.length===0?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function vn(t,e,r){var i={fired:!1,wrapFn:void 0,target:t,type:e,listener:r},n=Fa.bind(i);return n.listener=r,i.wrapFn=n,n}Ie.prototype.once=function(e,r){return Or(r),this.on(e,vn(this,e,r)),this},Ie.prototype.prependOnceListener=function(e,r){return Or(r),this.prependListener(e,vn(this,e,r)),this},Ie.prototype.removeListener=function(e,r){var i,n,s,f,u;if(Or(r),n=this._events,n===void 0)return this;if(i=n[e],i===void 0)return this;if(i===r||i.listener===r)--this._eventsCount===0?this._events=Object.create(null):(delete n[e],n.removeListener&&this.emit("removeListener",e,i.listener||r));else if(typeof i!="function"){for(s=-1,f=i.length-1;f>=0;f--)if(i[f]===r||i[f].listener===r){u=i[f].listener,s=f;break}if(s<0)return this;s===0?i.shift():Ba(i,s),i.length===1&&(n[e]=i[0]),n.removeListener!==void 0&&this.emit("removeListener",e,u||r)}return this},Ie.prototype.off=Ie.prototype.removeListener,Ie.prototype.removeAllListeners=function(e){var r,i,n;if(i=this._events,i===void 0)return this;if(i.removeListener===void 0)return arguments.length===0?(this._events=Object.create(null),this._eventsCount=0):i[e]!==void 0&&(--this._eventsCount===0?this._events=Object.create(null):delete i[e]),this;if(arguments.length===0){var s=Object.keys(i),f;for(n=0;n<s.length;++n)f=s[n],f!=="removeListener"&&this.removeAllListeners(f);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if(r=i[e],typeof r=="function")this.removeListener(e,r);else if(r!==void 0)for(n=r.length-1;n>=0;n--)this.removeListener(e,r[n]);return this};function wn(t,e,r){var i=t._events;if(i===void 0)return[];var n=i[e];return n===void 0?[]:typeof n=="function"?r?[n.listener||n]:[n]:r?za(n):En(n,n.length)}Ie.prototype.listeners=function(e){return wn(this,e,!0)},Ie.prototype.rawListeners=function(e){return wn(this,e,!1)},Ie.listenerCount=function(t,e){return typeof t.listenerCount=="function"?t.listenerCount(e):mn.call(t,e)},Ie.prototype.listenerCount=mn;function mn(t){var e=this._events;if(e!==void 0){var r=e[t];if(typeof r=="function")return 1;if(r!==void 0)return r.length}return 0}Ie.prototype.eventNames=function(){return this._eventsCount>0?Sr(this._events):[]};function En(t,e){for(var r=new Array(e),i=0;i<e;++i)r[i]=t[i];return r}function Ba(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}function za(t){for(var e=new Array(t.length),r=0;r<e.length;++r)e[r]=t[r].listener||t[r];return e}function Ka(t,e){return new Promise(function(r,i){function n(f){t.removeListener(e,s),i(f)}function s(){typeof t.removeListener=="function"&&t.removeListener("error",n),r([].slice.call(arguments))}Dn(t,e,s,{once:!0}),e!=="error"&&Ha(t,n,{once:!0})})}function Ha(t,e,r){typeof t.on=="function"&&Dn(t,"error",e,r)}function Dn(t,e,r,i){if(typeof t.on=="function")i.once?t.once(e,r):t.on(e,r);else if(typeof t.addEventListener=="function")t.addEventListener(e,function n(s){i.once&&t.removeEventListener(e,n),r(s)});else throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t)}const Ga=/"(?:_|\\u0{2}5[Ff]){2}(?:p|\\u0{2}70)(?:r|\\u0{2}72)(?:o|\\u0{2}6[Ff])(?:t|\\u0{2}74)(?:o|\\u0{2}6[Ff])(?:_|\\u0{2}5[Ff]){2}"\s*:/,Va=/"(?:c|\\u0063)(?:o|\\u006[Ff])(?:n|\\u006[Ee])(?:s|\\u0073)(?:t|\\u0074)(?:r|\\u0072)(?:u|\\u0075)(?:c|\\u0063)(?:t|\\u0074)(?:o|\\u006[Ff])(?:r|\\u0072)"\s*:/,qa=/^\s*["[{]|^\s*-?\d{1,16}(\.\d{1,17})?([Ee][+-]?\d+)?\s*$/;function Wa(t,e){if(t==="__proto__"||t==="constructor"&&e&&typeof e=="object"&&"prototype"in e){Ya(t);return}return e}function Ya(t){console.warn(`[destr] Dropping "${t}" key to prevent prototype pollution.`)}function Ir(t,e={}){if(typeof t!="string")return t;const r=t.trim();if(t[0]==='"'&&t.at(-1)==='"'&&!t.includes("\\"))return r.slice(1,-1);if(r.length<=9){const i=r.toLowerCase();if(i==="true")return!0;if(i==="false")return!1;if(i==="undefined")return;if(i==="null")return null;if(i==="nan")return Number.NaN;if(i==="infinity")return Number.POSITIVE_INFINITY;if(i==="-infinity")return Number.NEGATIVE_INFINITY}if(!qa.test(t)){if(e.strict)throw new SyntaxError("[destr] Invalid JSON");return t}try{if(Ga.test(t)||Va.test(t)){if(e.strict)throw new Error("[destr] Possible prototype pollution");return JSON.parse(t,Wa)}return JSON.parse(t)}catch(i){if(e.strict)throw i;return t}}function ka(t){return!t||typeof t.then!="function"?Promise.resolve(t):t}function Ke(t,...e){try{return ka(t(...e))}catch(r){return Promise.reject(r)}}function Xa(t){const e=typeof t;return t===null||e!=="object"&&e!=="function"}function Ja(t){const e=Object.getPrototypeOf(t);return!e||e.isPrototypeOf(Object)}function Tr(t){if(Xa(t))return String(t);if(Ja(t)||Array.isArray(t))return JSON.stringify(t);if(typeof t.toJSON=="function")return Tr(t.toJSON());throw new Error("[unstorage] Cannot stringify value!")}function Sn(){if(typeof Buffer===void 0)throw new TypeError("[unstorage] Buffer is not supported!")}const oi="base64:";function Qa(t){if(typeof t=="string")return t;Sn();const e=Buffer.from(t).toString("base64");return oi+e}function Za(t){return typeof t!="string"||!t.startsWith(oi)?t:(Sn(),Buffer.from(t.slice(oi.length),"base64"))}function ot(t){return t?t.split("?")[0].replace(/[/\\]/g,":").replace(/:+/g,":").replace(/^:|:$/g,""):""}function ec(...t){return ot(t.join(":"))}function xr(t){return t=ot(t),t?t+":":""}function Z0(t){return t}const tc="memory",rc=()=>{const t=new Map;return{name:tc,options:{},hasItem(e){return t.has(e)},getItem(e){return t.get(e)||null},getItemRaw(e){return t.get(e)||null},setItem(e,r){t.set(e,r)},setItemRaw(e,r){t.set(e,r)},removeItem(e){t.delete(e)},getKeys(){return Array.from(t.keys())},clear(){t.clear()},dispose(){t.clear()}}};function ic(t={}){const e={mounts:{"":t.driver||rc()},mountpoints:[""],watching:!1,watchListeners:[],unwatch:{}},r=c=>{for(const l of e.mountpoints)if(c.startsWith(l))return{base:l,relativeKey:c.slice(l.length),driver:e.mounts[l]};return{base:"",relativeKey:c,driver:e.mounts[""]}},i=(c,l)=>e.mountpoints.filter(_=>_.startsWith(c)||l&&c.startsWith(_)).map(_=>({relativeBase:c.length>_.length?c.slice(_.length):void 0,mountpoint:_,driver:e.mounts[_]})),n=(c,l)=>{if(e.watching){l=ot(l);for(const _ of e.watchListeners)_(c,l)}},s=async()=>{if(!e.watching){e.watching=!0;for(const c in e.mounts)e.unwatch[c]=await On(e.mounts[c],n,c)}},f=async()=>{if(e.watching){for(const c in e.unwatch)await e.unwatch[c]();e.unwatch={},e.watching=!1}},u=(c,l,_)=>{const p=new Map,b=O=>{let A=p.get(O.base);return A||(A={driver:O.driver,base:O.base,items:[]},p.set(O.base,A)),A};for(const O of c){const A=typeof O=="string",L=ot(A?O:O.key),G=A?void 0:O.value,E=A||!O.options?l:{...l,...O.options},R=r(L);b(R).items.push({key:L,value:G,relativeKey:R.relativeKey,options:E})}return Promise.all([...p.values()].map(O=>_(O))).then(O=>O.flat())},h={hasItem(c,l={}){c=ot(c);const{relativeKey:_,driver:p}=r(c);return Ke(p.hasItem,_,l)},getItem(c,l={}){c=ot(c);const{relativeKey:_,driver:p}=r(c);return Ke(p.getItem,_,l).then(b=>Ir(b))},getItems(c,l){return u(c,l,_=>_.driver.getItems?Ke(_.driver.getItems,_.items.map(p=>({key:p.relativeKey,options:p.options})),l).then(p=>p.map(b=>({key:ec(_.base,b.key),value:Ir(b.value)}))):Promise.all(_.items.map(p=>Ke(_.driver.getItem,p.relativeKey,p.options).then(b=>({key:p.key,value:Ir(b)})))))},getItemRaw(c,l={}){c=ot(c);const{relativeKey:_,driver:p}=r(c);return p.getItemRaw?Ke(p.getItemRaw,_,l):Ke(p.getItem,_,l).then(b=>Za(b))},async setItem(c,l,_={}){if(l===void 0)return h.removeItem(c);c=ot(c);const{relativeKey:p,driver:b}=r(c);b.setItem&&(await Ke(b.setItem,p,Tr(l),_),b.watch||n("update",c))},async setItems(c,l){await u(c,l,async _=>{_.driver.setItems&&await Ke(_.driver.setItems,_.items.map(p=>({key:p.relativeKey,value:Tr(p.value),options:p.options})),l),_.driver.setItem&&await Promise.all(_.items.map(p=>Ke(_.driver.setItem,p.relativeKey,Tr(p.value),p.options)))})},async setItemRaw(c,l,_={}){if(l===void 0)return h.removeItem(c,_);c=ot(c);const{relativeKey:p,driver:b}=r(c);if(b.setItemRaw)await Ke(b.setItemRaw,p,l,_);else if(b.setItem)await Ke(b.setItem,p,Qa(l),_);else return;b.watch||n("update",c)},async removeItem(c,l={}){typeof l=="boolean"&&(l={removeMeta:l}),c=ot(c);const{relativeKey:_,driver:p}=r(c);p.removeItem&&(await Ke(p.removeItem,_,l),(l.removeMeta||l.removeMata)&&await Ke(p.removeItem,_+"$",l),p.watch||n("remove",c))},async getMeta(c,l={}){typeof l=="boolean"&&(l={nativeOnly:l}),c=ot(c);const{relativeKey:_,driver:p}=r(c),b=Object.create(null);if(p.getMeta&&Object.assign(b,await Ke(p.getMeta,_,l)),!l.nativeOnly){const O=await Ke(p.getItem,_+"$",l).then(A=>Ir(A));O&&typeof O=="object"&&(typeof O.atime=="string"&&(O.atime=new Date(O.atime)),typeof O.mtime=="string"&&(O.mtime=new Date(O.mtime)),Object.assign(b,O))}return b},setMeta(c,l,_={}){return this.setItem(c+"$",l,_)},removeMeta(c,l={}){return this.removeItem(c+"$",l)},async getKeys(c,l={}){c=xr(c);const _=i(c,!0);let p=[];const b=[];for(const O of _){const L=(await Ke(O.driver.getKeys,O.relativeBase,l)).map(G=>O.mountpoint+ot(G)).filter(G=>!p.some(E=>G.startsWith(E)));b.push(...L),p=[O.mountpoint,...p.filter(G=>!G.startsWith(O.mountpoint))]}return c?b.filter(O=>O.startsWith(c)&&!O.endsWith("$")):b.filter(O=>!O.endsWith("$"))},async clear(c,l={}){c=xr(c),await Promise.all(i(c,!1).map(async _=>{if(_.driver.clear)return Ke(_.driver.clear,_.relativeBase,l);if(_.driver.removeItem){const p=await _.driver.getKeys(_.relativeBase||"",l);return Promise.all(p.map(b=>_.driver.removeItem(b,l)))}}))},async dispose(){await Promise.all(Object.values(e.mounts).map(c=>In(c)))},async watch(c){return await s(),e.watchListeners.push(c),async()=>{e.watchListeners=e.watchListeners.filter(l=>l!==c),e.watchListeners.length===0&&await f()}},async unwatch(){e.watchListeners=[],await f()},mount(c,l){if(c=xr(c),c&&e.mounts[c])throw new Error(`already mounted at ${c}`);return c&&(e.mountpoints.push(c),e.mountpoints.sort((_,p)=>p.length-_.length)),e.mounts[c]=l,e.watching&&Promise.resolve(On(l,n,c)).then(_=>{e.unwatch[c]=_}).catch(console.error),h},async unmount(c,l=!0){c=xr(c),!(!c||!e.mounts[c])&&(e.watching&&c in e.unwatch&&(e.unwatch[c](),delete e.unwatch[c]),l&&await In(e.mounts[c]),e.mountpoints=e.mountpoints.filter(_=>_!==c),delete e.mounts[c])},getMount(c=""){c=ot(c)+":";const l=r(c);return{driver:l.driver,base:l.base}},getMounts(c="",l={}){return c=ot(c),i(c,l.parents).map(p=>({driver:p.driver,base:p.mountpoint}))}};return h}function On(t,e,r){return t.watch?t.watch((i,n)=>e(i,r+n)):()=>{}}async function In(t){typeof t.dispose=="function"&&await Ke(t.dispose)}function Nt(t){return new Promise((e,r)=>{t.oncomplete=t.onsuccess=()=>e(t.result),t.onabort=t.onerror=()=>r(t.error)})}function Tn(t,e){const r=indexedDB.open(t);r.onupgradeneeded=()=>r.result.createObjectStore(e);const i=Nt(r);return(n,s)=>i.then(f=>s(f.transaction(e,n).objectStore(e)))}let ai;function tr(){return ai||(ai=Tn("keyval-store","keyval")),ai}function xn(t,e=tr()){return e("readonly",r=>Nt(r.get(t)))}function nc(t,e,r=tr()){return r("readwrite",i=>(i.put(e,t),Nt(i.transaction)))}function sc(t,e=tr()){return e("readwrite",r=>(r.delete(t),Nt(r.transaction)))}function oc(t=tr()){return t("readwrite",e=>(e.clear(),Nt(e.transaction)))}function ac(t,e){return t.openCursor().onsuccess=function(){this.result&&(e(this.result),this.result.continue())},Nt(t.transaction)}function cc(t=tr()){return t("readonly",e=>{if(e.getAllKeys)return Nt(e.getAllKeys());const r=[];return ac(e,i=>r.push(i.key)).then(()=>r)})}const uc=t=>JSON.stringify(t,(e,r)=>typeof r=="bigint"?r.toString()+"n":r),fc=t=>{const e=/([\[:])?(\d{17,}|(?:[9](?:[1-9]07199254740991|0[1-9]7199254740991|00[8-9]199254740991|007[2-9]99254740991|007199[3-9]54740991|0071992[6-9]4740991|00719925[5-9]740991|007199254[8-9]40991|0071992547[5-9]0991|00719925474[1-9]991|00719925474099[2-9])))([,\}\]])/g,r=t.replace(e,'$1"$2n"$3');return JSON.parse(r,(i,n)=>typeof n=="string"&&n.match(/^\d+n$/)?BigInt(n.substring(0,n.length-1)):n)};function Rr(t){if(typeof t!="string")throw new Error(`Cannot safe json parse value of type ${typeof t}`);try{return fc(t)}catch{return t}}function rr(t){return typeof t=="string"?t:uc(t)||""}const hc="idb-keyval";var lc=(t={})=>{const e=t.base&&t.base.length>0?`${t.base}:`:"",r=n=>e+n;let i;return t.dbName&&t.storeName&&(i=Tn(t.dbName,t.storeName)),{name:hc,options:t,async hasItem(n){return!(typeof await xn(r(n),i)>"u")},async getItem(n){return await xn(r(n),i)??null},setItem(n,s){return nc(r(n),s,i)},removeItem(n){return sc(r(n),i)},getKeys(){return cc(i)},clear(){return oc(i)}}};const dc="WALLET_CONNECT_V2_INDEXED_DB",gc="keyvaluestorage";class yc{constructor(){this.indexedDb=ic({driver:lc({dbName:dc,storeName:gc})})}async getKeys(){return this.indexedDb.getKeys()}async getEntries(){return(await this.indexedDb.getItems(await this.indexedDb.getKeys())).map(e=>[e.key,e.value])}async getItem(e){const r=await this.indexedDb.getItem(e);if(r!==null)return r}async setItem(e,r){await this.indexedDb.setItem(e,rr(r))}async removeItem(e){await this.indexedDb.removeItem(e)}}var ci=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},Cr={exports:{}};(function(){let t;function e(){}t=e,t.prototype.getItem=function(r){return this.hasOwnProperty(r)?String(this[r]):null},t.prototype.setItem=function(r,i){this[r]=String(i)},t.prototype.removeItem=function(r){delete this[r]},t.prototype.clear=function(){const r=this;Object.keys(r).forEach(function(i){r[i]=void 0,delete r[i]})},t.prototype.key=function(r){return r=r||0,Object.keys(this)[r]},t.prototype.__defineGetter__("length",function(){return Object.keys(this).length}),typeof ci<"u"&&ci.localStorage?Cr.exports=ci.localStorage:typeof window<"u"&&window.localStorage?Cr.exports=window.localStorage:Cr.exports=new e})();function pc(t){var e;return[t[0],Rr((e=t[1])!=null?e:"")]}class _c{constructor(){this.localStorage=Cr.exports}async getKeys(){return Object.keys(this.localStorage)}async getEntries(){return Object.entries(this.localStorage).map(pc)}async getItem(e){const r=this.localStorage.getItem(e);if(r!==null)return Rr(r)}async setItem(e,r){this.localStorage.setItem(e,rr(r))}async removeItem(e){this.localStorage.removeItem(e)}}const bc="wc_storage_version",Rn=1,vc=async(t,e,r)=>{const i=bc,n=await e.getItem(i);if(n&&n>=Rn){r(e);return}const s=await t.getKeys();if(!s.length){r(e);return}const f=[];for(;s.length;){const u=s.shift();if(!u)continue;const h=u.toLowerCase();if(h.includes("wc@")||h.includes("walletconnect")||h.includes("wc_")||h.includes("wallet_connect")){const c=await t.getItem(u);await e.setItem(u,c),f.push(u)}}await e.setItem(i,Rn),r(e),wc(t,f)},wc=async(t,e)=>{e.length&&e.forEach(async r=>{await t.removeItem(r)})};class mc{constructor(){this.initialized=!1,this.setInitialized=r=>{this.storage=r,this.initialized=!0};const e=new _c;this.storage=e;try{const r=new yc;vc(e,r,this.setInitialized)}catch{this.initialized=!0}}async getKeys(){return await this.initialize(),this.storage.getKeys()}async getEntries(){return await this.initialize(),this.storage.getEntries()}async getItem(e){return await this.initialize(),this.storage.getItem(e)}async setItem(e,r){return await this.initialize(),this.storage.setItem(e,r)}async removeItem(e){return await this.initialize(),this.storage.removeItem(e)}async initialize(){this.initialized||await new Promise(e=>{const r=setInterval(()=>{this.initialized&&(clearInterval(r),e())},20)})}}var qt={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var ui=function(t,e){return ui=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},ui(t,e)};function Ec(t,e){ui(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var fi=function(){return fi=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},fi.apply(this,arguments)};function Dc(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Sc(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var u=t.length-1;u>=0;u--)(f=t[u])&&(s=(n<3?f(s):n>3?f(e,r,s):f(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Oc(t,e){return function(r,i){e(r,i,t)}}function Ic(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Tc(t,e,r,i){function n(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function u(l){try{c(i.next(l))}catch(_){f(_)}}function h(l){try{c(i.throw(l))}catch(_){f(_)}}function c(l){l.done?s(l.value):n(l.value).then(u,h)}c((i=i.apply(t,e||[])).next())})}function xc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(c){return function(l){return h([c,l])}}function h(c){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=c[0]&2?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,n=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],n=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function Rc(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Cc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function hi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Cn(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],f;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(u){f={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(f)throw f.error}}return s}function Ac(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Cn(arguments[e]));return t}function Pc(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],f=0,u=s.length;f<u;f++,n++)i[n]=s[f];return i}function ir(t){return this instanceof ir?(this.v=t,this):new ir(t)}function Lc(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},f("next"),f("throw"),f("return"),n[Symbol.asyncIterator]=function(){return this},n;function f(p){i[p]&&(n[p]=function(b){return new Promise(function(O,A){s.push([p,b,O,A])>1||u(p,b)})})}function u(p,b){try{h(i[p](b))}catch(O){_(s[0][3],O)}}function h(p){p.value instanceof ir?Promise.resolve(p.value.v).then(c,l):_(s[0][2],p)}function c(p){u("next",p)}function l(p){u("throw",p)}function _(p,b){p(b),s.shift(),s.length&&u(s[0][0],s[0][1])}}function Nc(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(f){return(r=!r)?{value:ir(t[n](f)),done:n==="return"}:s?s(f):f}:s}}function Uc(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof hi=="function"?hi(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(f){return new Promise(function(u,h){f=t[s](f),n(u,h,f.done,f.value)})}}function n(s,f,u,h){Promise.resolve(h).then(function(c){s({value:c,done:u})},f)}}function Mc(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function $c(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function jc(t){return t&&t.__esModule?t:{default:t}}function Fc(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Bc(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var zc=Object.freeze({__proto__:null,__extends:Ec,get __assign(){return fi},__rest:Dc,__decorate:Sc,__param:Oc,__metadata:Ic,__awaiter:Tc,__generator:xc,__createBinding:Rc,__exportStar:Cc,__values:hi,__read:Cn,__spread:Ac,__spreadArrays:Pc,__await:ir,__asyncGenerator:Lc,__asyncDelegator:Nc,__asyncValues:Uc,__makeTemplateObject:Mc,__importStar:$c,__importDefault:jc,__classPrivateFieldGet:Fc,__classPrivateFieldSet:Bc}),Ar=Lt(zc),nr={},Z={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var li=function(t,e){return li=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},li(t,e)};function Kc(t,e){li(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var di=function(){return di=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},di.apply(this,arguments)};function Hc(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Gc(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var u=t.length-1;u>=0;u--)(f=t[u])&&(s=(n<3?f(s):n>3?f(e,r,s):f(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Vc(t,e){return function(r,i){e(r,i,t)}}function qc(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Wc(t,e,r,i){function n(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function u(l){try{c(i.next(l))}catch(_){f(_)}}function h(l){try{c(i.throw(l))}catch(_){f(_)}}function c(l){l.done?s(l.value):n(l.value).then(u,h)}c((i=i.apply(t,e||[])).next())})}function Yc(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(c){return function(l){return h([c,l])}}function h(c){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=c[0]&2?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,n=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],n=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function kc(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Xc(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function gi(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function An(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],f;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(u){f={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(f)throw f.error}}return s}function Jc(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(An(arguments[e]));return t}function Qc(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],f=0,u=s.length;f<u;f++,n++)i[n]=s[f];return i}function sr(t){return this instanceof sr?(this.v=t,this):new sr(t)}function Zc(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},f("next"),f("throw"),f("return"),n[Symbol.asyncIterator]=function(){return this},n;function f(p){i[p]&&(n[p]=function(b){return new Promise(function(O,A){s.push([p,b,O,A])>1||u(p,b)})})}function u(p,b){try{h(i[p](b))}catch(O){_(s[0][3],O)}}function h(p){p.value instanceof sr?Promise.resolve(p.value.v).then(c,l):_(s[0][2],p)}function c(p){u("next",p)}function l(p){u("throw",p)}function _(p,b){p(b),s.shift(),s.length&&u(s[0][0],s[0][1])}}function eu(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(f){return(r=!r)?{value:sr(t[n](f)),done:n==="return"}:s?s(f):f}:s}}function tu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof gi=="function"?gi(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(f){return new Promise(function(u,h){f=t[s](f),n(u,h,f.done,f.value)})}}function n(s,f,u,h){Promise.resolve(h).then(function(c){s({value:c,done:u})},f)}}function ru(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function iu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function nu(t){return t&&t.__esModule?t:{default:t}}function su(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function ou(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var au=Object.freeze({__proto__:null,__extends:Kc,get __assign(){return di},__rest:Hc,__decorate:Gc,__param:Vc,__metadata:qc,__awaiter:Wc,__generator:Yc,__createBinding:kc,__exportStar:Xc,__values:gi,__read:An,__spread:Jc,__spreadArrays:Qc,__await:sr,__asyncGenerator:Zc,__asyncDelegator:eu,__asyncValues:tu,__makeTemplateObject:ru,__importStar:iu,__importDefault:nu,__classPrivateFieldGet:su,__classPrivateFieldSet:ou}),Pr=Lt(au),yi={},or={},Pn;function cu(){if(Pn)return or;Pn=1,Object.defineProperty(or,"__esModule",{value:!0}),or.delay=void 0;function t(e){return new Promise(r=>{setTimeout(()=>{r(!0)},e)})}return or.delay=t,or}var Ut={},pi={},Mt={},Ln;function uu(){return Ln||(Ln=1,Object.defineProperty(Mt,"__esModule",{value:!0}),Mt.ONE_THOUSAND=Mt.ONE_HUNDRED=void 0,Mt.ONE_HUNDRED=100,Mt.ONE_THOUSAND=1e3),Mt}var _i={},Nn;function fu(){return Nn||(Nn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.ONE_YEAR=t.FOUR_WEEKS=t.THREE_WEEKS=t.TWO_WEEKS=t.ONE_WEEK=t.THIRTY_DAYS=t.SEVEN_DAYS=t.FIVE_DAYS=t.THREE_DAYS=t.ONE_DAY=t.TWENTY_FOUR_HOURS=t.TWELVE_HOURS=t.SIX_HOURS=t.THREE_HOURS=t.ONE_HOUR=t.SIXTY_MINUTES=t.THIRTY_MINUTES=t.TEN_MINUTES=t.FIVE_MINUTES=t.ONE_MINUTE=t.SIXTY_SECONDS=t.THIRTY_SECONDS=t.TEN_SECONDS=t.FIVE_SECONDS=t.ONE_SECOND=void 0,t.ONE_SECOND=1,t.FIVE_SECONDS=5,t.TEN_SECONDS=10,t.THIRTY_SECONDS=30,t.SIXTY_SECONDS=60,t.ONE_MINUTE=t.SIXTY_SECONDS,t.FIVE_MINUTES=t.ONE_MINUTE*5,t.TEN_MINUTES=t.ONE_MINUTE*10,t.THIRTY_MINUTES=t.ONE_MINUTE*30,t.SIXTY_MINUTES=t.ONE_MINUTE*60,t.ONE_HOUR=t.SIXTY_MINUTES,t.THREE_HOURS=t.ONE_HOUR*3,t.SIX_HOURS=t.ONE_HOUR*6,t.TWELVE_HOURS=t.ONE_HOUR*12,t.TWENTY_FOUR_HOURS=t.ONE_HOUR*24,t.ONE_DAY=t.TWENTY_FOUR_HOURS,t.THREE_DAYS=t.ONE_DAY*3,t.FIVE_DAYS=t.ONE_DAY*5,t.SEVEN_DAYS=t.ONE_DAY*7,t.THIRTY_DAYS=t.ONE_DAY*30,t.ONE_WEEK=t.SEVEN_DAYS,t.TWO_WEEKS=t.ONE_WEEK*2,t.THREE_WEEKS=t.ONE_WEEK*3,t.FOUR_WEEKS=t.ONE_WEEK*4,t.ONE_YEAR=t.ONE_DAY*365}(_i)),_i}var Un;function Mn(){return Un||(Un=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Pr;e.__exportStar(uu(),t),e.__exportStar(fu(),t)}(pi)),pi}var $n;function hu(){if($n)return Ut;$n=1,Object.defineProperty(Ut,"__esModule",{value:!0}),Ut.fromMiliseconds=Ut.toMiliseconds=void 0;const t=Mn();function e(i){return i*t.ONE_THOUSAND}Ut.toMiliseconds=e;function r(i){return Math.floor(i/t.ONE_THOUSAND)}return Ut.fromMiliseconds=r,Ut}var jn;function lu(){return jn||(jn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Pr;e.__exportStar(cu(),t),e.__exportStar(hu(),t)}(yi)),yi}var Wt={},Fn;function du(){if(Fn)return Wt;Fn=1,Object.defineProperty(Wt,"__esModule",{value:!0}),Wt.Watch=void 0;class t{constructor(){this.timestamps=new Map}start(r){if(this.timestamps.has(r))throw new Error(`Watch already started for label: ${r}`);this.timestamps.set(r,{started:Date.now()})}stop(r){const i=this.get(r);if(typeof i.elapsed<"u")throw new Error(`Watch already stopped for label: ${r}`);const n=Date.now()-i.started;this.timestamps.set(r,{started:i.started,elapsed:n})}get(r){const i=this.timestamps.get(r);if(typeof i>"u")throw new Error(`No timestamp found for label: ${r}`);return i}elapsed(r){const i=this.get(r);return i.elapsed||Date.now()-i.started}}return Wt.Watch=t,Wt.default=t,Wt}var bi={},ar={},Bn;function gu(){if(Bn)return ar;Bn=1,Object.defineProperty(ar,"__esModule",{value:!0}),ar.IWatch=void 0;class t{}return ar.IWatch=t,ar}var zn;function yu(){return zn||(zn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Pr.__exportStar(gu(),t)}(bi)),bi}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Pr;e.__exportStar(lu(),t),e.__exportStar(du(),t),e.__exportStar(yu(),t),e.__exportStar(Mn(),t)})(Z);var vi={},cr={};class $t{}var pu=Object.freeze({__proto__:null,IEvents:$t}),_u=Lt(pu),Kn;function bu(){if(Kn)return cr;Kn=1,Object.defineProperty(cr,"__esModule",{value:!0}),cr.IHeartBeat=void 0;const t=_u;class e extends t.IEvents{constructor(i){super()}}return cr.IHeartBeat=e,cr}var Hn;function Gn(){return Hn||(Hn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ar.__exportStar(bu(),t)}(vi)),vi}var wi={},jt={},Vn;function vu(){if(Vn)return jt;Vn=1,Object.defineProperty(jt,"__esModule",{value:!0}),jt.HEARTBEAT_EVENTS=jt.HEARTBEAT_INTERVAL=void 0;const t=Z;return jt.HEARTBEAT_INTERVAL=t.FIVE_SECONDS,jt.HEARTBEAT_EVENTS={pulse:"heartbeat_pulse"},jt}var qn;function Wn(){return qn||(qn=1,function(t){Object.defineProperty(t,"__esModule",{value:!0}),Ar.__exportStar(vu(),t)}(wi)),wi}var Yn;function wu(){if(Yn)return nr;Yn=1,Object.defineProperty(nr,"__esModule",{value:!0}),nr.HeartBeat=void 0;const t=Ar,e=ht.exports,r=Z,i=Gn(),n=Wn();class s extends i.IHeartBeat{constructor(u){super(u),this.events=new e.EventEmitter,this.interval=n.HEARTBEAT_INTERVAL,this.interval=u?.interval||n.HEARTBEAT_INTERVAL}static init(u){return t.__awaiter(this,void 0,void 0,function*(){const h=new s(u);return yield h.init(),h})}init(){return t.__awaiter(this,void 0,void 0,function*(){yield this.initialize()})}stop(){clearInterval(this.intervalRef)}on(u,h){this.events.on(u,h)}once(u,h){this.events.once(u,h)}off(u,h){this.events.off(u,h)}removeListener(u,h){this.events.removeListener(u,h)}initialize(){return t.__awaiter(this,void 0,void 0,function*(){this.intervalRef=setInterval(()=>this.pulse(),r.toMiliseconds(this.interval))})}pulse(){this.events.emit(n.HEARTBEAT_EVENTS.pulse)}}return nr.HeartBeat=s,nr}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=Ar;e.__exportStar(wu(),t),e.__exportStar(Gn(),t),e.__exportStar(Wn(),t)})(qt);var Ee={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var mi=function(t,e){return mi=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},mi(t,e)};function mu(t,e){mi(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var Ei=function(){return Ei=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},Ei.apply(this,arguments)};function Eu(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function Du(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var u=t.length-1;u>=0;u--)(f=t[u])&&(s=(n<3?f(s):n>3?f(e,r,s):f(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function Su(t,e){return function(r,i){e(r,i,t)}}function Ou(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function Iu(t,e,r,i){function n(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function u(l){try{c(i.next(l))}catch(_){f(_)}}function h(l){try{c(i.throw(l))}catch(_){f(_)}}function c(l){l.done?s(l.value):n(l.value).then(u,h)}c((i=i.apply(t,e||[])).next())})}function Tu(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(c){return function(l){return h([c,l])}}function h(c){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=c[0]&2?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,n=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],n=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function xu(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function Ru(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function Di(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function kn(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],f;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(u){f={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(f)throw f.error}}return s}function Cu(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(kn(arguments[e]));return t}function Au(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],f=0,u=s.length;f<u;f++,n++)i[n]=s[f];return i}function ur(t){return this instanceof ur?(this.v=t,this):new ur(t)}function Pu(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},f("next"),f("throw"),f("return"),n[Symbol.asyncIterator]=function(){return this},n;function f(p){i[p]&&(n[p]=function(b){return new Promise(function(O,A){s.push([p,b,O,A])>1||u(p,b)})})}function u(p,b){try{h(i[p](b))}catch(O){_(s[0][3],O)}}function h(p){p.value instanceof ur?Promise.resolve(p.value.v).then(c,l):_(s[0][2],p)}function c(p){u("next",p)}function l(p){u("throw",p)}function _(p,b){p(b),s.shift(),s.length&&u(s[0][0],s[0][1])}}function Lu(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(f){return(r=!r)?{value:ur(t[n](f)),done:n==="return"}:s?s(f):f}:s}}function Nu(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof Di=="function"?Di(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(f){return new Promise(function(u,h){f=t[s](f),n(u,h,f.done,f.value)})}}function n(s,f,u,h){Promise.resolve(h).then(function(c){s({value:c,done:u})},f)}}function Uu(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Mu(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function $u(t){return t&&t.__esModule?t:{default:t}}function ju(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Fu(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Bu=Object.freeze({__proto__:null,__extends:mu,get __assign(){return Ei},__rest:Eu,__decorate:Du,__param:Su,__metadata:Ou,__awaiter:Iu,__generator:Tu,__createBinding:xu,__exportStar:Ru,__values:Di,__read:kn,__spread:Cu,__spreadArrays:Au,__await:ur,__asyncGenerator:Pu,__asyncDelegator:Lu,__asyncValues:Nu,__makeTemplateObject:Uu,__importStar:Mu,__importDefault:$u,__classPrivateFieldGet:ju,__classPrivateFieldSet:Fu}),zu=Lt(Bu),Si,Xn;function Ku(){if(Xn)return Si;Xn=1;function t(r){try{return JSON.stringify(r)}catch{return'"[Circular]"'}}Si=e;function e(r,i,n){var s=n&&n.stringify||t,f=1;if(typeof r=="object"&&r!==null){var u=i.length+f;if(u===1)return r;var h=new Array(u);h[0]=s(r);for(var c=1;c<u;c++)h[c]=s(i[c]);return h.join(" ")}if(typeof r!="string")return r;var l=i.length;if(l===0)return r;for(var _="",p=1-f,b=-1,O=r&&r.length||0,A=0;A<O;){if(r.charCodeAt(A)===37&&A+1<O){switch(b=b>-1?b:0,r.charCodeAt(A+1)){case 100:case 102:if(p>=l||i[p]==null)break;b<A&&(_+=r.slice(b,A)),_+=Number(i[p]),b=A+2,A++;break;case 105:if(p>=l||i[p]==null)break;b<A&&(_+=r.slice(b,A)),_+=Math.floor(Number(i[p])),b=A+2,A++;break;case 79:case 111:case 106:if(p>=l||i[p]===void 0)break;b<A&&(_+=r.slice(b,A));var L=typeof i[p];if(L==="string"){_+="'"+i[p]+"'",b=A+2,A++;break}if(L==="function"){_+=i[p].name||"<anonymous>",b=A+2,A++;break}_+=s(i[p]),b=A+2,A++;break;case 115:if(p>=l)break;b<A&&(_+=r.slice(b,A)),_+=String(i[p]),b=A+2,A++;break;case 37:b<A&&(_+=r.slice(b,A)),_+="%",b=A+2,A++,p--;break}++p}++A}return b===-1?r:(b<O&&(_+=r.slice(b)),_)}return Si}var Oi,Jn;function Hu(){if(Jn)return Oi;Jn=1;const t=Ku();Oi=n;const e=m().console||{},r={mapHttpRequest:O,mapHttpResponse:O,wrapRequestSerializer:A,wrapResponseSerializer:A,wrapErrorSerializer:A,req:O,res:O,err:p};function i(g,o){return Array.isArray(g)?g.filter(function(N){return N!=="!stdSerializers.err"}):g===!0?Object.keys(o):!1}function n(g){g=g||{},g.browser=g.browser||{};const o=g.browser.transmit;if(o&&typeof o.send!="function")throw Error("pino: transmit option must have a send function");const d=g.browser.write||e;g.browser.write&&(g.browser.asObject=!0);const N=g.serializers||{},P=i(g.browser.serialize,N);let K=g.browser.serialize;Array.isArray(g.browser.serialize)&&g.browser.serialize.indexOf("!stdSerializers.err")>-1&&(K=!1);const V=["error","fatal","warn","info","debug","trace"];typeof d=="function"&&(d.error=d.fatal=d.warn=d.info=d.debug=d.trace=d),g.enabled===!1&&(g.level="silent");const J=g.level||"info",I=Object.create(d);I.log||(I.log=L),Object.defineProperty(I,"levelVal",{get:W}),Object.defineProperty(I,"level",{get:F,set:M});const C={transmit:o,serialize:P,asObject:g.browser.asObject,levels:V,timestamp:b(g)};I.levels=n.levels,I.level=J,I.setMaxListeners=I.getMaxListeners=I.emit=I.addListener=I.on=I.prependListener=I.once=I.prependOnceListener=I.removeListener=I.removeAllListeners=I.listeners=I.listenerCount=I.eventNames=I.write=I.flush=L,I.serializers=N,I._serialize=P,I._stdErrSerialize=K,I.child=j,o&&(I._logEvent=_());function W(){return this.level==="silent"?1/0:this.levels.values[this.level]}function F(){return this._level}function M(U){if(U!=="silent"&&!this.levels.values[U])throw Error("unknown level "+U);this._level=U,s(C,I,"error","log"),s(C,I,"fatal","error"),s(C,I,"warn","error"),s(C,I,"info","log"),s(C,I,"debug","log"),s(C,I,"trace","log")}function j(U,B){if(!U)throw new Error("missing bindings for child Pino");B=B||{},P&&U.serializers&&(B.serializers=U.serializers);const te=B.serializers;if(P&&te){var z=Object.assign({},N,te),Q=g.browser.serialize===!0?Object.keys(z):P;delete U.serializers,h([U],Q,z,this._stdErrSerialize)}function k(ee){this._childLevel=(ee._childLevel|0)+1,this.error=c(ee,U,"error"),this.fatal=c(ee,U,"fatal"),this.warn=c(ee,U,"warn"),this.info=c(ee,U,"info"),this.debug=c(ee,U,"debug"),this.trace=c(ee,U,"trace"),z&&(this.serializers=z,this._serialize=Q),o&&(this._logEvent=_([].concat(ee._logEvent.bindings,U)))}return k.prototype=this,new k(this)}return I}n.levels={values:{fatal:60,error:50,warn:40,info:30,debug:20,trace:10},labels:{10:"trace",20:"debug",30:"info",40:"warn",50:"error",60:"fatal"}},n.stdSerializers=r,n.stdTimeFunctions=Object.assign({},{nullTime:G,epochTime:E,unixTime:R,isoTime:w});function s(g,o,d,N){const P=Object.getPrototypeOf(o);o[d]=o.levelVal>o.levels.values[d]?L:P[d]?P[d]:e[d]||e[N]||L,f(g,o,d)}function f(g,o,d){!g.transmit&&o[d]===L||(o[d]=function(N){return function(){const K=g.timestamp(),V=new Array(arguments.length),J=Object.getPrototypeOf&&Object.getPrototypeOf(this)===e?e:this;for(var I=0;I<V.length;I++)V[I]=arguments[I];if(g.serialize&&!g.asObject&&h(V,this._serialize,this.serializers,this._stdErrSerialize),g.asObject?N.call(J,u(this,d,V,K)):N.apply(J,V),g.transmit){const C=g.transmit.level||o.level,W=n.levels.values[C],F=n.levels.values[d];if(F<W)return;l(this,{ts:K,methodLevel:d,methodValue:F,transmitLevel:C,transmitValue:n.levels.values[g.transmit.level||o.level],send:g.transmit.send,val:o.levelVal},V)}}}(o[d]))}function u(g,o,d,N){g._serialize&&h(d,g._serialize,g.serializers,g._stdErrSerialize);const P=d.slice();let K=P[0];const V={};N&&(V.time=N),V.level=n.levels.values[o];let J=(g._childLevel|0)+1;if(J<1&&(J=1),K!==null&&typeof K=="object"){for(;J--&&typeof P[0]=="object";)Object.assign(V,P.shift());K=P.length?t(P.shift(),P):void 0}else typeof K=="string"&&(K=t(P.shift(),P));return K!==void 0&&(V.msg=K),V}function h(g,o,d,N){for(const P in g)if(N&&g[P]instanceof Error)g[P]=n.stdSerializers.err(g[P]);else if(typeof g[P]=="object"&&!Array.isArray(g[P]))for(const K in g[P])o&&o.indexOf(K)>-1&&K in d&&(g[P][K]=d[K](g[P][K]))}function c(g,o,d){return function(){const N=new Array(1+arguments.length);N[0]=o;for(var P=1;P<N.length;P++)N[P]=arguments[P-1];return g[d].apply(this,N)}}function l(g,o,d){const N=o.send,P=o.ts,K=o.methodLevel,V=o.methodValue,J=o.val,I=g._logEvent.bindings;h(d,g._serialize||Object.keys(g.serializers),g.serializers,g._stdErrSerialize===void 0?!0:g._stdErrSerialize),g._logEvent.ts=P,g._logEvent.messages=d.filter(function(C){return I.indexOf(C)===-1}),g._logEvent.level.label=K,g._logEvent.level.value=V,N(K,g._logEvent,J),g._logEvent=_(I)}function _(g){return{ts:0,messages:[],bindings:g||[],level:{label:"",value:0}}}function p(g){const o={type:g.constructor.name,msg:g.message,stack:g.stack};for(const d in g)o[d]===void 0&&(o[d]=g[d]);return o}function b(g){return typeof g.timestamp=="function"?g.timestamp:g.timestamp===!1?G:E}function O(){return{}}function A(g){return g}function L(){}function G(){return!1}function E(){return Date.now()}function R(){return Math.round(Date.now()/1e3)}function w(){return new Date(Date.now()).toISOString()}function m(){function g(o){return typeof o<"u"&&o}try{return typeof globalThis<"u"||Object.defineProperty(Object.prototype,"globalThis",{get:function(){return delete Object.prototype.globalThis,this.globalThis=this},configurable:!0}),globalThis}catch{return g(self)||g(window)||g(this)||{}}}return Oi}var Ft={},Qn;function Zn(){return Qn||(Qn=1,Object.defineProperty(Ft,"__esModule",{value:!0}),Ft.PINO_CUSTOM_CONTEXT_KEY=Ft.PINO_LOGGER_DEFAULTS=void 0,Ft.PINO_LOGGER_DEFAULTS={level:"info"},Ft.PINO_CUSTOM_CONTEXT_KEY="custom_context"),Ft}var tt={},es;function Gu(){if(es)return tt;es=1,Object.defineProperty(tt,"__esModule",{value:!0}),tt.generateChildLogger=tt.formatChildLoggerContext=tt.getLoggerContext=tt.setBrowserLoggerContext=tt.getBrowserLoggerContext=tt.getDefaultLoggerOptions=void 0;const t=Zn();function e(u){return Object.assign(Object.assign({},u),{level:u?.level||t.PINO_LOGGER_DEFAULTS.level})}tt.getDefaultLoggerOptions=e;function r(u,h=t.PINO_CUSTOM_CONTEXT_KEY){return u[h]||""}tt.getBrowserLoggerContext=r;function i(u,h,c=t.PINO_CUSTOM_CONTEXT_KEY){return u[c]=h,u}tt.setBrowserLoggerContext=i;function n(u,h=t.PINO_CUSTOM_CONTEXT_KEY){let c="";return typeof u.bindings>"u"?c=r(u,h):c=u.bindings().context||"",c}tt.getLoggerContext=n;function s(u,h,c=t.PINO_CUSTOM_CONTEXT_KEY){const l=n(u,c);return l.trim()?`${l}/${h}`:h}tt.formatChildLoggerContext=s;function f(u,h,c=t.PINO_CUSTOM_CONTEXT_KEY){const l=s(u,h,c),_=u.child({context:l});return i(_,l,c)}return tt.generateChildLogger=f,tt}(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.pino=void 0;const e=zu,r=e.__importDefault(Hu());Object.defineProperty(t,"pino",{enumerable:!0,get:function(){return r.default}}),e.__exportStar(Zn(),t),e.__exportStar(Gu(),t)})(Ee);class Vu extends $t{constructor(e){super(),this.opts=e,this.protocol="wc",this.version=2}}class qu extends $t{constructor(e,r){super(),this.core=e,this.logger=r,this.records=new Map}}class Wu{constructor(e,r){this.logger=e,this.core=r}}class Yu extends $t{constructor(e,r){super(),this.relayer=e,this.logger=r}}class ku extends $t{constructor(e){super()}}class Xu{constructor(e,r,i,n){this.core=e,this.logger=r,this.name=i}}class Ju extends $t{constructor(e,r){super(),this.relayer=e,this.logger=r}}class Qu extends $t{constructor(e,r){super(),this.core=e,this.logger=r}}class Zu{constructor(e,r){this.projectId=e,this.logger=r}}class ef{constructor(e,r){this.projectId=e,this.logger=r}}var Ii={},Yt={},Lr={},Nr={};Object.defineProperty(Nr,"__esModule",{value:!0}),Nr.BrowserRandomSource=void 0;const ts=65536;class tf{constructor(){this.isAvailable=!1,this.isInstantiated=!1;const e=typeof self<"u"?self.crypto||self.msCrypto:null;e&&e.getRandomValues!==void 0&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Browser random byte generator is not available.");const r=new Uint8Array(e);for(let i=0;i<r.length;i+=ts)this._crypto.getRandomValues(r.subarray(i,i+Math.min(r.length-i,ts)));return r}}Nr.BrowserRandomSource=tf;function rf(t){throw new Error('Could not dynamically require "'+t+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var Ur={},at={};Object.defineProperty(at,"__esModule",{value:!0});function nf(t){for(var e=0;e<t.length;e++)t[e]=0;return t}at.wipe=nf;var sf={},of=Object.freeze({__proto__:null,default:sf}),af=Lt(of);Object.defineProperty(Ur,"__esModule",{value:!0}),Ur.NodeRandomSource=void 0;const cf=at;class uf{constructor(){if(this.isAvailable=!1,this.isInstantiated=!1,typeof rf<"u"){const e=af;e&&e.randomBytes&&(this._crypto=e,this.isAvailable=!0,this.isInstantiated=!0)}}randomBytes(e){if(!this.isAvailable||!this._crypto)throw new Error("Node.js random byte generator is not available.");let r=this._crypto.randomBytes(e);if(r.length!==e)throw new Error("NodeRandomSource: got fewer bytes than requested");const i=new Uint8Array(e);for(let n=0;n<i.length;n++)i[n]=r[n];return(0,cf.wipe)(r),i}}Ur.NodeRandomSource=uf,Object.defineProperty(Lr,"__esModule",{value:!0}),Lr.SystemRandomSource=void 0;const ff=Nr,hf=Ur;class lf{constructor(){if(this.isAvailable=!1,this.name="",this._source=new ff.BrowserRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Browser";return}if(this._source=new hf.NodeRandomSource,this._source.isAvailable){this.isAvailable=!0,this.name="Node";return}}randomBytes(e){if(!this.isAvailable)throw new Error("System random byte generator is not available.");return this._source.randomBytes(e)}}Lr.SystemRandomSource=lf;var ie={},rs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});function e(u,h){var c=u>>>16&65535,l=u&65535,_=h>>>16&65535,p=h&65535;return l*p+(c*p+l*_<<16>>>0)|0}t.mul=Math.imul||e;function r(u,h){return u+h|0}t.add=r;function i(u,h){return u-h|0}t.sub=i;function n(u,h){return u<<h|u>>>32-h}t.rotl=n;function s(u,h){return u<<32-h|u>>>h}t.rotr=s;function f(u){return typeof u=="number"&&isFinite(u)&&Math.floor(u)===u}t.isInteger=Number.isInteger||f,t.MAX_SAFE_INTEGER=9007199254740991,t.isSafeInteger=function(u){return t.isInteger(u)&&u>=-t.MAX_SAFE_INTEGER&&u<=t.MAX_SAFE_INTEGER}})(rs),Object.defineProperty(ie,"__esModule",{value:!0});var is=rs;function df(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])<<16>>16}ie.readInt16BE=df;function gf(t,e){return e===void 0&&(e=0),(t[e+0]<<8|t[e+1])>>>0}ie.readUint16BE=gf;function yf(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])<<16>>16}ie.readInt16LE=yf;function pf(t,e){return e===void 0&&(e=0),(t[e+1]<<8|t[e])>>>0}ie.readUint16LE=pf;function ns(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>8,e[r+1]=t>>>0,e}ie.writeUint16BE=ns,ie.writeInt16BE=ns;function ss(t,e,r){return e===void 0&&(e=new Uint8Array(2)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e}ie.writeUint16LE=ss,ie.writeInt16LE=ss;function Ti(t,e){return e===void 0&&(e=0),t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3]}ie.readInt32BE=Ti;function xi(t,e){return e===void 0&&(e=0),(t[e]<<24|t[e+1]<<16|t[e+2]<<8|t[e+3])>>>0}ie.readUint32BE=xi;function Ri(t,e){return e===void 0&&(e=0),t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e]}ie.readInt32LE=Ri;function Ci(t,e){return e===void 0&&(e=0),(t[e+3]<<24|t[e+2]<<16|t[e+1]<<8|t[e])>>>0}ie.readUint32LE=Ci;function Mr(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>24,e[r+1]=t>>>16,e[r+2]=t>>>8,e[r+3]=t>>>0,e}ie.writeUint32BE=Mr,ie.writeInt32BE=Mr;function $r(t,e,r){return e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0),e[r+0]=t>>>0,e[r+1]=t>>>8,e[r+2]=t>>>16,e[r+3]=t>>>24,e}ie.writeUint32LE=$r,ie.writeInt32LE=$r;function _f(t,e){e===void 0&&(e=0);var r=Ti(t,e),i=Ti(t,e+4);return r*4294967296+i-(i>>31)*4294967296}ie.readInt64BE=_f;function bf(t,e){e===void 0&&(e=0);var r=xi(t,e),i=xi(t,e+4);return r*4294967296+i}ie.readUint64BE=bf;function vf(t,e){e===void 0&&(e=0);var r=Ri(t,e),i=Ri(t,e+4);return i*4294967296+r-(r>>31)*4294967296}ie.readInt64LE=vf;function wf(t,e){e===void 0&&(e=0);var r=Ci(t,e),i=Ci(t,e+4);return i*4294967296+r}ie.readUint64LE=wf;function os(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),Mr(t/4294967296>>>0,e,r),Mr(t>>>0,e,r+4),e}ie.writeUint64BE=os,ie.writeInt64BE=os;function as(t,e,r){return e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0),$r(t>>>0,e,r),$r(t/4294967296>>>0,e,r+4),e}ie.writeUint64LE=as,ie.writeInt64LE=as;function mf(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintBE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintBE: array is too short for the given bitLength");for(var i=0,n=1,s=t/8+r-1;s>=r;s--)i+=e[s]*n,n*=256;return i}ie.readUintBE=mf;function Ef(t,e,r){if(r===void 0&&(r=0),t%8!==0)throw new Error("readUintLE supports only bitLengths divisible by 8");if(t/8>e.length-r)throw new Error("readUintLE: array is too short for the given bitLength");for(var i=0,n=1,s=r;s<r+t/8;s++)i+=e[s]*n,n*=256;return i}ie.readUintLE=Ef;function Df(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintBE supports only bitLengths divisible by 8");if(!is.isSafeInteger(e))throw new Error("writeUintBE value must be an integer");for(var n=1,s=t/8+i-1;s>=i;s--)r[s]=e/n&255,n*=256;return r}ie.writeUintBE=Df;function Sf(t,e,r,i){if(r===void 0&&(r=new Uint8Array(t/8)),i===void 0&&(i=0),t%8!==0)throw new Error("writeUintLE supports only bitLengths divisible by 8");if(!is.isSafeInteger(e))throw new Error("writeUintLE value must be an integer");for(var n=1,s=i;s<i+t/8;s++)r[s]=e/n&255,n*=256;return r}ie.writeUintLE=Sf;function Of(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e)}ie.readFloat32BE=Of;function If(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat32(e,!0)}ie.readFloat32LE=If;function Tf(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e)}ie.readFloat64BE=Tf;function xf(t,e){e===void 0&&(e=0);var r=new DataView(t.buffer,t.byteOffset,t.byteLength);return r.getFloat64(e,!0)}ie.readFloat64LE=xf;function Rf(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t),e}ie.writeFloat32BE=Rf;function Cf(t,e,r){e===void 0&&(e=new Uint8Array(4)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat32(r,t,!0),e}ie.writeFloat32LE=Cf;function Af(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t),e}ie.writeFloat64BE=Af;function Pf(t,e,r){e===void 0&&(e=new Uint8Array(8)),r===void 0&&(r=0);var i=new DataView(e.buffer,e.byteOffset,e.byteLength);return i.setFloat64(r,t,!0),e}ie.writeFloat64LE=Pf,function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.randomStringForEntropy=t.randomString=t.randomUint32=t.randomBytes=t.defaultRandomSource=void 0;const e=Lr,r=ie,i=at;t.defaultRandomSource=new e.SystemRandomSource;function n(c,l=t.defaultRandomSource){return l.randomBytes(c)}t.randomBytes=n;function s(c=t.defaultRandomSource){const l=n(4,c),_=(0,r.readUint32LE)(l);return(0,i.wipe)(l),_}t.randomUint32=s;const f="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz";function u(c,l=f,_=t.defaultRandomSource){if(l.length<2)throw new Error("randomString charset is too short");if(l.length>256)throw new Error("randomString charset is too long");let p="";const b=l.length,O=256-256%b;for(;c>0;){const A=n(Math.ceil(c*256/O),_);for(let L=0;L<A.length&&c>0;L++){const G=A[L];G<O&&(p+=l.charAt(G%b),c--)}(0,i.wipe)(A)}return p}t.randomString=u;function h(c,l=f,_=t.defaultRandomSource){const p=Math.ceil(c/(Math.log(l.length)/Math.LN2));return u(p,l,_)}t.randomStringForEntropy=h}(Yt);var cs={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=at;t.DIGEST_LENGTH=64,t.BLOCK_SIZE=128;var i=function(){function u(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._stateHi=new Int32Array(8),this._stateLo=new Int32Array(8),this._tempHi=new Int32Array(16),this._tempLo=new Int32Array(16),this._buffer=new Uint8Array(256),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._stateHi[0]=1779033703,this._stateHi[1]=3144134277,this._stateHi[2]=1013904242,this._stateHi[3]=2773480762,this._stateHi[4]=1359893119,this._stateHi[5]=2600822924,this._stateHi[6]=528734635,this._stateHi[7]=1541459225,this._stateLo[0]=4089235720,this._stateLo[1]=2227873595,this._stateLo[2]=4271175723,this._stateLo[3]=1595750129,this._stateLo[4]=2917565137,this._stateLo[5]=725511199,this._stateLo[6]=4215389547,this._stateLo[7]=327033209},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._tempHi),r.wipe(this._tempLo),this.reset()},u.prototype.update=function(h,c){if(c===void 0&&(c=h.length),this._finished)throw new Error("SHA512: can't update because hash was finished.");var l=0;if(this._bytesHashed+=c,this._bufferLength>0){for(;this._bufferLength<t.BLOCK_SIZE&&c>0;)this._buffer[this._bufferLength++]=h[l++],c--;this._bufferLength===this.blockSize&&(s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,this.blockSize),this._bufferLength=0)}for(c>=this.blockSize&&(l=s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,h,l,c),c%=this.blockSize);c>0;)this._buffer[this._bufferLength++]=h[l++],c--;return this},u.prototype.finish=function(h){if(!this._finished){var c=this._bytesHashed,l=this._bufferLength,_=c/536870912|0,p=c<<3,b=c%128<112?128:256;this._buffer[l]=128;for(var O=l+1;O<b-8;O++)this._buffer[O]=0;e.writeUint32BE(_,this._buffer,b-8),e.writeUint32BE(p,this._buffer,b-4),s(this._tempHi,this._tempLo,this._stateHi,this._stateLo,this._buffer,0,b),this._finished=!0}for(var O=0;O<this.digestLength/8;O++)e.writeUint32BE(this._stateHi[O],h,O*8),e.writeUint32BE(this._stateLo[O],h,O*8+4);return this},u.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{stateHi:new Int32Array(this._stateHi),stateLo:new Int32Array(this._stateLo),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(h){return this._stateHi.set(h.stateHi),this._stateLo.set(h.stateLo),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(h){r.wipe(h.stateHi),r.wipe(h.stateLo),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},u}();t.SHA512=i;var n=new Int32Array([1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591]);function s(u,h,c,l,_,p,b){for(var O=c[0],A=c[1],L=c[2],G=c[3],E=c[4],R=c[5],w=c[6],m=c[7],g=l[0],o=l[1],d=l[2],N=l[3],P=l[4],K=l[5],V=l[6],J=l[7],I,C,W,F,M,j,U,B;b>=128;){for(var te=0;te<16;te++){var z=8*te+p;u[te]=e.readUint32BE(_,z),h[te]=e.readUint32BE(_,z+4)}for(var te=0;te<80;te++){var Q=O,k=A,ee=L,x=G,T=E,D=R,a=w,v=m,H=g,Y=o,he=d,_e=N,de=P,we=K,Ue=V,Ae=J;if(I=m,C=J,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=(E>>>14|P<<32-14)^(E>>>18|P<<32-18)^(P>>>41-32|E<<32-(41-32)),C=(P>>>14|E<<32-14)^(P>>>18|E<<32-18)^(E>>>41-32|P<<32-(41-32)),M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,I=E&R^~E&w,C=P&K^~P&V,M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,I=n[te*2],C=n[te*2+1],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,I=u[te%16],C=h[te%16],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,W=U&65535|B<<16,F=M&65535|j<<16,I=W,C=F,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=(O>>>28|g<<32-28)^(g>>>34-32|O<<32-(34-32))^(g>>>39-32|O<<32-(39-32)),C=(g>>>28|O<<32-28)^(O>>>34-32|g<<32-(34-32))^(O>>>39-32|g<<32-(39-32)),M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,I=O&A^O&L^A&L,C=g&o^g&d^o&d,M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,v=U&65535|B<<16,Ae=M&65535|j<<16,I=x,C=_e,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=W,C=F,M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,x=U&65535|B<<16,_e=M&65535|j<<16,A=Q,L=k,G=ee,E=x,R=T,w=D,m=a,O=v,o=H,d=Y,N=he,P=_e,K=de,V=we,J=Ue,g=Ae,te%16===15)for(var z=0;z<16;z++)I=u[z],C=h[z],M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=u[(z+9)%16],C=h[(z+9)%16],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,W=u[(z+1)%16],F=h[(z+1)%16],I=(W>>>1|F<<32-1)^(W>>>8|F<<32-8)^W>>>7,C=(F>>>1|W<<32-1)^(F>>>8|W<<32-8)^(F>>>7|W<<32-7),M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,W=u[(z+14)%16],F=h[(z+14)%16],I=(W>>>19|F<<32-19)^(F>>>61-32|W<<32-(61-32))^W>>>6,C=(F>>>19|W<<32-19)^(W>>>61-32|F<<32-(61-32))^(F>>>6|W<<32-6),M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,u[z]=U&65535|B<<16,h[z]=M&65535|j<<16}I=O,C=g,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[0],C=l[0],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[0]=O=U&65535|B<<16,l[0]=g=M&65535|j<<16,I=A,C=o,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[1],C=l[1],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[1]=A=U&65535|B<<16,l[1]=o=M&65535|j<<16,I=L,C=d,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[2],C=l[2],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[2]=L=U&65535|B<<16,l[2]=d=M&65535|j<<16,I=G,C=N,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[3],C=l[3],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[3]=G=U&65535|B<<16,l[3]=N=M&65535|j<<16,I=E,C=P,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[4],C=l[4],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[4]=E=U&65535|B<<16,l[4]=P=M&65535|j<<16,I=R,C=K,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[5],C=l[5],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[5]=R=U&65535|B<<16,l[5]=K=M&65535|j<<16,I=w,C=V,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[6],C=l[6],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[6]=w=U&65535|B<<16,l[6]=V=M&65535|j<<16,I=m,C=J,M=C&65535,j=C>>>16,U=I&65535,B=I>>>16,I=c[7],C=l[7],M+=C&65535,j+=C>>>16,U+=I&65535,B+=I>>>16,j+=M>>>16,U+=j>>>16,B+=U>>>16,c[7]=m=U&65535|B<<16,l[7]=J=M&65535|j<<16,p+=128,b-=128}return p}function f(u){var h=new i;h.update(u);var c=h.digest();return h.clean(),c}t.hash=f})(cs),function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.convertSecretKeyToX25519=t.convertPublicKeyToX25519=t.verify=t.sign=t.extractPublicKeyFromSecretKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.SEED_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=t.SIGNATURE_LENGTH=void 0;const e=Yt,r=cs,i=at;t.SIGNATURE_LENGTH=64,t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=64,t.SEED_LENGTH=32;function n(x){const T=new Float64Array(16);if(x)for(let D=0;D<x.length;D++)T[D]=x[D];return T}const s=new Uint8Array(32);s[0]=9;const f=n(),u=n([1]),h=n([30883,4953,19914,30187,55467,16705,2637,112,59544,30585,16505,36039,65139,11119,27886,20995]),c=n([61785,9906,39828,60374,45398,33411,5274,224,53552,61171,33010,6542,64743,22239,55772,9222]),l=n([54554,36645,11616,51542,42930,38181,51040,26924,56412,64982,57905,49316,21502,52590,14035,8553]),_=n([26200,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214,26214]),p=n([41136,18958,6951,50414,58488,44335,6150,12099,55207,15867,153,11085,57099,20417,9344,11139]);function b(x,T){for(let D=0;D<16;D++)x[D]=T[D]|0}function O(x){let T=1;for(let D=0;D<16;D++){let a=x[D]+T+65535;T=Math.floor(a/65536),x[D]=a-T*65536}x[0]+=T-1+37*(T-1)}function A(x,T,D){const a=~(D-1);for(let v=0;v<16;v++){const H=a&(x[v]^T[v]);x[v]^=H,T[v]^=H}}function L(x,T){const D=n(),a=n();for(let v=0;v<16;v++)a[v]=T[v];O(a),O(a),O(a);for(let v=0;v<2;v++){D[0]=a[0]-65517;for(let Y=1;Y<15;Y++)D[Y]=a[Y]-65535-(D[Y-1]>>16&1),D[Y-1]&=65535;D[15]=a[15]-32767-(D[14]>>16&1);const H=D[15]>>16&1;D[14]&=65535,A(a,D,1-H)}for(let v=0;v<16;v++)x[2*v]=a[v]&255,x[2*v+1]=a[v]>>8}function G(x,T){let D=0;for(let a=0;a<32;a++)D|=x[a]^T[a];return(1&D-1>>>8)-1}function E(x,T){const D=new Uint8Array(32),a=new Uint8Array(32);return L(D,x),L(a,T),G(D,a)}function R(x){const T=new Uint8Array(32);return L(T,x),T[0]&1}function w(x,T){for(let D=0;D<16;D++)x[D]=T[2*D]+(T[2*D+1]<<8);x[15]&=32767}function m(x,T,D){for(let a=0;a<16;a++)x[a]=T[a]+D[a]}function g(x,T,D){for(let a=0;a<16;a++)x[a]=T[a]-D[a]}function o(x,T,D){let a,v,H=0,Y=0,he=0,_e=0,de=0,we=0,Ue=0,Ae=0,pe=0,ge=0,le=0,ue=0,ce=0,ae=0,oe=0,re=0,fe=0,ye=0,ne=0,be=0,ve=0,Se=0,Oe=0,me=0,vt=0,Et=0,Rt=0,ut=0,zt=0,mr=0,Zr=0,Me=D[0],Pe=D[1],$e=D[2],je=D[3],Fe=D[4],Le=D[5],He=D[6],Ge=D[7],Ve=D[8],qe=D[9],We=D[10],ze=D[11],Be=D[12],Re=D[13],Ye=D[14],ke=D[15];a=T[0],H+=a*Me,Y+=a*Pe,he+=a*$e,_e+=a*je,de+=a*Fe,we+=a*Le,Ue+=a*He,Ae+=a*Ge,pe+=a*Ve,ge+=a*qe,le+=a*We,ue+=a*ze,ce+=a*Be,ae+=a*Re,oe+=a*Ye,re+=a*ke,a=T[1],Y+=a*Me,he+=a*Pe,_e+=a*$e,de+=a*je,we+=a*Fe,Ue+=a*Le,Ae+=a*He,pe+=a*Ge,ge+=a*Ve,le+=a*qe,ue+=a*We,ce+=a*ze,ae+=a*Be,oe+=a*Re,re+=a*Ye,fe+=a*ke,a=T[2],he+=a*Me,_e+=a*Pe,de+=a*$e,we+=a*je,Ue+=a*Fe,Ae+=a*Le,pe+=a*He,ge+=a*Ge,le+=a*Ve,ue+=a*qe,ce+=a*We,ae+=a*ze,oe+=a*Be,re+=a*Re,fe+=a*Ye,ye+=a*ke,a=T[3],_e+=a*Me,de+=a*Pe,we+=a*$e,Ue+=a*je,Ae+=a*Fe,pe+=a*Le,ge+=a*He,le+=a*Ge,ue+=a*Ve,ce+=a*qe,ae+=a*We,oe+=a*ze,re+=a*Be,fe+=a*Re,ye+=a*Ye,ne+=a*ke,a=T[4],de+=a*Me,we+=a*Pe,Ue+=a*$e,Ae+=a*je,pe+=a*Fe,ge+=a*Le,le+=a*He,ue+=a*Ge,ce+=a*Ve,ae+=a*qe,oe+=a*We,re+=a*ze,fe+=a*Be,ye+=a*Re,ne+=a*Ye,be+=a*ke,a=T[5],we+=a*Me,Ue+=a*Pe,Ae+=a*$e,pe+=a*je,ge+=a*Fe,le+=a*Le,ue+=a*He,ce+=a*Ge,ae+=a*Ve,oe+=a*qe,re+=a*We,fe+=a*ze,ye+=a*Be,ne+=a*Re,be+=a*Ye,ve+=a*ke,a=T[6],Ue+=a*Me,Ae+=a*Pe,pe+=a*$e,ge+=a*je,le+=a*Fe,ue+=a*Le,ce+=a*He,ae+=a*Ge,oe+=a*Ve,re+=a*qe,fe+=a*We,ye+=a*ze,ne+=a*Be,be+=a*Re,ve+=a*Ye,Se+=a*ke,a=T[7],Ae+=a*Me,pe+=a*Pe,ge+=a*$e,le+=a*je,ue+=a*Fe,ce+=a*Le,ae+=a*He,oe+=a*Ge,re+=a*Ve,fe+=a*qe,ye+=a*We,ne+=a*ze,be+=a*Be,ve+=a*Re,Se+=a*Ye,Oe+=a*ke,a=T[8],pe+=a*Me,ge+=a*Pe,le+=a*$e,ue+=a*je,ce+=a*Fe,ae+=a*Le,oe+=a*He,re+=a*Ge,fe+=a*Ve,ye+=a*qe,ne+=a*We,be+=a*ze,ve+=a*Be,Se+=a*Re,Oe+=a*Ye,me+=a*ke,a=T[9],ge+=a*Me,le+=a*Pe,ue+=a*$e,ce+=a*je,ae+=a*Fe,oe+=a*Le,re+=a*He,fe+=a*Ge,ye+=a*Ve,ne+=a*qe,be+=a*We,ve+=a*ze,Se+=a*Be,Oe+=a*Re,me+=a*Ye,vt+=a*ke,a=T[10],le+=a*Me,ue+=a*Pe,ce+=a*$e,ae+=a*je,oe+=a*Fe,re+=a*Le,fe+=a*He,ye+=a*Ge,ne+=a*Ve,be+=a*qe,ve+=a*We,Se+=a*ze,Oe+=a*Be,me+=a*Re,vt+=a*Ye,Et+=a*ke,a=T[11],ue+=a*Me,ce+=a*Pe,ae+=a*$e,oe+=a*je,re+=a*Fe,fe+=a*Le,ye+=a*He,ne+=a*Ge,be+=a*Ve,ve+=a*qe,Se+=a*We,Oe+=a*ze,me+=a*Be,vt+=a*Re,Et+=a*Ye,Rt+=a*ke,a=T[12],ce+=a*Me,ae+=a*Pe,oe+=a*$e,re+=a*je,fe+=a*Fe,ye+=a*Le,ne+=a*He,be+=a*Ge,ve+=a*Ve,Se+=a*qe,Oe+=a*We,me+=a*ze,vt+=a*Be,Et+=a*Re,Rt+=a*Ye,ut+=a*ke,a=T[13],ae+=a*Me,oe+=a*Pe,re+=a*$e,fe+=a*je,ye+=a*Fe,ne+=a*Le,be+=a*He,ve+=a*Ge,Se+=a*Ve,Oe+=a*qe,me+=a*We,vt+=a*ze,Et+=a*Be,Rt+=a*Re,ut+=a*Ye,zt+=a*ke,a=T[14],oe+=a*Me,re+=a*Pe,fe+=a*$e,ye+=a*je,ne+=a*Fe,be+=a*Le,ve+=a*He,Se+=a*Ge,Oe+=a*Ve,me+=a*qe,vt+=a*We,Et+=a*ze,Rt+=a*Be,ut+=a*Re,zt+=a*Ye,mr+=a*ke,a=T[15],re+=a*Me,fe+=a*Pe,ye+=a*$e,ne+=a*je,be+=a*Fe,ve+=a*Le,Se+=a*He,Oe+=a*Ge,me+=a*Ve,vt+=a*qe,Et+=a*We,Rt+=a*ze,ut+=a*Be,zt+=a*Re,mr+=a*Ye,Zr+=a*ke,H+=38*fe,Y+=38*ye,he+=38*ne,_e+=38*be,de+=38*ve,we+=38*Se,Ue+=38*Oe,Ae+=38*me,pe+=38*vt,ge+=38*Et,le+=38*Rt,ue+=38*ut,ce+=38*zt,ae+=38*mr,oe+=38*Zr,v=1,a=H+v+65535,v=Math.floor(a/65536),H=a-v*65536,a=Y+v+65535,v=Math.floor(a/65536),Y=a-v*65536,a=he+v+65535,v=Math.floor(a/65536),he=a-v*65536,a=_e+v+65535,v=Math.floor(a/65536),_e=a-v*65536,a=de+v+65535,v=Math.floor(a/65536),de=a-v*65536,a=we+v+65535,v=Math.floor(a/65536),we=a-v*65536,a=Ue+v+65535,v=Math.floor(a/65536),Ue=a-v*65536,a=Ae+v+65535,v=Math.floor(a/65536),Ae=a-v*65536,a=pe+v+65535,v=Math.floor(a/65536),pe=a-v*65536,a=ge+v+65535,v=Math.floor(a/65536),ge=a-v*65536,a=le+v+65535,v=Math.floor(a/65536),le=a-v*65536,a=ue+v+65535,v=Math.floor(a/65536),ue=a-v*65536,a=ce+v+65535,v=Math.floor(a/65536),ce=a-v*65536,a=ae+v+65535,v=Math.floor(a/65536),ae=a-v*65536,a=oe+v+65535,v=Math.floor(a/65536),oe=a-v*65536,a=re+v+65535,v=Math.floor(a/65536),re=a-v*65536,H+=v-1+37*(v-1),v=1,a=H+v+65535,v=Math.floor(a/65536),H=a-v*65536,a=Y+v+65535,v=Math.floor(a/65536),Y=a-v*65536,a=he+v+65535,v=Math.floor(a/65536),he=a-v*65536,a=_e+v+65535,v=Math.floor(a/65536),_e=a-v*65536,a=de+v+65535,v=Math.floor(a/65536),de=a-v*65536,a=we+v+65535,v=Math.floor(a/65536),we=a-v*65536,a=Ue+v+65535,v=Math.floor(a/65536),Ue=a-v*65536,a=Ae+v+65535,v=Math.floor(a/65536),Ae=a-v*65536,a=pe+v+65535,v=Math.floor(a/65536),pe=a-v*65536,a=ge+v+65535,v=Math.floor(a/65536),ge=a-v*65536,a=le+v+65535,v=Math.floor(a/65536),le=a-v*65536,a=ue+v+65535,v=Math.floor(a/65536),ue=a-v*65536,a=ce+v+65535,v=Math.floor(a/65536),ce=a-v*65536,a=ae+v+65535,v=Math.floor(a/65536),ae=a-v*65536,a=oe+v+65535,v=Math.floor(a/65536),oe=a-v*65536,a=re+v+65535,v=Math.floor(a/65536),re=a-v*65536,H+=v-1+37*(v-1),x[0]=H,x[1]=Y,x[2]=he,x[3]=_e,x[4]=de,x[5]=we,x[6]=Ue,x[7]=Ae,x[8]=pe,x[9]=ge,x[10]=le,x[11]=ue,x[12]=ce,x[13]=ae,x[14]=oe,x[15]=re}function d(x,T){o(x,T,T)}function N(x,T){const D=n();let a;for(a=0;a<16;a++)D[a]=T[a];for(a=253;a>=0;a--)d(D,D),a!==2&&a!==4&&o(D,D,T);for(a=0;a<16;a++)x[a]=D[a]}function P(x,T){const D=n();let a;for(a=0;a<16;a++)D[a]=T[a];for(a=250;a>=0;a--)d(D,D),a!==1&&o(D,D,T);for(a=0;a<16;a++)x[a]=D[a]}function K(x,T){const D=n(),a=n(),v=n(),H=n(),Y=n(),he=n(),_e=n(),de=n(),we=n();g(D,x[1],x[0]),g(we,T[1],T[0]),o(D,D,we),m(a,x[0],x[1]),m(we,T[0],T[1]),o(a,a,we),o(v,x[3],T[3]),o(v,v,c),o(H,x[2],T[2]),m(H,H,H),g(Y,a,D),g(he,H,v),m(_e,H,v),m(de,a,D),o(x[0],Y,he),o(x[1],de,_e),o(x[2],_e,he),o(x[3],Y,de)}function V(x,T,D){for(let a=0;a<4;a++)A(x[a],T[a],D)}function J(x,T){const D=n(),a=n(),v=n();N(v,T[2]),o(D,T[0],v),o(a,T[1],v),L(x,a),x[31]^=R(D)<<7}function I(x,T,D){b(x[0],f),b(x[1],u),b(x[2],u),b(x[3],f);for(let a=255;a>=0;--a){const v=D[a/8|0]>>(a&7)&1;V(x,T,v),K(T,x),K(x,x),V(x,T,v)}}function C(x,T){const D=[n(),n(),n(),n()];b(D[0],l),b(D[1],_),b(D[2],u),o(D[3],l,_),I(x,D,T)}function W(x){if(x.length!==t.SEED_LENGTH)throw new Error(`ed25519: seed must be ${t.SEED_LENGTH} bytes`);const T=(0,r.hash)(x);T[0]&=248,T[31]&=127,T[31]|=64;const D=new Uint8Array(32),a=[n(),n(),n(),n()];C(a,T),J(D,a);const v=new Uint8Array(64);return v.set(x),v.set(D,32),{publicKey:D,secretKey:v}}t.generateKeyPairFromSeed=W;function F(x){const T=(0,e.randomBytes)(32,x),D=W(T);return(0,i.wipe)(T),D}t.generateKeyPair=F;function M(x){if(x.length!==t.SECRET_KEY_LENGTH)throw new Error(`ed25519: secret key must be ${t.SECRET_KEY_LENGTH} bytes`);return new Uint8Array(x.subarray(32))}t.extractPublicKeyFromSecretKey=M;const j=new Float64Array([237,211,245,92,26,99,18,88,214,156,247,162,222,249,222,20,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,16]);function U(x,T){let D,a,v,H;for(a=63;a>=32;--a){for(D=0,v=a-32,H=a-12;v<H;++v)T[v]+=D-16*T[a]*j[v-(a-32)],D=Math.floor((T[v]+128)/256),T[v]-=D*256;T[v]+=D,T[a]=0}for(D=0,v=0;v<32;v++)T[v]+=D-(T[31]>>4)*j[v],D=T[v]>>8,T[v]&=255;for(v=0;v<32;v++)T[v]-=D*j[v];for(a=0;a<32;a++)T[a+1]+=T[a]>>8,x[a]=T[a]&255}function B(x){const T=new Float64Array(64);for(let D=0;D<64;D++)T[D]=x[D];for(let D=0;D<64;D++)x[D]=0;U(x,T)}function te(x,T){const D=new Float64Array(64),a=[n(),n(),n(),n()],v=(0,r.hash)(x.subarray(0,32));v[0]&=248,v[31]&=127,v[31]|=64;const H=new Uint8Array(64);H.set(v.subarray(32),32);const Y=new r.SHA512;Y.update(H.subarray(32)),Y.update(T);const he=Y.digest();Y.clean(),B(he),C(a,he),J(H,a),Y.reset(),Y.update(H.subarray(0,32)),Y.update(x.subarray(32)),Y.update(T);const _e=Y.digest();B(_e);for(let de=0;de<32;de++)D[de]=he[de];for(let de=0;de<32;de++)for(let we=0;we<32;we++)D[de+we]+=_e[de]*v[we];return U(H.subarray(32),D),H}t.sign=te;function z(x,T){const D=n(),a=n(),v=n(),H=n(),Y=n(),he=n(),_e=n();return b(x[2],u),w(x[1],T),d(v,x[1]),o(H,v,h),g(v,v,x[2]),m(H,x[2],H),d(Y,H),d(he,Y),o(_e,he,Y),o(D,_e,v),o(D,D,H),P(D,D),o(D,D,v),o(D,D,H),o(D,D,H),o(x[0],D,H),d(a,x[0]),o(a,a,H),E(a,v)&&o(x[0],x[0],p),d(a,x[0]),o(a,a,H),E(a,v)?-1:(R(x[0])===T[31]>>7&&g(x[0],f,x[0]),o(x[3],x[0],x[1]),0)}function Q(x,T,D){const a=new Uint8Array(32),v=[n(),n(),n(),n()],H=[n(),n(),n(),n()];if(D.length!==t.SIGNATURE_LENGTH)throw new Error(`ed25519: signature must be ${t.SIGNATURE_LENGTH} bytes`);if(z(H,x))return!1;const Y=new r.SHA512;Y.update(D.subarray(0,32)),Y.update(x),Y.update(T);const he=Y.digest();return B(he),I(v,H,he),C(H,D.subarray(32)),K(v,H),J(a,v),!G(D,a)}t.verify=Q;function k(x){let T=[n(),n(),n(),n()];if(z(T,x))throw new Error("Ed25519: invalid public key");let D=n(),a=n(),v=T[1];m(D,u,v),g(a,u,v),N(a,a),o(D,D,a);let H=new Uint8Array(32);return L(H,D),H}t.convertPublicKeyToX25519=k;function ee(x){const T=(0,r.hash)(x.subarray(0,32));T[0]&=248,T[31]&=127,T[31]|=64;const D=new Uint8Array(T.subarray(0,32));return(0,i.wipe)(T),D}t.convertSecretKeyToX25519=ee}(Ii);const Lf="EdDSA",Nf="JWT",us=".",fs="base64url",Uf="utf8",Mf="utf8",$f=":",jf="did",Ff="key",hs="base58btc",Bf="z",zf="K36",Kf=32;function Ai(t){return globalThis.Buffer!=null?new Uint8Array(t.buffer,t.byteOffset,t.byteLength):t}function ls(t=0){return globalThis.Buffer!=null&&globalThis.Buffer.allocUnsafe!=null?Ai(globalThis.Buffer.allocUnsafe(t)):new Uint8Array(t)}function Pi(t,e){e||(e=t.reduce((n,s)=>n+s.length,0));const r=ls(e);let i=0;for(const n of t)r.set(n,i),i+=n.length;return Ai(r)}function Hf(t,e){if(t.length>=255)throw new TypeError("Alphabet too long");for(var r=new Uint8Array(256),i=0;i<r.length;i++)r[i]=255;for(var n=0;n<t.length;n++){var s=t.charAt(n),f=s.charCodeAt(0);if(r[f]!==255)throw new TypeError(s+" is ambiguous");r[f]=n}var u=t.length,h=t.charAt(0),c=Math.log(u)/Math.log(256),l=Math.log(256)/Math.log(u);function _(O){if(O instanceof Uint8Array||(ArrayBuffer.isView(O)?O=new Uint8Array(O.buffer,O.byteOffset,O.byteLength):Array.isArray(O)&&(O=Uint8Array.from(O))),!(O instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(O.length===0)return"";for(var A=0,L=0,G=0,E=O.length;G!==E&&O[G]===0;)G++,A++;for(var R=(E-G)*l+1>>>0,w=new Uint8Array(R);G!==E;){for(var m=O[G],g=0,o=R-1;(m!==0||g<L)&&o!==-1;o--,g++)m+=256*w[o]>>>0,w[o]=m%u>>>0,m=m/u>>>0;if(m!==0)throw new Error("Non-zero carry");L=g,G++}for(var d=R-L;d!==R&&w[d]===0;)d++;for(var N=h.repeat(A);d<R;++d)N+=t.charAt(w[d]);return N}function p(O){if(typeof O!="string")throw new TypeError("Expected String");if(O.length===0)return new Uint8Array;var A=0;if(O[A]!==" "){for(var L=0,G=0;O[A]===h;)L++,A++;for(var E=(O.length-A)*c+1>>>0,R=new Uint8Array(E);O[A];){var w=r[O.charCodeAt(A)];if(w===255)return;for(var m=0,g=E-1;(w!==0||m<G)&&g!==-1;g--,m++)w+=u*R[g]>>>0,R[g]=w%256>>>0,w=w/256>>>0;if(w!==0)throw new Error("Non-zero carry");G=m,A++}if(O[A]!==" "){for(var o=E-G;o!==E&&R[o]===0;)o++;for(var d=new Uint8Array(L+(E-o)),N=L;o!==E;)d[N++]=R[o++];return d}}}function b(O){var A=p(O);if(A)return A;throw new Error(`Non-${e} character`)}return{encode:_,decodeUnsafe:p,decode:b}}var Gf=Hf,Vf=Gf;const ds=t=>{if(t instanceof Uint8Array&&t.constructor.name==="Uint8Array")return t;if(t instanceof ArrayBuffer)return new Uint8Array(t);if(ArrayBuffer.isView(t))return new Uint8Array(t.buffer,t.byteOffset,t.byteLength);throw new Error("Unknown type, must be binary type")},qf=t=>new TextEncoder().encode(t),Wf=t=>new TextDecoder().decode(t);class Yf{constructor(e,r,i){this.name=e,this.prefix=r,this.baseEncode=i}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}class kf{constructor(e,r,i){if(this.name=e,this.prefix=r,r.codePointAt(0)===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=r.codePointAt(0),this.baseDecode=i}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return gs(this,e)}}class Xf{constructor(e){this.decoders=e}or(e){return gs(this,e)}decode(e){const r=e[0],i=this.decoders[r];if(i)return i.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}const gs=(t,e)=>new Xf({...t.decoders||{[t.prefix]:t},...e.decoders||{[e.prefix]:e}});class Jf{constructor(e,r,i,n){this.name=e,this.prefix=r,this.baseEncode=i,this.baseDecode=n,this.encoder=new Yf(e,r,i),this.decoder=new kf(e,r,n)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}const jr=({name:t,prefix:e,encode:r,decode:i})=>new Jf(t,e,r,i),fr=({prefix:t,name:e,alphabet:r})=>{const{encode:i,decode:n}=Vf(r,e);return jr({prefix:t,name:e,encode:i,decode:s=>ds(n(s))})},Qf=(t,e,r,i)=>{const n={};for(let l=0;l<e.length;++l)n[e[l]]=l;let s=t.length;for(;t[s-1]==="=";)--s;const f=new Uint8Array(s*r/8|0);let u=0,h=0,c=0;for(let l=0;l<s;++l){const _=n[t[l]];if(_===void 0)throw new SyntaxError(`Non-${i} character`);h=h<<r|_,u+=r,u>=8&&(u-=8,f[c++]=255&h>>u)}if(u>=r||255&h<<8-u)throw new SyntaxError("Unexpected end of data");return f},Zf=(t,e,r)=>{const i=e[e.length-1]==="=",n=(1<<r)-1;let s="",f=0,u=0;for(let h=0;h<t.length;++h)for(u=u<<8|t[h],f+=8;f>r;)f-=r,s+=e[n&u>>f];if(f&&(s+=e[n&u<<r-f]),i)for(;s.length*r&7;)s+="=";return s},Je=({name:t,prefix:e,bitsPerChar:r,alphabet:i})=>jr({prefix:e,name:t,encode(n){return Zf(n,i,r)},decode(n){return Qf(n,i,r,t)}}),eh=jr({prefix:"\0",name:"identity",encode:t=>Wf(t),decode:t=>qf(t)});var th=Object.freeze({__proto__:null,identity:eh});const rh=Je({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1});var ih=Object.freeze({__proto__:null,base2:rh});const nh=Je({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3});var sh=Object.freeze({__proto__:null,base8:nh});const oh=fr({prefix:"9",name:"base10",alphabet:"0123456789"});var ah=Object.freeze({__proto__:null,base10:oh});const ch=Je({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),uh=Je({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4});var fh=Object.freeze({__proto__:null,base16:ch,base16upper:uh});const hh=Je({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),lh=Je({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),dh=Je({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),gh=Je({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),yh=Je({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),ph=Je({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),_h=Je({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),bh=Je({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),vh=Je({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5});var wh=Object.freeze({__proto__:null,base32:hh,base32upper:lh,base32pad:dh,base32padupper:gh,base32hex:yh,base32hexupper:ph,base32hexpad:_h,base32hexpadupper:bh,base32z:vh});const mh=fr({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Eh=fr({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"});var Dh=Object.freeze({__proto__:null,base36:mh,base36upper:Eh});const Sh=fr({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Oh=fr({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"});var Ih=Object.freeze({__proto__:null,base58btc:Sh,base58flickr:Oh});const Th=Je({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),xh=Je({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),Rh=Je({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),Ch=Je({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6});var Ah=Object.freeze({__proto__:null,base64:Th,base64pad:xh,base64url:Rh,base64urlpad:Ch});const ys=Array.from("\u{1F680}\u{1FA90}\u2604\u{1F6F0}\u{1F30C}\u{1F311}\u{1F312}\u{1F313}\u{1F314}\u{1F315}\u{1F316}\u{1F317}\u{1F318}\u{1F30D}\u{1F30F}\u{1F30E}\u{1F409}\u2600\u{1F4BB}\u{1F5A5}\u{1F4BE}\u{1F4BF}\u{1F602}\u2764\u{1F60D}\u{1F923}\u{1F60A}\u{1F64F}\u{1F495}\u{1F62D}\u{1F618}\u{1F44D}\u{1F605}\u{1F44F}\u{1F601}\u{1F525}\u{1F970}\u{1F494}\u{1F496}\u{1F499}\u{1F622}\u{1F914}\u{1F606}\u{1F644}\u{1F4AA}\u{1F609}\u263A\u{1F44C}\u{1F917}\u{1F49C}\u{1F614}\u{1F60E}\u{1F607}\u{1F339}\u{1F926}\u{1F389}\u{1F49E}\u270C\u2728\u{1F937}\u{1F631}\u{1F60C}\u{1F338}\u{1F64C}\u{1F60B}\u{1F497}\u{1F49A}\u{1F60F}\u{1F49B}\u{1F642}\u{1F493}\u{1F929}\u{1F604}\u{1F600}\u{1F5A4}\u{1F603}\u{1F4AF}\u{1F648}\u{1F447}\u{1F3B6}\u{1F612}\u{1F92D}\u2763\u{1F61C}\u{1F48B}\u{1F440}\u{1F62A}\u{1F611}\u{1F4A5}\u{1F64B}\u{1F61E}\u{1F629}\u{1F621}\u{1F92A}\u{1F44A}\u{1F973}\u{1F625}\u{1F924}\u{1F449}\u{1F483}\u{1F633}\u270B\u{1F61A}\u{1F61D}\u{1F634}\u{1F31F}\u{1F62C}\u{1F643}\u{1F340}\u{1F337}\u{1F63B}\u{1F613}\u2B50\u2705\u{1F97A}\u{1F308}\u{1F608}\u{1F918}\u{1F4A6}\u2714\u{1F623}\u{1F3C3}\u{1F490}\u2639\u{1F38A}\u{1F498}\u{1F620}\u261D\u{1F615}\u{1F33A}\u{1F382}\u{1F33B}\u{1F610}\u{1F595}\u{1F49D}\u{1F64A}\u{1F639}\u{1F5E3}\u{1F4AB}\u{1F480}\u{1F451}\u{1F3B5}\u{1F91E}\u{1F61B}\u{1F534}\u{1F624}\u{1F33C}\u{1F62B}\u26BD\u{1F919}\u2615\u{1F3C6}\u{1F92B}\u{1F448}\u{1F62E}\u{1F646}\u{1F37B}\u{1F343}\u{1F436}\u{1F481}\u{1F632}\u{1F33F}\u{1F9E1}\u{1F381}\u26A1\u{1F31E}\u{1F388}\u274C\u270A\u{1F44B}\u{1F630}\u{1F928}\u{1F636}\u{1F91D}\u{1F6B6}\u{1F4B0}\u{1F353}\u{1F4A2}\u{1F91F}\u{1F641}\u{1F6A8}\u{1F4A8}\u{1F92C}\u2708\u{1F380}\u{1F37A}\u{1F913}\u{1F619}\u{1F49F}\u{1F331}\u{1F616}\u{1F476}\u{1F974}\u25B6\u27A1\u2753\u{1F48E}\u{1F4B8}\u2B07\u{1F628}\u{1F31A}\u{1F98B}\u{1F637}\u{1F57A}\u26A0\u{1F645}\u{1F61F}\u{1F635}\u{1F44E}\u{1F932}\u{1F920}\u{1F927}\u{1F4CC}\u{1F535}\u{1F485}\u{1F9D0}\u{1F43E}\u{1F352}\u{1F617}\u{1F911}\u{1F30A}\u{1F92F}\u{1F437}\u260E\u{1F4A7}\u{1F62F}\u{1F486}\u{1F446}\u{1F3A4}\u{1F647}\u{1F351}\u2744\u{1F334}\u{1F4A3}\u{1F438}\u{1F48C}\u{1F4CD}\u{1F940}\u{1F922}\u{1F445}\u{1F4A1}\u{1F4A9}\u{1F450}\u{1F4F8}\u{1F47B}\u{1F910}\u{1F92E}\u{1F3BC}\u{1F975}\u{1F6A9}\u{1F34E}\u{1F34A}\u{1F47C}\u{1F48D}\u{1F4E3}\u{1F942}"),Ph=ys.reduce((t,e,r)=>(t[r]=e,t),[]),Lh=ys.reduce((t,e,r)=>(t[e.codePointAt(0)]=r,t),[]);function Nh(t){return t.reduce((e,r)=>(e+=Ph[r],e),"")}function Uh(t){const e=[];for(const r of t){const i=Lh[r.codePointAt(0)];if(i===void 0)throw new Error(`Non-base256emoji character: ${r}`);e.push(i)}return new Uint8Array(e)}const Mh=jr({prefix:"\u{1F680}",name:"base256emoji",encode:Nh,decode:Uh});var $h=Object.freeze({__proto__:null,base256emoji:Mh}),jh=_s,ps=128,Fh=127,Bh=~Fh,zh=Math.pow(2,31);function _s(t,e,r){e=e||[],r=r||0;for(var i=r;t>=zh;)e[r++]=t&255|ps,t/=128;for(;t&Bh;)e[r++]=t&255|ps,t>>>=7;return e[r]=t|0,_s.bytes=r-i+1,e}var Kh=Li,Hh=128,bs=127;function Li(t,i){var r=0,i=i||0,n=0,s=i,f,u=t.length;do{if(s>=u)throw Li.bytes=0,new RangeError("Could not decode varint");f=t[s++],r+=n<28?(f&bs)<<n:(f&bs)*Math.pow(2,n),n+=7}while(f>=Hh);return Li.bytes=s-i,r}var Gh=Math.pow(2,7),Vh=Math.pow(2,14),qh=Math.pow(2,21),Wh=Math.pow(2,28),Yh=Math.pow(2,35),kh=Math.pow(2,42),Xh=Math.pow(2,49),Jh=Math.pow(2,56),Qh=Math.pow(2,63),Zh=function(t){return t<Gh?1:t<Vh?2:t<qh?3:t<Wh?4:t<Yh?5:t<kh?6:t<Xh?7:t<Jh?8:t<Qh?9:10},el={encode:jh,decode:Kh,encodingLength:Zh},vs=el;const ws=(t,e,r=0)=>(vs.encode(t,e,r),e),ms=t=>vs.encodingLength(t),Ni=(t,e)=>{const r=e.byteLength,i=ms(t),n=i+ms(r),s=new Uint8Array(n+r);return ws(t,s,0),ws(r,s,i),s.set(e,n),new tl(t,r,e,s)};class tl{constructor(e,r,i,n){this.code=e,this.size=r,this.digest=i,this.bytes=n}}const Es=({name:t,code:e,encode:r})=>new rl(t,e,r);class rl{constructor(e,r,i){this.name=e,this.code=r,this.encode=i}digest(e){if(e instanceof Uint8Array){const r=this.encode(e);return r instanceof Uint8Array?Ni(this.code,r):r.then(i=>Ni(this.code,i))}else throw Error("Unknown type, must be binary type")}}const Ds=t=>async e=>new Uint8Array(await crypto.subtle.digest(t,e)),il=Es({name:"sha2-256",code:18,encode:Ds("SHA-256")}),nl=Es({name:"sha2-512",code:19,encode:Ds("SHA-512")});var sl=Object.freeze({__proto__:null,sha256:il,sha512:nl});const Ss=0,ol="identity",Os=ds;var al=Object.freeze({__proto__:null,identity:{code:Ss,name:ol,encode:Os,digest:t=>Ni(Ss,Os(t))}});new TextEncoder,new TextDecoder;const Is={...th,...ih,...sh,...ah,...fh,...wh,...Dh,...Ih,...Ah,...$h};({...sl,...al});function Ts(t,e,r,i){return{name:t,prefix:e,encoder:{name:t,prefix:e,encode:r},decoder:{decode:i}}}const xs=Ts("utf8","u",t=>"u"+new TextDecoder("utf8").decode(t),t=>new TextEncoder().encode(t.substring(1))),Ui=Ts("ascii","a",t=>{let e="a";for(let r=0;r<t.length;r++)e+=String.fromCharCode(t[r]);return e},t=>{t=t.substring(1);const e=ls(t.length);for(let r=0;r<t.length;r++)e[r]=t.charCodeAt(r);return e}),Rs={utf8:xs,"utf-8":xs,hex:Is.base16,latin1:Ui,ascii:Ui,binary:Ui,...Is};function rt(t,e="utf8"){const r=Rs[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?globalThis.Buffer.from(t.buffer,t.byteOffset,t.byteLength).toString("utf8"):r.encoder.encode(t).substring(1)}function it(t,e="utf8"){const r=Rs[e];if(!r)throw new Error(`Unsupported encoding "${e}"`);return(e==="utf8"||e==="utf-8")&&globalThis.Buffer!=null&&globalThis.Buffer.from!=null?Ai(globalThis.Buffer.from(t,"utf-8")):r.decoder.decode(`${r.prefix}${t}`)}function Fr(t){return rt(it(rr(t),Uf),fs)}function Cs(t){const e=it(zf,hs),r=Bf+rt(Pi([e,t]),hs);return[jf,Ff,r].join($f)}function cl(t){return rt(t,fs)}function ul(t){return it([Fr(t.header),Fr(t.payload)].join(us),Mf)}function fl(t){return[Fr(t.header),Fr(t.payload),cl(t.signature)].join(us)}function As(t=Yt.randomBytes(Kf)){return Ii.generateKeyPairFromSeed(t)}async function hl(t,e,r,i,n=Z.fromMiliseconds(Date.now())){const s={alg:Lf,typ:Nf},f=Cs(i.publicKey),u=n+r,h={iss:f,sub:t,aud:e,iat:n,exp:u},c=ul({header:s,payload:h}),l=Ii.sign(i.secretKey,c);return fl({header:s,payload:h,signature:l})}var Mi={},Br={};Object.defineProperty(Br,"__esModule",{value:!0});var Ze=ie,$i=at,ll=20;function dl(t,e,r){for(var i=1634760805,n=857760878,s=2036477234,f=1797285236,u=r[3]<<24|r[2]<<16|r[1]<<8|r[0],h=r[7]<<24|r[6]<<16|r[5]<<8|r[4],c=r[11]<<24|r[10]<<16|r[9]<<8|r[8],l=r[15]<<24|r[14]<<16|r[13]<<8|r[12],_=r[19]<<24|r[18]<<16|r[17]<<8|r[16],p=r[23]<<24|r[22]<<16|r[21]<<8|r[20],b=r[27]<<24|r[26]<<16|r[25]<<8|r[24],O=r[31]<<24|r[30]<<16|r[29]<<8|r[28],A=e[3]<<24|e[2]<<16|e[1]<<8|e[0],L=e[7]<<24|e[6]<<16|e[5]<<8|e[4],G=e[11]<<24|e[10]<<16|e[9]<<8|e[8],E=e[15]<<24|e[14]<<16|e[13]<<8|e[12],R=i,w=n,m=s,g=f,o=u,d=h,N=c,P=l,K=_,V=p,J=b,I=O,C=A,W=L,F=G,M=E,j=0;j<ll;j+=2)R=R+o|0,C^=R,C=C>>>32-16|C<<16,K=K+C|0,o^=K,o=o>>>32-12|o<<12,w=w+d|0,W^=w,W=W>>>32-16|W<<16,V=V+W|0,d^=V,d=d>>>32-12|d<<12,m=m+N|0,F^=m,F=F>>>32-16|F<<16,J=J+F|0,N^=J,N=N>>>32-12|N<<12,g=g+P|0,M^=g,M=M>>>32-16|M<<16,I=I+M|0,P^=I,P=P>>>32-12|P<<12,m=m+N|0,F^=m,F=F>>>32-8|F<<8,J=J+F|0,N^=J,N=N>>>32-7|N<<7,g=g+P|0,M^=g,M=M>>>32-8|M<<8,I=I+M|0,P^=I,P=P>>>32-7|P<<7,w=w+d|0,W^=w,W=W>>>32-8|W<<8,V=V+W|0,d^=V,d=d>>>32-7|d<<7,R=R+o|0,C^=R,C=C>>>32-8|C<<8,K=K+C|0,o^=K,o=o>>>32-7|o<<7,R=R+d|0,M^=R,M=M>>>32-16|M<<16,J=J+M|0,d^=J,d=d>>>32-12|d<<12,w=w+N|0,C^=w,C=C>>>32-16|C<<16,I=I+C|0,N^=I,N=N>>>32-12|N<<12,m=m+P|0,W^=m,W=W>>>32-16|W<<16,K=K+W|0,P^=K,P=P>>>32-12|P<<12,g=g+o|0,F^=g,F=F>>>32-16|F<<16,V=V+F|0,o^=V,o=o>>>32-12|o<<12,m=m+P|0,W^=m,W=W>>>32-8|W<<8,K=K+W|0,P^=K,P=P>>>32-7|P<<7,g=g+o|0,F^=g,F=F>>>32-8|F<<8,V=V+F|0,o^=V,o=o>>>32-7|o<<7,w=w+N|0,C^=w,C=C>>>32-8|C<<8,I=I+C|0,N^=I,N=N>>>32-7|N<<7,R=R+d|0,M^=R,M=M>>>32-8|M<<8,J=J+M|0,d^=J,d=d>>>32-7|d<<7;Ze.writeUint32LE(R+i|0,t,0),Ze.writeUint32LE(w+n|0,t,4),Ze.writeUint32LE(m+s|0,t,8),Ze.writeUint32LE(g+f|0,t,12),Ze.writeUint32LE(o+u|0,t,16),Ze.writeUint32LE(d+h|0,t,20),Ze.writeUint32LE(N+c|0,t,24),Ze.writeUint32LE(P+l|0,t,28),Ze.writeUint32LE(K+_|0,t,32),Ze.writeUint32LE(V+p|0,t,36),Ze.writeUint32LE(J+b|0,t,40),Ze.writeUint32LE(I+O|0,t,44),Ze.writeUint32LE(C+A|0,t,48),Ze.writeUint32LE(W+L|0,t,52),Ze.writeUint32LE(F+G|0,t,56),Ze.writeUint32LE(M+E|0,t,60)}function Ps(t,e,r,i,n){if(n===void 0&&(n=0),t.length!==32)throw new Error("ChaCha: key size must be 32 bytes");if(i.length<r.length)throw new Error("ChaCha: destination is shorter than source");var s,f;if(n===0){if(e.length!==8&&e.length!==12)throw new Error("ChaCha nonce must be 8 or 12 bytes");s=new Uint8Array(16),f=s.length-e.length,s.set(e,f)}else{if(e.length!==16)throw new Error("ChaCha nonce with counter must be 16 bytes");s=e,f=n}for(var u=new Uint8Array(64),h=0;h<r.length;h+=64){dl(u,s,t);for(var c=h;c<h+64&&c<r.length;c++)i[c]=r[c]^u[c-h];yl(s,0,f)}return $i.wipe(u),n===0&&$i.wipe(s),i}Br.streamXOR=Ps;function gl(t,e,r,i){return i===void 0&&(i=0),$i.wipe(r),Ps(t,e,r,r,i)}Br.stream=gl;function yl(t,e,r){for(var i=1;r--;)i=i+(t[e]&255)|0,t[e]=i&255,i>>>=8,e++;if(i>0)throw new Error("ChaCha: counter overflow")}var Ls={},xt={};Object.defineProperty(xt,"__esModule",{value:!0});function pl(t,e,r){return~(t-1)&e|t-1&r}xt.select=pl;function _l(t,e){return(t|0)-(e|0)-1>>>31&1}xt.lessOrEqual=_l;function Ns(t,e){if(t.length!==e.length)return 0;for(var r=0,i=0;i<t.length;i++)r|=t[i]^e[i];return 1&r-1>>>8}xt.compare=Ns;function bl(t,e){return t.length===0||e.length===0?!1:Ns(t,e)!==0}xt.equal=bl,function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=xt,r=at;t.DIGEST_LENGTH=16;var i=function(){function f(u){this.digestLength=t.DIGEST_LENGTH,this._buffer=new Uint8Array(16),this._r=new Uint16Array(10),this._h=new Uint16Array(10),this._pad=new Uint16Array(8),this._leftover=0,this._fin=0,this._finished=!1;var h=u[0]|u[1]<<8;this._r[0]=h&8191;var c=u[2]|u[3]<<8;this._r[1]=(h>>>13|c<<3)&8191;var l=u[4]|u[5]<<8;this._r[2]=(c>>>10|l<<6)&7939;var _=u[6]|u[7]<<8;this._r[3]=(l>>>7|_<<9)&8191;var p=u[8]|u[9]<<8;this._r[4]=(_>>>4|p<<12)&255,this._r[5]=p>>>1&8190;var b=u[10]|u[11]<<8;this._r[6]=(p>>>14|b<<2)&8191;var O=u[12]|u[13]<<8;this._r[7]=(b>>>11|O<<5)&8065;var A=u[14]|u[15]<<8;this._r[8]=(O>>>8|A<<8)&8191,this._r[9]=A>>>5&127,this._pad[0]=u[16]|u[17]<<8,this._pad[1]=u[18]|u[19]<<8,this._pad[2]=u[20]|u[21]<<8,this._pad[3]=u[22]|u[23]<<8,this._pad[4]=u[24]|u[25]<<8,this._pad[5]=u[26]|u[27]<<8,this._pad[6]=u[28]|u[29]<<8,this._pad[7]=u[30]|u[31]<<8}return f.prototype._blocks=function(u,h,c){for(var l=this._fin?0:2048,_=this._h[0],p=this._h[1],b=this._h[2],O=this._h[3],A=this._h[4],L=this._h[5],G=this._h[6],E=this._h[7],R=this._h[8],w=this._h[9],m=this._r[0],g=this._r[1],o=this._r[2],d=this._r[3],N=this._r[4],P=this._r[5],K=this._r[6],V=this._r[7],J=this._r[8],I=this._r[9];c>=16;){var C=u[h+0]|u[h+1]<<8;_+=C&8191;var W=u[h+2]|u[h+3]<<8;p+=(C>>>13|W<<3)&8191;var F=u[h+4]|u[h+5]<<8;b+=(W>>>10|F<<6)&8191;var M=u[h+6]|u[h+7]<<8;O+=(F>>>7|M<<9)&8191;var j=u[h+8]|u[h+9]<<8;A+=(M>>>4|j<<12)&8191,L+=j>>>1&8191;var U=u[h+10]|u[h+11]<<8;G+=(j>>>14|U<<2)&8191;var B=u[h+12]|u[h+13]<<8;E+=(U>>>11|B<<5)&8191;var te=u[h+14]|u[h+15]<<8;R+=(B>>>8|te<<8)&8191,w+=te>>>5|l;var z=0,Q=z;Q+=_*m,Q+=p*(5*I),Q+=b*(5*J),Q+=O*(5*V),Q+=A*(5*K),z=Q>>>13,Q&=8191,Q+=L*(5*P),Q+=G*(5*N),Q+=E*(5*d),Q+=R*(5*o),Q+=w*(5*g),z+=Q>>>13,Q&=8191;var k=z;k+=_*g,k+=p*m,k+=b*(5*I),k+=O*(5*J),k+=A*(5*V),z=k>>>13,k&=8191,k+=L*(5*K),k+=G*(5*P),k+=E*(5*N),k+=R*(5*d),k+=w*(5*o),z+=k>>>13,k&=8191;var ee=z;ee+=_*o,ee+=p*g,ee+=b*m,ee+=O*(5*I),ee+=A*(5*J),z=ee>>>13,ee&=8191,ee+=L*(5*V),ee+=G*(5*K),ee+=E*(5*P),ee+=R*(5*N),ee+=w*(5*d),z+=ee>>>13,ee&=8191;var x=z;x+=_*d,x+=p*o,x+=b*g,x+=O*m,x+=A*(5*I),z=x>>>13,x&=8191,x+=L*(5*J),x+=G*(5*V),x+=E*(5*K),x+=R*(5*P),x+=w*(5*N),z+=x>>>13,x&=8191;var T=z;T+=_*N,T+=p*d,T+=b*o,T+=O*g,T+=A*m,z=T>>>13,T&=8191,T+=L*(5*I),T+=G*(5*J),T+=E*(5*V),T+=R*(5*K),T+=w*(5*P),z+=T>>>13,T&=8191;var D=z;D+=_*P,D+=p*N,D+=b*d,D+=O*o,D+=A*g,z=D>>>13,D&=8191,D+=L*m,D+=G*(5*I),D+=E*(5*J),D+=R*(5*V),D+=w*(5*K),z+=D>>>13,D&=8191;var a=z;a+=_*K,a+=p*P,a+=b*N,a+=O*d,a+=A*o,z=a>>>13,a&=8191,a+=L*g,a+=G*m,a+=E*(5*I),a+=R*(5*J),a+=w*(5*V),z+=a>>>13,a&=8191;var v=z;v+=_*V,v+=p*K,v+=b*P,v+=O*N,v+=A*d,z=v>>>13,v&=8191,v+=L*o,v+=G*g,v+=E*m,v+=R*(5*I),v+=w*(5*J),z+=v>>>13,v&=8191;var H=z;H+=_*J,H+=p*V,H+=b*K,H+=O*P,H+=A*N,z=H>>>13,H&=8191,H+=L*d,H+=G*o,H+=E*g,H+=R*m,H+=w*(5*I),z+=H>>>13,H&=8191;var Y=z;Y+=_*I,Y+=p*J,Y+=b*V,Y+=O*K,Y+=A*P,z=Y>>>13,Y&=8191,Y+=L*N,Y+=G*d,Y+=E*o,Y+=R*g,Y+=w*m,z+=Y>>>13,Y&=8191,z=(z<<2)+z|0,z=z+Q|0,Q=z&8191,z=z>>>13,k+=z,_=Q,p=k,b=ee,O=x,A=T,L=D,G=a,E=v,R=H,w=Y,h+=16,c-=16}this._h[0]=_,this._h[1]=p,this._h[2]=b,this._h[3]=O,this._h[4]=A,this._h[5]=L,this._h[6]=G,this._h[7]=E,this._h[8]=R,this._h[9]=w},f.prototype.finish=function(u,h){h===void 0&&(h=0);var c=new Uint16Array(10),l,_,p,b;if(this._leftover){for(b=this._leftover,this._buffer[b++]=1;b<16;b++)this._buffer[b]=0;this._fin=1,this._blocks(this._buffer,0,16)}for(l=this._h[1]>>>13,this._h[1]&=8191,b=2;b<10;b++)this._h[b]+=l,l=this._h[b]>>>13,this._h[b]&=8191;for(this._h[0]+=l*5,l=this._h[0]>>>13,this._h[0]&=8191,this._h[1]+=l,l=this._h[1]>>>13,this._h[1]&=8191,this._h[2]+=l,c[0]=this._h[0]+5,l=c[0]>>>13,c[0]&=8191,b=1;b<10;b++)c[b]=this._h[b]+l,l=c[b]>>>13,c[b]&=8191;for(c[9]-=8192,_=(l^1)-1,b=0;b<10;b++)c[b]&=_;for(_=~_,b=0;b<10;b++)this._h[b]=this._h[b]&_|c[b];for(this._h[0]=(this._h[0]|this._h[1]<<13)&65535,this._h[1]=(this._h[1]>>>3|this._h[2]<<10)&65535,this._h[2]=(this._h[2]>>>6|this._h[3]<<7)&65535,this._h[3]=(this._h[3]>>>9|this._h[4]<<4)&65535,this._h[4]=(this._h[4]>>>12|this._h[5]<<1|this._h[6]<<14)&65535,this._h[5]=(this._h[6]>>>2|this._h[7]<<11)&65535,this._h[6]=(this._h[7]>>>5|this._h[8]<<8)&65535,this._h[7]=(this._h[8]>>>8|this._h[9]<<5)&65535,p=this._h[0]+this._pad[0],this._h[0]=p&65535,b=1;b<8;b++)p=(this._h[b]+this._pad[b]|0)+(p>>>16)|0,this._h[b]=p&65535;return u[h+0]=this._h[0]>>>0,u[h+1]=this._h[0]>>>8,u[h+2]=this._h[1]>>>0,u[h+3]=this._h[1]>>>8,u[h+4]=this._h[2]>>>0,u[h+5]=this._h[2]>>>8,u[h+6]=this._h[3]>>>0,u[h+7]=this._h[3]>>>8,u[h+8]=this._h[4]>>>0,u[h+9]=this._h[4]>>>8,u[h+10]=this._h[5]>>>0,u[h+11]=this._h[5]>>>8,u[h+12]=this._h[6]>>>0,u[h+13]=this._h[6]>>>8,u[h+14]=this._h[7]>>>0,u[h+15]=this._h[7]>>>8,this._finished=!0,this},f.prototype.update=function(u){var h=0,c=u.length,l;if(this._leftover){l=16-this._leftover,l>c&&(l=c);for(var _=0;_<l;_++)this._buffer[this._leftover+_]=u[h+_];if(c-=l,h+=l,this._leftover+=l,this._leftover<16)return this;this._blocks(this._buffer,0,16),this._leftover=0}if(c>=16&&(l=c-c%16,this._blocks(u,h,l),h+=l,c-=l),c){for(var _=0;_<c;_++)this._buffer[this._leftover+_]=u[h+_];this._leftover+=c}return this},f.prototype.digest=function(){if(this._finished)throw new Error("Poly1305 was finished");var u=new Uint8Array(16);return this.finish(u),u},f.prototype.clean=function(){return r.wipe(this._buffer),r.wipe(this._r),r.wipe(this._h),r.wipe(this._pad),this._leftover=0,this._fin=0,this._finished=!0,this},f}();t.Poly1305=i;function n(f,u){var h=new i(f);h.update(u);var c=h.digest();return h.clean(),c}t.oneTimeAuth=n;function s(f,u){return f.length!==t.DIGEST_LENGTH||u.length!==t.DIGEST_LENGTH?!1:e.equal(f,u)}t.equal=s}(Ls),function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=Br,r=Ls,i=at,n=ie,s=xt;t.KEY_LENGTH=32,t.NONCE_LENGTH=12,t.TAG_LENGTH=16;var f=new Uint8Array(16),u=function(){function h(c){if(this.nonceLength=t.NONCE_LENGTH,this.tagLength=t.TAG_LENGTH,c.length!==t.KEY_LENGTH)throw new Error("ChaCha20Poly1305 needs 32-byte key");this._key=new Uint8Array(c)}return h.prototype.seal=function(c,l,_,p){if(c.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");var b=new Uint8Array(16);b.set(c,b.length-c.length);var O=new Uint8Array(32);e.stream(this._key,b,O,4);var A=l.length+this.tagLength,L;if(p){if(p.length!==A)throw new Error("ChaCha20Poly1305: incorrect destination length");L=p}else L=new Uint8Array(A);return e.streamXOR(this._key,b,l,L,4),this._authenticate(L.subarray(L.length-this.tagLength,L.length),O,L.subarray(0,L.length-this.tagLength),_),i.wipe(b),L},h.prototype.open=function(c,l,_,p){if(c.length>16)throw new Error("ChaCha20Poly1305: incorrect nonce length");if(l.length<this.tagLength)return null;var b=new Uint8Array(16);b.set(c,b.length-c.length);var O=new Uint8Array(32);e.stream(this._key,b,O,4);var A=new Uint8Array(this.tagLength);if(this._authenticate(A,O,l.subarray(0,l.length-this.tagLength),_),!s.equal(A,l.subarray(l.length-this.tagLength,l.length)))return null;var L=l.length-this.tagLength,G;if(p){if(p.length!==L)throw new Error("ChaCha20Poly1305: incorrect destination length");G=p}else G=new Uint8Array(L);return e.streamXOR(this._key,b,l.subarray(0,l.length-this.tagLength),G,4),i.wipe(b),G},h.prototype.clean=function(){return i.wipe(this._key),this},h.prototype._authenticate=function(c,l,_,p){var b=new r.Poly1305(l);p&&(b.update(p),p.length%16>0&&b.update(f.subarray(p.length%16))),b.update(_),_.length%16>0&&b.update(f.subarray(_.length%16));var O=new Uint8Array(8);p&&n.writeUint64LE(p.length,O),b.update(O),n.writeUint64LE(_.length,O),b.update(O);for(var A=b.digest(),L=0;L<A.length;L++)c[L]=A[L];b.clean(),i.wipe(A),i.wipe(O)},h}();t.ChaCha20Poly1305=u}(Mi);var Us={},hr={},ji={};Object.defineProperty(ji,"__esModule",{value:!0});function vl(t){return typeof t.saveState<"u"&&typeof t.restoreState<"u"&&typeof t.cleanSavedState<"u"}ji.isSerializableHash=vl,Object.defineProperty(hr,"__esModule",{value:!0});var mt=ji,wl=xt,ml=at,Ms=function(){function t(e,r){this._finished=!1,this._inner=new e,this._outer=new e,this.blockSize=this._outer.blockSize,this.digestLength=this._outer.digestLength;var i=new Uint8Array(this.blockSize);r.length>this.blockSize?this._inner.update(r).finish(i).clean():i.set(r);for(var n=0;n<i.length;n++)i[n]^=54;this._inner.update(i);for(var n=0;n<i.length;n++)i[n]^=106;this._outer.update(i),mt.isSerializableHash(this._inner)&&mt.isSerializableHash(this._outer)&&(this._innerKeyedState=this._inner.saveState(),this._outerKeyedState=this._outer.saveState()),ml.wipe(i)}return t.prototype.reset=function(){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't reset() because hash doesn't implement restoreState()");return this._inner.restoreState(this._innerKeyedState),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.clean=function(){mt.isSerializableHash(this._inner)&&this._inner.cleanSavedState(this._innerKeyedState),mt.isSerializableHash(this._outer)&&this._outer.cleanSavedState(this._outerKeyedState),this._inner.clean(),this._outer.clean()},t.prototype.update=function(e){return this._inner.update(e),this},t.prototype.finish=function(e){return this._finished?(this._outer.finish(e),this):(this._inner.finish(e),this._outer.update(e.subarray(0,this.digestLength)).finish(e),this._finished=!0,this)},t.prototype.digest=function(){var e=new Uint8Array(this.digestLength);return this.finish(e),e},t.prototype.saveState=function(){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't saveState() because hash doesn't implement it");return this._inner.saveState()},t.prototype.restoreState=function(e){if(!mt.isSerializableHash(this._inner)||!mt.isSerializableHash(this._outer))throw new Error("hmac: can't restoreState() because hash doesn't implement it");return this._inner.restoreState(e),this._outer.restoreState(this._outerKeyedState),this._finished=!1,this},t.prototype.cleanSavedState=function(e){if(!mt.isSerializableHash(this._inner))throw new Error("hmac: can't cleanSavedState() because hash doesn't implement it");this._inner.cleanSavedState(e)},t}();hr.HMAC=Ms;function El(t,e,r){var i=new Ms(t,e);i.update(r);var n=i.digest();return i.clean(),n}hr.hmac=El,hr.equal=wl.equal,Object.defineProperty(Us,"__esModule",{value:!0});var $s=hr,js=at,Dl=function(){function t(e,r,i,n){i===void 0&&(i=new Uint8Array(0)),this._counter=new Uint8Array(1),this._hash=e,this._info=n;var s=$s.hmac(this._hash,i,r);this._hmac=new $s.HMAC(e,s),this._buffer=new Uint8Array(this._hmac.digestLength),this._bufpos=this._buffer.length}return t.prototype._fillBuffer=function(){this._counter[0]++;var e=this._counter[0];if(e===0)throw new Error("hkdf: cannot expand more");this._hmac.reset(),e>1&&this._hmac.update(this._buffer),this._info&&this._hmac.update(this._info),this._hmac.update(this._counter),this._hmac.finish(this._buffer),this._bufpos=0},t.prototype.expand=function(e){for(var r=new Uint8Array(e),i=0;i<r.length;i++)this._bufpos===this._buffer.length&&this._fillBuffer(),r[i]=this._buffer[this._bufpos++];return r},t.prototype.clean=function(){this._hmac.clean(),js.wipe(this._buffer),js.wipe(this._counter),this._bufpos=0},t}(),Sl=Us.HKDF=Dl,zr={};(function(t){Object.defineProperty(t,"__esModule",{value:!0});var e=ie,r=at;t.DIGEST_LENGTH=32,t.BLOCK_SIZE=64;var i=function(){function u(){this.digestLength=t.DIGEST_LENGTH,this.blockSize=t.BLOCK_SIZE,this._state=new Int32Array(8),this._temp=new Int32Array(64),this._buffer=new Uint8Array(128),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this.reset()}return u.prototype._initState=function(){this._state[0]=1779033703,this._state[1]=3144134277,this._state[2]=1013904242,this._state[3]=2773480762,this._state[4]=1359893119,this._state[5]=2600822924,this._state[6]=528734635,this._state[7]=1541459225},u.prototype.reset=function(){return this._initState(),this._bufferLength=0,this._bytesHashed=0,this._finished=!1,this},u.prototype.clean=function(){r.wipe(this._buffer),r.wipe(this._temp),this.reset()},u.prototype.update=function(h,c){if(c===void 0&&(c=h.length),this._finished)throw new Error("SHA256: can't update because hash was finished.");var l=0;if(this._bytesHashed+=c,this._bufferLength>0){for(;this._bufferLength<this.blockSize&&c>0;)this._buffer[this._bufferLength++]=h[l++],c--;this._bufferLength===this.blockSize&&(s(this._temp,this._state,this._buffer,0,this.blockSize),this._bufferLength=0)}for(c>=this.blockSize&&(l=s(this._temp,this._state,h,l,c),c%=this.blockSize);c>0;)this._buffer[this._bufferLength++]=h[l++],c--;return this},u.prototype.finish=function(h){if(!this._finished){var c=this._bytesHashed,l=this._bufferLength,_=c/536870912|0,p=c<<3,b=c%64<56?64:128;this._buffer[l]=128;for(var O=l+1;O<b-8;O++)this._buffer[O]=0;e.writeUint32BE(_,this._buffer,b-8),e.writeUint32BE(p,this._buffer,b-4),s(this._temp,this._state,this._buffer,0,b),this._finished=!0}for(var O=0;O<this.digestLength/4;O++)e.writeUint32BE(this._state[O],h,O*4);return this},u.prototype.digest=function(){var h=new Uint8Array(this.digestLength);return this.finish(h),h},u.prototype.saveState=function(){if(this._finished)throw new Error("SHA256: cannot save finished state");return{state:new Int32Array(this._state),buffer:this._bufferLength>0?new Uint8Array(this._buffer):void 0,bufferLength:this._bufferLength,bytesHashed:this._bytesHashed}},u.prototype.restoreState=function(h){return this._state.set(h.state),this._bufferLength=h.bufferLength,h.buffer&&this._buffer.set(h.buffer),this._bytesHashed=h.bytesHashed,this._finished=!1,this},u.prototype.cleanSavedState=function(h){r.wipe(h.state),h.buffer&&r.wipe(h.buffer),h.bufferLength=0,h.bytesHashed=0},u}();t.SHA256=i;var n=new Int32Array([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]);function s(u,h,c,l,_){for(;_>=64;){for(var p=h[0],b=h[1],O=h[2],A=h[3],L=h[4],G=h[5],E=h[6],R=h[7],w=0;w<16;w++){var m=l+w*4;u[w]=e.readUint32BE(c,m)}for(var w=16;w<64;w++){var g=u[w-2],o=(g>>>17|g<<32-17)^(g>>>19|g<<32-19)^g>>>10;g=u[w-15];var d=(g>>>7|g<<32-7)^(g>>>18|g<<32-18)^g>>>3;u[w]=(o+u[w-7]|0)+(d+u[w-16]|0)}for(var w=0;w<64;w++){var o=(((L>>>6|L<<26)^(L>>>11|L<<21)^(L>>>25|L<<7))+(L&G^~L&E)|0)+(R+(n[w]+u[w]|0)|0)|0,d=((p>>>2|p<<32-2)^(p>>>13|p<<32-13)^(p>>>22|p<<32-22))+(p&b^p&O^b&O)|0;R=E,E=G,G=L,L=A+o|0,A=O,O=b,b=p,p=o+d|0}h[0]+=p,h[1]+=b,h[2]+=O,h[3]+=A,h[4]+=L,h[5]+=G,h[6]+=E,h[7]+=R,l+=64,_-=64}return l}function f(u){var h=new i;h.update(u);var c=h.digest();return h.clean(),c}t.hash=f})(zr);var Fi={};(function(t){Object.defineProperty(t,"__esModule",{value:!0}),t.sharedKey=t.generateKeyPair=t.generateKeyPairFromSeed=t.scalarMultBase=t.scalarMult=t.SHARED_KEY_LENGTH=t.SECRET_KEY_LENGTH=t.PUBLIC_KEY_LENGTH=void 0;const e=Yt,r=at;t.PUBLIC_KEY_LENGTH=32,t.SECRET_KEY_LENGTH=32,t.SHARED_KEY_LENGTH=32;function i(w){const m=new Float64Array(16);if(w)for(let g=0;g<w.length;g++)m[g]=w[g];return m}const n=new Uint8Array(32);n[0]=9;const s=i([56129,1]);function f(w){let m=1;for(let g=0;g<16;g++){let o=w[g]+m+65535;m=Math.floor(o/65536),w[g]=o-m*65536}w[0]+=m-1+37*(m-1)}function u(w,m,g){const o=~(g-1);for(let d=0;d<16;d++){const N=o&(w[d]^m[d]);w[d]^=N,m[d]^=N}}function h(w,m){const g=i(),o=i();for(let d=0;d<16;d++)o[d]=m[d];f(o),f(o),f(o);for(let d=0;d<2;d++){g[0]=o[0]-65517;for(let P=1;P<15;P++)g[P]=o[P]-65535-(g[P-1]>>16&1),g[P-1]&=65535;g[15]=o[15]-32767-(g[14]>>16&1);const N=g[15]>>16&1;g[14]&=65535,u(o,g,1-N)}for(let d=0;d<16;d++)w[2*d]=o[d]&255,w[2*d+1]=o[d]>>8}function c(w,m){for(let g=0;g<16;g++)w[g]=m[2*g]+(m[2*g+1]<<8);w[15]&=32767}function l(w,m,g){for(let o=0;o<16;o++)w[o]=m[o]+g[o]}function _(w,m,g){for(let o=0;o<16;o++)w[o]=m[o]-g[o]}function p(w,m,g){let o,d,N=0,P=0,K=0,V=0,J=0,I=0,C=0,W=0,F=0,M=0,j=0,U=0,B=0,te=0,z=0,Q=0,k=0,ee=0,x=0,T=0,D=0,a=0,v=0,H=0,Y=0,he=0,_e=0,de=0,we=0,Ue=0,Ae=0,pe=g[0],ge=g[1],le=g[2],ue=g[3],ce=g[4],ae=g[5],oe=g[6],re=g[7],fe=g[8],ye=g[9],ne=g[10],be=g[11],ve=g[12],Se=g[13],Oe=g[14],me=g[15];o=m[0],N+=o*pe,P+=o*ge,K+=o*le,V+=o*ue,J+=o*ce,I+=o*ae,C+=o*oe,W+=o*re,F+=o*fe,M+=o*ye,j+=o*ne,U+=o*be,B+=o*ve,te+=o*Se,z+=o*Oe,Q+=o*me,o=m[1],P+=o*pe,K+=o*ge,V+=o*le,J+=o*ue,I+=o*ce,C+=o*ae,W+=o*oe,F+=o*re,M+=o*fe,j+=o*ye,U+=o*ne,B+=o*be,te+=o*ve,z+=o*Se,Q+=o*Oe,k+=o*me,o=m[2],K+=o*pe,V+=o*ge,J+=o*le,I+=o*ue,C+=o*ce,W+=o*ae,F+=o*oe,M+=o*re,j+=o*fe,U+=o*ye,B+=o*ne,te+=o*be,z+=o*ve,Q+=o*Se,k+=o*Oe,ee+=o*me,o=m[3],V+=o*pe,J+=o*ge,I+=o*le,C+=o*ue,W+=o*ce,F+=o*ae,M+=o*oe,j+=o*re,U+=o*fe,B+=o*ye,te+=o*ne,z+=o*be,Q+=o*ve,k+=o*Se,ee+=o*Oe,x+=o*me,o=m[4],J+=o*pe,I+=o*ge,C+=o*le,W+=o*ue,F+=o*ce,M+=o*ae,j+=o*oe,U+=o*re,B+=o*fe,te+=o*ye,z+=o*ne,Q+=o*be,k+=o*ve,ee+=o*Se,x+=o*Oe,T+=o*me,o=m[5],I+=o*pe,C+=o*ge,W+=o*le,F+=o*ue,M+=o*ce,j+=o*ae,U+=o*oe,B+=o*re,te+=o*fe,z+=o*ye,Q+=o*ne,k+=o*be,ee+=o*ve,x+=o*Se,T+=o*Oe,D+=o*me,o=m[6],C+=o*pe,W+=o*ge,F+=o*le,M+=o*ue,j+=o*ce,U+=o*ae,B+=o*oe,te+=o*re,z+=o*fe,Q+=o*ye,k+=o*ne,ee+=o*be,x+=o*ve,T+=o*Se,D+=o*Oe,a+=o*me,o=m[7],W+=o*pe,F+=o*ge,M+=o*le,j+=o*ue,U+=o*ce,B+=o*ae,te+=o*oe,z+=o*re,Q+=o*fe,k+=o*ye,ee+=o*ne,x+=o*be,T+=o*ve,D+=o*Se,a+=o*Oe,v+=o*me,o=m[8],F+=o*pe,M+=o*ge,j+=o*le,U+=o*ue,B+=o*ce,te+=o*ae,z+=o*oe,Q+=o*re,k+=o*fe,ee+=o*ye,x+=o*ne,T+=o*be,D+=o*ve,a+=o*Se,v+=o*Oe,H+=o*me,o=m[9],M+=o*pe,j+=o*ge,U+=o*le,B+=o*ue,te+=o*ce,z+=o*ae,Q+=o*oe,k+=o*re,ee+=o*fe,x+=o*ye,T+=o*ne,D+=o*be,a+=o*ve,v+=o*Se,H+=o*Oe,Y+=o*me,o=m[10],j+=o*pe,U+=o*ge,B+=o*le,te+=o*ue,z+=o*ce,Q+=o*ae,k+=o*oe,ee+=o*re,x+=o*fe,T+=o*ye,D+=o*ne,a+=o*be,v+=o*ve,H+=o*Se,Y+=o*Oe,he+=o*me,o=m[11],U+=o*pe,B+=o*ge,te+=o*le,z+=o*ue,Q+=o*ce,k+=o*ae,ee+=o*oe,x+=o*re,T+=o*fe,D+=o*ye,a+=o*ne,v+=o*be,H+=o*ve,Y+=o*Se,he+=o*Oe,_e+=o*me,o=m[12],B+=o*pe,te+=o*ge,z+=o*le,Q+=o*ue,k+=o*ce,ee+=o*ae,x+=o*oe,T+=o*re,D+=o*fe,a+=o*ye,v+=o*ne,H+=o*be,Y+=o*ve,he+=o*Se,_e+=o*Oe,de+=o*me,o=m[13],te+=o*pe,z+=o*ge,Q+=o*le,k+=o*ue,ee+=o*ce,x+=o*ae,T+=o*oe,D+=o*re,a+=o*fe,v+=o*ye,H+=o*ne,Y+=o*be,he+=o*ve,_e+=o*Se,de+=o*Oe,we+=o*me,o=m[14],z+=o*pe,Q+=o*ge,k+=o*le,ee+=o*ue,x+=o*ce,T+=o*ae,D+=o*oe,a+=o*re,v+=o*fe,H+=o*ye,Y+=o*ne,he+=o*be,_e+=o*ve,de+=o*Se,we+=o*Oe,Ue+=o*me,o=m[15],Q+=o*pe,k+=o*ge,ee+=o*le,x+=o*ue,T+=o*ce,D+=o*ae,a+=o*oe,v+=o*re,H+=o*fe,Y+=o*ye,he+=o*ne,_e+=o*be,de+=o*ve,we+=o*Se,Ue+=o*Oe,Ae+=o*me,N+=38*k,P+=38*ee,K+=38*x,V+=38*T,J+=38*D,I+=38*a,C+=38*v,W+=38*H,F+=38*Y,M+=38*he,j+=38*_e,U+=38*de,B+=38*we,te+=38*Ue,z+=38*Ae,d=1,o=N+d+65535,d=Math.floor(o/65536),N=o-d*65536,o=P+d+65535,d=Math.floor(o/65536),P=o-d*65536,o=K+d+65535,d=Math.floor(o/65536),K=o-d*65536,o=V+d+65535,d=Math.floor(o/65536),V=o-d*65536,o=J+d+65535,d=Math.floor(o/65536),J=o-d*65536,o=I+d+65535,d=Math.floor(o/65536),I=o-d*65536,o=C+d+65535,d=Math.floor(o/65536),C=o-d*65536,o=W+d+65535,d=Math.floor(o/65536),W=o-d*65536,o=F+d+65535,d=Math.floor(o/65536),F=o-d*65536,o=M+d+65535,d=Math.floor(o/65536),M=o-d*65536,o=j+d+65535,d=Math.floor(o/65536),j=o-d*65536,o=U+d+65535,d=Math.floor(o/65536),U=o-d*65536,o=B+d+65535,d=Math.floor(o/65536),B=o-d*65536,o=te+d+65535,d=Math.floor(o/65536),te=o-d*65536,o=z+d+65535,d=Math.floor(o/65536),z=o-d*65536,o=Q+d+65535,d=Math.floor(o/65536),Q=o-d*65536,N+=d-1+37*(d-1),d=1,o=N+d+65535,d=Math.floor(o/65536),N=o-d*65536,o=P+d+65535,d=Math.floor(o/65536),P=o-d*65536,o=K+d+65535,d=Math.floor(o/65536),K=o-d*65536,o=V+d+65535,d=Math.floor(o/65536),V=o-d*65536,o=J+d+65535,d=Math.floor(o/65536),J=o-d*65536,o=I+d+65535,d=Math.floor(o/65536),I=o-d*65536,o=C+d+65535,d=Math.floor(o/65536),C=o-d*65536,o=W+d+65535,d=Math.floor(o/65536),W=o-d*65536,o=F+d+65535,d=Math.floor(o/65536),F=o-d*65536,o=M+d+65535,d=Math.floor(o/65536),M=o-d*65536,o=j+d+65535,d=Math.floor(o/65536),j=o-d*65536,o=U+d+65535,d=Math.floor(o/65536),U=o-d*65536,o=B+d+65535,d=Math.floor(o/65536),B=o-d*65536,o=te+d+65535,d=Math.floor(o/65536),te=o-d*65536,o=z+d+65535,d=Math.floor(o/65536),z=o-d*65536,o=Q+d+65535,d=Math.floor(o/65536),Q=o-d*65536,N+=d-1+37*(d-1),w[0]=N,w[1]=P,w[2]=K,w[3]=V,w[4]=J,w[5]=I,w[6]=C,w[7]=W,w[8]=F,w[9]=M,w[10]=j,w[11]=U,w[12]=B,w[13]=te,w[14]=z,w[15]=Q}function b(w,m){p(w,m,m)}function O(w,m){const g=i();for(let o=0;o<16;o++)g[o]=m[o];for(let o=253;o>=0;o--)b(g,g),o!==2&&o!==4&&p(g,g,m);for(let o=0;o<16;o++)w[o]=g[o]}function A(w,m){const g=new Uint8Array(32),o=new Float64Array(80),d=i(),N=i(),P=i(),K=i(),V=i(),J=i();for(let F=0;F<31;F++)g[F]=w[F];g[31]=w[31]&127|64,g[0]&=248,c(o,m);for(let F=0;F<16;F++)N[F]=o[F];d[0]=K[0]=1;for(let F=254;F>=0;--F){const M=g[F>>>3]>>>(F&7)&1;u(d,N,M),u(P,K,M),l(V,d,P),_(d,d,P),l(P,N,K),_(N,N,K),b(K,V),b(J,d),p(d,P,d),p(P,N,V),l(V,d,P),_(d,d,P),b(N,d),_(P,K,J),p(d,P,s),l(d,d,K),p(P,P,d),p(d,K,J),p(K,N,o),b(N,V),u(d,N,M),u(P,K,M)}for(let F=0;F<16;F++)o[F+16]=d[F],o[F+32]=P[F],o[F+48]=N[F],o[F+64]=K[F];const I=o.subarray(32),C=o.subarray(16);O(I,I),p(C,C,I);const W=new Uint8Array(32);return h(W,C),W}t.scalarMult=A;function L(w){return A(w,n)}t.scalarMultBase=L;function G(w){if(w.length!==t.SECRET_KEY_LENGTH)throw new Error(`x25519: seed must be ${t.SECRET_KEY_LENGTH} bytes`);const m=new Uint8Array(w);return{publicKey:L(m),secretKey:m}}t.generateKeyPairFromSeed=G;function E(w){const m=(0,e.randomBytes)(32,w),g=G(m);return(0,r.wipe)(m),g}t.generateKeyPair=E;function R(w,m,g=!1){if(w.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect secret key length");if(m.length!==t.PUBLIC_KEY_LENGTH)throw new Error("X25519: incorrect public key length");const o=A(w,m);if(g){let d=0;for(let N=0;N<o.length;N++)d|=o[N];if(d===0)throw new Error("X25519: invalid shared key")}return o}t.sharedKey=R})(Fi);var Fs=function(t,e,r){if(r||arguments.length===2)for(var i=0,n=e.length,s;i<n;i++)(s||!(i in e))&&(s||(s=Array.prototype.slice.call(e,0,i)),s[i]=e[i]);return t.concat(s||Array.prototype.slice.call(e))},Ol=function(){function t(e,r,i){this.name=e,this.version=r,this.os=i,this.type="browser"}return t}(),Il=function(){function t(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return t}(),Tl=function(){function t(e,r,i,n){this.name=e,this.version=r,this.os=i,this.bot=n,this.type="bot-device"}return t}(),xl=function(){function t(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return t}(),Rl=function(){function t(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return t}(),Cl=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,Al=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,Bs=3,Pl=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",Cl]],zs=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function Ll(t){return t?Ks(t):typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new Rl:typeof navigator<"u"?Ks(navigator.userAgent):Ml()}function Nl(t){return t!==""&&Pl.reduce(function(e,r){var i=r[0],n=r[1];if(e)return e;var s=n.exec(t);return!!s&&[i,s]},!1)}function Ks(t){var e=Nl(t);if(!e)return null;var r=e[0],i=e[1];if(r==="searchbot")return new xl;var n=i[1]&&i[1].split(".").join("_").split("_").slice(0,3);n?n.length<Bs&&(n=Fs(Fs([],n,!0),$l(Bs-n.length),!0)):n=[];var s=n.join("."),f=Ul(t),u=Al.exec(t);return u&&u[1]?new Tl(r,s,f,u[1]):new Ol(r,s,f)}function Ul(t){for(var e=0,r=zs.length;e<r;e++){var i=zs[e],n=i[0],s=i[1],f=s.exec(t);if(f)return n}return null}function Ml(){var t=typeof process<"u"&&process.version;return t?new Il(process.version.slice(1)):null}function $l(t){for(var e=[],r=0;r<t;r++)e.push("0");return e}var Te={};Object.defineProperty(Te,"__esModule",{value:!0}),Te.getLocalStorage=Te.getLocalStorageOrThrow=Te.getCrypto=Te.getCryptoOrThrow=Hs=Te.getLocation=Te.getLocationOrThrow=zi=Te.getNavigator=Te.getNavigatorOrThrow=Bi=Te.getDocument=Te.getDocumentOrThrow=Te.getFromWindowOrThrow=Te.getFromWindow=void 0;function Bt(t){let e;return typeof window<"u"&&typeof window[t]<"u"&&(e=window[t]),e}Te.getFromWindow=Bt;function kt(t){const e=Bt(t);if(!e)throw new Error(`${t} is not defined in Window`);return e}Te.getFromWindowOrThrow=kt;function jl(){return kt("document")}Te.getDocumentOrThrow=jl;function Fl(){return Bt("document")}var Bi=Te.getDocument=Fl;function Bl(){return kt("navigator")}Te.getNavigatorOrThrow=Bl;function zl(){return Bt("navigator")}var zi=Te.getNavigator=zl;function Kl(){return kt("location")}Te.getLocationOrThrow=Kl;function Hl(){return Bt("location")}var Hs=Te.getLocation=Hl;function Gl(){return kt("crypto")}Te.getCryptoOrThrow=Gl;function Vl(){return Bt("crypto")}Te.getCrypto=Vl;function ql(){return kt("localStorage")}Te.getLocalStorageOrThrow=ql;function Wl(){return Bt("localStorage")}Te.getLocalStorage=Wl;var Ki={};Object.defineProperty(Ki,"__esModule",{value:!0}),Ki.getWindowMetadata=void 0;const Gs=Te;function Yl(){let t,e;try{t=Gs.getDocumentOrThrow(),e=Gs.getLocationOrThrow()}catch{return null}function r(){const _=t.getElementsByTagName("link"),p=[];for(let b=0;b<_.length;b++){const O=_[b],A=O.getAttribute("rel");if(A&&A.toLowerCase().indexOf("icon")>-1){const L=O.getAttribute("href");if(L)if(L.toLowerCase().indexOf("https:")===-1&&L.toLowerCase().indexOf("http:")===-1&&L.indexOf("//")!==0){let G=e.protocol+"//"+e.host;if(L.indexOf("/")===0)G+=L;else{const E=e.pathname.split("/");E.pop();const R=E.join("/");G+=R+"/"+L}p.push(G)}else if(L.indexOf("//")===0){const G=e.protocol+L;p.push(G)}else p.push(L)}}return p}function i(..._){const p=t.getElementsByTagName("meta");for(let b=0;b<p.length;b++){const O=p[b],A=["itemprop","property","name"].map(L=>O.getAttribute(L)).filter(L=>L?_.includes(L):!1);if(A.length&&A){const L=O.getAttribute("content");if(L)return L}}return""}function n(){let _=i("name","og:site_name","og:title","twitter:title");return _||(_=t.title),_}function s(){return i("description","og:description","twitter:description","keywords")}const f=n(),u=s(),h=e.origin,c=r();return{description:u,url:h,icons:c,name:f}}Ki.getWindowMetadata=Yl;var lr={},kl=t=>encodeURIComponent(t).replace(/[!'()*]/g,e=>`%${e.charCodeAt(0).toString(16).toUpperCase()}`),Vs="%[a-f0-9]{2}",qs=new RegExp("("+Vs+")|([^%]+?)","gi"),Ws=new RegExp("("+Vs+")+","gi");function Hi(t,e){try{return[decodeURIComponent(t.join(""))]}catch{}if(t.length===1)return t;e=e||1;var r=t.slice(0,e),i=t.slice(e);return Array.prototype.concat.call([],Hi(r),Hi(i))}function Xl(t){try{return decodeURIComponent(t)}catch{for(var e=t.match(qs)||[],r=1;r<e.length;r++)t=Hi(e,r).join(""),e=t.match(qs)||[];return t}}function Jl(t){for(var e={"%FE%FF":"\uFFFD\uFFFD","%FF%FE":"\uFFFD\uFFFD"},r=Ws.exec(t);r;){try{e[r[0]]=decodeURIComponent(r[0])}catch{var i=Xl(r[0]);i!==r[0]&&(e[r[0]]=i)}r=Ws.exec(t)}e["%C2"]="\uFFFD";for(var n=Object.keys(e),s=0;s<n.length;s++){var f=n[s];t=t.replace(new RegExp(f,"g"),e[f])}return t}var Ql=function(t){if(typeof t!="string")throw new TypeError("Expected `encodedURI` to be of type `string`, got `"+typeof t+"`");try{return t=t.replace(/\+/g," "),decodeURIComponent(t)}catch{return Jl(t)}},Zl=(t,e)=>{if(!(typeof t=="string"&&typeof e=="string"))throw new TypeError("Expected the arguments to be of type `string`");if(e==="")return[t];const r=t.indexOf(e);return r===-1?[t]:[t.slice(0,r),t.slice(r+e.length)]},ed=function(t,e){for(var r={},i=Object.keys(t),n=Array.isArray(e),s=0;s<i.length;s++){var f=i[s],u=t[f];(n?e.indexOf(f)!==-1:e(f,u,t))&&(r[f]=u)}return r};(function(t){const e=kl,r=Ql,i=Zl,n=ed,s=E=>E==null,f=Symbol("encodeFragmentIdentifier");function u(E){switch(E.arrayFormat){case"index":return R=>(w,m)=>{const g=w.length;return m===void 0||E.skipNull&&m===null||E.skipEmptyString&&m===""?w:m===null?[...w,[l(R,E),"[",g,"]"].join("")]:[...w,[l(R,E),"[",l(g,E),"]=",l(m,E)].join("")]};case"bracket":return R=>(w,m)=>m===void 0||E.skipNull&&m===null||E.skipEmptyString&&m===""?w:m===null?[...w,[l(R,E),"[]"].join("")]:[...w,[l(R,E),"[]=",l(m,E)].join("")];case"colon-list-separator":return R=>(w,m)=>m===void 0||E.skipNull&&m===null||E.skipEmptyString&&m===""?w:m===null?[...w,[l(R,E),":list="].join("")]:[...w,[l(R,E),":list=",l(m,E)].join("")];case"comma":case"separator":case"bracket-separator":{const R=E.arrayFormat==="bracket-separator"?"[]=":"=";return w=>(m,g)=>g===void 0||E.skipNull&&g===null||E.skipEmptyString&&g===""?m:(g=g===null?"":g,m.length===0?[[l(w,E),R,l(g,E)].join("")]:[[m,l(g,E)].join(E.arrayFormatSeparator)])}default:return R=>(w,m)=>m===void 0||E.skipNull&&m===null||E.skipEmptyString&&m===""?w:m===null?[...w,l(R,E)]:[...w,[l(R,E),"=",l(m,E)].join("")]}}function h(E){let R;switch(E.arrayFormat){case"index":return(w,m,g)=>{if(R=/\[(\d*)\]$/.exec(w),w=w.replace(/\[\d*\]$/,""),!R){g[w]=m;return}g[w]===void 0&&(g[w]={}),g[w][R[1]]=m};case"bracket":return(w,m,g)=>{if(R=/(\[\])$/.exec(w),w=w.replace(/\[\]$/,""),!R){g[w]=m;return}if(g[w]===void 0){g[w]=[m];return}g[w]=[].concat(g[w],m)};case"colon-list-separator":return(w,m,g)=>{if(R=/(:list)$/.exec(w),w=w.replace(/:list$/,""),!R){g[w]=m;return}if(g[w]===void 0){g[w]=[m];return}g[w]=[].concat(g[w],m)};case"comma":case"separator":return(w,m,g)=>{const o=typeof m=="string"&&m.includes(E.arrayFormatSeparator),d=typeof m=="string"&&!o&&_(m,E).includes(E.arrayFormatSeparator);m=d?_(m,E):m;const N=o||d?m.split(E.arrayFormatSeparator).map(P=>_(P,E)):m===null?m:_(m,E);g[w]=N};case"bracket-separator":return(w,m,g)=>{const o=/(\[\])$/.test(w);if(w=w.replace(/\[\]$/,""),!o){g[w]=m&&_(m,E);return}const d=m===null?[]:m.split(E.arrayFormatSeparator).map(N=>_(N,E));if(g[w]===void 0){g[w]=d;return}g[w]=[].concat(g[w],d)};default:return(w,m,g)=>{if(g[w]===void 0){g[w]=m;return}g[w]=[].concat(g[w],m)}}}function c(E){if(typeof E!="string"||E.length!==1)throw new TypeError("arrayFormatSeparator must be single character string")}function l(E,R){return R.encode?R.strict?e(E):encodeURIComponent(E):E}function _(E,R){return R.decode?r(E):E}function p(E){return Array.isArray(E)?E.sort():typeof E=="object"?p(Object.keys(E)).sort((R,w)=>Number(R)-Number(w)).map(R=>E[R]):E}function b(E){const R=E.indexOf("#");return R!==-1&&(E=E.slice(0,R)),E}function O(E){let R="";const w=E.indexOf("#");return w!==-1&&(R=E.slice(w)),R}function A(E){E=b(E);const R=E.indexOf("?");return R===-1?"":E.slice(R+1)}function L(E,R){return R.parseNumbers&&!Number.isNaN(Number(E))&&typeof E=="string"&&E.trim()!==""?E=Number(E):R.parseBooleans&&E!==null&&(E.toLowerCase()==="true"||E.toLowerCase()==="false")&&(E=E.toLowerCase()==="true"),E}function G(E,R){R=Object.assign({decode:!0,sort:!0,arrayFormat:"none",arrayFormatSeparator:",",parseNumbers:!1,parseBooleans:!1},R),c(R.arrayFormatSeparator);const w=h(R),m=Object.create(null);if(typeof E!="string"||(E=E.trim().replace(/^[?#&]/,""),!E))return m;for(const g of E.split("&")){if(g==="")continue;let[o,d]=i(R.decode?g.replace(/\+/g," "):g,"=");d=d===void 0?null:["comma","separator","bracket-separator"].includes(R.arrayFormat)?d:_(d,R),w(_(o,R),d,m)}for(const g of Object.keys(m)){const o=m[g];if(typeof o=="object"&&o!==null)for(const d of Object.keys(o))o[d]=L(o[d],R);else m[g]=L(o,R)}return R.sort===!1?m:(R.sort===!0?Object.keys(m).sort():Object.keys(m).sort(R.sort)).reduce((g,o)=>{const d=m[o];return d&&typeof d=="object"&&!Array.isArray(d)?g[o]=p(d):g[o]=d,g},Object.create(null))}t.extract=A,t.parse=G,t.stringify=(E,R)=>{if(!E)return"";R=Object.assign({encode:!0,strict:!0,arrayFormat:"none",arrayFormatSeparator:","},R),c(R.arrayFormatSeparator);const w=d=>R.skipNull&&s(E[d])||R.skipEmptyString&&E[d]==="",m=u(R),g={};for(const d of Object.keys(E))w(d)||(g[d]=E[d]);const o=Object.keys(g);return R.sort!==!1&&o.sort(R.sort),o.map(d=>{const N=E[d];return N===void 0?"":N===null?l(d,R):Array.isArray(N)?N.length===0&&R.arrayFormat==="bracket-separator"?l(d,R)+"[]":N.reduce(m(d),[]).join("&"):l(d,R)+"="+l(N,R)}).filter(d=>d.length>0).join("&")},t.parseUrl=(E,R)=>{R=Object.assign({decode:!0},R);const[w,m]=i(E,"#");return Object.assign({url:w.split("?")[0]||"",query:G(A(E),R)},R&&R.parseFragmentIdentifier&&m?{fragmentIdentifier:_(m,R)}:{})},t.stringifyUrl=(E,R)=>{R=Object.assign({encode:!0,strict:!0,[f]:!0},R);const w=b(E.url).split("?")[0]||"",m=t.extract(E.url),g=t.parse(m,{sort:!1}),o=Object.assign(g,E.query);let d=t.stringify(o,R);d&&(d=`?${d}`);let N=O(E.url);return E.fragmentIdentifier&&(N=`#${R[f]?l(E.fragmentIdentifier,R):E.fragmentIdentifier}`),`${w}${d}${N}`},t.pick=(E,R,w)=>{w=Object.assign({parseFragmentIdentifier:!0,[f]:!1},w);const{url:m,query:g,fragmentIdentifier:o}=t.parseUrl(E,w);return t.stringifyUrl({url:m,query:n(g,R),fragmentIdentifier:o},w)},t.exclude=(E,R,w)=>{const m=Array.isArray(R)?g=>!R.includes(g):(g,o)=>!R(g,o);return t.pick(E,m,w)}})(lr);const td={waku:{publish:"waku_publish",batchPublish:"waku_batchPublish",subscribe:"waku_subscribe",batchSubscribe:"waku_batchSubscribe",subscription:"waku_subscription",unsubscribe:"waku_unsubscribe",batchUnsubscribe:"waku_batchUnsubscribe"},irn:{publish:"irn_publish",batchPublish:"irn_batchPublish",subscribe:"irn_subscribe",batchSubscribe:"irn_batchSubscribe",subscription:"irn_subscription",unsubscribe:"irn_unsubscribe",batchUnsubscribe:"irn_batchUnsubscribe"},iridium:{publish:"iridium_publish",batchPublish:"iridium_batchPublish",subscribe:"iridium_subscribe",batchSubscribe:"iridium_batchSubscribe",subscription:"iridium_subscription",unsubscribe:"iridium_unsubscribe",batchUnsubscribe:"iridium_batchUnsubscribe"}},Ys="base10",nt="base16",Gi="base64pad",Vi="utf8",ks=0,Xt=1,rd=0,Xs=1,qi=12,Wi=32;function id(){const t=Fi.generateKeyPair();return{privateKey:rt(t.secretKey,nt),publicKey:rt(t.publicKey,nt)}}function Yi(){const t=Yt.randomBytes(Wi);return rt(t,nt)}function nd(t,e){const r=Fi.sharedKey(it(t,nt),it(e,nt),!0),i=new Sl(zr.SHA256,r).expand(Wi);return rt(i,nt)}function sd(t){const e=zr.hash(it(t,nt));return rt(e,nt)}function ki(t){const e=zr.hash(it(t,Vi));return rt(e,nt)}function od(t){return it(`${t}`,Ys)}function dr(t){return Number(rt(t,Ys))}function ad(t){const e=od(typeof t.type<"u"?t.type:ks);if(dr(e)===Xt&&typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");const r=typeof t.senderPublicKey<"u"?it(t.senderPublicKey,nt):void 0,i=typeof t.iv<"u"?it(t.iv,nt):Yt.randomBytes(qi),n=new Mi.ChaCha20Poly1305(it(t.symKey,nt)).seal(i,it(t.message,Vi));return ud({type:e,sealed:n,iv:i,senderPublicKey:r})}function cd(t){const e=new Mi.ChaCha20Poly1305(it(t.symKey,nt)),{sealed:r,iv:i}=Kr(t.encoded),n=e.open(i,r);if(n===null)throw new Error("Failed to decrypt");return rt(n,Vi)}function ud(t){if(dr(t.type)===Xt){if(typeof t.senderPublicKey>"u")throw new Error("Missing sender public key for type 1 envelope");return rt(Pi([t.type,t.senderPublicKey,t.iv,t.sealed]),Gi)}return rt(Pi([t.type,t.iv,t.sealed]),Gi)}function Kr(t){const e=it(t,Gi),r=e.slice(rd,Xs),i=Xs;if(dr(r)===Xt){const u=i+Wi,h=u+qi,c=e.slice(i,u),l=e.slice(u,h),_=e.slice(h);return{type:r,sealed:_,iv:l,senderPublicKey:c}}const n=i+qi,s=e.slice(i,n),f=e.slice(n);return{type:r,sealed:f,iv:s}}function fd(t,e){const r=Kr(t);return Js({type:dr(r.type),senderPublicKey:typeof r.senderPublicKey<"u"?rt(r.senderPublicKey,nt):void 0,receiverPublicKey:e?.receiverPublicKey})}function Js(t){const e=t?.type||ks;if(e===Xt){if(typeof t?.senderPublicKey>"u")throw new Error("missing sender public key");if(typeof t?.receiverPublicKey>"u")throw new Error("missing receiver public key")}return{type:e,senderPublicKey:t?.senderPublicKey,receiverPublicKey:t?.receiverPublicKey}}function Qs(t){return t.type===Xt&&typeof t.senderPublicKey=="string"&&typeof t.receiverPublicKey=="string"}var hd=Object.defineProperty,Zs=Object.getOwnPropertySymbols,ld=Object.prototype.hasOwnProperty,dd=Object.prototype.propertyIsEnumerable,eo=(t,e,r)=>e in t?hd(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,to=(t,e)=>{for(var r in e||(e={}))ld.call(e,r)&&eo(t,r,e[r]);if(Zs)for(var r of Zs(e))dd.call(e,r)&&eo(t,r,e[r]);return t};const gd="ReactNative",pt={reactNative:"react-native",node:"node",browser:"browser",unknown:"unknown"},yd="js";function gr(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}function Jt(){return!Bi()&&!!zi()&&navigator.product===gd}function Hr(){return!gr()&&!!zi()&&!!Bi()}function Gr(){return Jt()?pt.reactNative:gr()?pt.node:Hr()?pt.browser:pt.unknown}function pd(){var t;try{return Jt()&&typeof global<"u"&&typeof(global==null?void 0:global.Application)<"u"?(t=global.Application)==null?void 0:t.applicationId:void 0}catch{return}}function _d(t,e){let r=lr.parse(t);return r=to(to({},r),e),t=lr.stringify(r),t}function bd(){if(Gr()===pt.reactNative&&typeof global<"u"&&typeof(global==null?void 0:global.Platform)<"u"){const{OS:r,Version:i}=global.Platform;return[r,i].join("-")}const t=Ll();if(t===null)return"unknown";const e=t.os?t.os.replace(" ","").toLowerCase():"unknown";return t.type==="browser"?[e,t.name,t.version].join("-"):[e,t.version].join("-")}function vd(){var t;const e=Gr();return e===pt.browser?[e,((t=Hs())==null?void 0:t.host)||"unknown"].join(":"):e}function wd(t,e,r){const i=bd(),n=vd();return[[t,e].join("-"),[yd,r].join("-"),i,n].join("/")}function md({protocol:t,version:e,relayUrl:r,sdkVersion:i,auth:n,projectId:s,useOnCloseEvent:f,bundleId:u}){const h=r.split("?"),c=wd(t,e,i),l={auth:n,ua:c,projectId:s,useOnCloseEvent:f||void 0,origin:u||void 0},_=_d(h[1]||"",l);return h[0]+"?"+_}function ro(t){return Object.fromEntries(t.entries())}function io(t){return new Map(Object.entries(t))}function Ed(t=Z.FIVE_MINUTES,e){const r=Z.toMiliseconds(t||Z.FIVE_MINUTES);let i,n,s;return{resolve:f=>{s&&i&&(clearTimeout(s),i(f))},reject:f=>{s&&n&&(clearTimeout(s),n(f))},done:()=>new Promise((f,u)=>{s=setTimeout(()=>{u(new Error(e))},r),i=f,n=u})}}function yr(t,e,r){return new Promise(async(i,n)=>{const s=setTimeout(()=>n(new Error(r)),e);try{const f=await t;i(f)}catch(f){n(f)}clearTimeout(s)})}function no(t,e){if(typeof e=="string"&&e.startsWith(`${t}:`))return e;if(t.toLowerCase()==="topic"){if(typeof e!="string")throw new Error('Value must be "string" for expirer target type: topic');return`topic:${e}`}else if(t.toLowerCase()==="id"){if(typeof e!="number")throw new Error('Value must be "number" for expirer target type: id');return`id:${e}`}throw new Error(`Unknown expirer target type: ${t}`)}function Dd(t){return no("topic",t)}function Sd(t){return no("id",t)}function Od(t){const[e,r]=t.split(":"),i={id:void 0,topic:void 0};if(e==="topic"&&typeof r=="string")i.topic=r;else if(e==="id"&&Number.isInteger(Number(r)))i.id=Number(r);else throw new Error(`Invalid target, expected id:number or topic:string, got ${e}:${r}`);return i}function Vr(t,e){return Z.fromMiliseconds((e||Date.now())+Z.toMiliseconds(t))}function so(t){return Date.now()>=Z.toMiliseconds(t)}function Xi(t,e){return`${t}${e?`:${e}`:""}`}const Id="irn";function Ji(t){return t?.relay||{protocol:Id}}function qr(t){const e=td[t];if(typeof e>"u")throw new Error(`Relay Protocol not supported: ${t}`);return e}var Td=Object.defineProperty,xd=Object.defineProperties,Rd=Object.getOwnPropertyDescriptors,oo=Object.getOwnPropertySymbols,Cd=Object.prototype.hasOwnProperty,Ad=Object.prototype.propertyIsEnumerable,ao=(t,e,r)=>e in t?Td(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Pd=(t,e)=>{for(var r in e||(e={}))Cd.call(e,r)&&ao(t,r,e[r]);if(oo)for(var r of oo(e))Ad.call(e,r)&&ao(t,r,e[r]);return t},Ld=(t,e)=>xd(t,Rd(e));function Nd(t,e="-"){const r={},i="relay"+e;return Object.keys(t).forEach(n=>{if(n.startsWith(i)){const s=n.replace(i,""),f=t[n];r[s]=f}}),r}function co(t){t=t.includes("wc://")?t.replace("wc://",""):t,t=t.includes("wc:")?t.replace("wc:",""):t;const e=t.indexOf(":"),r=t.indexOf("?")!==-1?t.indexOf("?"):void 0,i=t.substring(0,e),n=t.substring(e+1,r).split("@"),s=typeof r<"u"?t.substring(r):"",f=lr.parse(s);return{protocol:i,topic:Ud(n[0]),version:parseInt(n[1],10),symKey:f.symKey,relay:Nd(f),expiryTimestamp:f.expiryTimestamp?parseInt(f.expiryTimestamp,10):void 0}}function Ud(t){return t.startsWith("//")?t.substring(2):t}function Md(t,e="-"){const r="relay",i={};return Object.keys(t).forEach(n=>{const s=r+e+n;t[n]&&(i[s]=t[n])}),i}function $d(t){return`${t.protocol}:${t.topic}@${t.version}?`+lr.stringify(Ld(Pd({symKey:t.symKey},Md(t.relay)),{expiryTimestamp:t.expiryTimestamp}))}const jd={INVALID_METHOD:{message:"Invalid method.",code:1001},INVALID_EVENT:{message:"Invalid event.",code:1002},INVALID_UPDATE_REQUEST:{message:"Invalid update request.",code:1003},INVALID_EXTEND_REQUEST:{message:"Invalid extend request.",code:1004},INVALID_SESSION_SETTLE_REQUEST:{message:"Invalid session settle request.",code:1005},UNAUTHORIZED_METHOD:{message:"Unauthorized method.",code:3001},UNAUTHORIZED_EVENT:{message:"Unauthorized event.",code:3002},UNAUTHORIZED_UPDATE_REQUEST:{message:"Unauthorized update request.",code:3003},UNAUTHORIZED_EXTEND_REQUEST:{message:"Unauthorized extend request.",code:3004},USER_REJECTED:{message:"User rejected.",code:5e3},USER_REJECTED_CHAINS:{message:"User rejected chains.",code:5001},USER_REJECTED_METHODS:{message:"User rejected methods.",code:5002},USER_REJECTED_EVENTS:{message:"User rejected events.",code:5003},UNSUPPORTED_CHAINS:{message:"Unsupported chains.",code:5100},UNSUPPORTED_METHODS:{message:"Unsupported methods.",code:5101},UNSUPPORTED_EVENTS:{message:"Unsupported events.",code:5102},UNSUPPORTED_ACCOUNTS:{message:"Unsupported accounts.",code:5103},UNSUPPORTED_NAMESPACE_KEY:{message:"Unsupported namespace key.",code:5104},USER_DISCONNECTED:{message:"User disconnected.",code:6e3},SESSION_SETTLEMENT_FAILED:{message:"Session settlement failed.",code:7e3},WC_METHOD_UNSUPPORTED:{message:"Unsupported wc_ method.",code:10001}},Fd={NOT_INITIALIZED:{message:"Not initialized.",code:1},NO_MATCHING_KEY:{message:"No matching key.",code:2},RESTORE_WILL_OVERRIDE:{message:"Restore will override.",code:3},RESUBSCRIBED:{message:"Resubscribed.",code:4},MISSING_OR_INVALID:{message:"Missing or invalid.",code:5},EXPIRED:{message:"Expired.",code:6},UNKNOWN_TYPE:{message:"Unknown type.",code:7},MISMATCHED_TOPIC:{message:"Mismatched topic.",code:8},NON_CONFORMING_NAMESPACES:{message:"Non conforming namespaces.",code:9}};function De(t,e){const{message:r,code:i}=Fd[t];return{message:e?`${r} ${e}`:r,code:i}}function pr(t,e){const{message:r,code:i}=jd[t];return{message:e?`${r} ${e}`:r,code:i}}function Bd(t,e){return Array.isArray(t)?typeof e<"u"&&t.length?t.every(e):!0:!1}function Wr(t){return typeof t>"u"}function uo(t,e){return e&&Wr(t)?!0:typeof t=="string"&&!!t.trim().length}function zd(t){if(uo(t,!1))try{return typeof new URL(t)<"u"}catch{return!1}return!1}function Kd(t){var e;return(e=t?.proposer)==null?void 0:e.publicKey}function Hd(t){return t?.topic}function Qi(t){return typeof t<"u"&&typeof t!==null}function fo(){const t=Gr();return new Promise(e=>{switch(t){case pt.browser:e(Gd());break;case pt.reactNative:e(Vd());break;case pt.node:e(qd());break;default:e(!0)}})}function Gd(){return Hr()&&navigator?.onLine}async function Vd(){if(Jt()&&typeof global<"u"&&global!=null&&global.NetInfo){const t=await(global==null?void 0:global.NetInfo.fetch());return t?.isConnected}return!0}function qd(){return!0}function Wd(t){switch(Gr()){case pt.browser:Yd(t);break;case pt.reactNative:kd(t);break}}function Yd(t){!Jt()&&Hr()&&(window.addEventListener("online",()=>t(!0)),window.addEventListener("offline",()=>t(!1)))}function kd(t){Jt()&&typeof global<"u"&&global!=null&&global.NetInfo&&global?.NetInfo.addEventListener(e=>t(e?.isConnected))}const Zi="wc",ho=2,Yr="core",Dt=`${Zi}@2:${Yr}:`,lo={name:Yr,logger:"error"},go={database:":memory:"},yo="crypto",en="client_ed25519_seed",po=Z.ONE_DAY,_o="keychain",bo="0.3",vo="messages",wo="0.3",mo=Z.SIX_HOURS,Eo="publisher",Do="irn",So="error",tn="wss://relay.walletconnect.com",rn="wss://relay.walletconnect.org",Oo="relayer",lt={message:"relayer_message",message_ack:"relayer_message_ack",connect:"relayer_connect",disconnect:"relayer_disconnect",error:"relayer_error",connection_stalled:"relayer_connection_stalled",transport_closed:"relayer_transport_closed",publish:"relayer_publish"},Io="_subscription",ct={payload:"payload",connect:"connect",disconnect:"disconnect",error:"error"},To=Z.ONE_SECOND,Xd={database:":memory:"},xo="2.11.3",Ro=1e4,Co="0.3",Ao="WALLETCONNECT_CLIENT_ID",_t={created:"subscription_created",deleted:"subscription_deleted",expired:"subscription_expired",disabled:"subscription_disabled",sync:"subscription_sync",resubscribed:"subscription_resubscribed"},Jd=Z.THIRTY_DAYS,Po="subscription",Lo="0.3",No=Z.FIVE_SECONDS*1e3,Uo="pairing",Mo="0.3",Qd=Z.THIRTY_DAYS,Qt={wc_pairingDelete:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:1e3},res:{ttl:Z.ONE_DAY,prompt:!1,tag:1001}},wc_pairingPing:{req:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1002},res:{ttl:Z.THIRTY_SECONDS,prompt:!1,tag:1003}},unregistered_method:{req:{ttl:Z.ONE_DAY,prompt:!1,tag:0},res:{ttl:Z.ONE_DAY,prompt:!1,tag:0}}},_r={create:"pairing_create",expire:"pairing_expire",delete:"pairing_delete",ping:"pairing_ping"},bt={created:"history_created",updated:"history_updated",deleted:"history_deleted",sync:"history_sync"},$o="history",jo="0.3",Fo="expirer",dt={created:"expirer_created",deleted:"expirer_deleted",expired:"expirer_expired",sync:"expirer_sync"},Bo="0.3",Zd=Z.ONE_DAY,kr="verify-api",Zt="https://verify.walletconnect.com",Xr="https://verify.walletconnect.org",zo=[Zt,Xr],Ko="echo",Ho="https://echo.walletconnect.com";class Go{constructor(e,r){this.core=e,this.logger=r,this.keychain=new Map,this.name=_o,this.version=bo,this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{if(!this.initialized){const i=await this.getKeyChain();typeof i<"u"&&(this.keychain=i),this.initialized=!0}},this.has=i=>(this.isInitialized(),this.keychain.has(i)),this.set=async(i,n)=>{this.isInitialized(),this.keychain.set(i,n),await this.persist()},this.get=i=>{this.isInitialized();const n=this.keychain.get(i);if(typeof n>"u"){const{message:s}=De("NO_MATCHING_KEY",`${this.name}: ${i}`);throw new Error(s)}return n},this.del=async i=>{this.isInitialized(),this.keychain.delete(i),await this.persist()},this.core=e,this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setKeyChain(e){await this.core.storage.setItem(this.storageKey,ro(e))}async getKeyChain(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?io(e):void 0}async persist(){await this.setKeyChain(this.keychain)}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Vo{constructor(e,r,i){this.core=e,this.logger=r,this.name=yo,this.initialized=!1,this.init=async()=>{this.initialized||(await this.keychain.init(),this.initialized=!0)},this.hasKeys=n=>(this.isInitialized(),this.keychain.has(n)),this.getClientId=async()=>{this.isInitialized();const n=await this.getClientSeed(),s=As(n);return Cs(s.publicKey)},this.generateKeyPair=()=>{this.isInitialized();const n=id();return this.setPrivateKey(n.publicKey,n.privateKey)},this.signJWT=async n=>{this.isInitialized();const s=await this.getClientSeed(),f=As(s),u=Yi();return await hl(u,n,po,f)},this.generateSharedKey=(n,s,f)=>{this.isInitialized();const u=this.getPrivateKey(n),h=nd(u,s);return this.setSymKey(h,f)},this.setSymKey=async(n,s)=>{this.isInitialized();const f=s||sd(n);return await this.keychain.set(f,n),f},this.deleteKeyPair=async n=>{this.isInitialized(),await this.keychain.del(n)},this.deleteSymKey=async n=>{this.isInitialized(),await this.keychain.del(n)},this.encode=async(n,s,f)=>{this.isInitialized();const u=Js(f),h=rr(s);if(Qs(u)){const p=u.senderPublicKey,b=u.receiverPublicKey;n=await this.generateSharedKey(p,b)}const c=this.getSymKey(n),{type:l,senderPublicKey:_}=u;return ad({type:l,symKey:c,message:h,senderPublicKey:_})},this.decode=async(n,s,f)=>{this.isInitialized();const u=fd(s,f);if(Qs(u)){const h=u.receiverPublicKey,c=u.senderPublicKey;n=await this.generateSharedKey(h,c)}try{const h=this.getSymKey(n),c=cd({symKey:h,encoded:s});return Rr(c)}catch(h){this.logger.error(`Failed to decode message from topic: '${n}', clientId: '${await this.getClientId()}'`),this.logger.error(h)}},this.getPayloadType=n=>{const s=Kr(n);return dr(s.type)},this.getPayloadSenderPublicKey=n=>{const s=Kr(n);return s.senderPublicKey?rt(s.senderPublicKey,nt):void 0},this.core=e,this.logger=Ee.generateChildLogger(r,this.name),this.keychain=i||new Go(this.core,this.logger)}get context(){return Ee.getLoggerContext(this.logger)}async setPrivateKey(e,r){return await this.keychain.set(e,r),e}getPrivateKey(e){return this.keychain.get(e)}async getClientSeed(){let e="";try{e=this.keychain.get(en)}catch{e=Yi(),await this.keychain.set(en,e)}return it(e,"base16")}getSymKey(e){return this.keychain.get(e)}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}}class qo extends Wu{constructor(e,r){super(e,r),this.logger=e,this.core=r,this.messages=new Map,this.name=vo,this.version=wo,this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{if(!this.initialized){this.logger.trace("Initialized");try{const i=await this.getRelayerMessages();typeof i<"u"&&(this.messages=i),this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",size:this.messages.size})}catch(i){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(i)}finally{this.initialized=!0}}},this.set=async(i,n)=>{this.isInitialized();const s=ki(n);let f=this.messages.get(i);return typeof f>"u"&&(f={}),typeof f[s]<"u"||(f[s]=n,this.messages.set(i,f),await this.persist()),s},this.get=i=>{this.isInitialized();let n=this.messages.get(i);return typeof n>"u"&&(n={}),n},this.has=(i,n)=>{this.isInitialized();const s=this.get(i),f=ki(n);return typeof s[f]<"u"},this.del=async i=>{this.isInitialized(),this.messages.delete(i),await this.persist()},this.logger=Ee.generateChildLogger(e,this.name),this.core=r}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}async setRelayerMessages(e){await this.core.storage.setItem(this.storageKey,ro(e))}async getRelayerMessages(){const e=await this.core.storage.getItem(this.storageKey);return typeof e<"u"?io(e):void 0}async persist(){await this.setRelayerMessages(this.messages)}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}}const eg="PARSE_ERROR",tg="INVALID_REQUEST",rg="METHOD_NOT_FOUND",ig="INVALID_PARAMS",Wo="INTERNAL_ERROR",nn="SERVER_ERROR",ng=[-32700,-32600,-32601,-32602,-32603],br={[eg]:{code:-32700,message:"Parse error"},[tg]:{code:-32600,message:"Invalid Request"},[rg]:{code:-32601,message:"Method not found"},[ig]:{code:-32602,message:"Invalid params"},[Wo]:{code:-32603,message:"Internal error"},[nn]:{code:-32e3,message:"Server error"}},Yo=nn;function sg(t){return ng.includes(t)}function ko(t){return Object.keys(br).includes(t)?br[t]:br[Yo]}function og(t){const e=Object.values(br).find(r=>r.code===t);return e||br[Yo]}function ag(t,e,r){return t.message.includes("getaddrinfo ENOTFOUND")||t.message.includes("connect ECONNREFUSED")?new Error(`Unavailable ${r} RPC url at ${e}`):t}var Xo={};/*! *****************************************************************************
	Copyright (c) Microsoft Corporation.

	Permission to use, copy, modify, and/or distribute this software for any
	purpose with or without fee is hereby granted.

	THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
	REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
	AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
	INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
	LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
	OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
	PERFORMANCE OF THIS SOFTWARE.
	***************************************************************************** */var sn=function(t,e){return sn=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(r,i){r.__proto__=i}||function(r,i){for(var n in i)i.hasOwnProperty(n)&&(r[n]=i[n])},sn(t,e)};function cg(t,e){sn(t,e);function r(){this.constructor=t}t.prototype=e===null?Object.create(e):(r.prototype=e.prototype,new r)}var on=function(){return on=Object.assign||function(e){for(var r,i=1,n=arguments.length;i<n;i++){r=arguments[i];for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&(e[s]=r[s])}return e},on.apply(this,arguments)};function ug(t,e){var r={};for(var i in t)Object.prototype.hasOwnProperty.call(t,i)&&e.indexOf(i)<0&&(r[i]=t[i]);if(t!=null&&typeof Object.getOwnPropertySymbols=="function")for(var n=0,i=Object.getOwnPropertySymbols(t);n<i.length;n++)e.indexOf(i[n])<0&&Object.prototype.propertyIsEnumerable.call(t,i[n])&&(r[i[n]]=t[i[n]]);return r}function fg(t,e,r,i){var n=arguments.length,s=n<3?e:i===null?i=Object.getOwnPropertyDescriptor(e,r):i,f;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(t,e,r,i);else for(var u=t.length-1;u>=0;u--)(f=t[u])&&(s=(n<3?f(s):n>3?f(e,r,s):f(e,r))||s);return n>3&&s&&Object.defineProperty(e,r,s),s}function hg(t,e){return function(r,i){e(r,i,t)}}function lg(t,e){if(typeof Reflect=="object"&&typeof Reflect.metadata=="function")return Reflect.metadata(t,e)}function dg(t,e,r,i){function n(s){return s instanceof r?s:new r(function(f){f(s)})}return new(r||(r=Promise))(function(s,f){function u(l){try{c(i.next(l))}catch(_){f(_)}}function h(l){try{c(i.throw(l))}catch(_){f(_)}}function c(l){l.done?s(l.value):n(l.value).then(u,h)}c((i=i.apply(t,e||[])).next())})}function gg(t,e){var r={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},i,n,s,f;return f={next:u(0),throw:u(1),return:u(2)},typeof Symbol=="function"&&(f[Symbol.iterator]=function(){return this}),f;function u(c){return function(l){return h([c,l])}}function h(c){if(i)throw new TypeError("Generator is already executing.");for(;r;)try{if(i=1,n&&(s=c[0]&2?n.return:c[0]?n.throw||((s=n.return)&&s.call(n),0):n.next)&&!(s=s.call(n,c[1])).done)return s;switch(n=0,s&&(c=[c[0]&2,s.value]),c[0]){case 0:case 1:s=c;break;case 4:return r.label++,{value:c[1],done:!1};case 5:r.label++,n=c[1],c=[0];continue;case 7:c=r.ops.pop(),r.trys.pop();continue;default:if(s=r.trys,!(s=s.length>0&&s[s.length-1])&&(c[0]===6||c[0]===2)){r=0;continue}if(c[0]===3&&(!s||c[1]>s[0]&&c[1]<s[3])){r.label=c[1];break}if(c[0]===6&&r.label<s[1]){r.label=s[1],s=c;break}if(s&&r.label<s[2]){r.label=s[2],r.ops.push(c);break}s[2]&&r.ops.pop(),r.trys.pop();continue}c=e.call(t,r)}catch(l){c=[6,l],n=0}finally{i=s=0}if(c[0]&5)throw c[1];return{value:c[0]?c[1]:void 0,done:!0}}}function yg(t,e,r,i){i===void 0&&(i=r),t[i]=e[r]}function pg(t,e){for(var r in t)r!=="default"&&!e.hasOwnProperty(r)&&(e[r]=t[r])}function an(t){var e=typeof Symbol=="function"&&Symbol.iterator,r=e&&t[e],i=0;if(r)return r.call(t);if(t&&typeof t.length=="number")return{next:function(){return t&&i>=t.length&&(t=void 0),{value:t&&t[i++],done:!t}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Jo(t,e){var r=typeof Symbol=="function"&&t[Symbol.iterator];if(!r)return t;var i=r.call(t),n,s=[],f;try{for(;(e===void 0||e-- >0)&&!(n=i.next()).done;)s.push(n.value)}catch(u){f={error:u}}finally{try{n&&!n.done&&(r=i.return)&&r.call(i)}finally{if(f)throw f.error}}return s}function _g(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(Jo(arguments[e]));return t}function bg(){for(var t=0,e=0,r=arguments.length;e<r;e++)t+=arguments[e].length;for(var i=Array(t),n=0,e=0;e<r;e++)for(var s=arguments[e],f=0,u=s.length;f<u;f++,n++)i[n]=s[f];return i}function vr(t){return this instanceof vr?(this.v=t,this):new vr(t)}function vg(t,e,r){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var i=r.apply(t,e||[]),n,s=[];return n={},f("next"),f("throw"),f("return"),n[Symbol.asyncIterator]=function(){return this},n;function f(p){i[p]&&(n[p]=function(b){return new Promise(function(O,A){s.push([p,b,O,A])>1||u(p,b)})})}function u(p,b){try{h(i[p](b))}catch(O){_(s[0][3],O)}}function h(p){p.value instanceof vr?Promise.resolve(p.value.v).then(c,l):_(s[0][2],p)}function c(p){u("next",p)}function l(p){u("throw",p)}function _(p,b){p(b),s.shift(),s.length&&u(s[0][0],s[0][1])}}function wg(t){var e,r;return e={},i("next"),i("throw",function(n){throw n}),i("return"),e[Symbol.iterator]=function(){return this},e;function i(n,s){e[n]=t[n]?function(f){return(r=!r)?{value:vr(t[n](f)),done:n==="return"}:s?s(f):f}:s}}function mg(t){if(!Symbol.asyncIterator)throw new TypeError("Symbol.asyncIterator is not defined.");var e=t[Symbol.asyncIterator],r;return e?e.call(t):(t=typeof an=="function"?an(t):t[Symbol.iterator](),r={},i("next"),i("throw"),i("return"),r[Symbol.asyncIterator]=function(){return this},r);function i(s){r[s]=t[s]&&function(f){return new Promise(function(u,h){f=t[s](f),n(u,h,f.done,f.value)})}}function n(s,f,u,h){Promise.resolve(h).then(function(c){s({value:c,done:u})},f)}}function Eg(t,e){return Object.defineProperty?Object.defineProperty(t,"raw",{value:e}):t.raw=e,t}function Dg(t){if(t&&t.__esModule)return t;var e={};if(t!=null)for(var r in t)Object.hasOwnProperty.call(t,r)&&(e[r]=t[r]);return e.default=t,e}function Sg(t){return t&&t.__esModule?t:{default:t}}function Og(t,e){if(!e.has(t))throw new TypeError("attempted to get private field on non-instance");return e.get(t)}function Ig(t,e,r){if(!e.has(t))throw new TypeError("attempted to set private field on non-instance");return e.set(t,r),r}var Tg=Object.freeze({__proto__:null,__extends:cg,get __assign(){return on},__rest:ug,__decorate:fg,__param:hg,__metadata:lg,__awaiter:dg,__generator:gg,__createBinding:yg,__exportStar:pg,__values:an,__read:Jo,__spread:_g,__spreadArrays:bg,__await:vr,__asyncGenerator:vg,__asyncDelegator:wg,__asyncValues:mg,__makeTemplateObject:Eg,__importStar:Dg,__importDefault:Sg,__classPrivateFieldGet:Og,__classPrivateFieldSet:Ig}),xg=Lt(Tg),St={},Qo;function Rg(){if(Qo)return St;Qo=1,Object.defineProperty(St,"__esModule",{value:!0}),St.isBrowserCryptoAvailable=St.getSubtleCrypto=St.getBrowerCrypto=void 0;function t(){return st?.crypto||st?.msCrypto||{}}St.getBrowerCrypto=t;function e(){const i=t();return i.subtle||i.webkitSubtle}St.getSubtleCrypto=e;function r(){return!!t()&&!!e()}return St.isBrowserCryptoAvailable=r,St}var Ot={},Zo;function Cg(){if(Zo)return Ot;Zo=1,Object.defineProperty(Ot,"__esModule",{value:!0}),Ot.isBrowser=Ot.isNode=Ot.isReactNative=void 0;function t(){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"}Ot.isReactNative=t;function e(){return typeof process<"u"&&typeof process.versions<"u"&&typeof process.versions.node<"u"}Ot.isNode=e;function r(){return!t()&&!e()}return Ot.isBrowser=r,Ot}(function(t){Object.defineProperty(t,"__esModule",{value:!0});const e=xg;e.__exportStar(Rg(),t),e.__exportStar(Cg(),t)})(Xo);function ea(t=3){const e=Date.now()*Math.pow(10,t),r=Math.floor(Math.random()*Math.pow(10,t));return e+r}function cn(t=6){return BigInt(ea(t))}function un(t,e,r){return{id:r||ea(),jsonrpc:"2.0",method:t,params:e}}function ta(t,e){return{id:t,jsonrpc:"2.0",result:e}}function ra(t,e,r){return{id:t,jsonrpc:"2.0",error:Ag(e,r)}}function Ag(t,e){return typeof t>"u"?ko(Wo):(typeof t=="string"&&(t=Object.assign(Object.assign({},ko(nn)),{message:t})),typeof e<"u"&&(t.data=e),sg(t.code)&&(t=og(t.code)),t)}class Pg{}class Lg extends Pg{constructor(){super()}}class Ng extends Lg{constructor(e){super()}}const Ug="^wss?:";function Mg(t){const e=t.match(new RegExp(/^\w+:/,"gi"));if(!(!e||!e.length))return e[0]}function $g(t,e){const r=Mg(t);return typeof r>"u"?!1:new RegExp(e).test(r)}function ia(t){return $g(t,Ug)}function jg(t){return new RegExp("wss?://localhost(:d{2,5})?").test(t)}function na(t){return typeof t=="object"&&"id"in t&&"jsonrpc"in t&&t.jsonrpc==="2.0"}function sa(t){return na(t)&&"method"in t}function fn(t){return na(t)&&(oa(t)||Jr(t))}function oa(t){return"result"in t}function Jr(t){return"error"in t}class Fg extends Ng{constructor(e){super(e),this.events=new ht.exports.EventEmitter,this.hasRegisteredEventListeners=!1,this.connection=this.setConnection(e),this.connection.connected&&this.registerEventListeners()}async connect(e=this.connection){await this.open(e)}async disconnect(){await this.close()}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async request(e,r){return this.requestStrict(un(e.method,e.params||[],e.id||cn().toString()),r)}async requestStrict(e,r){return new Promise(async(i,n)=>{if(!this.connection.connected)try{await this.open()}catch(s){n(s)}this.events.on(`${e.id}`,s=>{Jr(s)?n(s.error):i(s.result)});try{await this.connection.send(e,r)}catch(s){n(s)}})}setConnection(e=this.connection){return e}onPayload(e){this.events.emit("payload",e),fn(e)?this.events.emit(`${e.id}`,e):this.events.emit("message",{type:e.method,data:e.params})}onClose(e){e&&e.code===3e3&&this.events.emit("error",new Error(`WebSocket connection closed abnormally with code: ${e.code} ${e.reason?`(${e.reason})`:""}`)),this.events.emit("disconnect")}async open(e=this.connection){this.connection===e&&this.connection.connected||(this.connection.connected&&this.close(),typeof e=="string"&&(await this.connection.open(e),e=this.connection),this.connection=this.setConnection(e),await this.connection.open(),this.registerEventListeners(),this.events.emit("connect"))}async close(){await this.connection.close()}registerEventListeners(){this.hasRegisteredEventListeners||(this.connection.on("payload",e=>this.onPayload(e)),this.connection.on("close",e=>this.onClose(e)),this.connection.on("error",e=>this.events.emit("error",e)),this.connection.on("register_error",e=>this.onClose()),this.hasRegisteredEventListeners=!0)}}const Bg=()=>typeof WebSocket<"u"?WebSocket:typeof global<"u"&&typeof global.WebSocket<"u"?global.WebSocket:typeof window<"u"&&typeof window.WebSocket<"u"?window.WebSocket:typeof self<"u"&&typeof self.WebSocket<"u"?self.WebSocket:require("ws"),zg=()=>typeof WebSocket<"u"||typeof global<"u"&&typeof global.WebSocket<"u"||typeof window<"u"&&typeof window.WebSocket<"u"||typeof self<"u"&&typeof self.WebSocket<"u",aa=t=>t.split("?")[0],ca=10,Kg=Bg();class Hg{constructor(e){if(this.url=e,this.events=new ht.exports.EventEmitter,this.registering=!1,!ia(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);this.url=e}get connected(){return typeof this.socket<"u"}get connecting(){return this.registering}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async open(e=this.url){await this.register(e)}async close(){return new Promise((e,r)=>{if(typeof this.socket>"u"){r(new Error("Connection already closed"));return}this.socket.onclose=i=>{this.onClose(i),e()},this.socket.close()})}async send(e){typeof this.socket>"u"&&(this.socket=await this.register());try{this.socket.send(rr(e))}catch(r){this.onError(e.id,r)}}register(e=this.url){if(!ia(e))throw new Error(`Provided URL is not compatible with WebSocket connection: ${e}`);if(this.registering){const r=this.events.getMaxListeners();return(this.events.listenerCount("register_error")>=r||this.events.listenerCount("open")>=r)&&this.events.setMaxListeners(r+1),new Promise((i,n)=>{this.events.once("register_error",s=>{this.resetMaxListeners(),n(s)}),this.events.once("open",()=>{if(this.resetMaxListeners(),typeof this.socket>"u")return n(new Error("WebSocket connection is missing or invalid"));i(this.socket)})})}return this.url=e,this.registering=!0,new Promise((r,i)=>{const n=new URLSearchParams(e).get("origin"),s=Xo.isReactNative()?{headers:{origin:n}}:{rejectUnauthorized:!jg(e)},f=new Kg(e,[],s);zg()?f.onerror=u=>{const h=u;i(this.emitError(h.error))}:f.on("error",u=>{i(this.emitError(u))}),f.onopen=()=>{this.onOpen(f),r(f)}})}onOpen(e){e.onmessage=r=>this.onPayload(r),e.onclose=r=>this.onClose(r),this.socket=e,this.registering=!1,this.events.emit("open")}onClose(e){this.socket=void 0,this.registering=!1,this.events.emit("close",e)}onPayload(e){if(typeof e.data>"u")return;const r=typeof e.data=="string"?Rr(e.data):e.data;this.events.emit("payload",r)}onError(e,r){const i=this.parseError(r),n=i.message||i.toString(),s=ra(e,n);this.events.emit("payload",s)}parseError(e,r=this.url){return ag(e,aa(r),"WS")}resetMaxListeners(){this.events.getMaxListeners()>ca&&this.events.setMaxListeners(ca)}emitError(e){const r=this.parseError(new Error(e?.message||`WebSocket connection failed for host: ${aa(this.url)}`));return this.events.emit("register_error",r),r}}class Gg extends Yu{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.events=new ht.exports.EventEmitter,this.name=Eo,this.queue=new Map,this.publishTimeout=Z.toMiliseconds(Z.ONE_MINUTE),this.failedPublishTimeout=Z.toMiliseconds(Z.ONE_SECOND),this.needsTransportRestart=!1,this.publish=async(i,n,s)=>{var f;this.logger.debug("Publishing Payload"),this.logger.trace({type:"method",method:"publish",params:{topic:i,message:n,opts:s}});const u=s?.ttl||mo,h=Ji(s),c=s?.prompt||!1,l=s?.tag||0,_=s?.id||cn().toString(),p={topic:i,message:n,opts:{ttl:u,relay:h,prompt:c,tag:l,id:_}},b=`Failed to publish payload, please try again. id:${_} tag:${l}`,O=Date.now();let A,L=1;try{for(;A===void 0;){if(Date.now()-O>this.publishTimeout)throw new Error(b);this.logger.trace({id:_,attempts:L},`publisher.publish - attempt ${L}`),A=await await yr(this.rpcPublish(i,n,u,h,c,l,_).catch(G=>this.logger.warn(G)),this.publishTimeout,b),L++,A||await new Promise(G=>setTimeout(G,this.failedPublishTimeout))}this.relayer.events.emit(lt.publish,p),this.logger.debug("Successfully Published Payload"),this.logger.trace({type:"method",method:"publish",params:{id:_,topic:i,message:n,opts:s}})}catch(G){if(this.logger.debug("Failed to Publish Payload"),this.logger.error(G),(f=s?.internal)!=null&&f.throwOnFailedPublish)throw G;this.queue.set(_,p)}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.relayer=e,this.logger=Ee.generateChildLogger(r,this.name),this.registerEventListeners()}get context(){return Ee.getLoggerContext(this.logger)}rpcPublish(e,r,i,n,s,f,u){var h,c,l,_;const p={method:qr(n.protocol).publish,params:{topic:e,message:r,ttl:i,prompt:s,tag:f},id:u};return Wr((h=p.params)==null?void 0:h.prompt)&&((c=p.params)==null||delete c.prompt),Wr((l=p.params)==null?void 0:l.tag)&&((_=p.params)==null||delete _.tag),this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"message",direction:"outgoing",request:p}),this.relayer.request(p)}removeRequestFromQueue(e){this.queue.delete(e)}checkQueue(){this.queue.forEach(async e=>{const{topic:r,message:i,opts:n}=e;await this.publish(r,i,n)})}registerEventListeners(){this.relayer.core.heartbeat.on(qt.HEARTBEAT_EVENTS.pulse,()=>{if(this.needsTransportRestart){this.needsTransportRestart=!1,this.relayer.events.emit(lt.connection_stalled);return}this.checkQueue()}),this.relayer.on(lt.message_ack,e=>{this.removeRequestFromQueue(e.id.toString())})}}class Vg{constructor(){this.map=new Map,this.set=(e,r)=>{const i=this.get(e);this.exists(e,r)||this.map.set(e,[...i,r])},this.get=e=>this.map.get(e)||[],this.exists=(e,r)=>this.get(e).includes(r),this.delete=(e,r)=>{if(typeof r>"u"){this.map.delete(e);return}if(!this.map.has(e))return;const i=this.get(e);if(!this.exists(e,r))return;const n=i.filter(s=>s!==r);if(!n.length){this.map.delete(e);return}this.map.set(e,n)},this.clear=()=>{this.map.clear()}}get topics(){return Array.from(this.map.keys())}}var qg=Object.defineProperty,Wg=Object.defineProperties,Yg=Object.getOwnPropertyDescriptors,ua=Object.getOwnPropertySymbols,kg=Object.prototype.hasOwnProperty,Xg=Object.prototype.propertyIsEnumerable,fa=(t,e,r)=>e in t?qg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,wr=(t,e)=>{for(var r in e||(e={}))kg.call(e,r)&&fa(t,r,e[r]);if(ua)for(var r of ua(e))Xg.call(e,r)&&fa(t,r,e[r]);return t},hn=(t,e)=>Wg(t,Yg(e));class ha extends Ju{constructor(e,r){super(e,r),this.relayer=e,this.logger=r,this.subscriptions=new Map,this.topicMap=new Vg,this.events=new ht.exports.EventEmitter,this.name=Po,this.version=Lo,this.pending=new Map,this.cached=[],this.initialized=!1,this.pendingSubscriptionWatchLabel="pending_sub_watch_label",this.pollingInterval=20,this.storagePrefix=Dt,this.subscribeTimeout=Z.toMiliseconds(Z.ONE_MINUTE),this.restartInProgress=!1,this.batchSubscribeTopicsLimit=500,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),this.registerEventListeners(),this.clientId=await this.relayer.core.crypto.getClientId())},this.subscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),this.logger.debug("Subscribing Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}});try{const s=Ji(n),f={topic:i,relay:s};this.pending.set(i,f);const u=await this.rpcSubscribe(i,s);return typeof u=="string"&&(this.onSubscribe(u,f),this.logger.debug("Successfully Subscribed Topic"),this.logger.trace({type:"method",method:"subscribe",params:{topic:i,opts:n}})),u}catch(s){throw this.logger.debug("Failed to Subscribe Topic"),this.logger.error(s),s}},this.unsubscribe=async(i,n)=>{await this.restartToComplete(),this.isInitialized(),typeof n?.id<"u"?await this.unsubscribeById(i,n.id,n):await this.unsubscribeByTopic(i,n)},this.isSubscribed=async i=>{if(this.topics.includes(i))return!0;const n=`${this.pendingSubscriptionWatchLabel}_${i}`;return await new Promise((s,f)=>{const u=new Z.Watch;u.start(n);const h=setInterval(()=>{!this.pending.has(i)&&this.topics.includes(i)&&(clearInterval(h),u.stop(n),s(!0)),u.elapsed(n)>=No&&(clearInterval(h),u.stop(n),f(new Error("Subscription resolution timeout")))},this.pollingInterval)}).catch(()=>!1)},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.start=async()=>{await this.onConnect()},this.stop=async()=>{await this.onDisconnect()},this.restart=async()=>{this.restartInProgress=!0,await this.restore(),await this.reset(),this.restartInProgress=!1},this.relayer=e,this.logger=Ee.generateChildLogger(r,this.name),this.clientId=""}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.relayer.core.customStoragePrefix+"//"+this.name}get length(){return this.subscriptions.size}get ids(){return Array.from(this.subscriptions.keys())}get values(){return Array.from(this.subscriptions.values())}get topics(){return this.topicMap.topics}hasSubscription(e,r){let i=!1;try{i=this.getSubscription(e).topic===r}catch{}return i}onEnable(){this.cached=[],this.initialized=!0}onDisable(){this.cached=this.values,this.subscriptions.clear(),this.topicMap.clear()}async unsubscribeByTopic(e,r){const i=this.topicMap.get(e);await Promise.all(i.map(async n=>await this.unsubscribeById(e,n,r)))}async unsubscribeById(e,r,i){this.logger.debug("Unsubscribing Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}});try{const n=Ji(i);await this.rpcUnsubscribe(e,r,n);const s=pr("USER_DISCONNECTED",`${this.name}, ${e}`);await this.onUnsubscribe(e,r,s),this.logger.debug("Successfully Unsubscribed Topic"),this.logger.trace({type:"method",method:"unsubscribe",params:{topic:e,id:r,opts:i}})}catch(n){throw this.logger.debug("Failed to Unsubscribe Topic"),this.logger.error(n),n}}async rpcSubscribe(e,r){const i={method:qr(r.protocol).subscribe,params:{topic:e}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await yr(this.relayer.request(i).catch(n=>this.logger.warn(n)),this.subscribeTimeout)?ki(e+this.clientId):null}catch{this.logger.debug("Outgoing Relay Subscribe Payload stalled"),this.relayer.events.emit(lt.connection_stalled)}return null}async rpcBatchSubscribe(e){if(!e.length)return;const r=e[0].relay,i={method:qr(r.protocol).batchSubscribe,params:{topics:e.map(n=>n.topic)}};this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:i});try{return await await yr(this.relayer.request(i).catch(n=>this.logger.warn(n)),this.subscribeTimeout)}catch{this.relayer.events.emit(lt.connection_stalled)}}rpcUnsubscribe(e,r,i){const n={method:qr(i.protocol).unsubscribe,params:{topic:e,id:r}};return this.logger.debug("Outgoing Relay Payload"),this.logger.trace({type:"payload",direction:"outgoing",request:n}),this.relayer.request(n)}onSubscribe(e,r){this.setSubscription(e,hn(wr({},r),{id:e})),this.pending.delete(r.topic)}onBatchSubscribe(e){e.length&&e.forEach(r=>{this.setSubscription(r.id,wr({},r)),this.pending.delete(r.topic)})}async onUnsubscribe(e,r,i){this.events.removeAllListeners(r),this.hasSubscription(r,e)&&this.deleteSubscription(r,i),await this.relayer.messages.del(e)}async setRelayerSubscriptions(e){await this.relayer.core.storage.setItem(this.storageKey,e)}async getRelayerSubscriptions(){return await this.relayer.core.storage.getItem(this.storageKey)}setSubscription(e,r){this.logger.debug("Setting subscription"),this.logger.trace({type:"method",method:"setSubscription",id:e,subscription:r}),this.addSubscription(e,r)}addSubscription(e,r){this.subscriptions.set(e,wr({},r)),this.topicMap.set(r.topic,e),this.events.emit(_t.created,r)}getSubscription(e){this.logger.debug("Getting subscription"),this.logger.trace({type:"method",method:"getSubscription",id:e});const r=this.subscriptions.get(e);if(!r){const{message:i}=De("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}deleteSubscription(e,r){this.logger.debug("Deleting subscription"),this.logger.trace({type:"method",method:"deleteSubscription",id:e,reason:r});const i=this.getSubscription(e);this.subscriptions.delete(e),this.topicMap.delete(i.topic,e),this.events.emit(_t.deleted,hn(wr({},i),{reason:r}))}async persist(){await this.setRelayerSubscriptions(this.values),this.events.emit(_t.sync)}async reset(){if(this.cached.length){const e=Math.ceil(this.cached.length/this.batchSubscribeTopicsLimit);for(let r=0;r<e;r++){const i=this.cached.splice(0,this.batchSubscribeTopicsLimit);await this.batchSubscribe(i)}}this.events.emit(_t.resubscribed)}async restore(){try{const e=await this.getRelayerSubscriptions();if(typeof e>"u"||!e.length)return;if(this.subscriptions.size){const{message:r}=De("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),this.logger.error(`${this.name}: ${JSON.stringify(this.values)}`),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored subscriptions for ${this.name}`),this.logger.trace({type:"method",method:"restore",subscriptions:this.values})}catch(e){this.logger.debug(`Failed to Restore subscriptions for ${this.name}`),this.logger.error(e)}}async batchSubscribe(e){if(!e.length)return;const r=await this.rpcBatchSubscribe(e);Bd(r)&&this.onBatchSubscribe(r.map((i,n)=>hn(wr({},e[n]),{id:i})))}async onConnect(){await this.restart(),this.onEnable()}onDisconnect(){this.onDisable()}async checkPending(){if(!this.initialized||!this.relayer.connected)return;const e=[];this.pending.forEach(r=>{e.push(r)}),await this.batchSubscribe(e)}registerEventListeners(){this.relayer.core.heartbeat.on(qt.HEARTBEAT_EVENTS.pulse,async()=>{await this.checkPending()}),this.events.on(_t.created,async e=>{const r=_t.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()}),this.events.on(_t.deleted,async e=>{const r=_t.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),await this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}async restartToComplete(){this.restartInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.restartInProgress||(clearInterval(r),e())},this.pollingInterval)})}}var Jg=Object.defineProperty,la=Object.getOwnPropertySymbols,Qg=Object.prototype.hasOwnProperty,Zg=Object.prototype.propertyIsEnumerable,da=(t,e,r)=>e in t?Jg(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,e0=(t,e)=>{for(var r in e||(e={}))Qg.call(e,r)&&da(t,r,e[r]);if(la)for(var r of la(e))Zg.call(e,r)&&da(t,r,e[r]);return t};class ga extends ku{constructor(e){super(e),this.protocol="wc",this.version=2,this.events=new ht.exports.EventEmitter,this.name=Oo,this.transportExplicitlyClosed=!1,this.initialized=!1,this.connectionAttemptInProgress=!1,this.connectionStatusPollingInterval=20,this.staleConnectionErrors=["socket hang up","socket stalled","interrupted"],this.hasExperiencedNetworkDisruption=!1,this.requestsInFlight=new Map,this.heartBeatTimeout=Z.toMiliseconds(Z.THIRTY_SECONDS+Z.ONE_SECOND),this.request=async r=>{var i,n;this.logger.debug("Publishing Request Payload");const s=r.id||cn().toString();await this.toEstablishConnection();try{const f=this.provider.request(r);this.requestsInFlight.set(s,{promise:f,request:r}),this.logger.trace({id:s,method:r.method,topic:(i=r.params)==null?void 0:i.topic},"relayer.request - attempt to publish...");const u=await new Promise(async(h,c)=>{const l=()=>{c(new Error(`relayer.request - publish interrupted, id: ${s}`))};this.provider.on(ct.disconnect,l);const _=await f;this.provider.off(ct.disconnect,l),h(_)});return this.logger.trace({id:s,method:r.method,topic:(n=r.params)==null?void 0:n.topic},"relayer.request - published"),u}catch(f){throw this.logger.debug(`Failed to Publish Request: ${s}`),f}finally{this.requestsInFlight.delete(s)}},this.resetPingTimeout=()=>{if(gr())try{clearTimeout(this.pingTimeout),this.pingTimeout=setTimeout(()=>{var r,i,n;(n=(i=(r=this.provider)==null?void 0:r.connection)==null?void 0:i.socket)==null||n.terminate()},this.heartBeatTimeout)}catch(r){this.logger.warn(r)}},this.onPayloadHandler=r=>{this.onProviderPayload(r),this.resetPingTimeout()},this.onConnectHandler=()=>{this.startPingTimeout(),this.events.emit(lt.connect)},this.onDisconnectHandler=()=>{this.onProviderDisconnect()},this.onProviderErrorHandler=r=>{this.logger.error(r),this.events.emit(lt.error,r),this.logger.info("Fatal socket error received, closing transport"),this.transportClose()},this.registerProviderListeners=()=>{this.provider.on(ct.payload,this.onPayloadHandler),this.provider.on(ct.connect,this.onConnectHandler),this.provider.on(ct.disconnect,this.onDisconnectHandler),this.provider.on(ct.error,this.onProviderErrorHandler)},this.core=e.core,this.logger=typeof e.logger<"u"&&typeof e.logger!="string"?Ee.generateChildLogger(e.logger,this.name):Ee.pino(Ee.getDefaultLoggerOptions({level:e.logger||So})),this.messages=new qo(this.logger,e.core),this.subscriber=new ha(this,this.logger),this.publisher=new Gg(this,this.logger),this.relayUrl=e?.relayUrl||tn,this.projectId=e.projectId,this.bundleId=pd(),this.provider={}}async init(){this.logger.trace("Initialized"),this.registerEventListeners(),await this.createProvider(),await Promise.all([this.messages.init(),this.subscriber.init()]);try{await this.transportOpen()}catch{this.logger.warn(`Connection via ${this.relayUrl} failed, attempting to connect via failover domain ${rn}...`),await this.restartTransport(rn)}this.initialized=!0,setTimeout(async()=>{this.subscriber.topics.length===0&&this.subscriber.pending.size===0&&(this.logger.info("No topics subscribed to after init, closing transport"),await this.transportClose(),this.transportExplicitlyClosed=!1)},Ro)}get context(){return Ee.getLoggerContext(this.logger)}get connected(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===1}get connecting(){var e,r,i;return((i=(r=(e=this.provider)==null?void 0:e.connection)==null?void 0:r.socket)==null?void 0:i.readyState)===0}async publish(e,r,i){this.isInitialized(),await this.publisher.publish(e,r,i),await this.recordMessageEvent({topic:e,message:r,publishedAt:Date.now()})}async subscribe(e,r){var i;this.isInitialized();let n=((i=this.subscriber.topicMap.get(e))==null?void 0:i[0])||"",s;const f=u=>{u.topic===e&&(this.subscriber.off(_t.created,f),s())};return await Promise.all([new Promise(u=>{s=u,this.subscriber.on(_t.created,f)}),new Promise(async u=>{n=await this.subscriber.subscribe(e,r)||n,u()})]),n}async unsubscribe(e,r){this.isInitialized(),await this.subscriber.unsubscribe(e,r)}on(e,r){this.events.on(e,r)}once(e,r){this.events.once(e,r)}off(e,r){this.events.off(e,r)}removeListener(e,r){this.events.removeListener(e,r)}async transportDisconnect(){if(!this.hasExperiencedNetworkDisruption&&this.connected&&this.requestsInFlight.size>0)try{await Promise.all(Array.from(this.requestsInFlight.values()).map(e=>e.promise))}catch(e){this.logger.warn(e)}this.hasExperiencedNetworkDisruption||this.connected?await yr(this.provider.disconnect(),2e3,"provider.disconnect()").catch(()=>this.onProviderDisconnect()):this.onProviderDisconnect()}async transportClose(){this.transportExplicitlyClosed=!0,await this.transportDisconnect()}async transportOpen(e){await this.confirmOnlineStateOrThrow(),e&&e!==this.relayUrl&&(this.relayUrl=e,await this.transportDisconnect(),await this.createProvider()),this.connectionAttemptInProgress=!0,this.transportExplicitlyClosed=!1;try{await new Promise(async(r,i)=>{const n=()=>{this.provider.off(ct.disconnect,n),i(new Error("Connection interrupted while trying to subscribe"))};this.provider.on(ct.disconnect,n),await yr(this.provider.connect(),Z.toMiliseconds(Z.ONE_MINUTE),`Socket stalled when trying to connect to ${this.relayUrl}`).catch(s=>{i(s)}),await this.subscriber.start(),this.hasExperiencedNetworkDisruption=!1,r()})}catch(r){this.logger.error(r);const i=r;if(!this.isConnectionStalled(i.message))throw r}finally{this.connectionAttemptInProgress=!1}}async restartTransport(e){this.connectionAttemptInProgress||(this.relayUrl=e||this.relayUrl,await this.confirmOnlineStateOrThrow(),await this.transportClose(),await this.createProvider(),await this.transportOpen())}async confirmOnlineStateOrThrow(){if(!await fo())throw new Error("No internet connection detected. Please restart your network and try again.")}startPingTimeout(){var e,r,i,n,s;if(gr())try{(r=(e=this.provider)==null?void 0:e.connection)!=null&&r.socket&&((s=(n=(i=this.provider)==null?void 0:i.connection)==null?void 0:n.socket)==null||s.once("ping",()=>{this.resetPingTimeout()})),this.resetPingTimeout()}catch(f){this.logger.warn(f)}}isConnectionStalled(e){return this.staleConnectionErrors.some(r=>e.includes(r))}async createProvider(){this.provider.connection&&this.unregisterProviderListeners();const e=await this.core.crypto.signJWT(this.relayUrl);this.provider=new Fg(new Hg(md({sdkVersion:xo,protocol:this.protocol,version:this.version,relayUrl:this.relayUrl,projectId:this.projectId,auth:e,useOnCloseEvent:!0,bundleId:this.bundleId}))),this.registerProviderListeners()}async recordMessageEvent(e){const{topic:r,message:i}=e;await this.messages.set(r,i)}async shouldIgnoreMessageEvent(e){const{topic:r,message:i}=e;if(!i||i.length===0)return this.logger.debug(`Ignoring invalid/empty message: ${i}`),!0;if(!await this.subscriber.isSubscribed(r))return this.logger.debug(`Ignoring message for non-subscribed topic ${r}`),!0;const n=this.messages.has(r,i);return n&&this.logger.debug(`Ignoring duplicate message: ${i}`),n}async onProviderPayload(e){if(this.logger.debug("Incoming Relay Payload"),this.logger.trace({type:"payload",direction:"incoming",payload:e}),sa(e)){if(!e.method.endsWith(Io))return;const r=e.params,{topic:i,message:n,publishedAt:s}=r.data,f={topic:i,message:n,publishedAt:s};this.logger.debug("Emitting Relayer Payload"),this.logger.trace(e0({type:"event",event:r.id},f)),this.events.emit(r.id,f),await this.acknowledgePayload(e),await this.onMessageEvent(f)}else fn(e)&&this.events.emit(lt.message_ack,e)}async onMessageEvent(e){await this.shouldIgnoreMessageEvent(e)||(this.events.emit(lt.message,e),await this.recordMessageEvent(e))}async acknowledgePayload(e){const r=ta(e.id,!0);await this.provider.connection.send(r)}unregisterProviderListeners(){this.provider.off(ct.payload,this.onPayloadHandler),this.provider.off(ct.connect,this.onConnectHandler),this.provider.off(ct.disconnect,this.onDisconnectHandler),this.provider.off(ct.error,this.onProviderErrorHandler)}async registerEventListeners(){let e=await fo();Wd(async r=>{e!==r&&(e=r,r?await this.restartTransport().catch(i=>this.logger.error(i)):(this.hasExperiencedNetworkDisruption=!0,await this.transportDisconnect(),this.transportExplicitlyClosed=!1))})}async onProviderDisconnect(){await this.subscriber.stop(),this.events.emit(lt.disconnect),this.connectionAttemptInProgress=!1,!this.transportExplicitlyClosed&&setTimeout(async()=>{await this.transportOpen().catch(e=>this.logger.error(e))},Z.toMiliseconds(To))}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}async toEstablishConnection(){await this.confirmOnlineStateOrThrow(),!this.connected&&(this.connectionAttemptInProgress&&await new Promise(e=>{const r=setInterval(()=>{this.connected&&(clearInterval(r),e())},this.connectionStatusPollingInterval)}),await this.transportOpen())}}var ln={exports:{}};(function(t,e){var r=200,i="__lodash_hash_undefined__",n=1,s=2,f=9007199254740991,u="[object Arguments]",h="[object Array]",c="[object AsyncFunction]",l="[object Boolean]",_="[object Date]",p="[object Error]",b="[object Function]",O="[object GeneratorFunction]",A="[object Map]",L="[object Number]",G="[object Null]",E="[object Object]",R="[object Promise]",w="[object Proxy]",m="[object RegExp]",g="[object Set]",o="[object String]",d="[object Symbol]",N="[object Undefined]",P="[object WeakMap]",K="[object ArrayBuffer]",V="[object DataView]",J="[object Float32Array]",I="[object Float64Array]",C="[object Int8Array]",W="[object Int16Array]",F="[object Int32Array]",M="[object Uint8Array]",j="[object Uint8ClampedArray]",U="[object Uint16Array]",B="[object Uint32Array]",te=/[\\^$.*+?()[\]{}|]/g,z=/^\[object .+?Constructor\]$/,Q=/^(?:0|[1-9]\d*)$/,k={};k[J]=k[I]=k[C]=k[W]=k[F]=k[M]=k[j]=k[U]=k[B]=!0,k[u]=k[h]=k[K]=k[l]=k[V]=k[_]=k[p]=k[b]=k[A]=k[L]=k[E]=k[m]=k[g]=k[o]=k[P]=!1;var ee=typeof st=="object"&&st&&st.Object===Object&&st,x=typeof self=="object"&&self&&self.Object===Object&&self,T=ee||x||Function("return this")(),D=e&&!e.nodeType&&e,a=D&&!0&&t&&!t.nodeType&&t,v=a&&a.exports===D,H=v&&ee.process,Y=function(){try{return H&&H.binding&&H.binding("util")}catch{}}(),he=Y&&Y.isTypedArray;function _e(y,S){for(var $=-1,X=y==null?0:y.length,xe=0,se=[];++$<X;){var Ne=y[$];S(Ne,$,y)&&(se[xe++]=Ne)}return se}function de(y,S){for(var $=-1,X=S.length,xe=y.length;++$<X;)y[xe+$]=S[$];return y}function we(y,S){for(var $=-1,X=y==null?0:y.length;++$<X;)if(S(y[$],$,y))return!0;return!1}function Ue(y,S){for(var $=-1,X=Array(y);++$<y;)X[$]=S($);return X}function Ae(y){return function(S){return y(S)}}function pe(y,S){return y.has(S)}function ge(y,S){return y?.[S]}function le(y){var S=-1,$=Array(y.size);return y.forEach(function(X,xe){$[++S]=[xe,X]}),$}function ue(y,S){return function($){return y(S($))}}function ce(y){var S=-1,$=Array(y.size);return y.forEach(function(X){$[++S]=X}),$}var ae=Array.prototype,oe=Function.prototype,re=Object.prototype,fe=T["__core-js_shared__"],ye=oe.toString,ne=re.hasOwnProperty,be=function(){var y=/[^.]+$/.exec(fe&&fe.keys&&fe.keys.IE_PROTO||"");return y?"Symbol(src)_1."+y:""}(),ve=re.toString,Se=RegExp("^"+ye.call(ne).replace(te,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),Oe=v?T.Buffer:void 0,me=T.Symbol,vt=T.Uint8Array,Et=re.propertyIsEnumerable,Rt=ae.splice,ut=me?me.toStringTag:void 0,zt=Object.getOwnPropertySymbols,mr=Oe?Oe.isBuffer:void 0,Zr=ue(Object.keys,Object),Me=er(T,"DataView"),Pe=er(T,"Map"),$e=er(T,"Promise"),je=er(T,"Set"),Fe=er(T,"WeakMap"),Le=er(Object,"create"),He=Ht(Me),Ge=Ht(Pe),Ve=Ht($e),qe=Ht(je),We=Ht(Fe),ze=me?me.prototype:void 0,Be=ze?ze.valueOf:void 0;function Re(y){var S=-1,$=y==null?0:y.length;for(this.clear();++S<$;){var X=y[S];this.set(X[0],X[1])}}function Ye(){this.__data__=Le?Le(null):{},this.size=0}function ke(y){var S=this.has(y)&&delete this.__data__[y];return this.size-=S?1:0,S}function l0(y){var S=this.__data__;if(Le){var $=S[y];return $===i?void 0:$}return ne.call(S,y)?S[y]:void 0}function d0(y){var S=this.__data__;return Le?S[y]!==void 0:ne.call(S,y)}function g0(y,S){var $=this.__data__;return this.size+=this.has(y)?0:1,$[y]=Le&&S===void 0?i:S,this}Re.prototype.clear=Ye,Re.prototype.delete=ke,Re.prototype.get=l0,Re.prototype.has=d0,Re.prototype.set=g0;function It(y){var S=-1,$=y==null?0:y.length;for(this.clear();++S<$;){var X=y[S];this.set(X[0],X[1])}}function y0(){this.__data__=[],this.size=0}function p0(y){var S=this.__data__,$=ti(S,y);if($<0)return!1;var X=S.length-1;return $==X?S.pop():Rt.call(S,$,1),--this.size,!0}function _0(y){var S=this.__data__,$=ti(S,y);return $<0?void 0:S[$][1]}function b0(y){return ti(this.__data__,y)>-1}function v0(y,S){var $=this.__data__,X=ti($,y);return X<0?(++this.size,$.push([y,S])):$[X][1]=S,this}It.prototype.clear=y0,It.prototype.delete=p0,It.prototype.get=_0,It.prototype.has=b0,It.prototype.set=v0;function Kt(y){var S=-1,$=y==null?0:y.length;for(this.clear();++S<$;){var X=y[S];this.set(X[0],X[1])}}function w0(){this.size=0,this.__data__={hash:new Re,map:new(Pe||It),string:new Re}}function m0(y){var S=ri(this,y).delete(y);return this.size-=S?1:0,S}function E0(y){return ri(this,y).get(y)}function D0(y){return ri(this,y).has(y)}function S0(y,S){var $=ri(this,y),X=$.size;return $.set(y,S),this.size+=$.size==X?0:1,this}Kt.prototype.clear=w0,Kt.prototype.delete=m0,Kt.prototype.get=E0,Kt.prototype.has=D0,Kt.prototype.set=S0;function ei(y){var S=-1,$=y==null?0:y.length;for(this.__data__=new Kt;++S<$;)this.add(y[S])}function O0(y){return this.__data__.set(y,i),this}function I0(y){return this.__data__.has(y)}ei.prototype.add=ei.prototype.push=O0,ei.prototype.has=I0;function Ct(y){var S=this.__data__=new It(y);this.size=S.size}function T0(){this.__data__=new It,this.size=0}function x0(y){var S=this.__data__,$=S.delete(y);return this.size=S.size,$}function R0(y){return this.__data__.get(y)}function C0(y){return this.__data__.has(y)}function A0(y,S){var $=this.__data__;if($ instanceof It){var X=$.__data__;if(!Pe||X.length<r-1)return X.push([y,S]),this.size=++$.size,this;$=this.__data__=new Kt(X)}return $.set(y,S),this.size=$.size,this}Ct.prototype.clear=T0,Ct.prototype.delete=x0,Ct.prototype.get=R0,Ct.prototype.has=C0,Ct.prototype.set=A0;function P0(y,S){var $=ii(y),X=!$&&W0(y),xe=!$&&!X&&dn(y),se=!$&&!X&&!xe&&Ma(y),Ne=$||X||xe||se,Xe=Ne?Ue(y.length,String):[],Qe=Xe.length;for(var Ce in y)(S||ne.call(y,Ce))&&!(Ne&&(Ce=="length"||xe&&(Ce=="offset"||Ce=="parent")||se&&(Ce=="buffer"||Ce=="byteLength"||Ce=="byteOffset")||K0(Ce,Qe)))&&Xe.push(Ce);return Xe}function ti(y,S){for(var $=y.length;$--;)if(Pa(y[$][0],S))return $;return-1}function L0(y,S,$){var X=S(y);return ii(y)?X:de(X,$(y))}function Er(y){return y==null?y===void 0?N:G:ut&&ut in Object(y)?B0(y):q0(y)}function xa(y){return Dr(y)&&Er(y)==u}function Ra(y,S,$,X,xe){return y===S?!0:y==null||S==null||!Dr(y)&&!Dr(S)?y!==y&&S!==S:N0(y,S,$,X,Ra,xe)}function N0(y,S,$,X,xe,se){var Ne=ii(y),Xe=ii(S),Qe=Ne?h:At(y),Ce=Xe?h:At(S);Qe=Qe==u?E:Qe,Ce=Ce==u?E:Ce;var ft=Qe==E,wt=Ce==E,et=Qe==Ce;if(et&&dn(y)){if(!dn(S))return!1;Ne=!0,ft=!1}if(et&&!ft)return se||(se=new Ct),Ne||Ma(y)?Ca(y,S,$,X,xe,se):j0(y,S,Qe,$,X,xe,se);if(!($&n)){var gt=ft&&ne.call(y,"__wrapped__"),yt=wt&&ne.call(S,"__wrapped__");if(gt||yt){var Pt=gt?y.value():y,Tt=yt?S.value():S;return se||(se=new Ct),xe(Pt,Tt,$,X,se)}}return et?(se||(se=new Ct),F0(y,S,$,X,xe,se)):!1}function U0(y){if(!Ua(y)||G0(y))return!1;var S=La(y)?Se:z;return S.test(Ht(y))}function M0(y){return Dr(y)&&Na(y.length)&&!!k[Er(y)]}function $0(y){if(!V0(y))return Zr(y);var S=[];for(var $ in Object(y))ne.call(y,$)&&$!="constructor"&&S.push($);return S}function Ca(y,S,$,X,xe,se){var Ne=$&n,Xe=y.length,Qe=S.length;if(Xe!=Qe&&!(Ne&&Qe>Xe))return!1;var Ce=se.get(y);if(Ce&&se.get(S))return Ce==S;var ft=-1,wt=!0,et=$&s?new ei:void 0;for(se.set(y,S),se.set(S,y);++ft<Xe;){var gt=y[ft],yt=S[ft];if(X)var Pt=Ne?X(yt,gt,ft,S,y,se):X(gt,yt,ft,y,S,se);if(Pt!==void 0){if(Pt)continue;wt=!1;break}if(et){if(!we(S,function(Tt,Gt){if(!pe(et,Gt)&&(gt===Tt||xe(gt,Tt,$,X,se)))return et.push(Gt)})){wt=!1;break}}else if(!(gt===yt||xe(gt,yt,$,X,se))){wt=!1;break}}return se.delete(y),se.delete(S),wt}function j0(y,S,$,X,xe,se,Ne){switch($){case V:if(y.byteLength!=S.byteLength||y.byteOffset!=S.byteOffset)return!1;y=y.buffer,S=S.buffer;case K:return!(y.byteLength!=S.byteLength||!se(new vt(y),new vt(S)));case l:case _:case L:return Pa(+y,+S);case p:return y.name==S.name&&y.message==S.message;case m:case o:return y==S+"";case A:var Xe=le;case g:var Qe=X&n;if(Xe||(Xe=ce),y.size!=S.size&&!Qe)return!1;var Ce=Ne.get(y);if(Ce)return Ce==S;X|=s,Ne.set(y,S);var ft=Ca(Xe(y),Xe(S),X,xe,se,Ne);return Ne.delete(y),ft;case d:if(Be)return Be.call(y)==Be.call(S)}return!1}function F0(y,S,$,X,xe,se){var Ne=$&n,Xe=Aa(y),Qe=Xe.length,Ce=Aa(S),ft=Ce.length;if(Qe!=ft&&!Ne)return!1;for(var wt=Qe;wt--;){var et=Xe[wt];if(!(Ne?et in S:ne.call(S,et)))return!1}var gt=se.get(y);if(gt&&se.get(S))return gt==S;var yt=!0;se.set(y,S),se.set(S,y);for(var Pt=Ne;++wt<Qe;){et=Xe[wt];var Tt=y[et],Gt=S[et];if(X)var $a=Ne?X(Gt,Tt,et,S,y,se):X(Tt,Gt,et,y,S,se);if(!($a===void 0?Tt===Gt||xe(Tt,Gt,$,X,se):$a)){yt=!1;break}Pt||(Pt=et=="constructor")}if(yt&&!Pt){var ni=y.constructor,si=S.constructor;ni!=si&&"constructor"in y&&"constructor"in S&&!(typeof ni=="function"&&ni instanceof ni&&typeof si=="function"&&si instanceof si)&&(yt=!1)}return se.delete(y),se.delete(S),yt}function Aa(y){return L0(y,X0,z0)}function ri(y,S){var $=y.__data__;return H0(S)?$[typeof S=="string"?"string":"hash"]:$.map}function er(y,S){var $=ge(y,S);return U0($)?$:void 0}function B0(y){var S=ne.call(y,ut),$=y[ut];try{y[ut]=void 0;var X=!0}catch{}var xe=ve.call(y);return X&&(S?y[ut]=$:delete y[ut]),xe}var z0=zt?function(y){return y==null?[]:(y=Object(y),_e(zt(y),function(S){return Et.call(y,S)}))}:J0,At=Er;(Me&&At(new Me(new ArrayBuffer(1)))!=V||Pe&&At(new Pe)!=A||$e&&At($e.resolve())!=R||je&&At(new je)!=g||Fe&&At(new Fe)!=P)&&(At=function(y){var S=Er(y),$=S==E?y.constructor:void 0,X=$?Ht($):"";if(X)switch(X){case He:return V;case Ge:return A;case Ve:return R;case qe:return g;case We:return P}return S});function K0(y,S){return S=S??f,!!S&&(typeof y=="number"||Q.test(y))&&y>-1&&y%1==0&&y<S}function H0(y){var S=typeof y;return S=="string"||S=="number"||S=="symbol"||S=="boolean"?y!=="__proto__":y===null}function G0(y){return!!be&&be in y}function V0(y){var S=y&&y.constructor,$=typeof S=="function"&&S.prototype||re;return y===$}function q0(y){return ve.call(y)}function Ht(y){if(y!=null){try{return ye.call(y)}catch{}try{return y+""}catch{}}return""}function Pa(y,S){return y===S||y!==y&&S!==S}var W0=xa(function(){return arguments}())?xa:function(y){return Dr(y)&&ne.call(y,"callee")&&!Et.call(y,"callee")},ii=Array.isArray;function Y0(y){return y!=null&&Na(y.length)&&!La(y)}var dn=mr||Q0;function k0(y,S){return Ra(y,S)}function La(y){if(!Ua(y))return!1;var S=Er(y);return S==b||S==O||S==c||S==w}function Na(y){return typeof y=="number"&&y>-1&&y%1==0&&y<=f}function Ua(y){var S=typeof y;return y!=null&&(S=="object"||S=="function")}function Dr(y){return y!=null&&typeof y=="object"}var Ma=he?Ae(he):M0;function X0(y){return Y0(y)?P0(y):$0(y)}function J0(){return[]}function Q0(){return!1}t.exports=k0})(ln,ln.exports);var t0=ln.exports,r0=Object.defineProperty,ya=Object.getOwnPropertySymbols,i0=Object.prototype.hasOwnProperty,n0=Object.prototype.propertyIsEnumerable,pa=(t,e,r)=>e in t?r0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,_a=(t,e)=>{for(var r in e||(e={}))i0.call(e,r)&&pa(t,r,e[r]);if(ya)for(var r of ya(e))n0.call(e,r)&&pa(t,r,e[r]);return t};class ba extends Xu{constructor(e,r,i,n=Dt,s=void 0){super(e,r,i,n),this.core=e,this.logger=r,this.name=i,this.map=new Map,this.version=Co,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.recentlyDeleted=[],this.recentlyDeletedLimit=200,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(f=>{this.getKey&&f!==null&&!Wr(f)?this.map.set(this.getKey(f),f):Kd(f)?this.map.set(f.id,f):Hd(f)&&this.map.set(f.topic,f)}),this.cached=[],this.initialized=!0)},this.set=async(f,u)=>{this.isInitialized(),this.map.has(f)?await this.update(f,u):(this.logger.debug("Setting value"),this.logger.trace({type:"method",method:"set",key:f,value:u}),this.map.set(f,u),await this.persist())},this.get=f=>(this.isInitialized(),this.logger.debug("Getting value"),this.logger.trace({type:"method",method:"get",key:f}),this.getData(f)),this.getAll=f=>(this.isInitialized(),f?this.values.filter(u=>Object.keys(f).every(h=>t0(u[h],f[h]))):this.values),this.update=async(f,u)=>{this.isInitialized(),this.logger.debug("Updating value"),this.logger.trace({type:"method",method:"update",key:f,update:u});const h=_a(_a({},this.getData(f)),u);this.map.set(f,h),await this.persist()},this.delete=async(f,u)=>{this.isInitialized(),this.map.has(f)&&(this.logger.debug("Deleting value"),this.logger.trace({type:"method",method:"delete",key:f,reason:u}),this.map.delete(f),this.addToRecentlyDeleted(f),await this.persist())},this.logger=Ee.generateChildLogger(r,this.name),this.storagePrefix=n,this.getKey=s}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.map.size}get keys(){return Array.from(this.map.keys())}get values(){return Array.from(this.map.values())}addToRecentlyDeleted(e){this.recentlyDeleted.push(e),this.recentlyDeleted.length>=this.recentlyDeletedLimit&&this.recentlyDeleted.splice(0,this.recentlyDeletedLimit/2)}async setDataStore(e){await this.core.storage.setItem(this.storageKey,e)}async getDataStore(){return await this.core.storage.getItem(this.storageKey)}getData(e){const r=this.map.get(e);if(!r){if(this.recentlyDeleted.includes(e)){const{message:n}=De("MISSING_OR_INVALID",`Record was recently deleted - ${this.name}: ${e}`);throw this.logger.error(n),new Error(n)}const{message:i}=De("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.error(i),new Error(i)}return r}async persist(){await this.setDataStore(this.values)}async restore(){try{const e=await this.getDataStore();if(typeof e>"u"||!e.length)return;if(this.map.size){const{message:r}=De("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored value for ${this.name}`),this.logger.trace({type:"method",method:"restore",value:this.values})}catch(e){this.logger.debug(`Failed to Restore value for ${this.name}`),this.logger.error(e)}}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}}class va{constructor(e,r){this.core=e,this.logger=r,this.name=Uo,this.version=Mo,this.events=new ht.exports,this.initialized=!1,this.storagePrefix=Dt,this.ignoredPayloadTypes=[Xt],this.registeredMethods=[],this.init=async()=>{this.initialized||(await this.pairings.init(),await this.cleanup(),this.registerRelayerEvents(),this.registerExpirerEvents(),this.initialized=!0,this.logger.trace("Initialized"))},this.register=({methods:i})=>{this.isInitialized(),this.registeredMethods=[...new Set([...this.registeredMethods,...i])]},this.create=async()=>{this.isInitialized();const i=Yi(),n=await this.core.crypto.setSymKey(i),s=Vr(Z.FIVE_MINUTES),f={protocol:Do},u={topic:n,expiry:s,relay:f,active:!1},h=$d({protocol:this.core.protocol,version:this.core.version,topic:n,symKey:i,relay:f,expiryTimestamp:s});return await this.pairings.set(n,u),await this.core.relayer.subscribe(n),this.core.expirer.set(n,s),{topic:n,uri:h}},this.pair=async i=>{this.isInitialized(),this.isValidPair(i);const{topic:n,symKey:s,relay:f,expiryTimestamp:u}=co(i.uri);let h;if(this.pairings.keys.includes(n)&&(h=this.pairings.get(n),h.active))throw new Error(`Pairing already exists: ${n}. Please try again with a new connection URI.`);const c=u||Vr(Z.FIVE_MINUTES),l={topic:n,relay:f,expiry:c,active:!1};return await this.pairings.set(n,l),this.core.expirer.set(n,c),i.activatePairing&&await this.activate({topic:n}),this.events.emit(_r.create,l),this.core.crypto.keychain.has(n)||await this.core.crypto.setSymKey(s,n),await this.core.relayer.subscribe(n,{relay:f}),l},this.activate=async({topic:i})=>{this.isInitialized();const n=Vr(Z.THIRTY_DAYS);await this.pairings.update(i,{active:!0,expiry:n}),this.core.expirer.set(i,n)},this.ping=async i=>{this.isInitialized(),await this.isValidPing(i);const{topic:n}=i;if(this.pairings.keys.includes(n)){const s=await this.sendRequest(n,"wc_pairingPing",{}),{done:f,resolve:u,reject:h}=Ed();this.events.once(Xi("pairing_ping",s),({error:c})=>{c?h(c):u()}),await f()}},this.updateExpiry=async({topic:i,expiry:n})=>{this.isInitialized(),await this.pairings.update(i,{expiry:n})},this.updateMetadata=async({topic:i,metadata:n})=>{this.isInitialized(),await this.pairings.update(i,{peerMetadata:n})},this.getPairings=()=>(this.isInitialized(),this.pairings.values),this.disconnect=async i=>{this.isInitialized(),await this.isValidDisconnect(i);const{topic:n}=i;this.pairings.keys.includes(n)&&(await this.sendRequest(n,"wc_pairingDelete",pr("USER_DISCONNECTED")),await this.deletePairing(n))},this.sendRequest=async(i,n,s)=>{const f=un(n,s),u=await this.core.crypto.encode(i,f),h=Qt[n].req;return this.core.history.set(i,f),this.core.relayer.publish(i,u,h),f.id},this.sendResult=async(i,n,s)=>{const f=ta(i,s),u=await this.core.crypto.encode(n,f),h=await this.core.history.get(n,i),c=Qt[h.request.method].res;await this.core.relayer.publish(n,u,c),await this.core.history.resolve(f)},this.sendError=async(i,n,s)=>{const f=ra(i,s),u=await this.core.crypto.encode(n,f),h=await this.core.history.get(n,i),c=Qt[h.request.method]?Qt[h.request.method].res:Qt.unregistered_method.res;await this.core.relayer.publish(n,u,c),await this.core.history.resolve(f)},this.deletePairing=async(i,n)=>{await this.core.relayer.unsubscribe(i),await Promise.all([this.pairings.delete(i,pr("USER_DISCONNECTED")),this.core.crypto.deleteSymKey(i),n?Promise.resolve():this.core.expirer.del(i)])},this.cleanup=async()=>{const i=this.pairings.getAll().filter(n=>so(n.expiry));await Promise.all(i.map(n=>this.deletePairing(n.topic)))},this.onRelayEventRequest=i=>{const{topic:n,payload:s}=i;switch(s.method){case"wc_pairingPing":return this.onPairingPingRequest(n,s);case"wc_pairingDelete":return this.onPairingDeleteRequest(n,s);default:return this.onUnknownRpcMethodRequest(n,s)}},this.onRelayEventResponse=async i=>{const{topic:n,payload:s}=i,f=(await this.core.history.get(n,s.id)).request.method;switch(f){case"wc_pairingPing":return this.onPairingPingResponse(n,s);default:return this.onUnknownRpcMethodResponse(f)}},this.onPairingPingRequest=async(i,n)=>{const{id:s}=n;try{this.isValidPing({topic:i}),await this.sendResult(s,i,!0),this.events.emit(_r.ping,{id:s,topic:i})}catch(f){await this.sendError(s,i,f),this.logger.error(f)}},this.onPairingPingResponse=(i,n)=>{const{id:s}=n;setTimeout(()=>{oa(n)?this.events.emit(Xi("pairing_ping",s),{}):Jr(n)&&this.events.emit(Xi("pairing_ping",s),{error:n.error})},500)},this.onPairingDeleteRequest=async(i,n)=>{const{id:s}=n;try{this.isValidDisconnect({topic:i}),await this.deletePairing(i),this.events.emit(_r.delete,{id:s,topic:i})}catch(f){await this.sendError(s,i,f),this.logger.error(f)}},this.onUnknownRpcMethodRequest=async(i,n)=>{const{id:s,method:f}=n;try{if(this.registeredMethods.includes(f))return;const u=pr("WC_METHOD_UNSUPPORTED",f);await this.sendError(s,i,u),this.logger.error(u)}catch(u){await this.sendError(s,i,u),this.logger.error(u)}},this.onUnknownRpcMethodResponse=i=>{this.registeredMethods.includes(i)||this.logger.error(pr("WC_METHOD_UNSUPPORTED",i))},this.isValidPair=i=>{var n;if(!Qi(i)){const{message:f}=De("MISSING_OR_INVALID",`pair() params: ${i}`);throw new Error(f)}if(!zd(i.uri)){const{message:f}=De("MISSING_OR_INVALID",`pair() uri: ${i.uri}`);throw new Error(f)}const s=co(i.uri);if(!((n=s?.relay)!=null&&n.protocol)){const{message:f}=De("MISSING_OR_INVALID","pair() uri#relay-protocol");throw new Error(f)}if(!(s!=null&&s.symKey)){const{message:f}=De("MISSING_OR_INVALID","pair() uri#symKey");throw new Error(f)}if(s!=null&&s.expiryTimestamp&&Z.toMiliseconds(s?.expiryTimestamp)<Date.now()){const{message:f}=De("EXPIRED","pair() URI has expired. Please try again with a new connection URI.");throw new Error(f)}},this.isValidPing=async i=>{if(!Qi(i)){const{message:s}=De("MISSING_OR_INVALID",`ping() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidDisconnect=async i=>{if(!Qi(i)){const{message:s}=De("MISSING_OR_INVALID",`disconnect() params: ${i}`);throw new Error(s)}const{topic:n}=i;await this.isValidPairingTopic(n)},this.isValidPairingTopic=async i=>{if(!uo(i,!1)){const{message:n}=De("MISSING_OR_INVALID",`pairing topic should be a string: ${i}`);throw new Error(n)}if(!this.pairings.keys.includes(i)){const{message:n}=De("NO_MATCHING_KEY",`pairing topic doesn't exist: ${i}`);throw new Error(n)}if(so(this.pairings.get(i).expiry)){await this.deletePairing(i);const{message:n}=De("EXPIRED",`pairing topic: ${i}`);throw new Error(n)}},this.core=e,this.logger=Ee.generateChildLogger(r,this.name),this.pairings=new ba(this.core,this.logger,this.name,this.storagePrefix)}get context(){return Ee.getLoggerContext(this.logger)}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}registerRelayerEvents(){this.core.relayer.on(lt.message,async e=>{const{topic:r,message:i}=e;if(!this.pairings.keys.includes(r)||this.ignoredPayloadTypes.includes(this.core.crypto.getPayloadType(i)))return;const n=await this.core.crypto.decode(r,i);try{sa(n)?(this.core.history.set(r,n),this.onRelayEventRequest({topic:r,payload:n})):fn(n)&&(await this.core.history.resolve(n),await this.onRelayEventResponse({topic:r,payload:n}),this.core.history.delete(r,n.id))}catch(s){this.logger.error(s)}})}registerExpirerEvents(){this.core.expirer.on(dt.expired,async e=>{const{topic:r}=Od(e.target);r&&this.pairings.keys.includes(r)&&(await this.deletePairing(r,!0),this.events.emit(_r.expire,{topic:r}))})}}class wa extends qu{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.records=new Map,this.events=new ht.exports.EventEmitter,this.name=$o,this.version=jo,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.records.set(i.id,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.set=(i,n,s)=>{if(this.isInitialized(),this.logger.debug("Setting JSON-RPC request history record"),this.logger.trace({type:"method",method:"set",topic:i,request:n,chainId:s}),this.records.has(n.id))return;const f={id:n.id,topic:i,request:{method:n.method,params:n.params||null},chainId:s,expiry:Vr(Z.THIRTY_DAYS)};this.records.set(f.id,f),this.events.emit(bt.created,f)},this.resolve=async i=>{if(this.isInitialized(),this.logger.debug("Updating JSON-RPC response history record"),this.logger.trace({type:"method",method:"update",response:i}),!this.records.has(i.id))return;const n=await this.getRecord(i.id);typeof n.response>"u"&&(n.response=Jr(i)?{error:i.error}:{result:i.result},this.records.set(n.id,n),this.events.emit(bt.updated,n))},this.get=async(i,n)=>(this.isInitialized(),this.logger.debug("Getting record"),this.logger.trace({type:"method",method:"get",topic:i,id:n}),await this.getRecord(n)),this.delete=(i,n)=>{this.isInitialized(),this.logger.debug("Deleting record"),this.logger.trace({type:"method",method:"delete",id:n}),this.values.forEach(s=>{if(s.topic===i){if(typeof n<"u"&&s.id!==n)return;this.records.delete(s.id),this.events.emit(bt.deleted,s)}})},this.exists=async(i,n)=>(this.isInitialized(),this.records.has(n)?(await this.getRecord(n)).topic===i:!1),this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get size(){return this.records.size}get keys(){return Array.from(this.records.keys())}get values(){return Array.from(this.records.values())}get pending(){const e=[];return this.values.forEach(r=>{if(typeof r.response<"u")return;const i={topic:r.topic,request:un(r.request.method,r.request.params,r.id),chainId:r.chainId};return e.push(i)}),e}async setJsonRpcRecords(e){await this.core.storage.setItem(this.storageKey,e)}async getJsonRpcRecords(){return await this.core.storage.getItem(this.storageKey)}getRecord(e){this.isInitialized();const r=this.records.get(e);if(!r){const{message:i}=De("NO_MATCHING_KEY",`${this.name}: ${e}`);throw new Error(i)}return r}async persist(){await this.setJsonRpcRecords(this.values),this.events.emit(bt.sync)}async restore(){try{const e=await this.getJsonRpcRecords();if(typeof e>"u"||!e.length)return;if(this.records.size){const{message:r}=De("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored records for ${this.name}`),this.logger.trace({type:"method",method:"restore",records:this.values})}catch(e){this.logger.debug(`Failed to Restore records for ${this.name}`),this.logger.error(e)}}registerEventListeners(){this.events.on(bt.created,e=>{const r=bt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(bt.updated,e=>{const r=bt.updated;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.events.on(bt.deleted,e=>{const r=bt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,record:e}),this.persist()}),this.core.heartbeat.on(qt.HEARTBEAT_EVENTS.pulse,()=>{this.cleanup()})}cleanup(){try{this.records.forEach(e=>{Z.toMiliseconds(e.expiry||0)-Date.now()<=0&&(this.logger.info(`Deleting expired history log: ${e.id}`),this.delete(e.topic,e.id))})}catch(e){this.logger.warn(e)}}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}}class ma extends Qu{constructor(e,r){super(e,r),this.core=e,this.logger=r,this.expirations=new Map,this.events=new ht.exports.EventEmitter,this.name=Fo,this.version=Bo,this.cached=[],this.initialized=!1,this.storagePrefix=Dt,this.init=async()=>{this.initialized||(this.logger.trace("Initialized"),await this.restore(),this.cached.forEach(i=>this.expirations.set(i.target,i)),this.cached=[],this.registerEventListeners(),this.initialized=!0)},this.has=i=>{try{const n=this.formatTarget(i);return typeof this.getExpiration(n)<"u"}catch{return!1}},this.set=(i,n)=>{this.isInitialized();const s=this.formatTarget(i),f={target:s,expiry:n};this.expirations.set(s,f),this.checkExpiry(s,f),this.events.emit(dt.created,{target:s,expiration:f})},this.get=i=>{this.isInitialized();const n=this.formatTarget(i);return this.getExpiration(n)},this.del=i=>{if(this.isInitialized(),this.has(i)){const n=this.formatTarget(i),s=this.getExpiration(n);this.expirations.delete(n),this.events.emit(dt.deleted,{target:n,expiration:s})}},this.on=(i,n)=>{this.events.on(i,n)},this.once=(i,n)=>{this.events.once(i,n)},this.off=(i,n)=>{this.events.off(i,n)},this.removeListener=(i,n)=>{this.events.removeListener(i,n)},this.logger=Ee.generateChildLogger(r,this.name)}get context(){return Ee.getLoggerContext(this.logger)}get storageKey(){return this.storagePrefix+this.version+this.core.customStoragePrefix+"//"+this.name}get length(){return this.expirations.size}get keys(){return Array.from(this.expirations.keys())}get values(){return Array.from(this.expirations.values())}formatTarget(e){if(typeof e=="string")return Dd(e);if(typeof e=="number")return Sd(e);const{message:r}=De("UNKNOWN_TYPE",`Target type: ${typeof e}`);throw new Error(r)}async setExpirations(e){await this.core.storage.setItem(this.storageKey,e)}async getExpirations(){return await this.core.storage.getItem(this.storageKey)}async persist(){await this.setExpirations(this.values),this.events.emit(dt.sync)}async restore(){try{const e=await this.getExpirations();if(typeof e>"u"||!e.length)return;if(this.expirations.size){const{message:r}=De("RESTORE_WILL_OVERRIDE",this.name);throw this.logger.error(r),new Error(r)}this.cached=e,this.logger.debug(`Successfully Restored expirations for ${this.name}`),this.logger.trace({type:"method",method:"restore",expirations:this.values})}catch(e){this.logger.debug(`Failed to Restore expirations for ${this.name}`),this.logger.error(e)}}getExpiration(e){const r=this.expirations.get(e);if(!r){const{message:i}=De("NO_MATCHING_KEY",`${this.name}: ${e}`);throw this.logger.warn(i),new Error(i)}return r}checkExpiry(e,r){const{expiry:i}=r;Z.toMiliseconds(i)-Date.now()<=0&&this.expire(e,r)}expire(e,r){this.expirations.delete(e),this.events.emit(dt.expired,{target:e,expiration:r})}checkExpirations(){this.core.relayer.connected&&this.expirations.forEach((e,r)=>this.checkExpiry(r,e))}registerEventListeners(){this.core.heartbeat.on(qt.HEARTBEAT_EVENTS.pulse,()=>this.checkExpirations()),this.events.on(dt.created,e=>{const r=dt.created;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(dt.expired,e=>{const r=dt.expired;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()}),this.events.on(dt.deleted,e=>{const r=dt.deleted;this.logger.info(`Emitting ${r}`),this.logger.debug({type:"event",event:r,data:e}),this.persist()})}isInitialized(){if(!this.initialized){const{message:e}=De("NOT_INITIALIZED",this.name);throw new Error(e)}}}class Ea extends Zu{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.name=kr,this.initialized=!1,this.queue=[],this.verifyDisabled=!1,this.init=async i=>{if(this.verifyDisabled||Jt()||!Hr())return;const n=this.getVerifyUrl(i?.verifyUrl);this.verifyUrl!==n&&this.removeIframe(),this.verifyUrl=n;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s)}if(!this.initialized){this.removeIframe(),this.verifyUrl=Xr;try{await this.createIframe()}catch(s){this.logger.info(`Verify iframe failed to load: ${this.verifyUrl}`),this.logger.info(s),this.verifyDisabled=!0}}},this.register=async i=>{this.initialized?this.sendPost(i.attestationId):(this.addToQueue(i.attestationId),await this.init())},this.resolve=async i=>{if(this.isDevEnv)return"";const n=this.getVerifyUrl(i?.verifyUrl);let s;try{s=await this.fetchAttestation(i.attestationId,n)}catch(f){this.logger.info(`failed to resolve attestation: ${i.attestationId} from url: ${n}`),this.logger.info(f),s=await this.fetchAttestation(i.attestationId,Xr)}return s},this.fetchAttestation=async(i,n)=>{this.logger.info(`resolving attestation: ${i} from url: ${n}`);const s=this.startAbortTimer(Z.ONE_SECOND*2),f=await fetch(`${n}/attestation/${i}`,{signal:this.abortController.signal});return clearTimeout(s),f.status===200?await f.json():void 0},this.addToQueue=i=>{this.queue.push(i)},this.processQueue=()=>{this.queue.length!==0&&(this.queue.forEach(i=>this.sendPost(i)),this.queue=[])},this.sendPost=i=>{var n;try{if(!this.iframe)return;(n=this.iframe.contentWindow)==null||n.postMessage(i,"*"),this.logger.info(`postMessage sent: ${i} ${this.verifyUrl}`)}catch{}},this.createIframe=async()=>{let i;const n=s=>{s.data==="verify_ready"&&(this.onInit(),window.removeEventListener("message",n),i())};await Promise.race([new Promise(s=>{const f=document.getElementById(kr);if(f)return this.iframe=f,this.onInit(),s();window.addEventListener("message",n);const u=document.createElement("iframe");u.id=kr,u.src=`${this.verifyUrl}/${this.projectId}`,u.style.display="none",document.body.append(u),this.iframe=u,i=s}),new Promise((s,f)=>setTimeout(()=>{window.removeEventListener("message",n),f("verify iframe load timeout")},Z.toMiliseconds(Z.FIVE_SECONDS)))])},this.onInit=()=>{this.initialized=!0,this.processQueue()},this.removeIframe=()=>{this.iframe&&(this.iframe.remove(),this.iframe=void 0,this.initialized=!1)},this.getVerifyUrl=i=>{let n=i||Zt;return zo.includes(n)||(this.logger.info(`verify url: ${n}, not included in trusted list, assigning default: ${Zt}`),n=Zt),n},this.logger=Ee.generateChildLogger(r,this.name),this.verifyUrl=Zt,this.abortController=new AbortController,this.isDevEnv=gr()&&process.env.IS_VITEST}get context(){return Ee.getLoggerContext(this.logger)}startAbortTimer(e){return this.abortController=new AbortController,setTimeout(()=>this.abortController.abort(),Z.toMiliseconds(e))}}function s0(t,e){return e=e||{},new Promise(function(r,i){var n=new XMLHttpRequest,s=[],f=[],u={},h=function(){return{ok:(n.status/100|0)==2,statusText:n.statusText,status:n.status,url:n.responseURL,text:function(){return Promise.resolve(n.responseText)},json:function(){return Promise.resolve(n.responseText).then(JSON.parse)},blob:function(){return Promise.resolve(new Blob([n.response]))},clone:h,headers:{keys:function(){return s},entries:function(){return f},get:function(l){return u[l.toLowerCase()]},has:function(l){return l.toLowerCase()in u}}}};for(var c in n.open(e.method||"get",t,!0),n.onload=function(){n.getAllResponseHeaders().replace(/^(.*?):[^\S\n]*([\s\S]*?)$/gm,function(l,_,p){s.push(_=_.toLowerCase()),f.push([_,p]),u[_]=u[_]?u[_]+","+p:p}),r(h())},n.onerror=i,n.withCredentials=e.credentials=="include",e.headers)n.setRequestHeader(c,e.headers[c]);n.send(e.body||null)})}var o0=Object.freeze({__proto__:null,default:s0}),Da=Lt(o0),a0=self.fetch||(self.fetch=Da.default||Da);class Sa extends ef{constructor(e,r){super(e,r),this.projectId=e,this.logger=r,this.context=Ko,this.registerDeviceToken=async i=>{const{clientId:n,token:s,notificationType:f,enableEncrypted:u=!1}=i,h=`${Ho}/${this.projectId}/clients`;await a0(h,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({client_id:n,type:f,token:s,always_raw:u})})},this.logger=Ee.generateChildLogger(r,this.context)}}var c0=Object.defineProperty,Oa=Object.getOwnPropertySymbols,u0=Object.prototype.hasOwnProperty,f0=Object.prototype.propertyIsEnumerable,Ia=(t,e,r)=>e in t?c0(t,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):t[e]=r,Ta=(t,e)=>{for(var r in e||(e={}))u0.call(e,r)&&Ia(t,r,e[r]);if(Oa)for(var r of Oa(e))f0.call(e,r)&&Ia(t,r,e[r]);return t};class Qr extends Vu{constructor(e){super(e),this.protocol=Zi,this.version=ho,this.name=Yr,this.events=new ht.exports.EventEmitter,this.initialized=!1,this.on=(i,n)=>this.events.on(i,n),this.once=(i,n)=>this.events.once(i,n),this.off=(i,n)=>this.events.off(i,n),this.removeListener=(i,n)=>this.events.removeListener(i,n),this.projectId=e?.projectId,this.relayUrl=e?.relayUrl||tn,this.customStoragePrefix=e!=null&&e.customStoragePrefix?`:${e.customStoragePrefix}`:"";const r=typeof e?.logger<"u"&&typeof e?.logger!="string"?e.logger:Ee.pino(Ee.getDefaultLoggerOptions({level:e?.logger||lo.logger}));this.logger=Ee.generateChildLogger(r,this.name),this.heartbeat=new qt.HeartBeat,this.crypto=new Vo(this,this.logger,e?.keychain),this.history=new wa(this,this.logger),this.expirer=new ma(this,this.logger),this.storage=e!=null&&e.storage?e.storage:new mc(Ta(Ta({},go),e?.storageOptions)),this.relayer=new ga({core:this,logger:this.logger,relayUrl:this.relayUrl,projectId:this.projectId}),this.pairing=new va(this,this.logger),this.verify=new Ea(this.projectId||"",this.logger),this.echoClient=new Sa(this.projectId||"",this.logger)}static async init(e){const r=new Qr(e);await r.initialize();const i=await r.crypto.getClientId();return await r.storage.setItem(Ao,i),r}get context(){return Ee.getLoggerContext(this.logger)}async start(){this.initialized||await this.initialize()}async initialize(){this.logger.trace("Initialized");try{await this.crypto.init(),await this.history.init(),await this.expirer.init(),await this.relayer.init(),await this.heartbeat.init(),await this.pairing.init(),this.initialized=!0,this.logger.info("Core Initialization Success")}catch(e){throw this.logger.warn(`Core Initialization Failure at epoch ${Date.now()}`,e),this.logger.error(e.message),e}}}const h0=Qr;q.CORE_CONTEXT=Yr,q.CORE_DEFAULT=lo,q.CORE_PROTOCOL=Zi,q.CORE_STORAGE_OPTIONS=go,q.CORE_STORAGE_PREFIX=Dt,q.CORE_VERSION=ho,q.CRYPTO_CLIENT_SEED=en,q.CRYPTO_CONTEXT=yo,q.CRYPTO_JWT_TTL=po,q.Core=h0,q.Crypto=Vo,q.ECHO_CONTEXT=Ko,q.ECHO_URL=Ho,q.EXPIRER_CONTEXT=Fo,q.EXPIRER_DEFAULT_TTL=Zd,q.EXPIRER_EVENTS=dt,q.EXPIRER_STORAGE_VERSION=Bo,q.EchoClient=Sa,q.Expirer=ma,q.HISTORY_CONTEXT=$o,q.HISTORY_EVENTS=bt,q.HISTORY_STORAGE_VERSION=jo,q.JsonRpcHistory=wa,q.KEYCHAIN_CONTEXT=_o,q.KEYCHAIN_STORAGE_VERSION=bo,q.KeyChain=Go,q.MESSAGES_CONTEXT=vo,q.MESSAGES_STORAGE_VERSION=wo,q.MessageTracker=qo,q.PAIRING_CONTEXT=Uo,q.PAIRING_DEFAULT_TTL=Qd,q.PAIRING_EVENTS=_r,q.PAIRING_RPC_OPTS=Qt,q.PAIRING_STORAGE_VERSION=Mo,q.PENDING_SUB_RESOLUTION_TIMEOUT=No,q.PUBLISHER_CONTEXT=Eo,q.PUBLISHER_DEFAULT_TTL=mo,q.Pairing=va,q.RELAYER_CONTEXT=Oo,q.RELAYER_DEFAULT_LOGGER=So,q.RELAYER_DEFAULT_PROTOCOL=Do,q.RELAYER_DEFAULT_RELAY_URL=tn,q.RELAYER_EVENTS=lt,q.RELAYER_FAILOVER_RELAY_URL=rn,q.RELAYER_PROVIDER_EVENTS=ct,q.RELAYER_RECONNECT_TIMEOUT=To,q.RELAYER_SDK_VERSION=xo,q.RELAYER_STORAGE_OPTIONS=Xd,q.RELAYER_SUBSCRIBER_SUFFIX=Io,q.RELAYER_TRANSPORT_CUTOFF=Ro,q.Relayer=ga,q.STORE_STORAGE_VERSION=Co,q.SUBSCRIBER_CONTEXT=Po,q.SUBSCRIBER_DEFAULT_TTL=Jd,q.SUBSCRIBER_EVENTS=_t,q.SUBSCRIBER_STORAGE_VERSION=Lo,q.Store=ba,q.Subscriber=ha,q.TRUSTED_VERIFY_URLS=zo,q.VERIFY_CONTEXT=kr,q.VERIFY_FALLBACK_SERVER=Xr,q.VERIFY_SERVER=Zt,q.Verify=Ea,q.WALLETCONNECT_CLIENT_ID=Ao,q.default=Qr,Object.defineProperty(q,"__esModule",{value:!0})});
//# sourceMappingURL=index.umd.js.map
